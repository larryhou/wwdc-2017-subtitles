[Script Info]
; Script generated by FFmpeg/Lavc57.89.100
ScriptType: v4.00+
PlayResX: 384
PlayResY: 288

[V4+ Styles]
Format: Name, Fontname, Fontsize, PrimaryColour, SecondaryColour, OutlineColour, BackColour, Bold, Italic, Underline, StrikeOut, ScaleX, ScaleY, Spacing, Angle, BorderStyle, Outline, Shadow, Alignment, MarginL, MarginR, MarginV, Encoding
Style: Default,Arial,16,&Hffffff,&Hffffff,&H0,&H0,0,0,0,0,100,100,0,0,1,1,0,2,10,10,10,0

[Events]
Format: Layer, Start, End, Style, Name, MarginL, MarginR, MarginV, Effect, Text
Dialogue: 0,0:00:30.62,0:00:31.70,Default,,0,0,0,,>> Good afternoon, everyone.
Dialogue: 0,0:00:31.87,0:00:32.70,Default,,0,0,0,,Thank you for being here.
Dialogue: 0,0:00:33.00,0:00:34.71,Default,,0,0,0,,Welcome to "What's New in
Dialogue: 0,0:00:34.71,0:00:35.06,Default,,0,0,0,,Health".
Dialogue: 0,0:00:35.51,0:00:36.39,Default,,0,0,0,,My name is Alexa.
Dialogue: 0,0:00:36.56,0:00:37.95,Default,,0,0,0,,I'm a software engineer on the
Dialogue: 0,0:00:37.95,0:00:40.04,Default,,0,0,0,,HealthKit Team and one of my
Dialogue: 0,0:00:40.04,0:00:41.51,Default,,0,0,0,,favorite parts of being on this
Dialogue: 0,0:00:41.51,0:00:43.36,Default,,0,0,0,,team is getting to see the ways
Dialogue: 0,0:00:43.36,0:00:44.49,Default,,0,0,0,,in which technology can help
Dialogue: 0,0:00:44.49,0:00:45.39,Default,,0,0,0,,people improve their lives.
Dialogue: 0,0:00:46.04,0:00:48.22,Default,,0,0,0,,Like many of our users, I've
Dialogue: 0,0:00:48.29,0:00:49.59,Default,,0,0,0,,absolutely loved getting to use
Dialogue: 0,0:00:49.59,0:00:51.52,Default,,0,0,0,,all fitness features on my Apple
Dialogue: 0,0:00:51.52,0:00:51.91,Default,,0,0,0,,Watch.
Dialogue: 0,0:00:52.53,0:00:53.98,Default,,0,0,0,,Getting to close my rings every
Dialogue: 0,0:00:53.98,0:00:55.48,Default,,0,0,0,,day and share my activity with
Dialogue: 0,0:00:55.48,0:00:55.99,Default,,0,0,0,,friends.
Dialogue: 0,0:00:55.99,0:00:57.51,Default,,0,0,0,,And really the integration with
Dialogue: 0,0:00:57.51,0:00:58.82,Default,,0,0,0,,all of your great fitness apps
Dialogue: 0,0:00:59.15,0:01:01.85,Default,,0,0,0,,have made it easier to get fit.
Dialogue: 0,0:01:02.43,0:01:04.24,Default,,0,0,0,,Many people also use technology
Dialogue: 0,0:01:04.24,0:01:05.24,Default,,0,0,0,,to help them track other
Dialogue: 0,0:01:05.24,0:01:06.17,Default,,0,0,0,,components of the well-being
Dialogue: 0,0:01:06.17,0:01:06.70,Default,,0,0,0,,like sleep.
Dialogue: 0,0:01:07.26,0:01:08.35,Default,,0,0,0,,Having a good understanding of
Dialogue: 0,0:01:08.35,0:01:09.85,Default,,0,0,0,,your sleep can help you be more
Dialogue: 0,0:01:09.85,0:01:11.77,Default,,0,0,0,,prepared for your day and get a
Dialogue: 0,0:01:11.77,0:01:13.77,Default,,0,0,0,,better night's rest.
Dialogue: 0,0:01:14.09,0:01:15.96,Default,,0,0,0,,However, many of our users also
Dialogue: 0,0:01:15.96,0:01:18.22,Default,,0,0,0,,rely on technology in ways that
Dialogue: 0,0:01:18.22,0:01:19.24,Default,,0,0,0,,we may not even think of.
Dialogue: 0,0:01:20.37,0:01:21.64,Default,,0,0,0,,For example, in managing a
Dialogue: 0,0:01:21.64,0:01:23.32,Default,,0,0,0,,chronic condition like diabetes
Dialogue: 0,0:01:23.93,0:01:27.95,Default,,0,0,0,,and on iOS and watchOS, the home
Dialogue: 0,0:01:27.95,0:01:29.47,Default,,0,0,0,,of all of this personal health
Dialogue: 0,0:01:29.74,0:01:30.89,Default,,0,0,0,,data is HealthKit.
Dialogue: 0,0:01:31.86,0:01:33.93,Default,,0,0,0,,So, we've seen that users have
Dialogue: 0,0:01:33.93,0:01:34.96,Default,,0,0,0,,really bought into our health
Dialogue: 0,0:01:34.96,0:01:36.06,Default,,0,0,0,,and wellness ecosystem.
Dialogue: 0,0:01:36.44,0:01:37.24,Default,,0,0,0,,And by innovating with
Dialogue: 0,0:01:37.24,0:01:38.57,Default,,0,0,0,,HealthKit, you're app can
Dialogue: 0,0:01:38.57,0:01:40.01,Default,,0,0,0,,immediately take advantage of
Dialogue: 0,0:01:40.01,0:01:41.45,Default,,0,0,0,,the guarantees of privacy,
Dialogue: 0,0:01:41.45,0:01:43.30,Default,,0,0,0,,transparency and control that we
Dialogue: 0,0:01:43.30,0:01:44.53,Default,,0,0,0,,aim to give all of our users.
Dialogue: 0,0:01:45.71,0:01:47.57,Default,,0,0,0,,So, in the next 60 minutes we'll
Dialogue: 0,0:01:47.57,0:01:49.35,Default,,0,0,0,,be going over what's new in our
Dialogue: 0,0:01:49.35,0:01:51.26,Default,,0,0,0,,SEK this year in iOS 11 and
Dialogue: 0,0:01:51.26,0:01:53.38,Default,,0,0,0,,watchOS 4 to help you continue
Dialogue: 0,0:01:53.38,0:01:54.50,Default,,0,0,0,,to create innovative health
Dialogue: 0,0:01:54.50,0:01:56.09,Default,,0,0,0,,technologies on Apple platforms.
Dialogue: 0,0:01:57.10,0:01:58.19,Default,,0,0,0,,Let's dive in.
Dialogue: 0,0:01:59.34,0:02:00.85,Default,,0,0,0,,So, first we'll go over a quick
Dialogue: 0,0:02:00.85,0:02:02.54,Default,,0,0,0,,tour of the new datatypes in
Dialogue: 0,0:02:02.54,0:02:03.40,Default,,0,0,0,,HealthKit this year.
Dialogue: 0,0:02:04.42,0:02:06.05,Default,,0,0,0,,After that, we'll cover some
Dialogue: 0,0:02:06.05,0:02:07.74,Default,,0,0,0,,general updates to our workout
Dialogue: 0,0:02:07.74,0:02:08.94,Default,,0,0,0,,API's to help build really great
Dialogue: 0,0:02:08.94,0:02:10.03,Default,,0,0,0,,fitness experiences.
Dialogue: 0,0:02:10.57,0:02:13.05,Default,,0,0,0,,After that we'll introduce sync
Dialogue: 0,0:02:13.05,0:02:14.83,Default,,0,0,0,,identifiers which are a new
Dialogue: 0,0:02:14.83,0:02:16.16,Default,,0,0,0,,feature to help you de-duplicate
Dialogue: 0,0:02:16.16,0:02:17.57,Default,,0,0,0,,data across multiple devices.
Dialogue: 0,0:02:18.17,0:02:20.21,Default,,0,0,0,,And finally, we have some
Dialogue: 0,0:02:20.21,0:02:21.55,Default,,0,0,0,,updates to share regarding our
Dialogue: 0,0:02:21.55,0:02:22.79,Default,,0,0,0,,support for users managing
Dialogue: 0,0:02:22.79,0:02:23.32,Default,,0,0,0,,diabetes.
Dialogue: 0,0:02:23.32,0:02:26.28,Default,,0,0,0,,So, let's get started with our
Dialogue: 0,0:02:26.28,0:02:27.23,Default,,0,0,0,,new HealthKit types.
Dialogue: 0,0:02:27.37,0:02:28.58,Default,,0,0,0,,So, if you've used HealthKit
Dialogue: 0,0:02:28.58,0:02:30.04,Default,,0,0,0,,before you'll know that we
Dialogue: 0,0:02:30.10,0:02:31.23,Default,,0,0,0,,categorize all of that personal
Dialogue: 0,0:02:31.23,0:02:32.63,Default,,0,0,0,,data into a bunch of different
Dialogue: 0,0:02:32.63,0:02:33.74,Default,,0,0,0,,types that you then save to
Dialogue: 0,0:02:33.74,0:02:34.15,Default,,0,0,0,,HealthKit.
Dialogue: 0,0:02:34.15,0:02:35.33,Default,,0,0,0,,And we have some new ones to
Dialogue: 0,0:02:35.33,0:02:36.10,Default,,0,0,0,,introduce this year.
Dialogue: 0,0:02:36.53,0:02:38.34,Default,,0,0,0,,I'm going to start with the
Dialogue: 0,0:02:38.34,0:02:39.11,Default,,0,0,0,,sample types.
Dialogue: 0,0:02:39.58,0:02:40.81,Default,,0,0,0,,So, samples that you save into
Dialogue: 0,0:02:40.81,0:02:42.49,Default,,0,0,0,,HealthKit are bits of data that
Dialogue: 0,0:02:42.49,0:02:44.04,Default,,0,0,0,,have particular timestamps and
Dialogue: 0,0:02:44.36,0:02:45.33,Default,,0,0,0,,are of a certain type.
Dialogue: 0,0:02:46.66,0:02:47.80,Default,,0,0,0,,The first new one that we have
Dialogue: 0,0:02:47.80,0:02:50.26,Default,,0,0,0,,this year, is HKWorkoutRoute.
Dialogue: 0,0:02:50.70,0:02:52.21,Default,,0,0,0,,So, workout routes let you save
Dialogue: 0,0:02:52.21,0:02:54.33,Default,,0,0,0,,a map of your colocation during
Dialogue: 0,0:02:54.33,0:02:54.77,Default,,0,0,0,,a workout.
Dialogue: 0,0:02:55.12,0:02:56.47,Default,,0,0,0,,And we will cover this in much
Dialogue: 0,0:02:56.47,0:02:59.35,Default,,0,0,0,,more detail later in the talk.
Dialogue: 0,0:02:59.94,0:03:01.29,Default,,0,0,0,,We are also introducing waist
Dialogue: 0,0:03:01.29,0:03:01.96,Default,,0,0,0,,circumference.
Dialogue: 0,0:03:02.30,0:03:03.41,Default,,0,0,0,,So, this is a body metric
Dialogue: 0,0:03:03.41,0:03:05.79,Default,,0,0,0,,similar to height or weight that
Dialogue: 0,0:03:05.79,0:03:07.16,Default,,0,0,0,,users can track over time to
Dialogue: 0,0:03:07.16,0:03:08.28,Default,,0,0,0,,understand changes to their
Dialogue: 0,0:03:08.28,0:03:08.59,Default,,0,0,0,,body.
Dialogue: 0,0:03:09.04,0:03:11.94,Default,,0,0,0,,Another body metric that we've
Dialogue: 0,0:03:11.97,0:03:13.83,Default,,0,0,0,,introduced this year is VO2 max.
Dialogue: 0,0:03:14.43,0:03:16.49,Default,,0,0,0,,So, VO2 max measures the maximum
Dialogue: 0,0:03:16.49,0:03:18.12,Default,,0,0,0,,rate of oxygen intake during
Dialogue: 0,0:03:18.12,0:03:18.91,Default,,0,0,0,,peak exercise.
Dialogue: 0,0:03:19.10,0:03:20.21,Default,,0,0,0,,And what's really cool about
Dialogue: 0,0:03:20.21,0:03:22.84,Default,,0,0,0,,this is on watchOS 4, the Apple
Dialogue: 0,0:03:22.84,0:03:25.15,Default,,0,0,0,,Watch can even estimate VO2 max
Dialogue: 0,0:03:25.48,0:03:26.85,Default,,0,0,0,,during certain outdoor walking
Dialogue: 0,0:03:26.85,0:03:27.49,Default,,0,0,0,,and running workouts.
Dialogue: 0,0:03:28.06,0:03:29.42,Default,,0,0,0,,So, with permission to do this
Dialogue: 0,0:03:29.42,0:03:31.35,Default,,0,0,0,,data, your app can see the VO2
Dialogue: 0,0:03:31.35,0:03:33.85,Default,,0,0,0,,max that was estimated by Apple
Dialogue: 0,0:03:33.85,0:03:34.21,Default,,0,0,0,,Watch.
Dialogue: 0,0:03:34.68,0:03:37.30,Default,,0,0,0,,And finally, one of our most
Dialogue: 0,0:03:37.30,0:03:38.46,Default,,0,0,0,,requested types in HealthKit,
Dialogue: 0,0:03:38.79,0:03:39.89,Default,,0,0,0,,this year we are introducing
Dialogue: 0,0:03:39.89,0:03:40.70,Default,,0,0,0,,insulin delivery.
Dialogue: 0,0:03:41.18,0:03:42.24,Default,,0,0,0,,My colleague Michael will cover
Dialogue: 0,0:03:42.24,0:03:42.52,Default,,0,0,0,,this [applause].
Dialogue: 0,0:03:46.98,0:03:47.95,Default,,0,0,0,,My colleague Michael will cover
Dialogue: 0,0:03:47.95,0:03:49.25,Default,,0,0,0,,this in much more detail later
Dialogue: 0,0:03:49.25,0:03:49.75,Default,,0,0,0,,in the talk.
Dialogue: 0,0:03:50.64,0:03:51.78,Default,,0,0,0,,So, along with these sample
Dialogue: 0,0:03:51.78,0:03:53.20,Default,,0,0,0,,types, we've also introduced
Dialogue: 0,0:03:53.20,0:03:54.65,Default,,0,0,0,,some new workout activity types.
Dialogue: 0,0:03:55.16,0:03:56.21,Default,,0,0,0,,So, these categorize the
Dialogue: 0,0:03:56.21,0:03:57.23,Default,,0,0,0,,different workouts your users
Dialogue: 0,0:03:57.23,0:03:58.04,Default,,0,0,0,,might be doing.
Dialogue: 0,0:03:58.32,0:04:00.58,Default,,0,0,0,,And we have a wide range of them
Dialogue: 0,0:04:00.58,0:04:02.22,Default,,0,0,0,,and they configure your workout
Dialogue: 0,0:04:02.53,0:04:03.42,Default,,0,0,0,,as well.
Dialogue: 0,0:04:04.02,0:04:04.81,Default,,0,0,0,,So, the first one we've
Dialogue: 0,0:04:04.81,0:04:06.23,Default,,0,0,0,,introduced this year is Tai Chi
Dialogue: 0,0:04:06.68,0:04:09.17,Default,,0,0,0,,as well as mixed cardio, and
Dialogue: 0,0:04:09.17,0:04:10.33,Default,,0,0,0,,finally hand cycling.
Dialogue: 0,0:04:10.63,0:04:11.59,Default,,0,0,0,,So, you can use these to build
Dialogue: 0,0:04:11.59,0:04:12.83,Default,,0,0,0,,even more encompassing fitness
Dialogue: 0,0:04:12.83,0:04:14.10,Default,,0,0,0,,experiences for your users.
Dialogue: 0,0:04:14.58,0:04:17.28,Default,,0,0,0,,Along with our new workout
Dialogue: 0,0:04:17.54,0:04:19.30,Default,,0,0,0,,activity types, we also have
Dialogue: 0,0:04:19.30,0:04:20.36,Default,,0,0,0,,some general updates to our
Dialogue: 0,0:04:20.36,0:04:20.90,Default,,0,0,0,,workout API.
Dialogue: 0,0:04:22.08,0:04:24.20,Default,,0,0,0,,So, some of these are tied to
Dialogue: 0,0:04:24.20,0:04:25.53,Default,,0,0,0,,our fall release where we
Dialogue: 0,0:04:25.53,0:04:26.71,Default,,0,0,0,,released the Apple Watch Series
Dialogue: 0,0:04:26.71,0:04:26.96,Default,,0,0,0,,2.
Dialogue: 0,0:04:27.20,0:04:28.35,Default,,0,0,0,,And some of this is new this
Dialogue: 0,0:04:28.35,0:04:30.04,Default,,0,0,0,,year in iOS 11 and watchOS 4.
Dialogue: 0,0:04:30.14,0:04:31.43,Default,,0,0,0,,So, we'll cover some updates
Dialogue: 0,0:04:31.43,0:04:32.22,Default,,0,0,0,,regarding swimming.
Dialogue: 0,0:04:32.56,0:04:34.71,Default,,0,0,0,,We'll talk about the new segment
Dialogue: 0,0:04:35.00,0:04:35.30,Default,,0,0,0,,API.
Dialogue: 0,0:04:35.30,0:04:36.80,Default,,0,0,0,,And we'll also talk about a new
Dialogue: 0,0:04:36.80,0:04:37.95,Default,,0,0,0,,way that your apps can pause and
Dialogue: 0,0:04:37.95,0:04:38.71,Default,,0,0,0,,resume workouts.
Dialogue: 0,0:04:39.64,0:04:42.05,Default,,0,0,0,,So, last fall we released the
Dialogue: 0,0:04:42.05,0:04:43.07,Default,,0,0,0,,Apple Watch Series 2.
Dialogue: 0,0:04:43.38,0:04:44.78,Default,,0,0,0,,And people have absolutely loved
Dialogue: 0,0:04:44.78,0:04:45.54,Default,,0,0,0,,getting to take their watch
Dialogue: 0,0:04:45.54,0:04:45.94,Default,,0,0,0,,swimming.
Dialogue: 0,0:04:46.56,0:04:47.99,Default,,0,0,0,,You can take it in the pool as
Dialogue: 0,0:04:47.99,0:04:49.26,Default,,0,0,0,,well as out in the ocean and
Dialogue: 0,0:04:49.26,0:04:49.63,Default,,0,0,0,,lakes.
Dialogue: 0,0:04:50.14,0:04:51.51,Default,,0,0,0,,And so, I'm going to start by
Dialogue: 0,0:04:51.82,0:04:52.94,Default,,0,0,0,,covering some of the types of
Dialogue: 0,0:04:52.94,0:04:54.89,Default,,0,0,0,,tracking that Apple Watch does
Dialogue: 0,0:04:54.89,0:04:56.44,Default,,0,0,0,,for swimming workouts, and then
Dialogue: 0,0:04:56.60,0:04:57.67,Default,,0,0,0,,dive into some of the new stuff
Dialogue: 0,0:04:57.67,0:04:58.06,Default,,0,0,0,,this year.
Dialogue: 0,0:04:59.38,0:05:01.28,Default,,0,0,0,,So firstly, as I mentioned we
Dialogue: 0,0:05:01.28,0:05:02.96,Default,,0,0,0,,have support for both pool and
Dialogue: 0,0:05:02.96,0:05:03.90,Default,,0,0,0,,open water swims.
Dialogue: 0,0:05:04.31,0:05:05.50,Default,,0,0,0,,And for pool swims you can
Dialogue: 0,0:05:05.50,0:05:06.99,Default,,0,0,0,,configure the lap length to get
Dialogue: 0,0:05:06.99,0:05:08.40,Default,,0,0,0,,the most accurate statistics
Dialogue: 0,0:05:08.40,0:05:10.41,Default,,0,0,0,,about the workout.
Dialogue: 0,0:05:10.88,0:05:12.54,Default,,0,0,0,,We also automatically track some
Dialogue: 0,0:05:12.54,0:05:13.64,Default,,0,0,0,,key swimming metrics.
Dialogue: 0,0:05:14.12,0:05:15.87,Default,,0,0,0,,The first of these are swimming
Dialogue: 0,0:05:15.87,0:05:18.10,Default,,0,0,0,,distance and swimming stroke
Dialogue: 0,0:05:18.10,0:05:18.35,Default,,0,0,0,,count.
Dialogue: 0,0:05:19.18,0:05:20.18,Default,,0,0,0,,So, if you're familiar with
Dialogue: 0,0:05:20.18,0:05:21.24,Default,,0,0,0,,HealthKit, you'll be aware of
Dialogue: 0,0:05:21.24,0:05:22.35,Default,,0,0,0,,how you would want to open a
Dialogue: 0,0:05:22.35,0:05:23.76,Default,,0,0,0,,query against certain samples
Dialogue: 0,0:05:23.76,0:05:24.72,Default,,0,0,0,,that you're interested in during
Dialogue: 0,0:05:24.72,0:05:25.13,Default,,0,0,0,,the workout.
Dialogue: 0,0:05:25.13,0:05:26.79,Default,,0,0,0,,For example, the calories the
Dialogue: 0,0:05:26.79,0:05:28.83,Default,,0,0,0,,user has burned or their heart
Dialogue: 0,0:05:28.83,0:05:30.29,Default,,0,0,0,,rate for that current time.
Dialogue: 0,0:05:31.07,0:05:32.40,Default,,0,0,0,,So, similarly, these two metrics
Dialogue: 0,0:05:32.69,0:05:34.18,Default,,0,0,0,,you'd want to open a query for
Dialogue: 0,0:05:34.18,0:05:34.94,Default,,0,0,0,,and track throughout the
Dialogue: 0,0:05:34.94,0:05:36.39,Default,,0,0,0,,workout, so you can display them
Dialogue: 0,0:05:36.39,0:05:37.10,Default,,0,0,0,,live to the user.
Dialogue: 0,0:05:38.17,0:05:40.68,Default,,0,0,0,,Apple Watch can also detect
Dialogue: 0,0:05:40.79,0:05:42.36,Default,,0,0,0,,individual laps as the user is
Dialogue: 0,0:05:42.36,0:05:43.45,Default,,0,0,0,,swimming in real time.
Dialogue: 0,0:05:44.32,0:05:46.14,Default,,0,0,0,,In addition, we even track the
Dialogue: 0,0:05:46.14,0:05:47.73,Default,,0,0,0,,stroke style per lap, which is
Dialogue: 0,0:05:47.73,0:05:48.88,Default,,0,0,0,,really cool and can help give
Dialogue: 0,0:05:49.18,0:05:51.52,Default,,0,0,0,,really up-to-date statistics
Dialogue: 0,0:05:51.52,0:05:52.17,Default,,0,0,0,,about the workout.
Dialogue: 0,0:05:53.77,0:05:55.19,Default,,0,0,0,,So, the stroke style detection
Dialogue: 0,0:05:55.47,0:05:57.42,Default,,0,0,0,,is stored as metadata on both
Dialogue: 0,0:05:57.42,0:05:59.56,Default,,0,0,0,,the stroke count sample, as well
Dialogue: 0,0:05:59.56,0:06:00.82,Default,,0,0,0,,as each lap event.
Dialogue: 0,0:06:01.17,0:06:02.06,Default,,0,0,0,,And we'll go over what that
Dialogue: 0,0:06:02.06,0:06:03.73,Default,,0,0,0,,looks like in a little bit.
Dialogue: 0,0:06:04.39,0:06:06.99,Default,,0,0,0,,New this year, in watchOS 4, we
Dialogue: 0,0:06:06.99,0:06:08.28,Default,,0,0,0,,also have automatic set
Dialogue: 0,0:06:08.31,0:06:08.87,Default,,0,0,0,,detection.
Dialogue: 0,0:06:09.33,0:06:10.86,Default,,0,0,0,,So, this is HealthKit detecting
Dialogue: 0,0:06:10.86,0:06:11.91,Default,,0,0,0,,the time in which the user was
Dialogue: 0,0:06:11.91,0:06:13.40,Default,,0,0,0,,swimming continuously and
Dialogue: 0,0:06:13.43,0:06:14.44,Default,,0,0,0,,highlighting that to the user.
Dialogue: 0,0:06:14.87,0:06:15.96,Default,,0,0,0,,And your apps will have access
Dialogue: 0,0:06:15.96,0:06:18.77,Default,,0,0,0,,to that information as well.
Dialogue: 0,0:06:18.77,0:06:20.52,Default,,0,0,0,,Also, new this year, in watchOS
Dialogue: 0,0:06:20.55,0:06:23.87,Default,,0,0,0,,4, your apps can now enable
Dialogue: 0,0:06:23.87,0:06:24.40,Default,,0,0,0,,Water lock.
Dialogue: 0,0:06:24.76,0:06:26.13,Default,,0,0,0,,So, this is a really great
Dialogue: 0,0:06:26.13,0:06:28.02,Default,,0,0,0,,feature that allows your app to
Dialogue: 0,0:06:28.02,0:06:29.53,Default,,0,0,0,,ignore any input from water on
Dialogue: 0,0:06:29.53,0:06:30.01,Default,,0,0,0,,the screen.
Dialogue: 0,0:06:30.32,0:06:31.67,Default,,0,0,0,,Which is really great to get a
Dialogue: 0,0:06:31.67,0:06:33.03,Default,,0,0,0,,consistent user experience.
Dialogue: 0,0:06:33.16,0:06:34.64,Default,,0,0,0,,When the user wants to exit
Dialogue: 0,0:06:34.64,0:06:36.01,Default,,0,0,0,,Water lock, all they need to do
Dialogue: 0,0:06:36.01,0:06:37.47,Default,,0,0,0,,is simply twist digital crown on
Dialogue: 0,0:06:37.47,0:06:39.89,Default,,0,0,0,,their watch and it'll eject the
Dialogue: 0,0:06:39.89,0:06:40.87,Default,,0,0,0,,water through the speakers by
Dialogue: 0,0:06:40.87,0:06:42.05,Default,,0,0,0,,displaying a custom sound.
Dialogue: 0,0:06:42.86,0:06:45.57,Default,,0,0,0,,So, now let's dig in by going
Dialogue: 0,0:06:45.57,0:06:46.68,Default,,0,0,0,,over some of the new metadata
Dialogue: 0,0:06:46.68,0:06:47.97,Default,,0,0,0,,keys and values that we
Dialogue: 0,0:06:47.97,0:06:49.04,Default,,0,0,0,,introduced along with swimming.
Dialogue: 0,0:06:50.44,0:06:51.79,Default,,0,0,0,,As I said, we have location
Dialogue: 0,0:06:51.79,0:06:51.99,Default,,0,0,0,,type.
Dialogue: 0,0:06:51.99,0:06:54.40,Default,,0,0,0,,And this is both pool open
Dialogue: 0,0:06:54.40,0:06:57.16,Default,,0,0,0,,water, as well as unknown.
Dialogue: 0,0:06:57.25,0:06:58.91,Default,,0,0,0,,We also have the swimming stroke
Dialogue: 0,0:06:58.91,0:07:01.98,Default,,0,0,0,,style, which is common styles
Dialogue: 0,0:07:01.98,0:07:03.78,Default,,0,0,0,,like freestyle and backstroke as
Dialogue: 0,0:07:03.83,0:07:06.45,Default,,0,0,0,,well as unknown or mixed.
Dialogue: 0,0:07:08.06,0:07:10.19,Default,,0,0,0,,So, now let's say you want to
Dialogue: 0,0:07:10.19,0:07:11.48,Default,,0,0,0,,build a swimming app and you
Dialogue: 0,0:07:11.48,0:07:12.47,Default,,0,0,0,,want to know how to start out
Dialogue: 0,0:07:12.47,0:07:12.96,Default,,0,0,0,,with HealthKit.
Dialogue: 0,0:07:13.40,0:07:14.32,Default,,0,0,0,,So, the first step is going to
Dialogue: 0,0:07:14.32,0:07:15.51,Default,,0,0,0,,be to configure a swimming
Dialogue: 0,0:07:15.51,0:07:15.83,Default,,0,0,0,,workout.
Dialogue: 0,0:07:16.14,0:07:17.11,Default,,0,0,0,,Let's say in this case we're
Dialogue: 0,0:07:17.11,0:07:18.58,Default,,0,0,0,,doing a pool swim workout.
Dialogue: 0,0:07:19.24,0:07:20.30,Default,,0,0,0,,So, first we'd want to create
Dialogue: 0,0:07:20.30,0:07:21.91,Default,,0,0,0,,our HK workoutConfiguration
Dialogue: 0,0:07:21.95,0:07:22.24,Default,,0,0,0,,object.
Dialogue: 0,0:07:23.59,0:07:24.46,Default,,0,0,0,,Next, we want to set some
Dialogue: 0,0:07:24.46,0:07:25.19,Default,,0,0,0,,properties on it.
Dialogue: 0,0:07:25.31,0:07:26.51,Default,,0,0,0,,Firstly, the activity type to
Dialogue: 0,0:07:26.51,0:07:26.96,Default,,0,0,0,,swimming.
Dialogue: 0,0:07:28.26,0:07:29.78,Default,,0,0,0,,The swimming location type.
Dialogue: 0,0:07:29.84,0:07:31.12,Default,,0,0,0,,We said we're going for a pool
Dialogue: 0,0:07:31.12,0:07:31.43,Default,,0,0,0,,swim.
Dialogue: 0,0:07:32.10,0:07:33.87,Default,,0,0,0,,And then the lap length.
Dialogue: 0,0:07:33.87,0:07:35.07,Default,,0,0,0,,In this case I'm setting it to
Dialogue: 0,0:07:35.18,0:07:36.97,Default,,0,0,0,,the HK quantity of 25 yards,
Dialogue: 0,0:07:37.04,0:07:37.95,Default,,0,0,0,,which is a pretty common pool
Dialogue: 0,0:07:37.95,0:07:38.37,Default,,0,0,0,,length.
Dialogue: 0,0:07:39.49,0:07:41.19,Default,,0,0,0,,Next, we want to start our
Dialogue: 0,0:07:41.19,0:07:42.77,Default,,0,0,0,,session by creating a session
Dialogue: 0,0:07:42.77,0:07:44.05,Default,,0,0,0,,object and then passing it to
Dialogue: 0,0:07:44.05,0:07:44.69,Default,,0,0,0,,the healthStore.
Dialogue: 0,0:07:46.10,0:07:47.50,Default,,0,0,0,,So, first we're going to create
Dialogue: 0,0:07:47.50,0:07:49.46,Default,,0,0,0,,our workout session and pass in
Dialogue: 0,0:07:49.46,0:07:50.30,Default,,0,0,0,,the configuration.
Dialogue: 0,0:07:50.78,0:07:51.86,Default,,0,0,0,,And you'll note here that the
Dialogue: 0,0:07:51.86,0:07:53.52,Default,,0,0,0,,initializer for HK Workout
Dialogue: 0,0:07:53.52,0:07:54.92,Default,,0,0,0,,session could throw.
Dialogue: 0,0:07:55.31,0:07:56.49,Default,,0,0,0,,It would throw in the case that
Dialogue: 0,0:07:56.49,0:07:57.89,Default,,0,0,0,,you pass an invalid workout
Dialogue: 0,0:07:57.89,0:07:58.59,Default,,0,0,0,,configuration.
Dialogue: 0,0:07:58.93,0:08:00.01,Default,,0,0,0,,For example, if you try to set
Dialogue: 0,0:08:00.01,0:08:01.76,Default,,0,0,0,,the lap length on an open water
Dialogue: 0,0:08:01.76,0:08:02.11,Default,,0,0,0,,swim.
Dialogue: 0,0:08:02.68,0:08:03.71,Default,,0,0,0,,So, be sure to handle that in
Dialogue: 0,0:08:03.71,0:08:04.14,Default,,0,0,0,,your code.
Dialogue: 0,0:08:04.54,0:08:06.77,Default,,0,0,0,,Next, we're going to set the
Dialogue: 0,0:08:07.05,0:08:08.85,Default,,0,0,0,,delegate of the workout session
Dialogue: 0,0:08:08.91,0:08:10.02,Default,,0,0,0,,to be ourselves so that we can
Dialogue: 0,0:08:10.02,0:08:11.45,Default,,0,0,0,,receive callbacks from HealthKit
Dialogue: 0,0:08:11.75,0:08:13.64,Default,,0,0,0,,as swimming events happen.
Dialogue: 0,0:08:14.52,0:08:16.20,Default,,0,0,0,,Finally, we're going to actually
Dialogue: 0,0:08:16.20,0:08:17.54,Default,,0,0,0,,start the session by calling the
Dialogue: 0,0:08:17.63,0:08:19.39,Default,,0,0,0,,start method on healthStore and
Dialogue: 0,0:08:19.39,0:08:20.45,Default,,0,0,0,,passing in the session we just
Dialogue: 0,0:08:20.50,0:08:20.91,Default,,0,0,0,,created.
Dialogue: 0,0:08:22.08,0:08:23.28,Default,,0,0,0,,So now, great.
Dialogue: 0,0:08:23.28,0:08:24.59,Default,,0,0,0,,Our swimming session is ongoing.
Dialogue: 0,0:08:24.83,0:08:26.14,Default,,0,0,0,,Maybe we also want to enable
Dialogue: 0,0:08:26.14,0:08:27.22,Default,,0,0,0,,water lock for this workout.
Dialogue: 0,0:08:27.56,0:08:30.21,Default,,0,0,0,,So, a good place to do that is
Dialogue: 0,0:08:30.21,0:08:31.51,Default,,0,0,0,,when our workout session changes
Dialogue: 0,0:08:31.51,0:08:32.52,Default,,0,0,0,,state to start running.
Dialogue: 0,0:08:32.96,0:08:34.09,Default,,0,0,0,,This is because this API will
Dialogue: 0,0:08:34.09,0:08:35.88,Default,,0,0,0,,only work if you have an active
Dialogue: 0,0:08:36.14,0:08:38.19,Default,,0,0,0,,workout, or a location session
Dialogue: 0,0:08:38.19,0:08:39.83,Default,,0,0,0,,ongoing, and if you're in the
Dialogue: 0,0:08:39.83,0:08:40.35,Default,,0,0,0,,foreground.
Dialogue: 0,0:08:40.92,0:08:42.23,Default,,0,0,0,,So, let's look at this method.
Dialogue: 0,0:08:42.23,0:08:43.79,Default,,0,0,0,,Workout session did change to
Dialogue: 0,0:08:43.79,0:08:45.29,Default,,0,0,0,,from state date.
Dialogue: 0,0:08:45.72,0:08:48.11,Default,,0,0,0,,We're going to switch on the
Dialogue: 0,0:08:48.11,0:08:49.59,Default,,0,0,0,,from state to the to state.
Dialogue: 0,0:08:50.20,0:08:51.55,Default,,0,0,0,,In this case, we're interested
Dialogue: 0,0:08:51.55,0:08:53.28,Default,,0,0,0,,in not started, switching to
Dialogue: 0,0:08:53.28,0:08:54.39,Default,,0,0,0,,running, which is how we know
Dialogue: 0,0:08:54.39,0:08:55.41,Default,,0,0,0,,that our session has begun.
Dialogue: 0,0:08:56.37,0:08:57.69,Default,,0,0,0,,So, here's where we're going to
Dialogue: 0,0:08:57.69,0:08:59.71,Default,,0,0,0,,want to grab the shared WatchKit
Dialogue: 0,0:08:59.71,0:09:01.48,Default,,0,0,0,,extension and then call enable
Dialogue: 0,0:09:01.48,0:09:02.77,Default,,0,0,0,,water lock on it.
Dialogue: 0,0:09:04.38,0:09:06.54,Default,,0,0,0,,So, along with the changes to
Dialogue: 0,0:09:06.54,0:09:08.72,Default,,0,0,0,,our swimming data types, we also
Dialogue: 0,0:09:08.81,0:09:10.41,Default,,0,0,0,,have some changes to our workout
Dialogue: 0,0:09:10.41,0:09:11.54,Default,,0,0,0,,events to better support
Dialogue: 0,0:09:11.54,0:09:13.47,Default,,0,0,0,,swimming as well as more nuance
Dialogue: 0,0:09:13.47,0:09:14.73,Default,,0,0,0,,workout experiences in general.
Dialogue: 0,0:09:14.91,0:09:15.98,Default,,0,0,0,,So, let's start with just an
Dialogue: 0,0:09:15.98,0:09:17.50,Default,,0,0,0,,overview of HKWorkoutEvent.
Dialogue: 0,0:09:19.10,0:09:20.62,Default,,0,0,0,,So, WorkoutEvents highlight a
Dialogue: 0,0:09:20.62,0:09:21.77,Default,,0,0,0,,specific time of interest in
Dialogue: 0,0:09:21.77,0:09:22.28,Default,,0,0,0,,your workout.
Dialogue: 0,0:09:22.53,0:09:24.86,Default,,0,0,0,,That can be used for pausing and
Dialogue: 0,0:09:24.86,0:09:26.22,Default,,0,0,0,,resuming, as well as things like
Dialogue: 0,0:09:26.32,0:09:28.08,Default,,0,0,0,,laps and markers.
Dialogue: 0,0:09:28.08,0:09:29.26,Default,,0,0,0,,And markers can really be
Dialogue: 0,0:09:29.26,0:09:30.59,Default,,0,0,0,,anything arbitrary set by your
Dialogue: 0,0:09:30.59,0:09:32.03,Default,,0,0,0,,application, and you can store
Dialogue: 0,0:09:32.03,0:09:33.52,Default,,0,0,0,,data on the metadata of the
Dialogue: 0,0:09:33.76,0:09:35.28,Default,,0,0,0,,event to store what you need for
Dialogue: 0,0:09:36.07,0:09:37.44,Default,,0,0,0,,your purpose.
Dialogue: 0,0:09:37.71,0:09:38.92,Default,,0,0,0,,Events are created by both
Dialogue: 0,0:09:38.92,0:09:40.15,Default,,0,0,0,,HealthKit and your app.
Dialogue: 0,0:09:40.84,0:09:41.95,Default,,0,0,0,,And this is key because
Dialogue: 0,0:09:41.95,0:09:43.28,Default,,0,0,0,,HealthKit will create events and
Dialogue: 0,0:09:43.28,0:09:44.08,Default,,0,0,0,,then pass them to you
Dialogue: 0,0:09:44.08,0:09:44.60,Default,,0,0,0,,immediately.
Dialogue: 0,0:09:44.60,0:09:45.67,Default,,0,0,0,,So, that's how you'll find
Dialogue: 0,0:09:45.67,0:09:47.53,Default,,0,0,0,,information about laps, and
Dialogue: 0,0:09:47.53,0:09:48.39,Default,,0,0,0,,strokes style and that for
Dialogue: 0,0:09:48.39,0:09:49.98,Default,,0,0,0,,swimming as well as pausing and
Dialogue: 0,0:09:49.98,0:09:51.19,Default,,0,0,0,,resuming through general workout
Dialogue: 0,0:09:52.09,0:09:52.20,Default,,0,0,0,,apps.
Dialogue: 0,0:09:52.72,0:09:55.00,Default,,0,0,0,,And WorkoutEvents are saved on a
Dialogue: 0,0:09:55.00,0:09:57.26,Default,,0,0,0,,list on HKWorkout.
Dialogue: 0,0:09:57.61,0:09:58.46,Default,,0,0,0,,And so, you'll get them back
Dialogue: 0,0:09:58.75,0:09:59.42,Default,,0,0,0,,when you're querying for
Dialogue: 0,0:09:59.42,0:09:59.86,Default,,0,0,0,,workouts.
Dialogue: 0,0:09:59.93,0:10:00.81,Default,,0,0,0,,Of, if you're looking at
Dialogue: 0,0:10:00.81,0:10:01.55,Default,,0,0,0,,workouts from other
Dialogue: 0,0:10:01.55,0:10:02.18,Default,,0,0,0,,applications.
Dialogue: 0,0:10:04.40,0:10:05.57,Default,,0,0,0,,In addition, workout events
Dialogue: 0,0:10:05.57,0:10:06.95,Default,,0,0,0,,affect the workout's duration.
Dialogue: 0,0:10:07.54,0:10:09.72,Default,,0,0,0,,Specifically, pause and resume
Dialogue: 0,0:10:09.72,0:10:10.11,Default,,0,0,0,,events.
Dialogue: 0,0:10:10.40,0:10:11.83,Default,,0,0,0,,So, if I go for a 10-minute run
Dialogue: 0,0:10:12.15,0:10:13.16,Default,,0,0,0,,and I pause for a minute,
Dialogue: 0,0:10:13.70,0:10:14.67,Default,,0,0,0,,HealthKit will see that there's
Dialogue: 0,0:10:14.67,0:10:15.94,Default,,0,0,0,,a pause event followed by a
Dialogue: 0,0:10:15.94,0:10:17.56,Default,,0,0,0,,resume event a minute later and
Dialogue: 0,0:10:17.56,0:10:18.96,Default,,0,0,0,,calculate the total duration to
Dialogue: 0,0:10:18.96,0:10:20.48,Default,,0,0,0,,be 9 minutes, just as we would
Dialogue: 0,0:10:20.48,0:10:20.70,Default,,0,0,0,,expect.
Dialogue: 0,0:10:22.19,0:10:23.74,Default,,0,0,0,,So, let's take a look at how we
Dialogue: 0,0:10:23.74,0:10:25.53,Default,,0,0,0,,can observe lap events back in
Dialogue: 0,0:10:25.53,0:10:26.40,Default,,0,0,0,,my swimming example.
Dialogue: 0,0:10:27.21,0:10:29.80,Default,,0,0,0,,So, we have this method, workout
Dialogue: 0,0:10:29.80,0:10:31.19,Default,,0,0,0,,session did generate event.
Dialogue: 0,0:10:31.66,0:10:32.58,Default,,0,0,0,,And that's where HealthKit is
Dialogue: 0,0:10:32.58,0:10:33.70,Default,,0,0,0,,going to pass through events as
Dialogue: 0,0:10:33.70,0:10:34.67,Default,,0,0,0,,the workout is ongoing.
Dialogue: 0,0:10:35.76,0:10:36.91,Default,,0,0,0,,So, we're going to switch on the
Dialogue: 0,0:10:37.06,0:10:38.07,Default,,0,0,0,,type of event that's given to
Dialogue: 0,0:10:38.07,0:10:38.43,Default,,0,0,0,,us.
Dialogue: 0,0:10:39.72,0:10:40.46,Default,,0,0,0,,In this case, what we're
Dialogue: 0,0:10:40.46,0:10:43.00,Default,,0,0,0,,interested in is laps.
Dialogue: 0,0:10:43.50,0:10:44.93,Default,,0,0,0,,So, now that we have our lap
Dialogue: 0,0:10:44.93,0:10:46.20,Default,,0,0,0,,event, we do something specific
Dialogue: 0,0:10:46.20,0:10:47.80,Default,,0,0,0,,to our app, like maybe increment
Dialogue: 0,0:10:47.80,0:10:48.74,Default,,0,0,0,,a count, so we can display it
Dialogue: 0,0:10:48.74,0:10:49.54,Default,,0,0,0,,live to the user.
Dialogue: 0,0:10:50.38,0:10:52.46,Default,,0,0,0,,We can also grab the stroke
Dialogue: 0,0:10:52.46,0:10:53.80,Default,,0,0,0,,style off of this lap event.
Dialogue: 0,0:10:54.29,0:10:55.40,Default,,0,0,0,,So, the stroke style is stored
Dialogue: 0,0:10:55.40,0:10:56.09,Default,,0,0,0,,as metadata.
Dialogue: 0,0:10:56.53,0:10:57.98,Default,,0,0,0,,We want to get the metadata for
Dialogue: 0,0:10:57.98,0:10:59.46,Default,,0,0,0,,the key swimming stroke style
Dialogue: 0,0:10:59.75,0:11:00.76,Default,,0,0,0,,and then again we can do
Dialogue: 0,0:11:00.76,0:11:02.58,Default,,0,0,0,,something specific like display
Dialogue: 0,0:11:02.58,0:11:03.67,Default,,0,0,0,,the current stroke style back to
Dialogue: 0,0:11:03.76,0:11:04.21,Default,,0,0,0,,the user.
Dialogue: 0,0:11:04.41,0:11:07.21,Default,,0,0,0,,So, as you can see, this can
Dialogue: 0,0:11:07.21,0:11:08.65,Default,,0,0,0,,help you build really detailed
Dialogue: 0,0:11:08.65,0:11:09.95,Default,,0,0,0,,experiences that your user can
Dialogue: 0,0:11:10.02,0:11:11.23,Default,,0,0,0,,access really quickly right from
Dialogue: 0,0:11:11.23,0:11:12.33,Default,,0,0,0,,their wrist.
Dialogue: 0,0:11:13.44,0:11:15.05,Default,,0,0,0,,So, we also have some new
Dialogue: 0,0:11:15.05,0:11:16.65,Default,,0,0,0,,WorkoutEvents this year in iOS
Dialogue: 0,0:11:16.65,0:11:17.70,Default,,0,0,0,,11 and watchOS 4.
Dialogue: 0,0:11:18.37,0:11:20.93,Default,,0,0,0,,So, here's our existing
Dialogue: 0,0:11:20.93,0:11:22.25,Default,,0,0,0,,WorkoutEvent type Enum.
Dialogue: 0,0:11:22.80,0:11:24.72,Default,,0,0,0,,And new this year, we've added
Dialogue: 0,0:11:24.72,0:11:26.15,Default,,0,0,0,,segments and pause and resume.
Dialogue: 0,0:11:26.79,0:11:27.83,Default,,0,0,0,,So, both of these new types have
Dialogue: 0,0:11:27.83,0:11:28.79,Default,,0,0,0,,important implications for
Dialogue: 0,0:11:28.79,0:11:30.14,Default,,0,0,0,,swimming, but they can also be
Dialogue: 0,0:11:30.14,0:11:31.26,Default,,0,0,0,,used for all workout apps in
Dialogue: 0,0:11:31.26,0:11:31.55,Default,,0,0,0,,general.
Dialogue: 0,0:11:31.94,0:11:34.77,Default,,0,0,0,,We'll start with talking about
Dialogue: 0,0:11:34.82,0:11:35.27,Default,,0,0,0,,segments.
Dialogue: 0,0:11:35.69,0:11:36.96,Default,,0,0,0,,So, rather than representing
Dialogue: 0,0:11:36.96,0:11:38.01,Default,,0,0,0,,just a moment in time.
Dialogue: 0,0:11:38.34,0:11:39.98,Default,,0,0,0,,Segments can represent a moment
Dialogue: 0,0:11:39.98,0:11:40.81,Default,,0,0,0,,and a duration.
Dialogue: 0,0:11:41.77,0:11:42.86,Default,,0,0,0,,And so, this has caused us to
Dialogue: 0,0:11:42.86,0:11:44.48,Default,,0,0,0,,update our existing WorkoutEvent
Dialogue: 0,0:11:44.48,0:11:46.44,Default,,0,0,0,,class; whereas previously we had
Dialogue: 0,0:11:46.44,0:11:48.81,Default,,0,0,0,,a date property, we've
Dialogue: 0,0:11:48.81,0:11:50.05,Default,,0,0,0,,deprecated that in favor of a
Dialogue: 0,0:11:50.05,0:11:51.14,Default,,0,0,0,,date interval property.
Dialogue: 0,0:11:51.58,0:11:53.18,Default,,0,0,0,,So, for all previous events
Dialogue: 0,0:11:53.18,0:11:54.90,Default,,0,0,0,,saved to HealthKit, the date
Dialogue: 0,0:11:55.21,0:11:56.59,Default,,0,0,0,,will now be the start date of
Dialogue: 0,0:11:56.59,0:11:57.74,Default,,0,0,0,,the state interval, and they
Dialogue: 0,0:11:57.74,0:11:58.90,Default,,0,0,0,,would have a duration of 0.
Dialogue: 0,0:11:59.88,0:12:01.16,Default,,0,0,0,,For segments, however, you would
Dialogue: 0,0:12:01.16,0:12:02.66,Default,,0,0,0,,have both a start data and a
Dialogue: 0,0:12:02.66,0:12:04.37,Default,,0,0,0,,duration, or equivalently a
Dialogue: 0,0:12:04.37,0:12:05.57,Default,,0,0,0,,start date and an end date on
Dialogue: 0,0:12:05.57,0:12:06.32,Default,,0,0,0,,that date interval.
Dialogue: 0,0:12:06.97,0:12:08.32,Default,,0,0,0,,So, I want to show you a
Dialogue: 0,0:12:08.32,0:12:09.55,Default,,0,0,0,,timeline of what this would look
Dialogue: 0,0:12:09.55,0:12:10.64,Default,,0,0,0,,like for a typical swimming
Dialogue: 0,0:12:10.64,0:12:12.24,Default,,0,0,0,,workout and all of these events
Dialogue: 0,0:12:12.24,0:12:13.44,Default,,0,0,0,,you can get in your application
Dialogue: 0,0:12:13.53,0:12:16.41,Default,,0,0,0,,as they happen with your workout
Dialogue: 0,0:12:17.28,0:12:17.59,Default,,0,0,0,,session.
Dialogue: 0,0:12:17.92,0:12:19.44,Default,,0,0,0,,So, first we start our workout.
Dialogue: 0,0:12:20.27,0:12:21.97,Default,,0,0,0,,And our user begins swimming.
Dialogue: 0,0:12:22.49,0:12:23.61,Default,,0,0,0,,Each of these grey dots
Dialogue: 0,0:12:23.61,0:12:25.36,Default,,0,0,0,,represents a lap event as the
Dialogue: 0,0:12:25.36,0:12:26.91,Default,,0,0,0,,user is swimming if we take a
Dialogue: 0,0:12:26.91,0:12:28.25,Default,,0,0,0,,look at a particular lap event,
Dialogue: 0,0:12:28.25,0:12:29.19,Default,,0,0,0,,you'll see that the type of
Dialogue: 0,0:12:29.19,0:12:30.09,Default,,0,0,0,,event is lap.
Dialogue: 0,0:12:30.67,0:12:32.90,Default,,0,0,0,,It has date interval, in this
Dialogue: 0,0:12:32.94,0:12:34.50,Default,,0,0,0,,case just the start date of 2.
Dialogue: 0,0:12:34.78,0:12:36.68,Default,,0,0,0,,And then it has on the metadata
Dialogue: 0,0:12:36.68,0:12:37.34,Default,,0,0,0,,the stroke style.
Dialogue: 0,0:12:37.63,0:12:38.89,Default,,0,0,0,,So, our user's doing a freestyle
Dialogue: 0,0:12:38.95,0:12:39.23,Default,,0,0,0,,stroke.
Dialogue: 0,0:12:39.86,0:12:42.72,Default,,0,0,0,,The user continues swimming and
Dialogue: 0,0:12:42.72,0:12:43.84,Default,,0,0,0,,decides to switch stroke style
Dialogue: 0,0:12:43.84,0:12:44.37,Default,,0,0,0,,to butterfly.
Dialogue: 0,0:12:44.85,0:12:45.72,Default,,0,0,0,,This will be reflected
Dialogue: 0,0:12:45.72,0:12:47.27,Default,,0,0,0,,immediately in the next lap
Dialogue: 0,0:12:47.27,0:12:48.54,Default,,0,0,0,,event your application receives.
Dialogue: 0,0:12:50.02,0:12:51.82,Default,,0,0,0,,The user might then decide to
Dialogue: 0,0:12:51.82,0:12:53.66,Default,,0,0,0,,pause their workout and you'll
Dialogue: 0,0:12:53.66,0:12:54.83,Default,,0,0,0,,get an event for that pause as
Dialogue: 0,0:12:54.83,0:12:55.13,Default,,0,0,0,,well.
Dialogue: 0,0:12:55.29,0:12:56.47,Default,,0,0,0,,In this case, you have no
Dialogue: 0,0:12:56.47,0:12:57.64,Default,,0,0,0,,metadata on the pause event.
Dialogue: 0,0:12:57.90,0:12:59.41,Default,,0,0,0,,And you also have just the start
Dialogue: 0,0:12:59.41,0:13:01.13,Default,,0,0,0,,date and no duration to your
Dialogue: 0,0:13:01.69,0:13:02.77,Default,,0,0,0,,date interval.
Dialogue: 0,0:13:03.30,0:13:04.90,Default,,0,0,0,,Now, in watchOS 4, HealthKit
Dialogue: 0,0:13:04.90,0:13:06.49,Default,,0,0,0,,will actually generate the auto
Dialogue: 0,0:13:06.49,0:13:08.13,Default,,0,0,0,,set detection for this
Dialogue: 0,0:13:08.13,0:13:09.49,Default,,0,0,0,,particular swimming workout for
Dialogue: 0,0:13:09.49,0:13:10.55,Default,,0,0,0,,the time in which the user was
Dialogue: 0,0:13:10.55,0:13:11.60,Default,,0,0,0,,swimming continuously.
Dialogue: 0,0:13:12.19,0:13:14.12,Default,,0,0,0,,So, this segment event has both
Dialogue: 0,0:13:14.12,0:13:16.22,Default,,0,0,0,,the start date of 0 and it ends
Dialogue: 0,0:13:16.22,0:13:18.13,Default,,0,0,0,,at 3:30 and the user has paused.
Dialogue: 0,0:13:18.44,0:13:19.91,Default,,0,0,0,,And it doesn't have any metadata
Dialogue: 0,0:13:19.91,0:13:22.78,Default,,0,0,0,,on it in this case.
Dialogue: 0,0:13:22.88,0:13:23.99,Default,,0,0,0,,Now, the user resumes their work
Dialogue: 0,0:13:23.99,0:13:24.86,Default,,0,0,0,,out again, and we receive an
Dialogue: 0,0:13:24.86,0:13:25.44,Default,,0,0,0,,event for that.
Dialogue: 0,0:13:25.44,0:13:27.91,Default,,0,0,0,,And they begin swimming back to
Dialogue: 0,0:13:27.91,0:13:28.42,Default,,0,0,0,,freestyle.
Dialogue: 0,0:13:29.25,0:13:30.55,Default,,0,0,0,,Now, at this point we're like
Dialogue: 0,0:13:30.55,0:13:32.34,Default,,0,0,0,,six 30 minutes in and our user
Dialogue: 0,0:13:32.34,0:13:33.45,Default,,0,0,0,,gets tired and they decide to
Dialogue: 0,0:13:33.45,0:13:34.89,Default,,0,0,0,,stop at the edge of the pool and
Dialogue: 0,0:13:34.89,0:13:36.31,Default,,0,0,0,,take a breath, but they forget
Dialogue: 0,0:13:36.31,0:13:37.64,Default,,0,0,0,,to actually pause their workout.
Dialogue: 0,0:13:38.20,0:13:40.39,Default,,0,0,0,,However, HealthKit will still
Dialogue: 0,0:13:40.39,0:13:41.65,Default,,0,0,0,,generate an event for the time
Dialogue: 0,0:13:41.65,0:13:42.56,Default,,0,0,0,,in which the user was swimming
Dialogue: 0,0:13:42.56,0:13:43.26,Default,,0,0,0,,continuously.
Dialogue: 0,0:13:43.65,0:13:45.18,Default,,0,0,0,,So, there will be a segment from
Dialogue: 0,0:13:45.18,0:13:46.68,Default,,0,0,0,,when they resumed the workout to
Dialogue: 0,0:13:46.68,0:13:47.64,Default,,0,0,0,,when they stopped actively
Dialogue: 0,0:13:47.64,0:13:48.06,Default,,0,0,0,,swimming.
Dialogue: 0,0:13:48.59,0:13:51.25,Default,,0,0,0,,Our user begins swimming again,
Dialogue: 0,0:13:51.25,0:13:51.85,Default,,0,0,0,,once they've caught their
Dialogue: 0,0:13:51.85,0:13:52.15,Default,,0,0,0,,breath.
Dialogue: 0,0:13:52.95,0:13:55.24,Default,,0,0,0,,And HealthKit generates a final
Dialogue: 0,0:13:55.24,0:13:56.72,Default,,0,0,0,,segment from when they started
Dialogue: 0,0:13:56.72,0:13:58.00,Default,,0,0,0,,swimming again to the end of the
Dialogue: 0,0:13:58.00,0:13:58.37,Default,,0,0,0,,workout.
Dialogue: 0,0:13:59.03,0:14:00.46,Default,,0,0,0,,So, as you can see, you can use
Dialogue: 0,0:14:00.46,0:14:01.51,Default,,0,0,0,,those to build really rich
Dialogue: 0,0:14:01.51,0:14:03.14,Default,,0,0,0,,swimming experiences, but your
Dialogue: 0,0:14:03.14,0:14:04.67,Default,,0,0,0,,apps can also create segments
Dialogue: 0,0:14:04.70,0:14:05.76,Default,,0,0,0,,that are specific to any other
Dialogue: 0,0:14:05.76,0:14:09.37,Default,,0,0,0,,type of workout app that you
Dialogue: 0,0:14:09.82,0:14:09.96,Default,,0,0,0,,build.
Dialogue: 0,0:14:09.96,0:14:11.89,Default,,0,0,0,,So, the other new WorkoutEvent
Dialogue: 0,0:14:11.89,0:14:12.85,Default,,0,0,0,,type that we have this year is
Dialogue: 0,0:14:12.85,0:14:14.14,Default,,0,0,0,,pause and resume request.
Dialogue: 0,0:14:14.48,0:14:16.19,Default,,0,0,0,,And if you've used the Apple
Dialogue: 0,0:14:16.19,0:14:17.31,Default,,0,0,0,,Watch workout app, you might be
Dialogue: 0,0:14:17.31,0:14:18.51,Default,,0,0,0,,familiar that you can press the
Dialogue: 0,0:14:18.51,0:14:19.77,Default,,0,0,0,,digital crown and side button
Dialogue: 0,0:14:19.77,0:14:21.51,Default,,0,0,0,,simultaneously to pause your
Dialogue: 0,0:14:21.51,0:14:22.78,Default,,0,0,0,,workout without ever interacting
Dialogue: 0,0:14:22.78,0:14:24.27,Default,,0,0,0,,with the screen, and now this
Dialogue: 0,0:14:24.27,0:14:25.50,Default,,0,0,0,,year, your apps can enable that
Dialogue: 0,0:14:25.50,0:14:26.25,Default,,0,0,0,,behavior as well.
Dialogue: 0,0:14:26.25,0:14:29.18,Default,,0,0,0,,So, again it's a quick press of
Dialogue: 0,0:14:29.21,0:14:30.52,Default,,0,0,0,,the digital crown and the side
Dialogue: 0,0:14:30.52,0:14:30.82,Default,,0,0,0,,button.
Dialogue: 0,0:14:31.41,0:14:33.70,Default,,0,0,0,,And it does work in water lock.
Dialogue: 0,0:14:33.95,0:14:35.92,Default,,0,0,0,,So, this is really great for
Dialogue: 0,0:14:35.92,0:14:37.36,Default,,0,0,0,,swimming applications, because
Dialogue: 0,0:14:37.36,0:14:38.64,Default,,0,0,0,,your user doesn't need to
Dialogue: 0,0:14:38.64,0:14:39.91,Default,,0,0,0,,interact with the screen at all,
Dialogue: 0,0:14:39.91,0:14:41.27,Default,,0,0,0,,or disturb their workout, they
Dialogue: 0,0:14:41.27,0:14:43.67,Default,,0,0,0,,can pause just by pressing the
Dialogue: 0,0:14:45.44,0:14:45.63,Default,,0,0,0,,buttons.
Dialogue: 0,0:14:46.03,0:14:47.30,Default,,0,0,0,,Like other events, you'd want to
Dialogue: 0,0:14:47.30,0:14:48.48,Default,,0,0,0,,handle this in your workout
Dialogue: 0,0:14:48.48,0:14:50.14,Default,,0,0,0,,session delegate, however, it's
Dialogue: 0,0:14:50.14,0:14:52.04,Default,,0,0,0,,important to note here that we
Dialogue: 0,0:14:52.04,0:14:53.04,Default,,0,0,0,,will not pause and resume
Dialogue: 0,0:14:53.04,0:14:54.67,Default,,0,0,0,,automatically when this event is
Dialogue: 0,0:14:54.67,0:14:55.12,Default,,0,0,0,,received.
Dialogue: 0,0:14:55.30,0:14:56.40,Default,,0,0,0,,It's up to your application to
Dialogue: 0,0:14:56.40,0:14:58.20,Default,,0,0,0,,actually enable this behavior by
Dialogue: 0,0:14:58.20,0:14:59.26,Default,,0,0,0,,calling pause or resume.
Dialogue: 0,0:14:59.97,0:15:01.38,Default,,0,0,0,,So, let's take a look at what
Dialogue: 0,0:15:01.38,0:15:02.82,Default,,0,0,0,,that would look like to enable
Dialogue: 0,0:15:02.82,0:15:03.44,Default,,0,0,0,,this behavior.
Dialogue: 0,0:15:04.07,0:15:06.97,Default,,0,0,0,,So, first our user is going to
Dialogue: 0,0:15:06.97,0:15:08.28,Default,,0,0,0,,press the digital crown and side
Dialogue: 0,0:15:08.28,0:15:09.31,Default,,0,0,0,,button to indicate they'd like
Dialogue: 0,0:15:09.31,0:15:09.78,Default,,0,0,0,,to pause.
Dialogue: 0,0:15:10.71,0:15:12.59,Default,,0,0,0,,And HealthKit then generates a
Dialogue: 0,0:15:12.59,0:15:13.88,Default,,0,0,0,,pause and resume request.
Dialogue: 0,0:15:15.20,0:15:16.72,Default,,0,0,0,,The application receives this
Dialogue: 0,0:15:16.72,0:15:18.01,Default,,0,0,0,,request, in your workout session
Dialogue: 0,0:15:18.01,0:15:19.49,Default,,0,0,0,,delegate and then you choose to
Dialogue: 0,0:15:19.49,0:15:20.12,Default,,0,0,0,,respond to it.
Dialogue: 0,0:15:20.55,0:15:21.39,Default,,0,0,0,,So, in this case we're going to
Dialogue: 0,0:15:21.39,0:15:21.80,Default,,0,0,0,,respond.
Dialogue: 0,0:15:23.29,0:15:24.69,Default,,0,0,0,,So, based on our state, we
Dialogue: 0,0:15:24.69,0:15:25.58,Default,,0,0,0,,either pause or resume.
Dialogue: 0,0:15:26.00,0:15:27.14,Default,,0,0,0,,If we're currently running, we'd
Dialogue: 0,0:15:27.14,0:15:28.40,Default,,0,0,0,,want to pause and if we're
Dialogue: 0,0:15:28.40,0:15:29.57,Default,,0,0,0,,currently paused, we'd want to
Dialogue: 0,0:15:29.57,0:15:29.94,Default,,0,0,0,,resume.
Dialogue: 0,0:15:30.83,0:15:33.43,Default,,0,0,0,,When HealthKit receives that, it
Dialogue: 0,0:15:33.62,0:15:34.99,Default,,0,0,0,,then generates an event for the
Dialogue: 0,0:15:34.99,0:15:36.55,Default,,0,0,0,,pause or the resume itself.
Dialogue: 0,0:15:36.96,0:15:38.50,Default,,0,0,0,,And finally, that pause or
Dialogue: 0,0:15:38.50,0:15:40.31,Default,,0,0,0,,resume event is also received in
Dialogue: 0,0:15:40.31,0:15:41.31,Default,,0,0,0,,your workout session delegate.
Dialogue: 0,0:15:42.45,0:15:43.78,Default,,0,0,0,,We think this is a really great
Dialogue: 0,0:15:43.78,0:15:45.28,Default,,0,0,0,,feature to provide consistent
Dialogue: 0,0:15:45.28,0:15:46.64,Default,,0,0,0,,experiences to users using
Dialogue: 0,0:15:46.64,0:15:47.37,Default,,0,0,0,,different workout apps.
Dialogue: 0,0:15:47.85,0:15:49.48,Default,,0,0,0,,And we hope that you adopt it to
Dialogue: 0,0:15:49.55,0:15:53.82,Default,,0,0,0,,continue that behavior.
Dialogue: 0,0:15:54.62,0:15:56.65,Default,,0,0,0,,So, another new, exciting
Dialogue: 0,0:15:56.65,0:15:57.70,Default,,0,0,0,,workout API this year we've
Dialogue: 0,0:15:57.70,0:15:59.85,Default,,0,0,0,,introduced is workout routes.
Dialogue: 0,0:16:00.18,0:16:01.60,Default,,0,0,0,,Users can use this to track
Dialogue: 0,0:16:01.60,0:16:02.52,Default,,0,0,0,,their location throughout their
Dialogue: 0,0:16:02.52,0:16:03.11,Default,,0,0,0,,workout.
Dialogue: 0,0:16:03.11,0:16:04.16,Default,,0,0,0,,And people have really loved
Dialogue: 0,0:16:04.16,0:16:05.08,Default,,0,0,0,,doing this with the Apple Watch
Dialogue: 0,0:16:05.08,0:16:05.67,Default,,0,0,0,,series 2.
Dialogue: 0,0:16:07.07,0:16:08.28,Default,,0,0,0,,People have used it for things
Dialogue: 0,0:16:08.28,0:16:10.02,Default,,0,0,0,,as ambitious as marathons or
Dialogue: 0,0:16:10.02,0:16:11.81,Default,,0,0,0,,maybe just a casual jog around
Dialogue: 0,0:16:11.81,0:16:12.51,Default,,0,0,0,,Golden Gate Park.
Dialogue: 0,0:16:12.73,0:16:14.50,Default,,0,0,0,,So, let's start with how your
Dialogue: 0,0:16:14.50,0:16:16.07,Default,,0,0,0,,applications can read this data
Dialogue: 0,0:16:16.24,0:16:16.83,Default,,0,0,0,,from HealthKit.
Dialogue: 0,0:16:18.20,0:16:20.33,Default,,0,0,0,,So, we have a new datatype which
Dialogue: 0,0:16:20.33,0:16:21.71,Default,,0,0,0,,is HKWorkoutRouteType.
Dialogue: 0,0:16:22.89,0:16:23.99,Default,,0,0,0,,And it's important that this
Dialogue: 0,0:16:23.99,0:16:25.17,Default,,0,0,0,,type requires additional
Dialogue: 0,0:16:25.17,0:16:25.99,Default,,0,0,0,,authorization.
Dialogue: 0,0:16:26.10,0:16:27.13,Default,,0,0,0,,And this is really on two
Dialogue: 0,0:16:27.13,0:16:27.55,Default,,0,0,0,,fronts.
Dialogue: 0,0:16:28.00,0:16:29.27,Default,,0,0,0,,The first is that even if you
Dialogue: 0,0:16:29.27,0:16:30.84,Default,,0,0,0,,have access to read and write
Dialogue: 0,0:16:30.84,0:16:32.19,Default,,0,0,0,,workouts from HealthKit, you
Dialogue: 0,0:16:32.19,0:16:33.62,Default,,0,0,0,,need additional authorization to
Dialogue: 0,0:16:33.62,0:16:34.50,Default,,0,0,0,,read or write WorkoutRoutes.
Dialogue: 0,0:16:35.23,0:16:36.61,Default,,0,0,0,,In addition to actually get the
Dialogue: 0,0:16:36.61,0:16:38.50,Default,,0,0,0,,user's location you would want
Dialogue: 0,0:16:38.50,0:16:40.01,Default,,0,0,0,,permission or authorization from
Dialogue: 0,0:16:40.01,0:16:41.93,Default,,0,0,0,,Core Location to view the user's
Dialogue: 0,0:16:41.93,0:16:42.45,Default,,0,0,0,,location.
Dialogue: 0,0:16:43.78,0:16:45.68,Default,,0,0,0,,So, HealthKit models
Dialogue: 0,0:16:45.68,0:16:46.87,Default,,0,0,0,,WorkoutRoutes as an array of
Dialogue: 0,0:16:47.02,0:16:48.19,Default,,0,0,0,,CLLocation, which is Core
Dialogue: 0,0:16:48.19,0:16:49.11,Default,,0,0,0,,Location Location.
Dialogue: 0,0:16:49.61,0:16:51.20,Default,,0,0,0,,Each location has latitude and
Dialogue: 0,0:16:51.20,0:16:52.45,Default,,0,0,0,,longitude as well as some other
Dialogue: 0,0:16:52.45,0:16:53.85,Default,,0,0,0,,data about the location at that
Dialogue: 0,0:16:53.85,0:16:54.98,Default,,0,0,0,,moment including speed.
Dialogue: 0,0:16:55.54,0:16:58.06,Default,,0,0,0,,It's important to know that
Dialogue: 0,0:16:58.06,0:16:59.32,Default,,0,0,0,,these datasets can be quite
Dialogue: 0,0:16:59.32,0:16:59.93,Default,,0,0,0,,large.
Dialogue: 0,0:17:00.30,0:17:01.62,Default,,0,0,0,,So, in marathon example, it can
Dialogue: 0,0:17:01.62,0:17:02.69,Default,,0,0,0,,be many thousands of data
Dialogue: 0,0:17:02.69,0:17:03.10,Default,,0,0,0,,points.
Dialogue: 0,0:17:03.71,0:17:04.68,Default,,0,0,0,,Because of this, we've
Dialogue: 0,0:17:04.68,0:17:07.85,Default,,0,0,0,,introduced a new query
Dialogue: 0,0:17:07.85,0:17:09.08,Default,,0,0,0,,specifically for WorkoutRoutes,
Dialogue: 0,0:17:09.24,0:17:10.70,Default,,0,0,0,,which is HKWorkoutRouteQuery.
Dialogue: 0,0:17:12.32,0:17:13.96,Default,,0,0,0,,This returns location data in
Dialogue: 0,0:17:13.96,0:17:15.03,Default,,0,0,0,,batches, rather than all at
Dialogue: 0,0:17:15.03,0:17:15.23,Default,,0,0,0,,once.
Dialogue: 0,0:17:15.32,0:17:16.65,Default,,0,0,0,,So, you don't have to hold it
Dialogue: 0,0:17:16.85,0:17:18.56,Default,,0,0,0,,all in memory at one time.
Dialogue: 0,0:17:19.20,0:17:20.87,Default,,0,0,0,,So, let's go over what this
Dialogue: 0,0:17:20.87,0:17:22.36,Default,,0,0,0,,looks like in code to read a
Dialogue: 0,0:17:22.36,0:17:23.41,Default,,0,0,0,,WorkoutRoute from HealthKit.
Dialogue: 0,0:17:24.54,0:17:25.62,Default,,0,0,0,,So, we're going to assume we
Dialogue: 0,0:17:25.62,0:17:26.75,Default,,0,0,0,,already have the workout that
Dialogue: 0,0:17:26.75,0:17:27.98,Default,,0,0,0,,we're interested in saved as a
Dialogue: 0,0:17:27.98,0:17:28.66,Default,,0,0,0,,workout object.
Dialogue: 0,0:17:30.09,0:17:32.18,Default,,0,0,0,,So, first we create the type we
Dialogue: 0,0:17:32.18,0:17:33.94,Default,,0,0,0,,want by calling WorkoutRoute on
Dialogue: 0,0:17:33.94,0:17:34.87,Default,,0,0,0,,HKSeriesType.
Dialogue: 0,0:17:35.31,0:17:37.31,Default,,0,0,0,,And then we create a predicate
Dialogue: 0,0:17:37.35,0:17:38.92,Default,,0,0,0,,for the objects associated with
Dialogue: 0,0:17:38.92,0:17:39.40,Default,,0,0,0,,our workout.
Dialogue: 0,0:17:39.85,0:17:42.60,Default,,0,0,0,,Next, we want to use an
Dialogue: 0,0:17:42.60,0:17:43.80,Default,,0,0,0,,HKSampleQuery.
Dialogue: 0,0:17:44.07,0:17:45.45,Default,,0,0,0,,So, this is an existing query
Dialogue: 0,0:17:45.45,0:17:46.57,Default,,0,0,0,,that just returns samples of a
Dialogue: 0,0:17:46.57,0:17:47.19,Default,,0,0,0,,certain type.
Dialogue: 0,0:17:47.19,0:17:48.57,Default,,0,0,0,,And we're going to pass in our
Dialogue: 0,0:17:48.57,0:17:50.51,Default,,0,0,0,,WorkoutRoute type as well as our
Dialogue: 0,0:17:50.51,0:17:51.33,Default,,0,0,0,,workout predicate.
Dialogue: 0,0:17:51.80,0:17:53.26,Default,,0,0,0,,We don't have any limit on the
Dialogue: 0,0:17:53.26,0:17:54.70,Default,,0,0,0,,samples we want to receive back
Dialogue: 0,0:17:54.96,0:17:55.60,Default,,0,0,0,,in this case.
Dialogue: 0,0:17:55.94,0:17:56.86,Default,,0,0,0,,And we don't have any sort
Dialogue: 0,0:17:56.86,0:17:57.36,Default,,0,0,0,,descriptors.
Dialogue: 0,0:17:57.91,0:18:00.63,Default,,0,0,0,,So, this will give us back the
Dialogue: 0,0:18:00.63,0:18:02.21,Default,,0,0,0,,query itself as well as the
Dialogue: 0,0:18:02.21,0:18:03.39,Default,,0,0,0,,samples we're interested in and
Dialogue: 0,0:18:03.39,0:18:04.93,Default,,0,0,0,,potentially an error.
Dialogue: 0,0:18:05.76,0:18:07.01,Default,,0,0,0,,So, the first step here, is
Dialogue: 0,0:18:07.01,0:18:07.83,Default,,0,0,0,,we're going to guard that the
Dialogue: 0,0:18:07.83,0:18:09.26,Default,,0,0,0,,samples that we got back are
Dialogue: 0,0:18:09.26,0:18:10.73,Default,,0,0,0,,indeed HKWorkoutRoutes.
Dialogue: 0,0:18:11.23,0:18:13.74,Default,,0,0,0,,And now, the second step is to
Dialogue: 0,0:18:13.74,0:18:14.99,Default,,0,0,0,,actually query for the raw
Dialogue: 0,0:18:14.99,0:18:17.69,Default,,0,0,0,,location data from each route.
Dialogue: 0,0:18:18.17,0:18:19.25,Default,,0,0,0,,So, here's where the new
Dialogue: 0,0:18:19.25,0:18:21.13,Default,,0,0,0,,HKWorkoutRouteQuery comes in.
Dialogue: 0,0:18:21.38,0:18:23.61,Default,,0,0,0,,It takes the WorkoutRoute and it
Dialogue: 0,0:18:23.61,0:18:24.96,Default,,0,0,0,,then returns that query.
Dialogue: 0,0:18:25.49,0:18:27.57,Default,,0,0,0,,The raw locations, a Boolean to
Dialogue: 0,0:18:27.57,0:18:28.56,Default,,0,0,0,,indicate whether it's done
Dialogue: 0,0:18:28.56,0:18:30.11,Default,,0,0,0,,batching the data to you, and
Dialogue: 0,0:18:30.11,0:18:31.63,Default,,0,0,0,,potentially an error.
Dialogue: 0,0:18:32.60,0:18:33.90,Default,,0,0,0,,So, here we'd want to do
Dialogue: 0,0:18:33.90,0:18:34.66,Default,,0,0,0,,something specific to our
Dialogue: 0,0:18:34.66,0:18:36.24,Default,,0,0,0,,application like add the
Dialogue: 0,0:18:36.24,0:18:37.10,Default,,0,0,0,,location data to a map.
Dialogue: 0,0:18:37.51,0:18:39.14,Default,,0,0,0,,And note that this block will
Dialogue: 0,0:18:39.14,0:18:40.14,Default,,0,0,0,,probably be called multiple
Dialogue: 0,0:18:40.14,0:18:41.56,Default,,0,0,0,,times as the data is returned to
Dialogue: 0,0:18:41.56,0:18:42.27,Default,,0,0,0,,you in batches.
Dialogue: 0,0:18:43.31,0:18:45.39,Default,,0,0,0,,Finally, we execute this by
Dialogue: 0,0:18:45.39,0:18:46.84,Default,,0,0,0,,calling execute on the queries,
Dialogue: 0,0:18:47.21,0:18:50.61,Default,,0,0,0,,or calling the execute method on
Dialogue: 0,0:18:50.61,0:18:51.74,Default,,0,0,0,,healthStore and passing these
Dialogue: 0,0:18:51.74,0:18:52.08,Default,,0,0,0,,queries.
Dialogue: 0,0:18:53.25,0:18:54.95,Default,,0,0,0,,So, now let's go over how your
Dialogue: 0,0:18:54.95,0:18:56.50,Default,,0,0,0,,applications can actually build
Dialogue: 0,0:18:56.50,0:18:57.57,Default,,0,0,0,,and save your own workout
Dialogue: 0,0:18:57.57,0:18:57.85,Default,,0,0,0,,routes.
Dialogue: 0,0:18:59.07,0:19:00.76,Default,,0,0,0,,So, we use a builder model
Dialogue: 0,0:19:00.76,0:19:02.23,Default,,0,0,0,,called HKWorkoutRouteBuilder.
Dialogue: 0,0:19:02.70,0:19:04.04,Default,,0,0,0,,And the lifetime of this model
Dialogue: 0,0:19:04.04,0:19:05.08,Default,,0,0,0,,is that you want one builder
Dialogue: 0,0:19:05.08,0:19:06.48,Default,,0,0,0,,object per route that you're
Dialogue: 0,0:19:06.48,0:19:07.83,Default,,0,0,0,,keeping track of.
Dialogue: 0,0:19:08.98,0:19:11.00,Default,,0,0,0,,So, location data is added
Dialogue: 0,0:19:11.00,0:19:12.47,Default,,0,0,0,,asynchronously and it's sorted
Dialogue: 0,0:19:12.47,0:19:13.77,Default,,0,0,0,,by date, by HealthKit when the
Dialogue: 0,0:19:13.77,0:19:14.83,Default,,0,0,0,,series is finalized.
Dialogue: 0,0:19:15.18,0:19:16.09,Default,,0,0,0,,So, you don't need to worry
Dialogue: 0,0:19:16.09,0:19:17.45,Default,,0,0,0,,about the order in which you add
Dialogue: 0,0:19:18.14,0:19:19.70,Default,,0,0,0,,the data.
Dialogue: 0,0:19:19.78,0:19:21.04,Default,,0,0,0,,Also, the workout needs to be
Dialogue: 0,0:19:21.04,0:19:22.00,Default,,0,0,0,,saved before the route.
Dialogue: 0,0:19:22.06,0:19:23.77,Default,,0,0,0,,So, let's go over what the
Dialogue: 0,0:19:23.89,0:19:25.25,Default,,0,0,0,,timeline would look like if you
Dialogue: 0,0:19:25.25,0:19:26.75,Default,,0,0,0,,have a workout session and you
Dialogue: 0,0:19:26.75,0:19:27.98,Default,,0,0,0,,want to keep track of the route
Dialogue: 0,0:19:27.98,0:19:29.26,Default,,0,0,0,,for it and save it to HealthKit.
Dialogue: 0,0:19:29.34,0:19:30.95,Default,,0,0,0,,So, first we're going to create
Dialogue: 0,0:19:30.95,0:19:31.99,Default,,0,0,0,,our WorkoutRouteBuilder.
Dialogue: 0,0:19:32.44,0:19:35.70,Default,,0,0,0,,Next, we want to actually start
Dialogue: 0,0:19:35.70,0:19:36.98,Default,,0,0,0,,our workout session as we've
Dialogue: 0,0:19:36.98,0:19:37.37,Default,,0,0,0,,shown.
Dialogue: 0,0:19:39.30,0:19:40.86,Default,,0,0,0,,Then our workout is active.
Dialogue: 0,0:19:40.86,0:19:43.62,Default,,0,0,0,,And we want to begin observing
Dialogue: 0,0:19:43.62,0:19:44.27,Default,,0,0,0,,location data.
Dialogue: 0,0:19:44.79,0:19:46.09,Default,,0,0,0,,And this is where you' would be
Dialogue: 0,0:19:46.09,0:19:47.42,Default,,0,0,0,,observing location data from
Dialogue: 0,0:19:47.42,0:19:48.89,Default,,0,0,0,,Core Location, the location
Dialogue: 0,0:19:48.89,0:19:50.47,Default,,0,0,0,,framework on iOS and watchOS.
Dialogue: 0,0:19:51.26,0:19:53.60,Default,,0,0,0,,You then want to add those
Dialogue: 0,0:19:53.60,0:19:54.77,Default,,0,0,0,,locations to your builder.
Dialogue: 0,0:19:54.77,0:19:57.03,Default,,0,0,0,,And this process is ongoing.
Dialogue: 0,0:19:57.03,0:19:58.10,Default,,0,0,0,,You want to do it many times
Dialogue: 0,0:19:58.10,0:19:59.43,Default,,0,0,0,,throughout your workout.
Dialogue: 0,0:20:00.58,0:20:02.01,Default,,0,0,0,,Finally, you'd want to end your
Dialogue: 0,0:20:02.01,0:20:03.46,Default,,0,0,0,,session and save the workout.
Dialogue: 0,0:20:03.46,0:20:05.21,Default,,0,0,0,,And then the last step is to
Dialogue: 0,0:20:05.21,0:20:07.06,Default,,0,0,0,,finish your WorkoutRoute, which
Dialogue: 0,0:20:07.06,0:20:07.94,Default,,0,0,0,,saves it into HealthKit.
Dialogue: 0,0:20:08.61,0:20:09.81,Default,,0,0,0,,So, let's take a look at the
Dialogue: 0,0:20:09.81,0:20:11.01,Default,,0,0,0,,same thing in code.
Dialogue: 0,0:20:11.56,0:20:13.54,Default,,0,0,0,,You're going to start by
Dialogue: 0,0:20:13.67,0:20:15.40,Default,,0,0,0,,creating your RouteBuilder and
Dialogue: 0,0:20:15.40,0:20:16.18,Default,,0,0,0,,adding locations.
Dialogue: 0,0:20:16.69,0:20:17.74,Default,,0,0,0,,So, we create our builder,
Dialogue: 0,0:20:18.01,0:20:20.21,Default,,0,0,0,,passing in the healthStore and a
Dialogue: 0,0:20:20.21,0:20:20.71,Default,,0,0,0,,device.
Dialogue: 0,0:20:20.75,0:20:22.15,Default,,0,0,0,,In this case, nil will default
Dialogue: 0,0:20:22.15,0:20:23.05,Default,,0,0,0,,to the local device.
Dialogue: 0,0:20:24.95,0:20:26.33,Default,,0,0,0,,You then add locations as the
Dialogue: 0,0:20:26.33,0:20:27.36,Default,,0,0,0,,workout is ongoing.
Dialogue: 0,0:20:27.70,0:20:28.86,Default,,0,0,0,,So, presumably this snippet of
Dialogue: 0,0:20:28.86,0:20:30.22,Default,,0,0,0,,code is called multiple times.
Dialogue: 0,0:20:30.90,0:20:32.53,Default,,0,0,0,,And here I'm calling some local
Dialogue: 0,0:20:32.53,0:20:34.18,Default,,0,0,0,,method fetchRecentLocations that
Dialogue: 0,0:20:34.18,0:20:35.08,Default,,0,0,0,,returns me a list of
Dialogue: 0,0:20:35.15,0:20:37.08,Default,,0,0,0,,CLLocations, and then inserting
Dialogue: 0,0:20:37.08,0:20:39.18,Default,,0,0,0,,those locations into the
Dialogue: 0,0:20:39.80,0:20:40.11,Default,,0,0,0,,builder.
Dialogue: 0,0:20:40.11,0:20:41.08,Default,,0,0,0,,Because I'm a responsible
Dialogue: 0,0:20:41.08,0:20:42.06,Default,,0,0,0,,developer, I'm going to handle
Dialogue: 0,0:20:42.06,0:20:42.65,Default,,0,0,0,,all my errors.
Dialogue: 0,0:20:44.06,0:20:45.21,Default,,0,0,0,,Step three.
Dialogue: 0,0:20:45.44,0:20:46.68,Default,,0,0,0,,So, this is after our workout is
Dialogue: 0,0:20:46.68,0:20:47.07,Default,,0,0,0,,saved.
Dialogue: 0,0:20:47.42,0:20:48.38,Default,,0,0,0,,We'd want to finish the route.
Dialogue: 0,0:20:49.12,0:20:50.67,Default,,0,0,0,,And this takes in the workout
Dialogue: 0,0:20:50.67,0:20:51.58,Default,,0,0,0,,objects that we've already
Dialogue: 0,0:20:51.58,0:20:53.43,Default,,0,0,0,,saved, as well as any metadata
Dialogue: 0,0:20:53.43,0:20:57.66,Default,,0,0,0,,that we want to be on the route.
Dialogue: 0,0:20:58.26,0:21:00.04,Default,,0,0,0,,So, next I'd like to demo adding
Dialogue: 0,0:21:00.04,0:21:01.60,Default,,0,0,0,,WorkoutRoutes to an application
Dialogue: 0,0:21:01.60,0:21:01.99,Default,,0,0,0,,to you guys.
Dialogue: 0,0:21:02.69,0:21:04.58,Default,,0,0,0,,So, if you attended our talk or
Dialogue: 0,0:21:04.58,0:21:06.40,Default,,0,0,0,,watched online last year, you'll
Dialogue: 0,0:21:06.40,0:21:07.87,Default,,0,0,0,,remember that Speedy Sloth is a
Dialogue: 0,0:21:07.87,0:21:10.02,Default,,0,0,0,,super cool workout application
Dialogue: 0,0:21:10.02,0:21:10.94,Default,,0,0,0,,for sloth lovers.
Dialogue: 0,0:21:11.17,0:21:12.13,Default,,0,0,0,,And today we're going to add
Dialogue: 0,0:21:12.13,0:21:13.65,Default,,0,0,0,,location routes to it.
Dialogue: 0,0:21:19.99,0:21:20.81,Default,,0,0,0,,Great. So, I'm going to switch
Dialogue: 0,0:21:20.81,0:21:22.18,Default,,0,0,0,,over to XCode and you'll see
Dialogue: 0,0:21:22.18,0:21:23.38,Default,,0,0,0,,here that I have Speedy Sloth
Dialogue: 0,0:21:23.38,0:21:23.75,Default,,0,0,0,,running.
Dialogue: 0,0:21:24.40,0:21:25.91,Default,,0,0,0,,So, Speedy Sloth is a WatchKit
Dialogue: 0,0:21:26.01,0:21:27.61,Default,,0,0,0,,app that lets you configure your
Dialogue: 0,0:21:27.61,0:21:29.82,Default,,0,0,0,,workout and then run it and show
Dialogue: 0,0:21:29.82,0:21:30.82,Default,,0,0,0,,you some live metrics.
Dialogue: 0,0:21:31.07,0:21:32.33,Default,,0,0,0,,And it saves the workouts into
Dialogue: 0,0:21:32.33,0:21:32.80,Default,,0,0,0,,HealthKit.
Dialogue: 0,0:21:33.22,0:21:35.08,Default,,0,0,0,,So, I'll start here by just
Dialogue: 0,0:21:35.08,0:21:36.12,Default,,0,0,0,,running Speedy Sloth so you have
Dialogue: 0,0:21:36.12,0:21:37.08,Default,,0,0,0,,an idea of what it looks like
Dialogue: 0,0:21:37.08,0:21:37.52,Default,,0,0,0,,currently.
Dialogue: 0,0:21:37.94,0:21:39.28,Default,,0,0,0,,So, you'll see that we keep
Dialogue: 0,0:21:39.28,0:21:40.33,Default,,0,0,0,,track of the duration of the
Dialogue: 0,0:21:40.33,0:21:40.78,Default,,0,0,0,,workout.
Dialogue: 0,0:21:41.39,0:21:43.30,Default,,0,0,0,,I can pause or resume.
Dialogue: 0,0:21:44.02,0:21:46.04,Default,,0,0,0,,And we keep track of the current
Dialogue: 0,0:21:46.09,0:21:47.50,Default,,0,0,0,,totals of your metrics as the
Dialogue: 0,0:21:47.50,0:21:48.38,Default,,0,0,0,,workout is ongoing.
Dialogue: 0,0:21:48.85,0:21:50.32,Default,,0,0,0,,So, we have calories coming in,
Dialogue: 0,0:21:50.59,0:21:51.43,Default,,0,0,0,,as well as meters.
Dialogue: 0,0:21:52.17,0:21:54.13,Default,,0,0,0,,So, I'll stop that.
Dialogue: 0,0:21:55.57,0:21:57.21,Default,,0,0,0,,And we saw a summary there of
Dialogue: 0,0:21:57.21,0:21:57.68,Default,,0,0,0,,our workout.
Dialogue: 0,0:21:58.63,0:22:00.47,Default,,0,0,0,,So, switching over to XCode, I
Dialogue: 0,0:22:00.47,0:22:01.25,Default,,0,0,0,,have this class,
Dialogue: 0,0:22:01.55,0:22:02.52,Default,,0,0,0,,healthStoreManager.
Dialogue: 0,0:22:03.03,0:22:03.97,Default,,0,0,0,,So, this is the class that
Dialogue: 0,0:22:03.97,0:22:05.40,Default,,0,0,0,,handles all of our interactions
Dialogue: 0,0:22:05.71,0:22:07.15,Default,,0,0,0,,with the HKhealthStore, which
Dialogue: 0,0:22:07.22,0:22:08.50,Default,,0,0,0,,saves and reads data from
Dialogue: 0,0:22:09.15,0:22:09.37,Default,,0,0,0,,HealthKit.
Dialogue: 0,0:22:10.32,0:22:16.43,Default,,0,0,0,,So, what I want to do first, is
Dialogue: 0,0:22:16.43,0:22:18.26,Default,,0,0,0,,implement the CLLocation Manager
Dialogue: 0,0:22:18.26,0:22:19.29,Default,,0,0,0,,Delegate Protocol.
Dialogue: 0,0:22:19.54,0:22:20.80,Default,,0,0,0,,This will allow me to receive
Dialogue: 0,0:22:20.80,0:22:22.68,Default,,0,0,0,,locations from Core Location.
Dialogue: 0,0:22:23.26,0:22:27.22,Default,,0,0,0,,In order to track these
Dialogue: 0,0:22:27.22,0:22:28.53,Default,,0,0,0,,locations, I'll need some
Dialogue: 0,0:22:28.53,0:22:29.10,Default,,0,0,0,,properties.
Dialogue: 0,0:22:29.78,0:22:32.61,Default,,0,0,0,,So, the first of these is going
Dialogue: 0,0:22:32.61,0:22:34.34,Default,,0,0,0,,to be the HKWorkoutRouteBuilder
Dialogue: 0,0:22:34.34,0:22:35.13,Default,,0,0,0,,that we just went over.
Dialogue: 0,0:22:36.71,0:22:38.59,Default,,0,0,0,,Next, I'll also need a location
Dialogue: 0,0:22:38.59,0:22:40.94,Default,,0,0,0,,manager from Core Location to
Dialogue: 0,0:22:40.94,0:22:45.65,Default,,0,0,0,,receive the updates from them.
Dialogue: 0,0:22:45.86,0:22:47.38,Default,,0,0,0,,Now, I want to actually start
Dialogue: 0,0:22:47.38,0:22:48.61,Default,,0,0,0,,accumulating location data.
Dialogue: 0,0:22:49.06,0:22:51.00,Default,,0,0,0,,So, we have this method, start
Dialogue: 0,0:22:51.00,0:22:51.74,Default,,0,0,0,,accumulating data.
Dialogue: 0,0:22:52.41,0:22:53.62,Default,,0,0,0,,And this is called when our
Dialogue: 0,0:22:53.62,0:22:55.13,Default,,0,0,0,,workout session changes state
Dialogue: 0,0:22:55.41,0:22:56.90,Default,,0,0,0,,from not started to running.
Dialogue: 0,0:22:57.44,0:22:58.36,Default,,0,0,0,,You can see here that I was
Dialogue: 0,0:22:58.36,0:23:00.05,Default,,0,0,0,,already using this place to
Dialogue: 0,0:23:00.05,0:23:01.13,Default,,0,0,0,,start walking and running
Dialogue: 0,0:23:01.13,0:23:02.34,Default,,0,0,0,,queries, which is what's
Dialogue: 0,0:23:02.43,0:23:05.36,Default,,0,0,0,,updating that distance metric,
Dialogue: 0,0:23:05.62,0:23:06.91,Default,,0,0,0,,as well as the
Dialogue: 0,0:23:06.91,0:23:08.95,Default,,0,0,0,,ActiveEnergyBurnedQuery which is
Dialogue: 0,0:23:09.12,0:23:10.61,Default,,0,0,0,,going to be showing the calorie
Dialogue: 0,0:23:10.61,0:23:10.95,Default,,0,0,0,,metric.
Dialogue: 0,0:23:11.20,0:23:13.02,Default,,0,0,0,,So, here's a good place to also
Dialogue: 0,0:23:13.18,0:23:15.80,Default,,0,0,0,,start accumulating location
Dialogue: 0,0:23:16.61,0:23:16.74,Default,,0,0,0,,data.
Dialogue: 0,0:23:17.92,0:23:20.00,Default,,0,0,0,,So, here I have a new method,
Dialogue: 0,0:23:20.00,0:23:21.36,Default,,0,0,0,,startAccumulatingLocationData.
Dialogue: 0,0:23:21.80,0:23:26.11,Default,,0,0,0,,And I'm going to add in the
Dialogue: 0,0:23:26.11,0:23:27.00,Default,,0,0,0,,implementation here.
Dialogue: 0,0:23:27.50,0:23:31.99,Default,,0,0,0,,First, I want to guard that he
Dialogue: 0,0:23:31.99,0:23:33.64,Default,,0,0,0,,location services are enabled,
Dialogue: 0,0:23:33.84,0:23:34.69,Default,,0,0,0,,otherwise return.
Dialogue: 0,0:23:35.24,0:23:37.71,Default,,0,0,0,,And then I want to create my
Dialogue: 0,0:23:37.81,0:23:39.32,Default,,0,0,0,,CLLocationManager object.
Dialogue: 0,0:23:40.33,0:23:41.93,Default,,0,0,0,,I'm going to set the delegate of
Dialogue: 0,0:23:41.93,0:23:43.29,Default,,0,0,0,,the object to be myself, so I
Dialogue: 0,0:23:43.29,0:23:44.96,Default,,0,0,0,,can receive callbacks for the
Dialogue: 0,0:23:44.96,0:23:46.12,Default,,0,0,0,,locations that are incoming.
Dialogue: 0,0:23:46.72,0:23:49.25,Default,,0,0,0,,I'm going to set the
Dialogue: 0,0:23:49.25,0:23:51.72,Default,,0,0,0,,desiredAccuracy to be the best
Dialogue: 0,0:23:51.82,0:23:52.72,Default,,0,0,0,,possible accuracy.
Dialogue: 0,0:23:53.21,0:23:54.39,Default,,0,0,0,,This is a good idea since we're
Dialogue: 0,0:23:54.39,0:23:55.37,Default,,0,0,0,,going to be displaying this data
Dialogue: 0,0:23:55.37,0:23:55.77,Default,,0,0,0,,on a map.
Dialogue: 0,0:23:55.77,0:23:57.22,Default,,0,0,0,,So, we want the most accurate
Dialogue: 0,0:23:57.22,0:23:58.75,Default,,0,0,0,,data possible to show visually
Dialogue: 0,0:23:58.75,0:23:59.29,Default,,0,0,0,,to our user.
Dialogue: 0,0:23:59.82,0:24:03.54,Default,,0,0,0,,Next, I'm going to set allows
Dialogue: 0,0:24:03.54,0:24:05.02,Default,,0,0,0,,background updates to be true.
Dialogue: 0,0:24:05.60,0:24:06.52,Default,,0,0,0,,And so, this will allow us to
Dialogue: 0,0:24:06.52,0:24:07.88,Default,,0,0,0,,continue to receive locations
Dialogue: 0,0:24:07.88,0:24:08.82,Default,,0,0,0,,while we're in the background.
Dialogue: 0,0:24:09.46,0:24:11.02,Default,,0,0,0,,So, in order for this to work,
Dialogue: 0,0:24:11.02,0:24:12.10,Default,,0,0,0,,we'd also need to setup some
Dialogue: 0,0:24:12.17,0:24:13.44,Default,,0,0,0,,keys in our info.keylist.
Dialogue: 0,0:24:13.72,0:24:14.63,Default,,0,0,0,,I'm not going to demo that
Dialogue: 0,0:24:14.63,0:24:16.13,Default,,0,0,0,,explicitly, but we do have
Dialogue: 0,0:24:16.13,0:24:17.69,Default,,0,0,0,,Speedy Sloth as a sample app
Dialogue: 0,0:24:17.75,0:24:19.26,Default,,0,0,0,,that you can check out at the
Dialogue: 0,0:24:19.26,0:24:20.23,Default,,0,0,0,,website we'll show at the end of
Dialogue: 0,0:24:20.23,0:24:20.71,Default,,0,0,0,,the session.
Dialogue: 0,0:24:23.00,0:24:24.07,Default,,0,0,0,,And finally, from the Core
Dialogue: 0,0:24:24.07,0:24:25.83,Default,,0,0,0,,Location side, I want to start
Dialogue: 0,0:24:25.83,0:24:26.79,Default,,0,0,0,,updating locations.
Dialogue: 0,0:24:27.47,0:24:28.92,Default,,0,0,0,,And all I need to do on the
Dialogue: 0,0:24:28.92,0:24:30.47,Default,,0,0,0,,HealthKit side is simply
Dialogue: 0,0:24:30.47,0:24:31.32,Default,,0,0,0,,instantiate my
Dialogue: 0,0:24:31.32,0:24:33.51,Default,,0,0,0,,HKWorkoutRouteBuilder, passing
Dialogue: 0,0:24:33.51,0:24:34.78,Default,,0,0,0,,in the healthStore variable,
Dialogue: 0,0:24:34.78,0:24:37.04,Default,,0,0,0,,which is a HK healthStore, as
Dialogue: 0,0:24:37.04,0:24:40.14,Default,,0,0,0,,well as a nil device.
Dialogue: 0,0:24:40.14,0:24:42.21,Default,,0,0,0,,Awesome. So, now we have all the
Dialogue: 0,0:24:42.21,0:24:43.32,Default,,0,0,0,,variables we need to track
Dialogue: 0,0:24:43.32,0:24:43.95,Default,,0,0,0,,location.
Dialogue: 0,0:24:44.24,0:24:45.34,Default,,0,0,0,,We've set everything up.
Dialogue: 0,0:24:45.66,0:24:46.88,Default,,0,0,0,,Now, we actually need to handle
Dialogue: 0,0:24:46.88,0:24:49.24,Default,,0,0,0,,those locations as they come in.
Dialogue: 0,0:24:49.60,0:24:53.49,Default,,0,0,0,,And to do that we want to
Dialogue: 0,0:24:53.49,0:24:55.37,Default,,0,0,0,,implement the function from Core
Dialogue: 0,0:24:55.37,0:24:56.59,Default,,0,0,0,,Location Manager Delegate,
Dialogue: 0,0:24:57.05,0:24:58.16,Default,,0,0,0,,locationManager
Dialogue: 0,0:24:58.28,0:24:59.43,Default,,0,0,0,,didUpdateLocations.
Dialogue: 0,0:24:59.84,0:25:01.75,Default,,0,0,0,,So, this passes us the manager
Dialogue: 0,0:25:01.75,0:25:04.18,Default,,0,0,0,,object itself, as well as the
Dialogue: 0,0:25:04.18,0:25:05.91,Default,,0,0,0,,list of CLLocation.
Dialogue: 0,0:25:06.42,0:25:09.55,Default,,0,0,0,,So, first, I'm going to filter
Dialogue: 0,0:25:09.55,0:25:10.73,Default,,0,0,0,,the locations that come in.
Dialogue: 0,0:25:10.94,0:25:12.78,Default,,0,0,0,,This is a good idea depending on
Dialogue: 0,0:25:12.78,0:25:14.36,Default,,0,0,0,,the exact purpose of your app.
Dialogue: 0,0:25:14.36,0:25:15.66,Default,,0,0,0,,I'm going to do a really simple
Dialogue: 0,0:25:15.66,0:25:17.66,Default,,0,0,0,,filter here, in some cases you
Dialogue: 0,0:25:17.66,0:25:18.45,Default,,0,0,0,,might want to instead do
Dialogue: 0,0:25:18.45,0:25:19.45,Default,,0,0,0,,something like smooth the route,
Dialogue: 0,0:25:19.45,0:25:21.29,Default,,0,0,0,,but for this demo, I'll just do
Dialogue: 0,0:25:21.29,0:25:21.96,Default,,0,0,0,,a simple filter.
Dialogue: 0,0:25:22.32,0:25:23.19,Default,,0,0,0,,So, I'm checking that the
Dialogue: 0,0:25:23.19,0:25:25.31,Default,,0,0,0,,horizontal accuracy is less than
Dialogue: 0,0:25:25.31,0:25:26.40,Default,,0,0,0,,or equal to the nearest 10
Dialogue: 0,0:25:26.40,0:25:26.76,Default,,0,0,0,,meters.
Dialogue: 0,0:25:27.92,0:25:29.35,Default,,0,0,0,,It's also important to do this
Dialogue: 0,0:25:29.35,0:25:30.61,Default,,0,0,0,,because even though we set the
Dialogue: 0,0:25:30.61,0:25:32.01,Default,,0,0,0,,desired accuracy on the Core
Dialogue: 0,0:25:32.01,0:25:33.57,Default,,0,0,0,,Location Manager, that is not
Dialogue: 0,0:25:33.57,0:25:34.26,Default,,0,0,0,,guaranteed.
Dialogue: 0,0:25:34.70,0:25:37.76,Default,,0,0,0,,Next, I want to check that
Dialogue: 0,0:25:37.76,0:25:39.37,Default,,0,0,0,,filter locations isn't empty
Dialogue: 0,0:25:39.37,0:25:40.19,Default,,0,0,0,,otherwise return.
Dialogue: 0,0:25:40.73,0:25:44.74,Default,,0,0,0,,And finally, I'm going to insert
Dialogue: 0,0:25:44.74,0:25:46.76,Default,,0,0,0,,this data into the
Dialogue: 0,0:25:46.76,0:25:48.46,Default,,0,0,0,,WorkoutRouteBuilder, passing in
Dialogue: 0,0:25:48.46,0:25:50.00,Default,,0,0,0,,the filtered locations and
Dialogue: 0,0:25:50.00,0:25:52.11,Default,,0,0,0,,receiving back successfully and
Dialogue: 0,0:25:52.26,0:25:52.82,Default,,0,0,0,,an error.
Dialogue: 0,0:25:53.64,0:25:55.42,Default,,0,0,0,,If it's not successful, I'm just
Dialogue: 0,0:25:55.42,0:25:58.28,Default,,0,0,0,,going to print the error here.
Dialogue: 0,0:25:58.28,0:26:00.03,Default,,0,0,0,,Awesome. So, now our workout
Dialogue: 0,0:26:00.03,0:26:01.59,Default,,0,0,0,,session is ongoing, we're
Dialogue: 0,0:26:01.59,0:26:03.13,Default,,0,0,0,,receiving locations from Core
Dialogue: 0,0:26:03.13,0:26:04.64,Default,,0,0,0,,Location and inserting them into
Dialogue: 0,0:26:04.64,0:26:05.18,Default,,0,0,0,,our builder.
Dialogue: 0,0:26:05.18,0:26:06.39,Default,,0,0,0,,Now, we want to make sure we
Dialogue: 0,0:26:06.43,0:26:07.99,Default,,0,0,0,,clean up after ourselves, once
Dialogue: 0,0:26:07.99,0:26:09.04,Default,,0,0,0,,the user has ended their
Dialogue: 0,0:26:09.04,0:26:09.44,Default,,0,0,0,,workout.
Dialogue: 0,0:26:09.95,0:26:12.47,Default,,0,0,0,,So, this method,
Dialogue: 0,0:26:12.60,0:26:13.91,Default,,0,0,0,,stopAccumulatingData is
Dialogue: 0,0:26:13.91,0:26:15.06,Default,,0,0,0,,similarly called when the
Dialogue: 0,0:26:15.06,0:26:16.32,Default,,0,0,0,,workout session changes state.
Dialogue: 0,0:26:16.79,0:26:18.08,Default,,0,0,0,,In this case, when it changes
Dialogue: 0,0:26:18.08,0:26:19.83,Default,,0,0,0,,state from running, or from
Dialogue: 0,0:26:19.83,0:26:21.22,Default,,0,0,0,,pause, to ended.
Dialogue: 0,0:26:22.19,0:26:23.50,Default,,0,0,0,,And so, here I was previously
Dialogue: 0,0:26:23.50,0:26:25.11,Default,,0,0,0,,going through my healthStore
Dialogue: 0,0:26:25.11,0:26:26.65,Default,,0,0,0,,queries and stopping them as
Dialogue: 0,0:26:26.65,0:26:27.73,Default,,0,0,0,,well as removing the active
Dialogue: 0,0:26:27.73,0:26:29.40,Default,,0,0,0,,queries on.
Dialogue: 0,0:26:29.40,0:26:30.34,Default,,0,0,0,,So, here's where I'll want to
Dialogue: 0,0:26:30.34,0:26:32.43,Default,,0,0,0,,also stop receiving location
Dialogue: 0,0:26:32.47,0:26:32.92,Default,,0,0,0,,updates.
Dialogue: 0,0:26:33.34,0:26:34.50,Default,,0,0,0,,So, I just called
Dialogue: 0,0:26:34.70,0:26:36.36,Default,,0,0,0,,stopUpdatingLocation on the
Dialogue: 0,0:26:36.36,0:26:37.50,Default,,0,0,0,,CLLocationMangaer.
Dialogue: 0,0:26:38.05,0:26:40.98,Default,,0,0,0,,Awesome. Now, the last step is
Dialogue: 0,0:26:40.98,0:26:42.82,Default,,0,0,0,,to actually save this data into
Dialogue: 0,0:26:42.82,0:26:43.37,Default,,0,0,0,,HealthKit.
Dialogue: 0,0:26:43.89,0:26:45.58,Default,,0,0,0,,So, I have this method,
Dialogue: 0,0:26:45.84,0:26:48.76,Default,,0,0,0,,saveWorkout and you'll see it
Dialogue: 0,0:26:48.76,0:26:50.43,Default,,0,0,0,,takes in the session as well as
Dialogue: 0,0:26:50.43,0:26:51.16,Default,,0,0,0,,a start and an end date.
Dialogue: 0,0:26:51.91,0:26:53.15,Default,,0,0,0,,So, first I want to configure
Dialogue: 0,0:26:53.15,0:26:54.89,Default,,0,0,0,,some metadata to save with my
Dialogue: 0,0:26:54.89,0:26:55.29,Default,,0,0,0,,workout.
Dialogue: 0,0:26:55.70,0:26:57.92,Default,,0,0,0,,In this case, what I'm doing is
Dialogue: 0,0:26:57.92,0:26:59.29,Default,,0,0,0,,I'm checking whether the
Dialogue: 0,0:26:59.29,0:27:01.27,Default,,0,0,0,,location type is indoor, and
Dialogue: 0,0:27:01.27,0:27:03.14,Default,,0,0,0,,setting the metadata key indoor
Dialogue: 0,0:27:03.14,0:27:03.74,Default,,0,0,0,,to that value.
Dialogue: 0,0:27:03.74,0:27:07.39,Default,,0,0,0,,Now, I actually want to create
Dialogue: 0,0:27:07.39,0:27:09.16,Default,,0,0,0,,my workout object with the
Dialogue: 0,0:27:09.16,0:27:11.25,Default,,0,0,0,,activity type from the workout
Dialogue: 0,0:27:11.25,0:27:12.01,Default,,0,0,0,,configuration.
Dialogue: 0,0:27:12.79,0:27:14.14,Default,,0,0,0,,The start and the end date.
Dialogue: 0,0:27:14.14,0:27:16.26,Default,,0,0,0,,The list of workout events that
Dialogue: 0,0:27:16.26,0:27:17.39,Default,,0,0,0,,I've saved elsewhere in Speedy
Dialogue: 0,0:27:17.39,0:27:17.69,Default,,0,0,0,,Sloth.
Dialogue: 0,0:27:18.37,0:27:20.35,Default,,0,0,0,,The total energy burned, the
Dialogue: 0,0:27:20.35,0:27:22.04,Default,,0,0,0,,total distance, as well as the
Dialogue: 0,0:27:22.04,0:27:25.53,Default,,0,0,0,,metadata I just created.
Dialogue: 0,0:27:25.59,0:27:27.30,Default,,0,0,0,,Now, finally I want to save the
Dialogue: 0,0:27:27.30,0:27:27.71,Default,,0,0,0,,workout.
Dialogue: 0,0:27:28.44,0:27:29.65,Default,,0,0,0,,And if the workout save was
Dialogue: 0,0:27:29.65,0:27:30.79,Default,,0,0,0,,successful, you'll see here that
Dialogue: 0,0:27:30.79,0:27:32.04,Default,,0,0,0,,we are already adding samples to
Dialogue: 0,0:27:32.04,0:27:32.43,Default,,0,0,0,,workout.
Dialogue: 0,0:27:32.71,0:27:33.51,Default,,0,0,0,,So, that was actually
Dialogue: 0,0:27:33.51,0:27:35.22,Default,,0,0,0,,associating those distance and
Dialogue: 0,0:27:35.22,0:27:36.36,Default,,0,0,0,,calorie samples with the
Dialogue: 0,0:27:36.36,0:27:36.72,Default,,0,0,0,,workout.
Dialogue: 0,0:27:37.07,0:27:38.65,Default,,0,0,0,,So, here's a good place to also
Dialogue: 0,0:27:38.65,0:27:39.67,Default,,0,0,0,,finish the WorkoutRoute.
Dialogue: 0,0:27:39.67,0:27:44.08,Default,,0,0,0,,So, I'm going to add this
Dialogue: 0,0:27:44.08,0:27:46.81,Default,,0,0,0,,snippet of code in here, which
Dialogue: 0,0:27:46.81,0:27:47.98,Default,,0,0,0,,calls FinishRoute on the
Dialogue: 0,0:27:47.98,0:27:49.49,Default,,0,0,0,,Builder, passing in the workout
Dialogue: 0,0:27:49.49,0:27:51.63,Default,,0,0,0,,as well as no metadata for the
Dialogue: 0,0:27:51.63,0:27:52.60,Default,,0,0,0,,route itself.
Dialogue: 0,0:27:53.84,0:27:55.44,Default,,0,0,0,,And finally, just check whether
Dialogue: 0,0:27:55.44,0:27:57.37,Default,,0,0,0,,or not there's an error.
Dialogue: 0,0:27:57.68,0:27:59.25,Default,,0,0,0,,Awesome. So, let's run this.
Dialogue: 0,0:28:12.67,0:28:13.77,Default,,0,0,0,,So, you'll note that I also did
Dialogue: 0,0:28:13.77,0:28:15.14,Default,,0,0,0,,not show in this demo actually
Dialogue: 0,0:28:15.14,0:28:16.49,Default,,0,0,0,,receiving authorization for the
Dialogue: 0,0:28:16.49,0:28:17.27,Default,,0,0,0,,HealthKit types.
Dialogue: 0,0:28:17.75,0:28:18.97,Default,,0,0,0,,I've already done that in the
Dialogue: 0,0:28:19.06,0:28:20.06,Default,,0,0,0,,iOS component of the app.
Dialogue: 0,0:28:20.46,0:28:21.31,Default,,0,0,0,,So, be sure to check out how to
Dialogue: 0,0:28:21.31,0:28:22.30,Default,,0,0,0,,do that in our sample code as
Dialogue: 0,0:28:22.30,0:28:22.48,Default,,0,0,0,,well.
Dialogue: 0,0:28:23.66,0:28:25.31,Default,,0,0,0,,So, here we can start another
Dialogue: 0,0:28:25.31,0:28:27.81,Default,,0,0,0,,outdoor walking workout, and see
Dialogue: 0,0:28:27.81,0:28:28.97,Default,,0,0,0,,again that we have our metrics
Dialogue: 0,0:28:28.97,0:28:29.22,Default,,0,0,0,,tracked.
Dialogue: 0,0:28:29.54,0:28:31.60,Default,,0,0,0,,The duration, and the calories
Dialogue: 0,0:28:31.60,0:28:32.72,Default,,0,0,0,,and meters that are incoming.
Dialogue: 0,0:28:33.30,0:28:34.44,Default,,0,0,0,,Maybe we want to throw in a
Dialogue: 0,0:28:34.44,0:28:35.93,Default,,0,0,0,,marker if we've seen a really
Dialogue: 0,0:28:35.93,0:28:36.45,Default,,0,0,0,,cool sloth.
Dialogue: 0,0:28:37.15,0:28:39.25,Default,,0,0,0,,All right, finally, we're going
Dialogue: 0,0:28:39.25,0:28:40.75,Default,,0,0,0,,to stop our workout and see our
Dialogue: 0,0:28:40.75,0:28:41.36,Default,,0,0,0,,summary.
Dialogue: 0,0:28:42.10,0:28:44.22,Default,,0,0,0,,And then, I'm going to open
Dialogue: 0,0:28:44.22,0:28:46.01,Default,,0,0,0,,HealthKit to show you that this
Dialogue: 0,0:28:46.19,0:28:47.04,Default,,0,0,0,,data has been saved.
Dialogue: 0,0:28:47.41,0:28:49.43,Default,,0,0,0,,So, I'll open the Health app.
Dialogue: 0,0:28:51.28,0:28:52.81,Default,,0,0,0,,And here we see a list of
Dialogue: 0,0:28:52.81,0:28:53.31,Default,,0,0,0,,workouts.
Dialogue: 0,0:28:53.31,0:28:56.54,Default,,0,0,0,,So, in the most recent one,
Dialogue: 0,0:28:56.60,0:28:58.14,Default,,0,0,0,,we'll see here we have workout
Dialogue: 0,0:28:58.14,0:28:58.66,Default,,0,0,0,,route saved.
Dialogue: 0,0:28:59.46,0:29:01.76,Default,,0,0,0,,I can click in and look about
Dialogue: 0,0:29:01.76,0:29:02.50,Default,,0,0,0,,this map view.
Dialogue: 0,0:29:03.52,0:29:04.91,Default,,0,0,0,,And now other applications that
Dialogue: 0,0:29:04.91,0:29:06.55,Default,,0,0,0,,have access to WorkoutRoute can
Dialogue: 0,0:29:06.55,0:29:08.15,Default,,0,0,0,,also receive this data and
Dialogue: 0,0:29:08.15,0:29:09.58,Default,,0,0,0,,analyze it, or do anything else
Dialogue: 0,0:29:09.62,0:29:10.85,Default,,0,0,0,,that they see fit.
Dialogue: 0,0:29:13.10,0:29:15.19,Default,,0,0,0,,So, that's how easy it is to add
Dialogue: 0,0:29:15.19,0:29:16.59,Default,,0,0,0,,WorkoutRoutes to your existing
Dialogue: 0,0:29:16.59,0:29:17.21,Default,,0,0,0,,application.
Dialogue: 0,0:29:17.49,0:29:18.53,Default,,0,0,0,,I'm going to switch back to the
Dialogue: 0,0:29:18.53,0:29:22.71,Default,,0,0,0,,slides, and then I want to
Dialogue: 0,0:29:22.94,0:29:24.26,Default,,0,0,0,,summarize what I've just done.
Dialogue: 0,0:29:24.88,0:29:26.11,Default,,0,0,0,,So, I first implemented the
Dialogue: 0,0:29:26.11,0:29:27.35,Default,,0,0,0,,CLLocationManager delegate
Dialogue: 0,0:29:27.35,0:29:27.97,Default,,0,0,0,,protocol.
Dialogue: 0,0:29:28.29,0:29:29.72,Default,,0,0,0,,I kept around some variables to
Dialogue: 0,0:29:29.72,0:29:31.12,Default,,0,0,0,,keep track of the state, both
Dialogue: 0,0:29:31.12,0:29:32.38,Default,,0,0,0,,from HealthKit and from Core
Dialogue: 0,0:29:32.38,0:29:32.96,Default,,0,0,0,,Location.
Dialogue: 0,0:29:33.70,0:29:35.39,Default,,0,0,0,,I set up the Location Manager.
Dialogue: 0,0:29:35.84,0:29:37.75,Default,,0,0,0,,I made sure to insert the
Dialogue: 0,0:29:37.75,0:29:39.49,Default,,0,0,0,,location data I got and Location
Dialogue: 0,0:29:39.49,0:29:41.73,Default,,0,0,0,,Manager did update location into
Dialogue: 0,0:29:41.73,0:29:42.69,Default,,0,0,0,,the WorkoutRouteBuilder.
Dialogue: 0,0:29:43.46,0:29:45.01,Default,,0,0,0,,I made sure to stop updating
Dialogue: 0,0:29:45.01,0:29:46.06,Default,,0,0,0,,location when I finished.
Dialogue: 0,0:29:46.54,0:29:47.98,Default,,0,0,0,,And then finally after the
Dialogue: 0,0:29:47.98,0:29:49.75,Default,,0,0,0,,workout was saved I finished the
Dialogue: 0,0:29:49.75,0:29:50.33,Default,,0,0,0,,WorkoutRoute.
Dialogue: 0,0:29:52.59,0:29:53.75,Default,,0,0,0,,So, next I want to hand it over
Dialogue: 0,0:29:53.75,0:29:55.13,Default,,0,0,0,,to my colleague Michael, who's
Dialogue: 0,0:29:55.13,0:29:56.01,Default,,0,0,0,,going to talk to you about a new
Dialogue: 0,0:29:56.01,0:29:57.27,Default,,0,0,0,,feature called Sync Identifiers.
Dialogue: 0,0:29:57.55,0:29:57.85,Default,,0,0,0,,Thank you.
Dialogue: 0,0:29:58.52,0:30:06.01,Default,,0,0,0,,[ Applause ]
Dialogue: 0,0:30:06.51,0:30:07.05,Default,,0,0,0,,>> Thanks Alexa.
Dialogue: 0,0:30:07.70,0:30:09.59,Default,,0,0,0,,Hi. I'm Michael and I'm an iOS
Dialogue: 0,0:30:09.59,0:30:10.81,Default,,0,0,0,,software engineer on the
Dialogue: 0,0:30:10.81,0:30:11.93,Default,,0,0,0,,HealthKit team.
Dialogue: 0,0:30:12.48,0:30:14.19,Default,,0,0,0,,Today our users are carrying
Dialogue: 0,0:30:14.19,0:30:15.44,Default,,0,0,0,,more than one device, such as a
Dialogue: 0,0:30:15.44,0:30:16.60,Default,,0,0,0,,watch and a phone.
Dialogue: 0,0:30:17.87,0:30:19.01,Default,,0,0,0,,We know that it's important that
Dialogue: 0,0:30:19.01,0:30:20.14,Default,,0,0,0,,you want to make sure that your
Dialogue: 0,0:30:20.14,0:30:21.44,Default,,0,0,0,,health apps data stays
Dialogue: 0,0:30:21.44,0:30:22.79,Default,,0,0,0,,consistent across all their
Dialogue: 0,0:30:22.79,0:30:23.31,Default,,0,0,0,,devices.
Dialogue: 0,0:30:23.77,0:30:24.98,Default,,0,0,0,,Sometimes this can be rather
Dialogue: 0,0:30:24.98,0:30:25.41,Default,,0,0,0,,difficult.
Dialogue: 0,0:30:27.99,0:30:29.35,Default,,0,0,0,,Sometimes, we want to be able to
Dialogue: 0,0:30:29.35,0:30:31.05,Default,,0,0,0,,add a sample to one device, and
Dialogue: 0,0:30:31.05,0:30:31.96,Default,,0,0,0,,then also add a sample to
Dialogue: 0,0:30:31.96,0:30:33.53,Default,,0,0,0,,another device, and then have
Dialogue: 0,0:30:33.53,0:30:34.94,Default,,0,0,0,,the sample synced over, it can
Dialogue: 0,0:30:34.94,0:30:35.97,Default,,0,0,0,,get sometimes complicated.
Dialogue: 0,0:30:36.96,0:30:39.34,Default,,0,0,0,,In iOS 11 and watchOS 4 we've
Dialogue: 0,0:30:39.34,0:30:40.66,Default,,0,0,0,,introduced Sync Identifiers.
Dialogue: 0,0:30:41.64,0:30:43.45,Default,,0,0,0,,Sync Identifiers allows you to
Dialogue: 0,0:30:43.45,0:30:44.94,Default,,0,0,0,,uniquely identify a sample
Dialogue: 0,0:30:44.94,0:30:46.45,Default,,0,0,0,,within HealthKit across all your
Dialogue: 0,0:30:46.45,0:30:47.23,Default,,0,0,0,,user's devices.
Dialogue: 0,0:30:47.96,0:30:51.01,Default,,0,0,0,,To support this, we've added two
Dialogue: 0,0:30:51.01,0:30:51.86,Default,,0,0,0,,new metadata keys.
Dialogue: 0,0:30:52.37,0:30:52.79,Default,,0,0,0,,These are
Dialogue: 0,0:30:52.79,0:30:55.01,Default,,0,0,0,,HKMetadatKeySyncIdentifier and
Dialogue: 0,0:30:55.01,0:30:56.49,Default,,0,0,0,,HKMetadataKeySyncVersion.
Dialogue: 0,0:30:57.08,0:30:59.99,Default,,0,0,0,,The Sync Identifier can be any
Dialogue: 0,0:30:59.99,0:31:01.17,Default,,0,0,0,,string, such as a string
Dialogue: 0,0:31:01.17,0:31:03.42,Default,,0,0,0,,representation of a UUID or the
Dialogue: 0,0:31:03.42,0:31:04.39,Default,,0,0,0,,primary key in a remote
Dialogue: 0,0:31:04.39,0:31:04.95,Default,,0,0,0,,database.
Dialogue: 0,0:31:05.46,0:31:08.01,Default,,0,0,0,,The sync version can be any
Dialogue: 0,0:31:08.01,0:31:08.31,Default,,0,0,0,,number.
Dialogue: 0,0:31:09.76,0:31:11.23,Default,,0,0,0,,HealthKit will use this version
Dialogue: 0,0:31:11.40,0:31:12.81,Default,,0,0,0,,to perform conflict resolution
Dialogue: 0,0:31:12.84,0:31:13.55,Default,,0,0,0,,on your behalf.
Dialogue: 0,0:31:13.66,0:31:15.41,Default,,0,0,0,,So, when you save a sample into
Dialogue: 0,0:31:15.41,0:31:16.82,Default,,0,0,0,,HealthKit, first it will look
Dialogue: 0,0:31:16.82,0:31:18.17,Default,,0,0,0,,for an existing sample matching
Dialogue: 0,0:31:18.17,0:31:18.98,Default,,0,0,0,,the Sync Identifier.
Dialogue: 0,0:31:19.70,0:31:20.98,Default,,0,0,0,,If it finds a sample, it will
Dialogue: 0,0:31:20.98,0:31:21.91,Default,,0,0,0,,then compare the version.
Dialogue: 0,0:31:22.22,0:31:23.75,Default,,0,0,0,,If your new sample has a higher
Dialogue: 0,0:31:23.75,0:31:25.28,Default,,0,0,0,,version, HealthKit will delete
Dialogue: 0,0:31:25.28,0:31:26.69,Default,,0,0,0,,the original sample, and then
Dialogue: 0,0:31:26.86,0:31:28.27,Default,,0,0,0,,save your new sample in its
Dialogue: 0,0:31:28.27,0:31:28.69,Default,,0,0,0,,place.
Dialogue: 0,0:31:29.10,0:31:30.56,Default,,0,0,0,,If you save a sample with a
Dialogue: 0,0:31:30.56,0:31:31.77,Default,,0,0,0,,lower version, HealthKit will
Dialogue: 0,0:31:31.77,0:31:32.53,Default,,0,0,0,,ignore this safe.
Dialogue: 0,0:31:35.48,0:31:36.96,Default,,0,0,0,,You must use both these keys
Dialogue: 0,0:31:36.96,0:31:37.81,Default,,0,0,0,,together to enable this
Dialogue: 0,0:31:37.81,0:31:38.21,Default,,0,0,0,,behavior.
Dialogue: 0,0:31:39.85,0:31:41.49,Default,,0,0,0,,This metadata applies to any HK
Dialogue: 0,0:31:41.49,0:31:41.86,Default,,0,0,0,,object.
Dialogue: 0,0:31:42.04,0:31:43.43,Default,,0,0,0,,Such as an HKSample, or an
Dialogue: 0,0:31:43.43,0:31:43.99,Default,,0,0,0,,HKWorkout.
Dialogue: 0,0:31:45.78,0:31:47.32,Default,,0,0,0,,Further, it's important to note
Dialogue: 0,0:31:47.32,0:31:48.53,Default,,0,0,0,,that this is restricted to your
Dialogue: 0,0:31:48.53,0:31:49.00,Default,,0,0,0,,source.
Dialogue: 0,0:31:49.72,0:31:51.26,Default,,0,0,0,,So, only your app can override
Dialogue: 0,0:31:51.26,0:31:52.87,Default,,0,0,0,,samples that you inserted.
Dialogue: 0,0:31:57.86,0:31:59.73,Default,,0,0,0,,Sync Identifiers adds a whole
Dialogue: 0,0:31:59.73,0:32:00.97,Default,,0,0,0,,new flexibility to how you can
Dialogue: 0,0:32:00.97,0:32:02.29,Default,,0,0,0,,manage your data.
Dialogue: 0,0:32:03.20,0:32:04.91,Default,,0,0,0,,By just using these two metadata
Dialogue: 0,0:32:04.91,0:32:06.45,Default,,0,0,0,,keys, you could ensure sample
Dialogue: 0,0:32:06.45,0:32:07.81,Default,,0,0,0,,uniqueness across all your
Dialogue: 0,0:32:07.81,0:32:08.22,Default,,0,0,0,,devices.
Dialogue: 0,0:32:10.66,0:32:12.79,Default,,0,0,0,,Further, by taking advantage of
Dialogue: 0,0:32:13.22,0:32:15.42,Default,,0,0,0,,the version key, you can also
Dialogue: 0,0:32:15.42,0:32:16.60,Default,,0,0,0,,enable local versioning.
Dialogue: 0,0:32:20.48,0:32:21.86,Default,,0,0,0,,HealthKit will manage all
Dialogue: 0,0:32:21.86,0:32:23.19,Default,,0,0,0,,conflict resolution for you,
Dialogue: 0,0:32:24.01,0:32:25.42,Default,,0,0,0,,upon saving and syncing.
Dialogue: 0,0:32:26.90,0:32:28.97,Default,,0,0,0,,Additionally, all operations
Dialogue: 0,0:32:29.04,0:32:30.72,Default,,0,0,0,,done using Sync Identifiers are
Dialogue: 0,0:32:30.72,0:32:31.66,Default,,0,0,0,,transaction safe.
Dialogue: 0,0:32:32.16,0:32:33.39,Default,,0,0,0,,That means that if there was any
Dialogue: 0,0:32:33.39,0:32:35.36,Default,,0,0,0,,error, then you can know that
Dialogue: 0,0:32:35.36,0:32:36.63,Default,,0,0,0,,your data will be in a
Dialogue: 0,0:32:36.68,0:32:38.97,Default,,0,0,0,,consistent state.
Dialogue: 0,0:32:39.18,0:32:40.66,Default,,0,0,0,,And finally, relationships to
Dialogue: 0,0:32:40.66,0:32:42.15,Default,,0,0,0,,parent objects are maintained.
Dialogue: 0,0:32:42.79,0:32:44.09,Default,,0,0,0,,If you replace a sample that's
Dialogue: 0,0:32:44.09,0:32:45.91,Default,,0,0,0,,been associated to an HKWorkout,
Dialogue: 0,0:32:45.91,0:32:47.86,Default,,0,0,0,,or a HKCorrelation, the replaced
Dialogue: 0,0:32:47.86,0:32:49.41,Default,,0,0,0,,sample will still be associated
Dialogue: 0,0:32:49.41,0:32:50.73,Default,,0,0,0,,to that HKWorkout or
Dialogue: 0,0:32:50.73,0:32:51.47,Default,,0,0,0,,HKCorrelation.
Dialogue: 0,0:32:52.63,0:32:57.32,Default,,0,0,0,,Now, let's take a look at how
Dialogue: 0,0:32:57.32,0:32:58.66,Default,,0,0,0,,using sync identifiers can
Dialogue: 0,0:32:58.66,0:33:00.21,Default,,0,0,0,,enable our apps to become fully
Dialogue: 0,0:33:00.21,0:33:00.74,Default,,0,0,0,,independent.
Dialogue: 0,0:33:01.65,0:33:03.10,Default,,0,0,0,,Imagine we have a workout app on
Dialogue: 0,0:33:03.10,0:33:04.73,Default,,0,0,0,,our phone and a WatchKit
Dialogue: 0,0:33:04.73,0:33:05.14,Default,,0,0,0,,extension.
Dialogue: 0,0:33:05.57,0:33:06.64,Default,,0,0,0,,We're going to us a remote
Dialogue: 0,0:33:06.64,0:33:08.12,Default,,0,0,0,,server to provide some
Dialogue: 0,0:33:08.12,0:33:09.31,Default,,0,0,0,,additional processing after the
Dialogue: 0,0:33:09.31,0:33:12.82,Default,,0,0,0,,workout has completed.
Dialogue: 0,0:33:12.82,0:33:14.04,Default,,0,0,0,,Our user is going to perform a
Dialogue: 0,0:33:14.04,0:33:15.72,Default,,0,0,0,,workout using their watch, and
Dialogue: 0,0:33:15.72,0:33:16.89,Default,,0,0,0,,our app is going to save this
Dialogue: 0,0:33:16.89,0:33:17.77,Default,,0,0,0,,data into HealthKit.
Dialogue: 0,0:33:17.98,0:33:19.28,Default,,0,0,0,,We're going to use a random Sync
Dialogue: 0,0:33:19.28,0:33:20.75,Default,,0,0,0,,Identifier and because this is
Dialogue: 0,0:33:20.75,0:33:21.97,Default,,0,0,0,,the initial version, we're going
Dialogue: 0,0:33:21.97,0:33:22.87,Default,,0,0,0,,to call this version 1.
Dialogue: 0,0:33:23.38,0:33:26.66,Default,,0,0,0,,After the save our watch can
Dialogue: 0,0:33:26.66,0:33:29.00,Default,,0,0,0,,upload the data directly to our
Dialogue: 0,0:33:30.56,0:33:31.01,Default,,0,0,0,,cloud.
Dialogue: 0,0:33:31.01,0:33:33.37,Default,,0,0,0,,As usual, HealthKit notices that
Dialogue: 0,0:33:33.37,0:33:34.68,Default,,0,0,0,,there's new data and syncs our
Dialogue: 0,0:33:34.68,0:33:35.18,Default,,0,0,0,,devices.
Dialogue: 0,0:33:35.81,0:33:39.41,Default,,0,0,0,,Now, the sample exists on both
Dialogue: 0,0:33:39.41,0:33:42.98,Default,,0,0,0,,of our devices.
Dialogue: 0,0:33:43.05,0:33:44.18,Default,,0,0,0,,Sometime later our cloud
Dialogue: 0,0:33:44.18,0:33:45.55,Default,,0,0,0,,finishes processing the data and
Dialogue: 0,0:33:45.55,0:33:46.88,Default,,0,0,0,,at this point, we can call this
Dialogue: 0,0:33:46.88,0:33:47.40,Default,,0,0,0,,version 2.
Dialogue: 0,0:33:47.98,0:33:52.41,Default,,0,0,0,,Our phone notices new data in
Dialogue: 0,0:33:52.41,0:33:54.09,Default,,0,0,0,,cloud and decides to download it
Dialogue: 0,0:33:54.09,0:33:55.06,Default,,0,0,0,,and save it into HealthKit.
Dialogue: 0,0:33:55.06,0:33:56.45,Default,,0,0,0,,We're going to use the same Sync
Dialogue: 0,0:33:56.45,0:33:57.37,Default,,0,0,0,,Identifier that we used
Dialogue: 0,0:33:57.53,0:33:58.89,Default,,0,0,0,,previously, but this time we're
Dialogue: 0,0:33:58.89,0:34:00.66,Default,,0,0,0,,going to set the version to 2.
Dialogue: 0,0:34:02.38,0:34:03.53,Default,,0,0,0,,Because we're using Sync
Dialogue: 0,0:34:03.53,0:34:04.92,Default,,0,0,0,,Identifiers, HealthKit will
Dialogue: 0,0:34:04.92,0:34:06.03,Default,,0,0,0,,first look for an existing
Dialogue: 0,0:34:06.03,0:34:07.32,Default,,0,0,0,,sample matching that identifier.
Dialogue: 0,0:34:07.77,0:34:09.20,Default,,0,0,0,,In this case, it found that the
Dialogue: 0,0:34:09.20,0:34:10.52,Default,,0,0,0,,existing sample is a version 1,
Dialogue: 0,0:34:10.75,0:34:11.96,Default,,0,0,0,,and our new sample has a version
Dialogue: 0,0:34:11.96,0:34:12.16,Default,,0,0,0,,2.
Dialogue: 0,0:34:12.75,0:34:13.98,Default,,0,0,0,,So, it deleted the existing
Dialogue: 0,0:34:13.98,0:34:15.16,Default,,0,0,0,,sample and replaced it with our
Dialogue: 0,0:34:15.16,0:34:15.65,Default,,0,0,0,,new sample.
Dialogue: 0,0:34:17.16,0:34:18.68,Default,,0,0,0,,Again, HealthKit notices that
Dialogue: 0,0:34:18.68,0:34:20.69,Default,,0,0,0,,there's new data, so it performs
Dialogue: 0,0:34:21.53,0:34:25.26,Default,,0,0,0,,a sync.
Dialogue: 0,0:34:25.41,0:34:26.27,Default,,0,0,0,,Because we're using Sync
Dialogue: 0,0:34:26.27,0:34:28.19,Default,,0,0,0,,Identifiers during sync
Dialogue: 0,0:34:28.19,0:34:29.51,Default,,0,0,0,,HealthKit will also look for an
Dialogue: 0,0:34:29.51,0:34:30.67,Default,,0,0,0,,existing sample matching the
Dialogue: 0,0:34:30.67,0:34:31.37,Default,,0,0,0,,Sync Identifier.
Dialogue: 0,0:34:32.08,0:34:33.13,Default,,0,0,0,,In our case, it found the
Dialogue: 0,0:34:33.17,0:34:33.85,Default,,0,0,0,,original sample.
Dialogue: 0,0:34:34.56,0:34:35.78,Default,,0,0,0,,Notice that our new sample has a
Dialogue: 0,0:34:35.78,0:34:37.27,Default,,0,0,0,,version 2, so it deleted the
Dialogue: 0,0:34:37.27,0:34:38.49,Default,,0,0,0,,original sample and replaced it
Dialogue: 0,0:34:38.49,0:34:39.14,Default,,0,0,0,,with our new sample.
Dialogue: 0,0:34:39.70,0:34:42.52,Default,,0,0,0,,As we expect, there's only one
Dialogue: 0,0:34:42.52,0:34:43.83,Default,,0,0,0,,sample in all of our devices,
Dialogue: 0,0:34:44.01,0:34:45.07,Default,,0,0,0,,and HealthKit managed all the
Dialogue: 0,0:34:45.07,0:34:46.89,Default,,0,0,0,,conflict resolution for us.
Dialogue: 0,0:34:49.16,0:34:50.78,Default,,0,0,0,,Because your apps are fully
Dialogue: 0,0:34:50.78,0:34:52.25,Default,,0,0,0,,independent, the Watch does not
Dialogue: 0,0:34:52.25,0:34:53.88,Default,,0,0,0,,need to know whether the phone
Dialogue: 0,0:34:53.88,0:34:54.99,Default,,0,0,0,,has downloaded data or not.
Dialogue: 0,0:34:55.79,0:34:57.77,Default,,0,0,0,,So, our Watch app sees new data
Dialogue: 0,0:34:57.77,0:34:59.42,Default,,0,0,0,,in the cloud, downloads it and
Dialogue: 0,0:34:59.42,0:35:00.25,Default,,0,0,0,,saves into HealthKit.
Dialogue: 0,0:35:00.39,0:35:01.64,Default,,0,0,0,,We're going to use the same Sync
Dialogue: 0,0:35:01.64,0:35:03.28,Default,,0,0,0,,Identifier and we're also going
Dialogue: 0,0:35:03.28,0:35:06.62,Default,,0,0,0,,to specify the version as 2.
Dialogue: 0,0:35:06.86,0:35:08.44,Default,,0,0,0,,In this case, HealthKit saw that
Dialogue: 0,0:35:08.73,0:35:09.80,Default,,0,0,0,,there already existed sample
Dialogue: 0,0:35:09.80,0:35:11.19,Default,,0,0,0,,with the same identifier, and
Dialogue: 0,0:35:11.19,0:35:11.88,Default,,0,0,0,,the same version.
Dialogue: 0,0:35:12.45,0:35:13.43,Default,,0,0,0,,So, this sample is ignored.
Dialogue: 0,0:35:13.94,0:35:18.33,Default,,0,0,0,,As we expect, we have one sample
Dialogue: 0,0:35:18.33,0:35:19.62,Default,,0,0,0,,on all of our devices and
Dialogue: 0,0:35:19.62,0:35:20.51,Default,,0,0,0,,HealthKit managed all the
Dialogue: 0,0:35:20.51,0:35:21.69,Default,,0,0,0,,conflict resolution for us.
Dialogue: 0,0:35:21.91,0:35:25.78,Default,,0,0,0,,Now, our app can upload and
Dialogue: 0,0:35:25.78,0:35:27.24,Default,,0,0,0,,download, and sync whenever it
Dialogue: 0,0:35:27.24,0:35:27.56,Default,,0,0,0,,wants.
Dialogue: 0,0:35:27.76,0:35:28.81,Default,,0,0,0,,And we don't have to worry about
Dialogue: 0,0:35:28.81,0:35:29.19,Default,,0,0,0,,anything.
Dialogue: 0,0:35:29.52,0:35:30.56,Default,,0,0,0,,HealthKit manages all the
Dialogue: 0,0:35:30.56,0:35:32.19,Default,,0,0,0,,conflict resolution for us and
Dialogue: 0,0:35:32.19,0:35:33.68,Default,,0,0,0,,handles all the complicated
Dialogue: 0,0:35:33.77,0:35:34.51,Default,,0,0,0,,things necessary.
Dialogue: 0,0:35:37.28,0:35:37.87,Default,,0,0,0,,All right.
Dialogue: 0,0:35:38.07,0:35:39.58,Default,,0,0,0,,Alexa just added WorkoutRoutes
Dialogue: 0,0:35:39.58,0:35:40.24,Default,,0,0,0,,to Speedy Sloth.
Dialogue: 0,0:35:40.64,0:35:42.52,Default,,0,0,0,,Now, I'm going to do a demo on
Dialogue: 0,0:35:42.52,0:35:43.42,Default,,0,0,0,,how to update this route.
Dialogue: 0,0:35:45.69,0:35:47.59,Default,,0,0,0,,A common example of this might
Dialogue: 0,0:35:47.59,0:35:49.05,Default,,0,0,0,,be to do some additional
Dialogue: 0,0:35:49.05,0:35:50.21,Default,,0,0,0,,processing such as smoothing out
Dialogue: 0,0:35:50.21,0:35:51.82,Default,,0,0,0,,the route and then we want to
Dialogue: 0,0:35:51.82,0:35:52.95,Default,,0,0,0,,update the route in place.
Dialogue: 0,0:35:53.44,0:35:55.70,Default,,0,0,0,,So, first I'm going to go to
Dialogue: 0,0:35:56.76,0:35:57.12,Default,,0,0,0,,Speedy Sloth.
Dialogue: 0,0:35:57.12,0:35:58.26,Default,,0,0,0,,Earlier, I added this new
Dialogue: 0,0:35:58.26,0:35:59.88,Default,,0,0,0,,ability to Speedy Sloth, to
Dialogue: 0,0:35:59.88,0:36:00.97,Default,,0,0,0,,slothify our workouts.
Dialogue: 0,0:36:01.49,0:36:04.01,Default,,0,0,0,,What this means, it's going to
Dialogue: 0,0:36:04.01,0:36:05.57,Default,,0,0,0,,take our original route and
Dialogue: 0,0:36:05.57,0:36:06.97,Default,,0,0,0,,change it so we visit every tree
Dialogue: 0,0:36:06.97,0:36:07.49,Default,,0,0,0,,along the way.
Dialogue: 0,0:36:07.66,0:36:09.03,Default,,0,0,0,,Just like a sloth would.
Dialogue: 0,0:36:10.50,0:36:13.21,Default,,0,0,0,,All right, so let's see the
Dialogue: 0,0:36:13.21,0:36:14.38,Default,,0,0,0,,implementation of this method.
Dialogue: 0,0:36:14.66,0:36:16.54,Default,,0,0,0,,First, we're going to go to
Dialogue: 0,0:36:16.54,0:36:17.66,Default,,0,0,0,,configuration interface
Dialogue: 0,0:36:17.66,0:36:18.06,Default,,0,0,0,,controller.
Dialogue: 0,0:36:18.66,0:36:22.26,Default,,0,0,0,,In this class, we have a method
Dialogue: 0,0:36:22.26,0:36:23.48,Default,,0,0,0,,called updateWorkoutRoute.
Dialogue: 0,0:36:24.90,0:36:26.77,Default,,0,0,0,,This method takes a workout, a
Dialogue: 0,0:36:26.77,0:36:28.00,Default,,0,0,0,,route from that workout and all
Dialogue: 0,0:36:28.00,0:36:29.96,Default,,0,0,0,,the locations from that route.
Dialogue: 0,0:36:30.24,0:36:31.50,Default,,0,0,0,,Below in this file, I've already
Dialogue: 0,0:36:31.50,0:36:32.62,Default,,0,0,0,,performed all the necessary
Dialogue: 0,0:36:32.62,0:36:33.61,Default,,0,0,0,,queries to collect all this
Dialogue: 0,0:36:33.61,0:36:33.83,Default,,0,0,0,,data.
Dialogue: 0,0:36:34.76,0:36:36.31,Default,,0,0,0,,When we press slothify workouts,
Dialogue: 0,0:36:36.45,0:36:37.34,Default,,0,0,0,,it's going to collect all this
Dialogue: 0,0:36:37.34,0:36:38.41,Default,,0,0,0,,data and then pass it to this
Dialogue: 0,0:36:38.41,0:36:38.72,Default,,0,0,0,,method.
Dialogue: 0,0:36:42.25,0:36:43.76,Default,,0,0,0,,With our raw locations collected
Dialogue: 0,0:36:43.76,0:36:44.88,Default,,0,0,0,,from the initial workout, we're
Dialogue: 0,0:36:44.88,0:36:45.56,Default,,0,0,0,,going to pass this to our
Dialogue: 0,0:36:45.56,0:36:47.28,Default,,0,0,0,,method, slothifyRouteLocations.
Dialogue: 0,0:36:47.55,0:36:49.00,Default,,0,0,0,,This is going to take our
Dialogue: 0,0:36:49.00,0:36:50.66,Default,,0,0,0,,locations, find all the trees,
Dialogue: 0,0:36:50.69,0:36:51.56,Default,,0,0,0,,and then adjust our route
Dialogue: 0,0:36:51.56,0:36:52.20,Default,,0,0,0,,accordingly.
Dialogue: 0,0:36:52.38,0:36:54.30,Default,,0,0,0,,Now, we're going to have the new
Dialogue: 0,0:36:54.30,0:36:54.95,Default,,0,0,0,,locations.
Dialogue: 0,0:36:56.03,0:36:57.25,Default,,0,0,0,,Next, we're going to create a
Dialogue: 0,0:36:57.25,0:36:58.71,Default,,0,0,0,,new WorkoutRoute and associate
Dialogue: 0,0:36:58.71,0:36:59.53,Default,,0,0,0,,this with our workout.
Dialogue: 0,0:36:59.95,0:37:01.74,Default,,0,0,0,,To do this, we're going to
Dialogue: 0,0:37:01.74,0:37:04.10,Default,,0,0,0,,create an HKWorkoutRouteBuilder.
Dialogue: 0,0:37:04.64,0:37:07.52,Default,,0,0,0,,Again, we're going to pass our
Dialogue: 0,0:37:07.52,0:37:08.90,Default,,0,0,0,,healthStore and a nil device to
Dialogue: 0,0:37:08.90,0:37:10.03,Default,,0,0,0,,represent our local source.
Dialogue: 0,0:37:10.59,0:37:13.83,Default,,0,0,0,,To insert the locations, we're
Dialogue: 0,0:37:14.86,0:37:16.86,Default,,0,0,0,,going to call insertRouteData on
Dialogue: 0,0:37:16.86,0:37:18.13,Default,,0,0,0,,our WorkoutRouteBuilder passing
Dialogue: 0,0:37:18.13,0:37:18.99,Default,,0,0,0,,our new locations.
Dialogue: 0,0:37:19.49,0:37:22.40,Default,,0,0,0,,We're going to ensure that this
Dialogue: 0,0:37:22.40,0:37:24.11,Default,,0,0,0,,was successful, and once that is
Dialogue: 0,0:37:24.11,0:37:25.53,Default,,0,0,0,,done, we're going to finish our
Dialogue: 0,0:37:25.53,0:37:27.53,Default,,0,0,0,,route on the original workout.
Dialogue: 0,0:37:28.04,0:37:30.63,Default,,0,0,0,,All right, let's see this in
Dialogue: 0,0:37:30.63,0:37:30.81,Default,,0,0,0,,action.
Dialogue: 0,0:37:36.77,0:37:38.83,Default,,0,0,0,,Here is Alexa's original route.
Dialogue: 0,0:37:45.05,0:37:46.40,Default,,0,0,0,,Let's go ahead and slothify that
Dialogue: 0,0:37:46.58,0:37:46.70,Default,,0,0,0,,route.
Dialogue: 0,0:37:47.52,0:38:11.26,Default,,0,0,0,,[Pause]
Dialogue: 0,0:38:11.76,0:38:12.83,Default,,0,0,0,,All right, as you can see the
Dialogue: 0,0:38:12.83,0:38:14.15,Default,,0,0,0,,original route was slothified,
Dialogue: 0,0:38:14.18,0:38:15.10,Default,,0,0,0,,and then applied onto the
Dialogue: 0,0:38:15.10,0:38:15.49,Default,,0,0,0,,workout.
Dialogue: 0,0:38:16.54,0:38:18.77,Default,,0,0,0,,But the original route is still
Dialogue: 0,0:38:18.77,0:38:19.04,Default,,0,0,0,,there.
Dialogue: 0,0:38:19.04,0:38:21.42,Default,,0,0,0,,What we need to do now is delete
Dialogue: 0,0:38:21.42,0:38:23.49,Default,,0,0,0,,the original route and then add
Dialogue: 0,0:38:23.49,0:38:24.02,Default,,0,0,0,,our new route.
Dialogue: 0,0:38:24.46,0:38:25.10,Default,,0,0,0,,This can get kind of
Dialogue: 0,0:38:25.10,0:38:25.69,Default,,0,0,0,,complicated.
Dialogue: 0,0:38:25.69,0:38:26.62,Default,,0,0,0,,We need to make sure the data
Dialogue: 0,0:38:26.62,0:38:27.96,Default,,0,0,0,,has been synced over correctly,
Dialogue: 0,0:38:28.23,0:38:29.30,Default,,0,0,0,,and then it's also not really
Dialogue: 0,0:38:29.30,0:38:30.16,Default,,0,0,0,,transaction safe.
Dialogue: 0,0:38:30.30,0:38:32.96,Default,,0,0,0,,So, to do this, very easily, I'm
Dialogue: 0,0:38:32.96,0:38:34.37,Default,,0,0,0,,going to use Sync Identifiers.
Dialogue: 0,0:38:34.86,0:38:37.56,Default,,0,0,0,,First, I'm going to go to where
Dialogue: 0,0:38:37.56,0:38:38.57,Default,,0,0,0,,we originally created the
Dialogue: 0,0:38:38.57,0:38:39.08,Default,,0,0,0,,WorkoutRoute.
Dialogue: 0,0:38:39.60,0:38:42.33,Default,,0,0,0,,In this save workout method,
Dialogue: 0,0:38:43.05,0:38:44.56,Default,,0,0,0,,after we've originally saved the
Dialogue: 0,0:38:44.56,0:38:46.34,Default,,0,0,0,,workout, and right before we
Dialogue: 0,0:38:46.34,0:38:48.10,Default,,0,0,0,,finish the route, I'm going to
Dialogue: 0,0:38:48.10,0:38:49.35,Default,,0,0,0,,add in some Sync Identifier
Dialogue: 0,0:38:49.35,0:38:49.79,Default,,0,0,0,,metadata.
Dialogue: 0,0:39:02.08,0:39:03.33,Default,,0,0,0,,First, I'm going to create the
Dialogue: 0,0:39:03.33,0:39:04.24,Default,,0,0,0,,metadata dictionary.
Dialogue: 0,0:39:06.08,0:39:07.89,Default,,0,0,0,,Next, I'm going to assign the
Dialogue: 0,0:39:07.89,0:39:10.05,Default,,0,0,0,,Sync Identifier metadata key to
Dialogue: 0,0:39:10.11,0:39:12.00,Default,,0,0,0,,string representation of a UUID.
Dialogue: 0,0:39:13.35,0:39:15.51,Default,,0,0,0,,Next, I'm going to set the sync
Dialogue: 0,0:39:15.51,0:39:17.12,Default,,0,0,0,,version to version 1, because
Dialogue: 0,0:39:17.12,0:39:18.14,Default,,0,0,0,,this is our initial route.
Dialogue: 0,0:39:19.58,0:39:20.43,Default,,0,0,0,,After we've created our
Dialogue: 0,0:39:20.43,0:39:22.71,Default,,0,0,0,,metadata, we're going to pass it
Dialogue: 0,0:39:23.28,0:39:24.40,Default,,0,0,0,,to finish route, so it is
Dialogue: 0,0:39:24.40,0:39:25.98,Default,,0,0,0,,associated to the workout route
Dialogue: 0,0:39:25.98,0:39:26.96,Default,,0,0,0,,when we save it onto the
Dialogue: 0,0:39:26.96,0:39:27.31,Default,,0,0,0,,workout.
Dialogue: 0,0:39:27.31,0:39:29.86,Default,,0,0,0,,Now let's go back to
Dialogue: 0,0:39:29.86,0:39:30.87,Default,,0,0,0,,configuration interface
Dialogue: 0,0:39:30.87,0:39:32.72,Default,,0,0,0,,controller to where we updated
Dialogue: 0,0:39:32.72,0:39:33.35,Default,,0,0,0,,this WorkoutRoute.
Dialogue: 0,0:39:35.48,0:39:37.41,Default,,0,0,0,,To enable Sync Identifiers,
Dialogue: 0,0:39:37.41,0:39:39.12,Default,,0,0,0,,we're also going to add the same
Dialogue: 0,0:39:39.12,0:39:41.65,Default,,0,0,0,,Sync Identifier metadata to our
Dialogue: 0,0:39:41.65,0:39:42.19,Default,,0,0,0,,updated route.
Dialogue: 0,0:39:43.67,0:39:45.55,Default,,0,0,0,,First, we're going to grab the
Dialogue: 0,0:39:45.55,0:39:47.03,Default,,0,0,0,,Sync Identifier that we used on
Dialogue: 0,0:39:47.03,0:39:47.60,Default,,0,0,0,,the original route.
Dialogue: 0,0:39:48.67,0:39:49.86,Default,,0,0,0,,Just in case our routes don't
Dialogue: 0,0:39:49.86,0:39:51.04,Default,,0,0,0,,have any metadata, we're going
Dialogue: 0,0:39:51.04,0:39:52.03,Default,,0,0,0,,to define a default value.
Dialogue: 0,0:39:52.53,0:39:55.81,Default,,0,0,0,,Next, let's create a metadata
Dialogue: 0,0:39:55.81,0:39:56.26,Default,,0,0,0,,dictionary.
Dialogue: 0,0:39:56.83,0:40:00.19,Default,,0,0,0,,Here, we create our dictionary
Dialogue: 0,0:40:00.74,0:40:02.75,Default,,0,0,0,,and then assigns the Sync
Dialogue: 0,0:40:02.75,0:40:04.16,Default,,0,0,0,,Identifier to the original Sync
Dialogue: 0,0:40:04.16,0:40:04.98,Default,,0,0,0,,Identifier we had.
Dialogue: 0,0:40:05.84,0:40:07.46,Default,,0,0,0,,Next, we're going to use the
Dialogue: 0,0:40:07.46,0:40:09.08,Default,,0,0,0,,sync version of 2, because this
Dialogue: 0,0:40:09.08,0:40:09.93,Default,,0,0,0,,is our updated route.
Dialogue: 0,0:40:11.41,0:40:13.14,Default,,0,0,0,,Again, let's pass the metadata
Dialogue: 0,0:40:13.61,0:40:15.09,Default,,0,0,0,,to finish route, so we associate
Dialogue: 0,0:40:15.09,0:40:16.15,Default,,0,0,0,,it to the WorkoutRoute when it
Dialogue: 0,0:40:16.15,0:40:17.10,Default,,0,0,0,,gets saved to the workout.
Dialogue: 0,0:40:18.22,0:40:19.46,Default,,0,0,0,,HealthKit will then replace our
Dialogue: 0,0:40:19.46,0:40:19.91,Default,,0,0,0,,original route.
Dialogue: 0,0:40:19.91,0:40:22.11,Default,,0,0,0,,All right, let's see this in
Dialogue: 0,0:40:22.11,0:40:22.41,Default,,0,0,0,,action.
Dialogue: 0,0:40:23.52,0:40:33.74,Default,,0,0,0,,[Pause]
Dialogue: 0,0:40:34.24,0:40:34.49,Default,,0,0,0,,All right.
Dialogue: 0,0:40:34.77,0:40:35.71,Default,,0,0,0,,First let's perform a new
Dialogue: 0,0:40:35.71,0:40:36.13,Default,,0,0,0,,workout.
Dialogue: 0,0:40:37.45,0:40:39.63,Default,,0,0,0,,When we save this workout, it
Dialogue: 0,0:40:39.63,0:40:40.76,Default,,0,0,0,,will have Sync Identifier
Dialogue: 0,0:40:40.76,0:40:41.34,Default,,0,0,0,,metadata.
Dialogue: 0,0:40:42.74,0:40:44.55,Default,,0,0,0,,After we've burn some calories
Dialogue: 0,0:40:44.86,0:40:46.98,Default,,0,0,0,,and walked a few meters, we're
Dialogue: 0,0:40:46.98,0:40:47.82,Default,,0,0,0,,going to go ahead and stop our
Dialogue: 0,0:40:47.82,0:40:49.93,Default,,0,0,0,,workout and save into HealthKit.
Dialogue: 0,0:40:56.05,0:40:56.99,Default,,0,0,0,,Here, we can see our original
Dialogue: 0,0:40:56.99,0:40:57.13,Default,,0,0,0,,route.
Dialogue: 0,0:40:57.13,0:40:59.93,Default,,0,0,0,,Now, let's go back and slothify
Dialogue: 0,0:40:59.93,0:41:00.93,Default,,0,0,0,,this route.
Dialogue: 0,0:41:01.52,0:41:14.90,Default,,0,0,0,,[Pause]
Dialogue: 0,0:41:15.40,0:41:15.78,Default,,0,0,0,,All right.
Dialogue: 0,0:41:16.42,0:41:17.59,Default,,0,0,0,,As you can see, the original
Dialogue: 0,0:41:17.59,0:41:18.99,Default,,0,0,0,,route was replaced with our new
Dialogue: 0,0:41:18.99,0:41:19.21,Default,,0,0,0,,route.
Dialogue: 0,0:41:19.93,0:41:20.94,Default,,0,0,0,,All we need to do is add a
Dialogue: 0,0:41:20.94,0:41:22.28,Default,,0,0,0,,couple metadata keys, and
Dialogue: 0,0:41:22.28,0:41:23.30,Default,,0,0,0,,HealthKit handled all the
Dialogue: 0,0:41:23.30,0:41:24.48,Default,,0,0,0,,conflict resolution for us.
Dialogue: 0,0:41:26.82,0:41:28.17,Default,,0,0,0,,Now, you can see how easy it is
Dialogue: 0,0:41:28.31,0:41:29.70,Default,,0,0,0,,to handle conflict resolution
Dialogue: 0,0:41:29.90,0:41:30.71,Default,,0,0,0,,and take advantage of
Dialogue: 0,0:41:30.71,0:41:31.60,Default,,0,0,0,,HealthKit's advanced new
Dialogue: 0,0:41:31.60,0:41:32.09,Default,,0,0,0,,features.
Dialogue: 0,0:41:34.44,0:41:36.58,Default,,0,0,0,,Okay, onto sample source
Dialogue: 0,0:41:36.58,0:41:37.06,Default,,0,0,0,,information.
Dialogue: 0,0:41:38.31,0:41:39.48,Default,,0,0,0,,It's important to know that when
Dialogue: 0,0:41:39.48,0:41:40.91,Default,,0,0,0,,you display data from HealthKit,
Dialogue: 0,0:41:41.77,0:41:43.16,Default,,0,0,0,,the origin of where the data
Dialogue: 0,0:41:43.16,0:41:43.67,Default,,0,0,0,,came from.
Dialogue: 0,0:41:44.36,0:41:46.95,Default,,0,0,0,,When you query for data, samples
Dialogue: 0,0:41:46.95,0:41:47.80,Default,,0,0,0,,will contain an
Dialogue: 0,0:41:47.80,0:41:48.74,Default,,0,0,0,,HKSourceRevision.
Dialogue: 0,0:41:49.33,0:41:51.67,Default,,0,0,0,,An HKSourceRevision includes the
Dialogue: 0,0:41:51.73,0:41:54.26,Default,,0,0,0,,app and the device which saved
Dialogue: 0,0:41:54.26,0:41:55.31,Default,,0,0,0,,the sample into HealthKit.
Dialogue: 0,0:41:56.72,0:41:58.61,Default,,0,0,0,,In iOS 11 and watchOS 4, we're
Dialogue: 0,0:41:58.61,0:42:00.26,Default,,0,0,0,,adding additional properties and
Dialogue: 0,0:42:00.26,0:42:01.92,Default,,0,0,0,,a few constants so you can gain
Dialogue: 0,0:42:01.92,0:42:03.36,Default,,0,0,0,,a deeper insight into the data
Dialogue: 0,0:42:03.36,0:42:04.69,Default,,0,0,0,,that you display form HealthKit.
Dialogue: 0,0:42:07.36,0:42:09.78,Default,,0,0,0,,In iOS 10 HKSourceRevision
Dialogue: 0,0:42:09.78,0:42:12.30,Default,,0,0,0,,included the source, as HK
Dialogue: 0,0:42:12.30,0:42:15.09,Default,,0,0,0,,source, and the version of the
Dialogue: 0,0:42:15.09,0:42:18.33,Default,,0,0,0,,app as an NSString.
Dialogue: 0,0:42:18.47,0:42:19.97,Default,,0,0,0,,First, we added product type.
Dialogue: 0,0:42:20.60,0:42:21.56,Default,,0,0,0,,Product type is a string
Dialogue: 0,0:42:21.56,0:42:23.00,Default,,0,0,0,,representation of the device
Dialogue: 0,0:42:23.00,0:42:24.47,Default,,0,0,0,,which saved the sample into
Dialogue: 0,0:42:24.47,0:42:24.94,Default,,0,0,0,,HealthKit.
Dialogue: 0,0:42:24.94,0:42:27.00,Default,,0,0,0,,So, if you save a sample on a
Dialogue: 0,0:42:27.00,0:42:28.63,Default,,0,0,0,,Watch Series 2, this will be
Dialogue: 0,0:42:28.63,0:42:30.93,Default,,0,0,0,,Watch 2, 4.
Dialogue: 0,0:42:31.32,0:42:32.85,Default,,0,0,0,,Next, we added operating system
Dialogue: 0,0:42:32.85,0:42:33.19,Default,,0,0,0,,version.
Dialogue: 0,0:42:34.16,0:42:35.21,Default,,0,0,0,,This is the operating system
Dialogue: 0,0:42:35.21,0:42:36.60,Default,,0,0,0,,that was running on the device
Dialogue: 0,0:42:36.79,0:42:38.23,Default,,0,0,0,,when the sample was saved into
Dialogue: 0,0:42:38.82,0:42:39.04,Default,,0,0,0,,HealthKit.
Dialogue: 0,0:42:39.50,0:42:41.58,Default,,0,0,0,,So, if we save the sample using
Dialogue: 0,0:42:41.58,0:42:44.55,Default,,0,0,0,,watchOS 4.0, this will return 4,
Dialogue: 0,0:42:44.55,0:42:45.48,Default,,0,0,0,,0, 0.
Dialogue: 0,0:42:46.28,0:42:49.18,Default,,0,0,0,,Next, we added three new
Dialogue: 0,0:42:49.18,0:42:49.84,Default,,0,0,0,,constants.
Dialogue: 0,0:42:50.06,0:42:50.71,Default,,0,0,0,,These constants are
Dialogue: 0,0:42:50.71,0:42:52.96,Default,,0,0,0,,HKSourceRevision, any version,
Dialogue: 0,0:42:53.49,0:42:54.98,Default,,0,0,0,,HKSourceRevision any product
Dialogue: 0,0:42:54.98,0:42:55.18,Default,,0,0,0,,type.
Dialogue: 0,0:42:55.72,0:42:57.29,Default,,0,0,0,,And HKSourceRevision any
Dialogue: 0,0:42:57.29,0:42:58.32,Default,,0,0,0,,operating system.
Dialogue: 0,0:42:58.93,0:43:00.30,Default,,0,0,0,,When creating predicates to
Dialogue: 0,0:43:00.30,0:43:02.78,Default,,0,0,0,,query for data, which involves
Dialogue: 0,0:43:02.78,0:43:04.56,Default,,0,0,0,,an HKSourceRevision, you must
Dialogue: 0,0:43:04.56,0:43:05.94,Default,,0,0,0,,specify all of these values.
Dialogue: 0,0:43:06.70,0:43:08.36,Default,,0,0,0,,You can use these constants so
Dialogue: 0,0:43:08.36,0:43:10.49,Default,,0,0,0,,you could gain a very specific
Dialogue: 0,0:43:10.49,0:43:13.40,Default,,0,0,0,,predicate, such as for a certain
Dialogue: 0,0:43:13.40,0:43:14.86,Default,,0,0,0,,product type, but any operating
Dialogue: 0,0:43:14.86,0:43:15.16,Default,,0,0,0,,system.
Dialogue: 0,0:43:16.25,0:43:18.18,Default,,0,0,0,,With this new information, you
Dialogue: 0,0:43:18.18,0:43:20.73,Default,,0,0,0,,can now gain deeper insight into
Dialogue: 0,0:43:20.73,0:43:21.91,Default,,0,0,0,,the data that you display in
Dialogue: 0,0:43:21.91,0:43:26.23,Default,,0,0,0,,your app.
Dialogue: 0,0:43:26.48,0:43:27.39,Default,,0,0,0,,All right.
Dialogue: 0,0:43:27.89,0:43:30.24,Default,,0,0,0,,Finally, supporting diabetes
Dialogue: 0,0:43:30.24,0:43:34.06,Default,,0,0,0,,management in HealthKit.
Dialogue: 0,0:43:34.06,0:43:35.52,Default,,0,0,0,,Our users love using Apple
Dialogue: 0,0:43:35.52,0:43:37.20,Default,,0,0,0,,products to help manage their
Dialogue: 0,0:43:37.20,0:43:37.61,Default,,0,0,0,,condition.
Dialogue: 0,0:43:38.22,0:43:40.47,Default,,0,0,0,,Today in HealthKit we have
Dialogue: 0,0:43:40.47,0:43:41.47,Default,,0,0,0,,support for tracking blood
Dialogue: 0,0:43:41.47,0:43:43.32,Default,,0,0,0,,glucose samples, keeping track
Dialogue: 0,0:43:43.32,0:43:44.75,Default,,0,0,0,,of carbohydrates and tracking
Dialogue: 0,0:43:44.80,0:43:46.07,Default,,0,0,0,,all kinds of activity data,
Dialogue: 0,0:43:46.37,0:43:47.62,Default,,0,0,0,,which is all useful in managing
Dialogue: 0,0:43:47.89,0:43:48.45,Default,,0,0,0,,diabetes.
Dialogue: 0,0:43:49.54,0:43:50.38,Default,,0,0,0,,We've heard there's some missing
Dialogue: 0,0:43:50.38,0:43:52.03,Default,,0,0,0,,pieces to the story and I'm
Dialogue: 0,0:43:52.03,0:43:53.11,Default,,0,0,0,,pleased to announce that we've
Dialogue: 0,0:43:53.11,0:43:54.40,Default,,0,0,0,,added some new additional
Dialogue: 0,0:43:54.45,0:43:55.98,Default,,0,0,0,,features to help out.
Dialogue: 0,0:44:00.37,0:44:02.29,Default,,0,0,0,,First, we added the ability to
Dialogue: 0,0:44:02.29,0:44:04.48,Default,,0,0,0,,track the relative mealtime to a
Dialogue: 0,0:44:04.48,0:44:05.38,Default,,0,0,0,,blood glucose sample.
Dialogue: 0,0:44:05.89,0:44:08.74,Default,,0,0,0,,Next, we added the ability to
Dialogue: 0,0:44:08.74,0:44:09.96,Default,,0,0,0,,track insulin delivery.
Dialogue: 0,0:44:10.53,0:44:13.60,Default,,0,0,0,,With the addition to
Dialogue: 0,0:44:13.60,0:44:15.79,Default,,0,0,0,,CoreBluetooth in watchOS 4, now
Dialogue: 0,0:44:15.79,0:44:17.29,Default,,0,0,0,,your Bluetooth enabled diabetes
Dialogue: 0,0:44:17.29,0:44:19.09,Default,,0,0,0,,devices can connect directly to
Dialogue: 0,0:44:19.16,0:44:20.33,Default,,0,0,0,,your Watch.
Dialogue: 0,0:44:21.06,0:44:22.69,Default,,0,0,0,,Please watch "What's New in
Dialogue: 0,0:44:22.69,0:44:23.70,Default,,0,0,0,,CoreBluetooth" to learn more
Dialogue: 0,0:44:23.70,0:44:24.73,Default,,0,0,0,,about that.
Dialogue: 0,0:44:25.38,0:44:27.20,Default,,0,0,0,,To support the relative blood
Dialogue: 0,0:44:27.20,0:44:28.89,Default,,0,0,0,,glucose mealtime, we've added a
Dialogue: 0,0:44:28.89,0:44:29.75,Default,,0,0,0,,new metadata key.
Dialogue: 0,0:44:30.33,0:44:31.39,Default,,0,0,0,,This metadata key is
Dialogue: 0,0:44:31.39,0:44:32.41,Default,,0,0,0,,HKMetadataKey
Dialogue: 0,0:44:32.41,0:44:33.55,Default,,0,0,0,,BloodGlucoseMealTime.
Dialogue: 0,0:44:33.55,0:44:35.42,Default,,0,0,0,,You could use this metadata key
Dialogue: 0,0:44:35.42,0:44:36.54,Default,,0,0,0,,when saving blood glucose
Dialogue: 0,0:44:36.54,0:44:37.04,Default,,0,0,0,,samples.
Dialogue: 0,0:44:38.50,0:44:39.98,Default,,0,0,0,,This metadata key supports two
Dialogue: 0,0:44:39.98,0:44:40.90,Default,,0,0,0,,possible values.
Dialogue: 0,0:44:41.64,0:44:42.99,Default,,0,0,0,,These values can be found in the
Dialogue: 0,0:44:42.99,0:44:44.91,Default,,0,0,0,,Enum, HKBloodGlucoseMealTime.
Dialogue: 0,0:44:45.62,0:44:47.33,Default,,0,0,0,,The values are preprandial and
Dialogue: 0,0:44:47.33,0:44:47.92,Default,,0,0,0,,postprandial.
Dialogue: 0,0:44:48.95,0:44:50.59,Default,,0,0,0,,Preprandial represents any time
Dialogue: 0,0:44:50.59,0:44:51.23,Default,,0,0,0,,before a meal.
Dialogue: 0,0:44:51.23,0:44:53.24,Default,,0,0,0,,And postprandial represents any
Dialogue: 0,0:44:53.24,0:44:57.43,Default,,0,0,0,,time after a meal.
Dialogue: 0,0:44:57.65,0:44:58.87,Default,,0,0,0,,With this new data, now you
Dialogue: 0,0:44:58.87,0:45:00.16,Default,,0,0,0,,could gain a deeper insight into
Dialogue: 0,0:45:00.16,0:45:01.96,Default,,0,0,0,,blood glucose samples relative
Dialogue: 0,0:45:01.96,0:45:03.02,Default,,0,0,0,,to when the user last ate a
Dialogue: 0,0:45:03.02,0:45:03.24,Default,,0,0,0,,meal.
Dialogue: 0,0:45:03.98,0:45:05.85,Default,,0,0,0,,Now, we are onto supporting
Dialogue: 0,0:45:05.85,0:45:06.95,Default,,0,0,0,,insulin deliver in HealthKit.
Dialogue: 0,0:45:08.00,0:45:09.31,Default,,0,0,0,,Here is a graph of what it looks
Dialogue: 0,0:45:09.31,0:45:12.50,Default,,0,0,0,,like in HealthKit for all data
Dialogue: 0,0:45:12.78,0:45:13.77,Default,,0,0,0,,that's been inserted into
Dialogue: 0,0:45:14.36,0:45:14.49,Default,,0,0,0,,Health.
Dialogue: 0,0:45:16.12,0:45:17.71,Default,,0,0,0,,To support this new type, we've
Dialogue: 0,0:45:17.71,0:45:18.92,Default,,0,0,0,,added a new quantity type
Dialogue: 0,0:45:18.92,0:45:19.58,Default,,0,0,0,,identifier.
Dialogue: 0,0:45:19.95,0:45:20.45,Default,,0,0,0,,This is
Dialogue: 0,0:45:20.45,0:45:21.79,Default,,0,0,0,,HKQuantityTypeIdentifier,
Dialogue: 0,0:45:21.79,0:45:22.51,Default,,0,0,0,,insulinDelivery.
Dialogue: 0,0:45:23.59,0:45:24.84,Default,,0,0,0,,When adding samples of this
Dialogue: 0,0:45:24.84,0:45:27.23,Default,,0,0,0,,quantity type, you must include
Dialogue: 0,0:45:27.57,0:45:28.46,Default,,0,0,0,,the delivery reason.
Dialogue: 0,0:45:29.41,0:45:31.76,Default,,0,0,0,,To do this, you should use the
Dialogue: 0,0:45:31.76,0:45:32.99,Default,,0,0,0,,HKMetadataKeyInsulin
Dialogue: 0,0:45:32.99,0:45:33.85,Default,,0,0,0,,DeliveryReason.
Dialogue: 0,0:45:34.08,0:45:36.80,Default,,0,0,0,,Metadata. This metadata supports
Dialogue: 0,0:45:36.80,0:45:37.85,Default,,0,0,0,,two possible values.
Dialogue: 0,0:45:38.93,0:45:40.24,Default,,0,0,0,,These values and be found on the
Dialogue: 0,0:45:40.24,0:45:41.89,Default,,0,0,0,,Enum HKInsulinDeliverReason.
Dialogue: 0,0:45:43.33,0:45:44.69,Default,,0,0,0,,These values are basal and
Dialogue: 0,0:45:44.69,0:45:45.22,Default,,0,0,0,,bolus.
Dialogue: 0,0:45:46.42,0:45:47.50,Default,,0,0,0,,Basal is the background
Dialogue: 0,0:45:47.50,0:45:48.55,Default,,0,0,0,,metabolic need throughout the
Dialogue: 0,0:45:48.55,0:45:48.83,Default,,0,0,0,,day.
Dialogue: 0,0:45:49.21,0:45:50.93,Default,,0,0,0,,While bolus is the episodic need
Dialogue: 0,0:45:50.96,0:45:52.19,Default,,0,0,0,,such as for a meal and
Dialogue: 0,0:45:52.19,0:45:53.11,Default,,0,0,0,,correcting high blood sugar.
Dialogue: 0,0:45:54.42,0:45:56.59,Default,,0,0,0,,It's important to know that you
Dialogue: 0,0:45:56.59,0:45:57.78,Default,,0,0,0,,should only add these kinds of
Dialogue: 0,0:45:57.78,0:45:59.87,Default,,0,0,0,,samples after user has delivered
Dialogue: 0,0:45:59.87,0:46:00.27,Default,,0,0,0,,insulin.
Dialogue: 0,0:46:02.22,0:46:04.48,Default,,0,0,0,,Further, when creating an HK
Dialogue: 0,0:46:04.48,0:46:06.41,Default,,0,0,0,,sample with this identifier, you
Dialogue: 0,0:46:06.41,0:46:07.78,Default,,0,0,0,,should use the international
Dialogue: 0,0:46:08.35,0:46:08.51,Default,,0,0,0,,unit.
Dialogue: 0,0:46:09.48,0:46:10.90,Default,,0,0,0,,To support the international
Dialogue: 0,0:46:10.90,0:46:12.99,Default,,0,0,0,,unit, or the IU, we've extended
Dialogue: 0,0:46:12.99,0:46:14.79,Default,,0,0,0,,HKUnit to now return an
Dialogue: 0,0:46:14.79,0:46:15.56,Default,,0,0,0,,international unit.
Dialogue: 0,0:46:16.38,0:46:18.02,Default,,0,0,0,,The international unit is the
Dialogue: 0,0:46:18.02,0:46:19.81,Default,,0,0,0,,biological effectiveness of the
Dialogue: 0,0:46:19.81,0:46:20.43,Default,,0,0,0,,substance.
Dialogue: 0,0:46:20.96,0:46:23.59,Default,,0,0,0,,It does not represent a specific
Dialogue: 0,0:46:23.59,0:46:24.89,Default,,0,0,0,,amount, but it represents the
Dialogue: 0,0:46:24.89,0:46:26.41,Default,,0,0,0,,biological effectiveness of the
Dialogue: 0,0:46:26.41,0:46:27.43,Default,,0,0,0,,amount that's been delivered.
Dialogue: 0,0:46:27.94,0:46:30.89,Default,,0,0,0,,It's also important to know that
Dialogue: 0,0:46:30.89,0:46:32.32,Default,,0,0,0,,this unit cannot be converted to
Dialogue: 0,0:46:32.32,0:46:33.88,Default,,0,0,0,,other units, but it does
Dialogue: 0,0:46:33.88,0:46:35.84,Default,,0,0,0,,support, common SI prefixes such
Dialogue: 0,0:46:35.84,0:46:36.76,Default,,0,0,0,,as mili and micro.
Dialogue: 0,0:46:37.34,0:46:41.94,Default,,0,0,0,,All right let's take a look at
Dialogue: 0,0:46:41.94,0:46:43.17,Default,,0,0,0,,how to insert insulin delivery
Dialogue: 0,0:46:43.17,0:46:43.51,Default,,0,0,0,,sample.
Dialogue: 0,0:46:44.76,0:46:46.58,Default,,0,0,0,,Let's say our insulin pump has
Dialogue: 0,0:46:46.58,0:46:49.42,Default,,0,0,0,,delivered 0.85 units of basal
Dialogue: 0,0:46:49.42,0:46:50.60,Default,,0,0,0,,insulin over the past hour.
Dialogue: 0,0:46:51.92,0:46:53.36,Default,,0,0,0,,First, let's create an
Dialogue: 0,0:46:53.36,0:46:54.58,Default,,0,0,0,,HKQuantityType using the
Dialogue: 0,0:46:54.58,0:46:56.11,Default,,0,0,0,,identifier insulinDelivery.
Dialogue: 0,0:46:56.63,0:47:01.20,Default,,0,0,0,,Next, let's create an HKQuantity
Dialogue: 0,0:47:01.40,0:47:03.26,Default,,0,0,0,,using the international unit and
Dialogue: 0,0:47:03.39,0:47:06.01,Default,,0,0,0,,a double value of 0.825.
Dialogue: 0,0:47:08.02,0:47:09.89,Default,,0,0,0,,After that we're going to create
Dialogue: 0,0:47:09.89,0:47:10.67,Default,,0,0,0,,an HKQuantitySample.
Dialogue: 0,0:47:11.34,0:47:12.49,Default,,0,0,0,,We're going to use the quantity
Dialogue: 0,0:47:12.49,0:47:13.74,Default,,0,0,0,,type and the quantity we
Dialogue: 0,0:47:13.74,0:47:14.56,Default,,0,0,0,,previously defined.
Dialogue: 0,0:47:15.06,0:47:16.46,Default,,0,0,0,,We're going to set the start and
Dialogue: 0,0:47:16.46,0:47:17.71,Default,,0,0,0,,end date to be the start end
Dialogue: 0,0:47:17.71,0:47:18.96,Default,,0,0,0,,date that the pump had delivered
Dialogue: 0,0:47:18.96,0:47:19.39,Default,,0,0,0,,the insulin.
Dialogue: 0,0:47:20.81,0:47:22.10,Default,,0,0,0,,Next, we're going to remember to
Dialogue: 0,0:47:22.10,0:47:23.39,Default,,0,0,0,,include the required metadata
Dialogue: 0,0:47:23.39,0:47:24.29,Default,,0,0,0,,for the deliver reason.
Dialogue: 0,0:47:24.82,0:47:26.15,Default,,0,0,0,,In our case, this is basal.
Dialogue: 0,0:47:26.73,0:47:29.53,Default,,0,0,0,,After the sample has been
Dialogue: 0,0:47:29.53,0:47:30.93,Default,,0,0,0,,created, we can save into
Dialogue: 0,0:47:30.93,0:47:32.40,Default,,0,0,0,,HealthKit by passing it to the
Dialogue: 0,0:47:32.40,0:47:33.44,Default,,0,0,0,,save function on our
Dialogue: 0,0:47:33.44,0:47:33.87,Default,,0,0,0,,healthStore.
Dialogue: 0,0:47:34.53,0:47:36.82,Default,,0,0,0,,Now, an insulin delivery sample
Dialogue: 0,0:47:36.82,0:47:37.89,Default,,0,0,0,,has been saved into HealthKit,
Dialogue: 0,0:47:37.95,0:47:39.11,Default,,0,0,0,,which can be utilized by your
Dialogue: 0,0:47:39.11,0:47:40.80,Default,,0,0,0,,app and any other app which
Dialogue: 0,0:47:40.80,0:47:42.11,Default,,0,0,0,,helps users manage diabetes.
Dialogue: 0,0:47:42.69,0:47:46.97,Default,,0,0,0,,With the sample in HealthKit,
Dialogue: 0,0:47:47.40,0:47:49.00,Default,,0,0,0,,now we can retrieve it back out.
Dialogue: 0,0:47:49.56,0:47:50.44,Default,,0,0,0,,To do this we're going to
Dialogue: 0,0:47:50.44,0:47:51.88,Default,,0,0,0,,perform a statistic query for
Dialogue: 0,0:47:51.88,0:47:52.73,Default,,0,0,0,,all basal samples.
Dialogue: 0,0:47:53.42,0:47:55.08,Default,,0,0,0,,I'm interested in every basal
Dialogue: 0,0:47:55.08,0:47:56.02,Default,,0,0,0,,sample that's ever been
Dialogue: 0,0:47:56.02,0:47:57.63,Default,,0,0,0,,delivered to the user on an hour
Dialogue: 0,0:47:57.63,0:47:58.55,Default,,0,0,0,,by hour basis.
Dialogue: 0,0:47:59.69,0:48:01.06,Default,,0,0,0,,First, we're going to create a
Dialogue: 0,0:48:01.06,0:48:01.45,Default,,0,0,0,,predicate.
Dialogue: 0,0:48:02.07,0:48:03.00,Default,,0,0,0,,We're going to base this on the
Dialogue: 0,0:48:03.00,0:48:03.75,Default,,0,0,0,,metadata key,
Dialogue: 0,0:48:03.92,0:48:05.42,Default,,0,0,0,,insulineDeliveryReason, and
Dialogue: 0,0:48:05.42,0:48:06.77,Default,,0,0,0,,we're going to pass in basal.
Dialogue: 0,0:48:06.77,0:48:08.29,Default,,0,0,0,,Because that's the type we're
Dialogue: 0,0:48:08.29,0:48:09.42,Default,,0,0,0,,interested in.
Dialogue: 0,0:48:10.72,0:48:12.65,Default,,0,0,0,,Next, we're going to define the
Dialogue: 0,0:48:12.65,0:48:13.81,Default,,0,0,0,,quantity type, just like we did
Dialogue: 0,0:48:13.81,0:48:14.14,Default,,0,0,0,,before.
Dialogue: 0,0:48:14.76,0:48:15.55,Default,,0,0,0,,We're going to use the
Dialogue: 0,0:48:15.55,0:48:16.97,Default,,0,0,0,,insulinDelivery quantityType
Dialogue: 0,0:48:16.97,0:48:17.46,Default,,0,0,0,,identifier.
Dialogue: 0,0:48:19.08,0:48:21.13,Default,,0,0,0,,After that we're going to create
Dialogue: 0,0:48:21.13,0:48:22.21,Default,,0,0,0,,an HK statistics collections
Dialogue: 0,0:48:22.21,0:48:22.45,Default,,0,0,0,,query.
Dialogue: 0,0:48:22.88,0:48:23.58,Default,,0,0,0,,We're going to pass in the
Dialogue: 0,0:48:23.58,0:48:24.69,Default,,0,0,0,,quantity type and predicate that
Dialogue: 0,0:48:24.69,0:48:25.59,Default,,0,0,0,,we previously defined.
Dialogue: 0,0:48:26.09,0:48:29.07,Default,,0,0,0,,Next, we're going to pass in a
Dialogue: 0,0:48:29.07,0:48:29.85,Default,,0,0,0,,couple of options.
Dialogue: 0,0:48:29.85,0:48:31.18,Default,,0,0,0,,These are cumulativeSum and
Dialogue: 0,0:48:31.18,0:48:32.10,Default,,0,0,0,,separateBySource.
Dialogue: 0,0:48:32.26,0:48:33.71,Default,,0,0,0,,It's important to pass in
Dialogue: 0,0:48:33.71,0:48:35.43,Default,,0,0,0,,separateBySource, because
Dialogue: 0,0:48:35.85,0:48:37.65,Default,,0,0,0,,HealthKit would normally only
Dialogue: 0,0:48:38.00,0:48:39.84,Default,,0,0,0,,return samples within a certain
Dialogue: 0,0:48:39.84,0:48:40.37,Default,,0,0,0,,time period.
Dialogue: 0,0:48:40.63,0:48:42.56,Default,,0,0,0,,Because the user has the option
Dialogue: 0,0:48:42.56,0:48:44.19,Default,,0,0,0,,to be delivered insulin over the
Dialogue: 0,0:48:44.19,0:48:45.67,Default,,0,0,0,,course of an hour, and also by
Dialogue: 0,0:48:45.67,0:48:47.59,Default,,0,0,0,,manual injection, these time
Dialogue: 0,0:48:47.59,0:48:48.43,Default,,0,0,0,,periods can overlap.
Dialogue: 0,0:48:48.94,0:48:50.34,Default,,0,0,0,,So, we use separateBySource to
Dialogue: 0,0:48:50.34,0:48:51.42,Default,,0,0,0,,get all the information.
Dialogue: 0,0:48:51.93,0:48:54.41,Default,,0,0,0,,Next, I'm interested in all the
Dialogue: 0,0:48:54.41,0:48:55.42,Default,,0,0,0,,basal samples.
Dialogue: 0,0:48:55.48,0:48:57.09,Default,,0,0,0,,So, I'm going to use date,
Dialogue: 0,0:48:57.09,0:48:58.50,Default,,0,0,0,,distantPast for the anchor date.
Dialogue: 0,0:48:58.99,0:49:01.77,Default,,0,0,0,,After that, to specify an hour
Dialogue: 0,0:49:01.77,0:49:03.24,Default,,0,0,0,,by hour basis, I'm going to pass
Dialogue: 0,0:49:03.24,0:49:04.78,Default,,0,0,0,,DateComponents of an hour of 1
Dialogue: 0,0:49:05.07,0:49:06.22,Default,,0,0,0,,to the intervalComponents.
Dialogue: 0,0:49:06.77,0:49:10.37,Default,,0,0,0,,Now that my query is created, I
Dialogue: 0,0:49:10.37,0:49:11.82,Default,,0,0,0,,could create the initial results
Dialogue: 0,0:49:11.82,0:49:12.10,Default,,0,0,0,,handler.
Dialogue: 0,0:49:12.40,0:49:14.22,Default,,0,0,0,,The results pass back from this
Dialogue: 0,0:49:14.22,0:49:15.77,Default,,0,0,0,,handler are going to contain all
Dialogue: 0,0:49:15.77,0:49:16.96,Default,,0,0,0,,the information that we need to
Dialogue: 0,0:49:16.96,0:49:18.44,Default,,0,0,0,,sum up to find out this
Dialogue: 0,0:49:18.44,0:49:21.88,Default,,0,0,0,,information that we need.
Dialogue: 0,0:49:21.88,0:49:22.97,Default,,0,0,0,,Finally, I'm going to execute
Dialogue: 0,0:49:22.97,0:49:24.16,Default,,0,0,0,,this query by passing it to the
Dialogue: 0,0:49:24.55,0:49:26.14,Default,,0,0,0,,execute method on healthStore.
Dialogue: 0,0:49:26.74,0:49:28.94,Default,,0,0,0,,Now you know how to insert
Dialogue: 0,0:49:28.94,0:49:30.19,Default,,0,0,0,,samples and retrieve them back
Dialogue: 0,0:49:30.94,0:49:31.01,Default,,0,0,0,,out.
Dialogue: 0,0:49:35.34,0:49:36.84,Default,,0,0,0,,Today we learned about a lot of
Dialogue: 0,0:49:36.84,0:49:38.82,Default,,0,0,0,,new features available in
Dialogue: 0,0:49:39.86,0:49:40.08,Default,,0,0,0,,HealthKit.
Dialogue: 0,0:49:40.18,0:49:41.42,Default,,0,0,0,,First, you learned about new
Dialogue: 0,0:49:41.42,0:49:42.75,Default,,0,0,0,,data types and new activity
Dialogue: 0,0:49:42.75,0:49:43.93,Default,,0,0,0,,types, which will make your
Dialogue: 0,0:49:43.93,0:49:49.45,Default,,0,0,0,,great workout apps even better.
Dialogue: 0,0:49:49.81,0:49:51.03,Default,,0,0,0,,Next, you learned about the new
Dialogue: 0,0:49:51.03,0:49:52.44,Default,,0,0,0,,WorkoutRouteBuilder API.
Dialogue: 0,0:49:53.37,0:49:54.89,Default,,0,0,0,,This allow you to record workout
Dialogue: 0,0:49:54.89,0:49:56.06,Default,,0,0,0,,routes and associate them to
Dialogue: 0,0:49:56.06,0:49:56.68,Default,,0,0,0,,workouts.
Dialogue: 0,0:49:57.19,0:49:59.99,Default,,0,0,0,,After that we introduced sync
Dialogue: 0,0:49:59.99,0:50:00.73,Default,,0,0,0,,identifiers.
Dialogue: 0,0:50:01.38,0:50:02.46,Default,,0,0,0,,Now, you can take advantage of
Dialogue: 0,0:50:02.46,0:50:04.19,Default,,0,0,0,,HealthKit to manage all data
Dialogue: 0,0:50:04.19,0:50:05.91,Default,,0,0,0,,duplication and prevent data
Dialogue: 0,0:50:05.91,0:50:07.66,Default,,0,0,0,,duplication across your devices.
Dialogue: 0,0:50:08.23,0:50:12.52,Default,,0,0,0,,And Finally, we added additional
Dialogue: 0,0:50:12.52,0:50:14.48,Default,,0,0,0,,support for users managing
Dialogue: 0,0:50:14.48,0:50:15.02,Default,,0,0,0,,diabetes.
Dialogue: 0,0:50:19.85,0:50:21.75,Default,,0,0,0,,For more information and to
Dialogue: 0,0:50:21.75,0:50:23.06,Default,,0,0,0,,download the full-implementation
Dialogue: 0,0:50:23.06,0:50:24.97,Default,,0,0,0,,of Speedy Sloth, please visit
Dialogue: 0,0:50:25.51,0:50:26.82,Default,,0,0,0,,this URL.
Dialogue: 0,0:50:27.52,0:50:33.86,Default,,0,0,0,,[ Applause ]
Dialogue: 0,0:50:34.36,0:50:35.52,Default,,0,0,0,,We have a few related sessions
Dialogue: 0,0:50:35.52,0:50:36.23,Default,,0,0,0,,that we recommend.
Dialogue: 0,0:50:37.59,0:50:41.74,Default,,0,0,0,,Thank you and have a great WWDC
Dialogue: 0,0:50:41.74,0:50:42.00,Default,,0,0,0,,[Applause].
