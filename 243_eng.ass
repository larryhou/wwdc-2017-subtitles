[Script Info]
; Script generated by FFmpeg/Lavc57.89.100
ScriptType: v4.00+
PlayResX: 384
PlayResY: 288

[V4+ Styles]
Format: Name, Fontname, Fontsize, PrimaryColour, SecondaryColour, OutlineColour, BackColour, Bold, Italic, Underline, StrikeOut, ScaleX, ScaleY, Spacing, Angle, BorderStyle, Outline, Shadow, Alignment, MarginL, MarginR, MarginV, Encoding
Style: Default,Arial,16,&Hffffff,&Hffffff,&H0,&H0,0,0,0,0,100,100,0,0,1,1,0,2,10,10,10,0

[Events]
Format: Layer, Start, End, Style, Name, MarginL, MarginR, MarginV, Effect, Text
Dialogue: 0,0:00:23.04,0:00:25.04,Default,,0,0,0,,[ Applause ]
Dialogue: 0,0:00:25.07,0:00:26.47,Default,,0,0,0,,>> Good morning, and welcome.
Dialogue: 0,0:00:27.62,0:00:28.86,Default,,0,0,0,,My name is Jean-Gabriel.
Dialogue: 0,0:00:28.95,0:00:29.85,Default,,0,0,0,,I hope you've been having a
Dialogue: 0,0:00:29.85,0:00:30.45,Default,,0,0,0,,great week.
Dialogue: 0,0:00:30.73,0:00:31.76,Default,,0,0,0,,We're here to talk about file
Dialogue: 0,0:00:31.76,0:00:33.43,Default,,0,0,0,,providers, the technology
Dialogue: 0,0:00:33.43,0:00:34.83,Default,,0,0,0,,between, behind the new Files
Dialogue: 0,0:00:35.68,0:00:35.75,Default,,0,0,0,,app.
Dialogue: 0,0:00:37.12,0:00:38.64,Default,,0,0,0,,We're going to see what file
Dialogue: 0,0:00:38.64,0:00:41.05,Default,,0,0,0,,providers are and what new APIs
Dialogue: 0,0:00:41.05,0:00:43.76,Default,,0,0,0,,in iOS 11 allow you to enumerate
Dialogue: 0,0:00:44.18,0:00:45.99,Default,,0,0,0,,files from the cloud down to the
Dialogue: 0,0:00:45.99,0:00:48.03,Default,,0,0,0,,device, to modify those files on
Dialogue: 0,0:00:48.03,0:00:49.50,Default,,0,0,0,,the device and up to the cloud,
Dialogue: 0,0:00:49.93,0:00:50.99,Default,,0,0,0,,and to customize your file
Dialogue: 0,0:00:50.99,0:00:52.71,Default,,0,0,0,,provider to expose your
Dialogue: 0,0:00:52.71,0:00:53.87,Default,,0,0,0,,non-standout features.
Dialogue: 0,0:00:56.21,0:00:57.42,Default,,0,0,0,,So file providers have been
Dialogue: 0,0:00:57.42,0:00:59.84,Default,,0,0,0,,around since iOS 8, and at the
Dialogue: 0,0:00:59.89,0:01:02.65,Default,,0,0,0,,core, they materialize files for
Dialogue: 0,0:01:02.65,0:01:03.30,Default,,0,0,0,,applications.
Dialogue: 0,0:01:03.30,0:01:04.31,Default,,0,0,0,,So applications may keep
Dialogue: 0,0:01:04.31,0:01:06.85,Default,,0,0,0,,preferences to files that are
Dialogue: 0,0:01:06.85,0:01:08.26,Default,,0,0,0,,provided by file providers, and
Dialogue: 0,0:01:08.26,0:01:09.65,Default,,0,0,0,,when they need the files, file
Dialogue: 0,0:01:09.65,0:01:11.09,Default,,0,0,0,,providers fulfill the promises.
Dialogue: 0,0:01:12.41,0:01:14.29,Default,,0,0,0,,But we are here today to talk
Dialogue: 0,0:01:14.29,0:01:16.41,Default,,0,0,0,,about the new APIs, the APIs for
Dialogue: 0,0:01:16.41,0:01:18.14,Default,,0,0,0,,enumerating files from the cloud
Dialogue: 0,0:01:18.14,0:01:18.98,Default,,0,0,0,,down to the device.
Dialogue: 0,0:01:19.63,0:01:22.56,Default,,0,0,0,,So the audience for this talk is
Dialogue: 0,0:01:22.56,0:01:24.22,Default,,0,0,0,,people who have servers out
Dialogue: 0,0:01:24.22,0:01:26.49,Default,,0,0,0,,there with user documents on
Dialogue: 0,0:01:26.49,0:01:27.78,Default,,0,0,0,,those servers and want to bring
Dialogue: 0,0:01:27.78,0:01:29.49,Default,,0,0,0,,those documents to iPad and
Dialogue: 0,0:01:29.49,0:01:29.86,Default,,0,0,0,,iPhone.
Dialogue: 0,0:01:32.32,0:01:34.89,Default,,0,0,0,,So let's look at the Files app.
Dialogue: 0,0:01:35.44,0:01:37.89,Default,,0,0,0,,The Files app is a thin wrapper
Dialogue: 0,0:01:37.89,0:01:40.13,Default,,0,0,0,,around a new piece of system UI
Dialogue: 0,0:01:40.13,0:01:41.30,Default,,0,0,0,,called the document browser that
Dialogue: 0,0:01:41.30,0:01:42.86,Default,,0,0,0,,is pretty ubiquitous in the
Dialogue: 0,0:01:42.86,0:01:43.34,Default,,0,0,0,,system.
Dialogue: 0,0:01:44.27,0:01:45.93,Default,,0,0,0,,It is where the user, where
Dialogue: 0,0:01:45.93,0:01:48.30,Default,,0,0,0,,users find, organize, share,
Dialogue: 0,0:01:48.37,0:01:49.38,Default,,0,0,0,,open documents.
Dialogue: 0,0:01:52.78,0:01:54.90,Default,,0,0,0,,File providers appear here under
Dialogue: 0,0:01:54.90,0:01:55.91,Default,,0,0,0,,Locations.
Dialogue: 0,0:01:56.37,0:01:57.75,Default,,0,0,0,,These are the entry points to
Dialogue: 0,0:01:57.75,0:02:01.13,Default,,0,0,0,,your cloud storage, and iCloud
Dialogue: 0,0:02:01.13,0:02:02.44,Default,,0,0,0,,Drive is one of them.
Dialogue: 0,0:02:03.72,0:02:04.19,Default,,0,0,0,,That's good.
Dialogue: 0,0:02:04.40,0:02:05.96,Default,,0,0,0,,That means that the APIs that we
Dialogue: 0,0:02:05.96,0:02:07.45,Default,,0,0,0,,are going to go through today
Dialogue: 0,0:02:07.92,0:02:09.36,Default,,0,0,0,,are implemented by iCloud Drive,
Dialogue: 0,0:02:09.43,0:02:10.83,Default,,0,0,0,,really well tested, and you have
Dialogue: 0,0:02:10.83,0:02:11.89,Default,,0,0,0,,a reference point if you're
Dialogue: 0,0:02:11.89,0:02:13.25,Default,,0,0,0,,wondering about the expected
Dialogue: 0,0:02:13.25,0:02:15.85,Default,,0,0,0,,behavior of, say, renaming your
Dialogue: 0,0:02:15.85,0:02:17.11,Default,,0,0,0,,file when there's already a file
Dialogue: 0,0:02:17.11,0:02:18.11,Default,,0,0,0,,with the same name and the same
Dialogue: 0,0:02:18.11,0:02:19.20,Default,,0,0,0,,folder, or you can just try it
Dialogue: 0,0:02:19.20,0:02:20.47,Default,,0,0,0,,out in iCloud Drive and see how
Dialogue: 0,0:02:20.47,0:02:21.25,Default,,0,0,0,,it's supposed to behave.
Dialogue: 0,0:02:22.57,0:02:24.74,Default,,0,0,0,,It also means that your
Dialogue: 0,0:02:24.74,0:02:26.30,Default,,0,0,0,,documents, being in a file
Dialogue: 0,0:02:26.30,0:02:27.71,Default,,0,0,0,,provider just like iCloud Drive,
Dialogue: 0,0:02:27.71,0:02:29.19,Default,,0,0,0,,are first-class citizens on the
Dialogue: 0,0:02:29.19,0:02:29.55,Default,,0,0,0,,OS.
Dialogue: 0,0:02:29.90,0:02:31.21,Default,,0,0,0,,They're available everywhere
Dialogue: 0,0:02:31.21,0:02:32.69,Default,,0,0,0,,really prominently just as
Dialogue: 0,0:02:32.69,0:02:33.71,Default,,0,0,0,,iCloud Drive documents.
Dialogue: 0,0:02:34.02,0:02:35.47,Default,,0,0,0,,Actually, on this shot, iCloud
Dialogue: 0,0:02:35.47,0:02:36.47,Default,,0,0,0,,Drive is at the top, but the
Dialogue: 0,0:02:36.47,0:02:38.06,Default,,0,0,0,,user may want to reconfigure
Dialogue: 0,0:02:38.06,0:02:39.55,Default,,0,0,0,,that however they want to really
Dialogue: 0,0:02:39.67,0:02:41.19,Default,,0,0,0,,leave on your file provider.
Dialogue: 0,0:02:42.62,0:02:44.36,Default,,0,0,0,,There's on file provider in
Dialogue: 0,0:02:44.36,0:02:45.86,Default,,0,0,0,,there that I just want to make a
Dialogue: 0,0:02:46.53,0:02:47.36,Default,,0,0,0,,passing mention of.
Dialogue: 0,0:02:47.62,0:02:49.11,Default,,0,0,0,,On My iPad, that is the only
Dialogue: 0,0:02:49.11,0:02:50.25,Default,,0,0,0,,local file provider.
Dialogue: 0,0:02:50.25,0:02:51.44,Default,,0,0,0,,That is the only file provider
Dialogue: 0,0:02:51.44,0:02:52.80,Default,,0,0,0,,that doesn't show files that are
Dialogue: 0,0:02:52.80,0:02:54.85,Default,,0,0,0,,in the cloud somewhere, and it's
Dialogue: 0,0:02:54.85,0:02:57.32,Default,,0,0,0,,for apps to expose their
Dialogue: 0,0:02:57.95,0:02:59.63,Default,,0,0,0,,document, their local document
Dialogue: 0,0:02:59.63,0:03:01.41,Default,,0,0,0,,storage to other applications.
Dialogue: 0,0:03:04.66,0:03:06.15,Default,,0,0,0,,So let's see where the document
Dialogue: 0,0:03:06.15,0:03:07.68,Default,,0,0,0,,browser fits on the platform.
Dialogue: 0,0:03:08.56,0:03:09.89,Default,,0,0,0,,Well, it sits right below the
Dialogue: 0,0:03:09.89,0:03:11.16,Default,,0,0,0,,document-based applications --
Dialogue: 0,0:03:11.53,0:03:12.93,Default,,0,0,0,,the Files app that we just saw;
Dialogue: 0,0:03:13.74,0:03:15.28,Default,,0,0,0,,all the iWork apps, which
Dialogue: 0,0:03:15.28,0:03:17.42,Default,,0,0,0,,[inaudible] the document browser
Dialogue: 0,0:03:17.42,0:03:19.03,Default,,0,0,0,,to be that new piece of system
Dialogue: 0,0:03:19.03,0:03:20.79,Default,,0,0,0,,UI; and all the third-party
Dialogue: 0,0:03:20.79,0:03:22.16,Default,,0,0,0,,[inaudible] in iOS 11.
Dialogue: 0,0:03:22.71,0:03:25.20,Default,,0,0,0,,On the other side of the
Dialogue: 0,0:03:25.20,0:03:27.02,Default,,0,0,0,,document browser UI are the file
Dialogue: 0,0:03:27.02,0:03:28.48,Default,,0,0,0,,providers, and the file
Dialogue: 0,0:03:28.48,0:03:30.07,Default,,0,0,0,,providers will provide files to
Dialogue: 0,0:03:30.07,0:03:31.63,Default,,0,0,0,,the system UI while the
Dialogue: 0,0:03:31.63,0:03:33.15,Default,,0,0,0,,document-based applications
Dialogue: 0,0:03:34.19,0:03:35.72,Default,,0,0,0,,pick, open one of those
Dialogue: 0,0:03:35.72,0:03:36.93,Default,,0,0,0,,documents from whichever file
Dialogue: 0,0:03:36.93,0:03:39.51,Default,,0,0,0,,provider, edit, or create new
Dialogue: 0,0:03:40.85,0:03:41.30,Default,,0,0,0,,documents.
Dialogue: 0,0:03:41.51,0:03:43.01,Default,,0,0,0,,So the reason why document-based
Dialogue: 0,0:03:43.01,0:03:44.38,Default,,0,0,0,,applications are going to adapt
Dialogue: 0,0:03:44.59,0:03:46.46,Default,,0,0,0,,is that this is a single API to
Dialogue: 0,0:03:46.70,0:03:49.01,Default,,0,0,0,,get access to all the places
Dialogue: 0,0:03:49.01,0:03:50.92,Default,,0,0,0,,where their users have their
Dialogue: 0,0:03:50.92,0:03:51.59,Default,,0,0,0,,documents.
Dialogue: 0,0:03:52.22,0:03:53.89,Default,,0,0,0,,Replaces the multiple SDKs that
Dialogue: 0,0:03:53.89,0:03:55.14,Default,,0,0,0,,they have had to adapt to until
Dialogue: 0,0:03:55.14,0:03:55.38,Default,,0,0,0,,now.
Dialogue: 0,0:03:56.77,0:03:58.33,Default,,0,0,0,,The reasons for file providers
Dialogue: 0,0:03:58.33,0:04:00.00,Default,,0,0,0,,to adopt is the privacy model,
Dialogue: 0,0:04:00.00,0:04:01.25,Default,,0,0,0,,which is really awesome here.
Dialogue: 0,0:04:01.25,0:04:03.60,Default,,0,0,0,,So document-based applications
Dialogue: 0,0:04:03.71,0:04:05.25,Default,,0,0,0,,open documents one at a time.
Dialogue: 0,0:04:06.49,0:04:08.91,Default,,0,0,0,,It's totally user-gated access.
Dialogue: 0,0:04:09.23,0:04:11.29,Default,,0,0,0,,The system UI is out of process.
Dialogue: 0,0:04:11.59,0:04:12.73,Default,,0,0,0,,Document-based applications
Dialogue: 0,0:04:12.73,0:04:14.93,Default,,0,0,0,,cannot know which files exist
Dialogue: 0,0:04:14.93,0:04:16.05,Default,,0,0,0,,next to the file that was picked
Dialogue: 0,0:04:16.05,0:04:18.14,Default,,0,0,0,,or even which file providers are
Dialogue: 0,0:04:18.14,0:04:19.88,Default,,0,0,0,,installed until the user picks
Dialogue: 0,0:04:19.88,0:04:21.23,Default,,0,0,0,,one of the documents.
Dialogue: 0,0:04:23.60,0:04:25.67,Default,,0,0,0,,There are two key APIs here:
Dialogue: 0,0:04:26.33,0:04:27.27,Default,,0,0,0,,UIDocumentBrowser
Dialogue: 0,0:04:27.27,0:04:29.63,Default,,0,0,0,,ViewController, which is in the
Dialogue: 0,0:04:29.63,0:04:30.81,Default,,0,0,0,,SDK of the document-based
Dialogue: 0,0:04:30.81,0:04:31.53,Default,,0,0,0,,applications, and
Dialogue: 0,0:04:31.53,0:04:33.16,Default,,0,0,0,,NSFileProviderExtension.
Dialogue: 0,0:04:36.12,0:04:37.17,Default,,0,0,0,,We're not here to talk about
Dialogue: 0,0:04:37.17,0:04:37.98,Default,,0,0,0,,UIDocumentBrowser
Dialogue: 0,0:04:37.98,0:04:38.67,Default,,0,0,0,,ViewController.
Dialogue: 0,0:04:38.91,0:04:40.18,Default,,0,0,0,,That was covered in the session
Dialogue: 0,0:04:40.55,0:04:42.42,Default,,0,0,0,,yesterday that I invite you to
Dialogue: 0,0:04:42.42,0:04:43.97,Default,,0,0,0,,go watch if you missed it about
Dialogue: 0,0:04:43.97,0:04:45.47,Default,,0,0,0,,building document-based
Dialogue: 0,0:04:45.47,0:04:46.11,Default,,0,0,0,,applications.
Dialogue: 0,0:04:46.11,0:04:47.78,Default,,0,0,0,,We are here to talk about the
Dialogue: 0,0:04:47.78,0:04:48.49,Default,,0,0,0,,other end of this,
Dialogue: 0,0:04:48.54,0:04:49.81,Default,,0,0,0,,NSFileProviderExtension.
Dialogue: 0,0:04:52.66,0:04:54.89,Default,,0,0,0,,So let's look again at the Files
Dialogue: 0,0:04:54.89,0:04:55.02,Default,,0,0,0,,app.
Dialogue: 0,0:04:55.72,0:04:57.49,Default,,0,0,0,,There are two main ways for the
Dialogue: 0,0:04:57.49,0:05:00.81,Default,,0,0,0,,user to go and interact with his
Dialogue: 0,0:05:00.81,0:05:02.49,Default,,0,0,0,,documents, and those correspond
Dialogue: 0,0:05:02.49,0:05:03.69,Default,,0,0,0,,to two tabs in the app.
Dialogue: 0,0:05:04.04,0:05:05.48,Default,,0,0,0,,The first tab is the Browse tab.
Dialogue: 0,0:05:06.16,0:05:07.74,Default,,0,0,0,,That is where the user goes to
Dialogue: 0,0:05:07.74,0:05:11.05,Default,,0,0,0,,find content in your cloud and
Dialogue: 0,0:05:11.05,0:05:12.33,Default,,0,0,0,,bring it down to the device.
Dialogue: 0,0:05:13.08,0:05:14.91,Default,,0,0,0,,In this mode, your file provider
Dialogue: 0,0:05:14.91,0:05:17.14,Default,,0,0,0,,extension acts as a pipe between
Dialogue: 0,0:05:17.14,0:05:18.87,Default,,0,0,0,,the system UI and your servers.
Dialogue: 0,0:05:18.87,0:05:20.24,Default,,0,0,0,,It's not even expected to work
Dialogue: 0,0:05:20.24,0:05:23.19,Default,,0,0,0,,offline, really.
Dialogue: 0,0:05:23.37,0:05:25.55,Default,,0,0,0,,Once the user has selected those
Dialogue: 0,0:05:25.55,0:05:26.95,Default,,0,0,0,,documents in the Browse tab,
Dialogue: 0,0:05:26.95,0:05:28.10,Default,,0,0,0,,they become available in the
Dialogue: 0,0:05:28.10,0:05:28.81,Default,,0,0,0,,Recents tab.
Dialogue: 0,0:05:28.81,0:05:31.42,Default,,0,0,0,,The Recents tab is the other
Dialogue: 0,0:05:31.42,0:05:33.83,Default,,0,0,0,,mode, and it is a flat list of
Dialogue: 0,0:05:33.83,0:05:34.90,Default,,0,0,0,,documents that come from the
Dialogue: 0,0:05:34.90,0:05:38.29,Default,,0,0,0,,very sources of documents and
Dialogue: 0,0:05:38.32,0:05:39.67,Default,,0,0,0,,are really relevant to the user.
Dialogue: 0,0:05:39.67,0:05:40.89,Default,,0,0,0,,That is where the user is going
Dialogue: 0,0:05:40.89,0:05:42.19,Default,,0,0,0,,to go look for the file he wants
Dialogue: 0,0:05:42.19,0:05:42.50,Default,,0,0,0,,to open.
Dialogue: 0,0:05:42.50,0:05:43.45,Default,,0,0,0,,And sure enough, it's going to
Dialogue: 0,0:05:43.45,0:05:43.80,Default,,0,0,0,,be there.
Dialogue: 0,0:05:47.82,0:05:50.67,Default,,0,0,0,,So two tabs -- Browse, Recents.
Dialogue: 0,0:05:50.67,0:05:52.03,Default,,0,0,0,,The Browse tab is for putting
Dialogue: 0,0:05:52.03,0:05:53.72,Default,,0,0,0,,new content for file providers
Dialogue: 0,0:05:53.90,0:05:56.00,Default,,0,0,0,,online for, folder, online to
Dialogue: 0,0:05:56.00,0:05:57.49,Default,,0,0,0,,folders and pick a document.
Dialogue: 0,0:05:57.95,0:06:00.02,Default,,0,0,0,,The Recents tab shows what we
Dialogue: 0,0:06:00.02,0:06:01.28,Default,,0,0,0,,call the working set, and we're
Dialogue: 0,0:06:01.28,0:06:02.26,Default,,0,0,0,,going to talk about the working
Dialogue: 0,0:06:02.26,0:06:02.71,Default,,0,0,0,,set now.
Dialogue: 0,0:06:03.42,0:06:05.26,Default,,0,0,0,,So it's not folder based and it
Dialogue: 0,0:06:05.26,0:06:07.06,Default,,0,0,0,,spans multiple file providers.
Dialogue: 0,0:06:07.79,0:06:10.07,Default,,0,0,0,,And in a working set, there are
Dialogue: 0,0:06:10.68,0:06:12.42,Default,,0,0,0,,these documents.
Dialogue: 0,0:06:12.55,0:06:14.11,Default,,0,0,0,,So recently-opened documents or
Dialogue: 0,0:06:14.11,0:06:16.85,Default,,0,0,0,,used document, favorites, tag
Dialogue: 0,0:06:16.85,0:06:20.33,Default,,0,0,0,,documents and folders, documents
Dialogue: 0,0:06:20.33,0:06:22.11,Default,,0,0,0,,shared through or by the user,
Dialogue: 0,0:06:22.39,0:06:23.87,Default,,0,0,0,,documents that were previously
Dialogue: 0,0:06:23.87,0:06:25.21,Default,,0,0,0,,downloaded to the device and are
Dialogue: 0,0:06:25.21,0:06:26.23,Default,,0,0,0,,available offline, and
Dialogue: 0,0:06:26.76,0:06:30.04,Default,,0,0,0,,recently-deleted documents.
Dialogue: 0,0:06:30.04,0:06:32.33,Default,,0,0,0,,For the user experience to be
Dialogue: 0,0:06:32.33,0:06:33.65,Default,,0,0,0,,consistent across file provider,
Dialogue: 0,0:06:33.65,0:06:35.69,Default,,0,0,0,,we ask you to put all those
Dialogue: 0,0:06:35.69,0:06:36.70,Default,,0,0,0,,files in the working set.
Dialogue: 0,0:06:37.16,0:06:38.34,Default,,0,0,0,,But you have domain-specific
Dialogue: 0,0:06:38.34,0:06:38.72,Default,,0,0,0,,knowledge.
Dialogue: 0,0:06:38.72,0:06:39.76,Default,,0,0,0,,You know what's relevant to the
Dialogue: 0,0:06:39.76,0:06:40.03,Default,,0,0,0,,user.
Dialogue: 0,0:06:40.03,0:06:41.98,Default,,0,0,0,,So you might choose to add more
Dialogue: 0,0:06:41.98,0:06:44.22,Default,,0,0,0,,to the working set, if you so
Dialogue: 0,0:06:44.22,0:06:44.53,Default,,0,0,0,,want.
Dialogue: 0,0:06:45.02,0:06:48.66,Default,,0,0,0,,However, caveat: We are actually
Dialogue: 0,0:06:48.66,0:06:50.65,Default,,0,0,0,,Smart Caching the working set on
Dialogue: 0,0:06:50.65,0:06:51.13,Default,,0,0,0,,the device.
Dialogue: 0,0:06:51.13,0:06:52.30,Default,,0,0,0,,So once something is in the
Dialogue: 0,0:06:52.30,0:06:53.42,Default,,0,0,0,,working set, you'll have to keep
Dialogue: 0,0:06:53.42,0:06:53.92,Default,,0,0,0,,it in sync.
Dialogue: 0,0:06:54.96,0:06:58.02,Default,,0,0,0,,I'll get back to that.
Dialogue: 0,0:06:58.02,0:07:00.11,Default,,0,0,0,,So in the document browser in
Dialogue: 0,0:07:00.11,0:07:02.45,Default,,0,0,0,,the Recents tab, you'll see the
Dialogue: 0,0:07:02.45,0:07:03.26,Default,,0,0,0,,working set.
Dialogue: 0,0:07:03.35,0:07:04.70,Default,,0,0,0,,And each file provider may
Dialogue: 0,0:07:04.70,0:07:05.98,Default,,0,0,0,,contribute different documents
Dialogue: 0,0:07:05.98,0:07:06.90,Default,,0,0,0,,to the working set.
Dialogue: 0,0:07:08.25,0:07:10.92,Default,,0,0,0,,We don't do that at display
Dialogue: 0,0:07:10.92,0:07:11.27,Default,,0,0,0,,time.
Dialogue: 0,0:07:11.79,0:07:13.30,Default,,0,0,0,,If we had to merge the list of
Dialogue: 0,0:07:13.30,0:07:15.83,Default,,0,0,0,,documents as they come in from
Dialogue: 0,0:07:15.83,0:07:16.89,Default,,0,0,0,,the different file provider
Dialogue: 0,0:07:16.89,0:07:18.43,Default,,0,0,0,,extensions when the UI is
Dialogue: 0,0:07:18.43,0:07:19.33,Default,,0,0,0,,onscreen, you'd have weird
Dialogue: 0,0:07:19.33,0:07:21.25,Default,,0,0,0,,animations, visual glitches.
Dialogue: 0,0:07:21.25,0:07:22.43,Default,,0,0,0,,So we don't do that.
Dialogue: 0,0:07:22.43,0:07:24.29,Default,,0,0,0,,Instead, what we do is we
Dialogue: 0,0:07:24.29,0:07:26.44,Default,,0,0,0,,enumerate a working set index
Dialogue: 0,0:07:26.44,0:07:28.33,Default,,0,0,0,,that is kept by the system when
Dialogue: 0,0:07:28.33,0:07:29.27,Default,,0,0,0,,the UI comes up.
Dialogue: 0,0:07:29.34,0:07:30.22,Default,,0,0,0,,And your file provider
Dialogue: 0,0:07:30.22,0:07:32.03,Default,,0,0,0,,extensions are not even invoked
Dialogue: 0,0:07:32.38,0:07:32.76,Default,,0,0,0,,at all.
Dialogue: 0,0:07:33.84,0:07:34.85,Default,,0,0,0,,We're going to talk about how
Dialogue: 0,0:07:34.85,0:07:35.72,Default,,0,0,0,,that index is built.
Dialogue: 0,0:07:36.98,0:07:39.33,Default,,0,0,0,,So the index is local and on the
Dialogue: 0,0:07:39.33,0:07:39.99,Default,,0,0,0,,device.
Dialogue: 0,0:07:40.16,0:07:42.06,Default,,0,0,0,,It is the aggregation of the
Dialogue: 0,0:07:42.06,0:07:43.28,Default,,0,0,0,,working set from the different
Dialogue: 0,0:07:43.28,0:07:44.19,Default,,0,0,0,,file providers.
Dialogue: 0,0:07:44.56,0:07:45.87,Default,,0,0,0,,Because the index is local, it
Dialogue: 0,0:07:45.87,0:07:47.12,Default,,0,0,0,,means the index is available
Dialogue: 0,0:07:47.22,0:07:47.73,Default,,0,0,0,,offline.
Dialogue: 0,0:07:47.73,0:07:49.38,Default,,0,0,0,,It means that offline, if I
Dialogue: 0,0:07:49.38,0:07:50.81,Default,,0,0,0,,bring up that UI, the document
Dialogue: 0,0:07:50.81,0:07:52.09,Default,,0,0,0,,browser, I will see my recent
Dialogue: 0,0:07:52.09,0:07:52.56,Default,,0,0,0,,documents.
Dialogue: 0,0:07:52.91,0:07:53.70,Default,,0,0,0,,That doesn't mean that all the
Dialogue: 0,0:07:53.70,0:07:54.92,Default,,0,0,0,,documents are local on the
Dialogue: 0,0:07:54.92,0:07:56.51,Default,,0,0,0,,device at all time and offline.
Dialogue: 0,0:07:56.88,0:07:57.72,Default,,0,0,0,,It means that [inaudible] to
Dialogue: 0,0:07:57.89,0:08:01.32,Default,,0,0,0,,build the UI is cached to the
Dialogue: 0,0:08:01.32,0:08:01.83,Default,,0,0,0,,device.
Dialogue: 0,0:08:02.18,0:08:06.51,Default,,0,0,0,,Because the index is local and
Dialogue: 0,0:08:06.51,0:08:09.54,Default,,0,0,0,,available offline, it is also in
Dialogue: 0,0:08:09.54,0:08:10.11,Default,,0,0,0,,Spotlight.
Dialogue: 0,0:08:10.11,0:08:11.87,Default,,0,0,0,,So the system index is for you,
Dialogue: 0,0:08:12.63,0:08:14.30,Default,,0,0,0,,the working set in Spotlight,
Dialogue: 0,0:08:14.36,0:08:16.27,Default,,0,0,0,,and users may pick a document in
Dialogue: 0,0:08:16.27,0:08:18.09,Default,,0,0,0,,Spotlight, and that will wake
Dialogue: 0,0:08:18.09,0:08:19.69,Default,,0,0,0,,your file provider extension at
Dialogue: 0,0:08:20.27,0:08:22.53,Default,,0,0,0,,that time.
Dialogue: 0,0:08:22.74,0:08:25.11,Default,,0,0,0,,So let's talk about how you
Dialogue: 0,0:08:25.33,0:08:27.27,Default,,0,0,0,,provide files to the working set
Dialogue: 0,0:08:27.27,0:08:28.28,Default,,0,0,0,,index, which happens in the
Dialogue: 0,0:08:28.28,0:08:29.70,Default,,0,0,0,,background before the document
Dialogue: 0,0:08:29.70,0:08:30.73,Default,,0,0,0,,browser comes up.
Dialogue: 0,0:08:32.13,0:08:33.42,Default,,0,0,0,,The first thing that you are
Dialogue: 0,0:08:33.49,0:08:35.84,Default,,0,0,0,,going to have to do is sync your
Dialogue: 0,0:08:35.84,0:08:38.19,Default,,0,0,0,,working set from your servers
Dialogue: 0,0:08:38.19,0:08:39.03,Default,,0,0,0,,down to the device.
Dialogue: 0,0:08:39.35,0:08:40.60,Default,,0,0,0,,So watch those file provider
Dialogue: 0,0:08:40.60,0:08:41.63,Default,,0,0,0,,extension boxes here.
Dialogue: 0,0:08:42.44,0:08:45.05,Default,,0,0,0,,The, we're asking you to keep a
Dialogue: 0,0:08:45.05,0:08:47.86,Default,,0,0,0,,database of the metadata for all
Dialogue: 0,0:08:47.86,0:08:49.18,Default,,0,0,0,,the files in the working set on
Dialogue: 0,0:08:49.18,0:08:49.64,Default,,0,0,0,,the device.
Dialogue: 0,0:08:49.64,0:08:51.28,Default,,0,0,0,,And actually, do sync both ways
Dialogue: 0,0:08:51.28,0:08:53.03,Default,,0,0,0,,because there are local changes
Dialogue: 0,0:08:53.14,0:08:54.07,Default,,0,0,0,,and [inaudible] changes.
Dialogue: 0,0:08:54.68,0:08:56.68,Default,,0,0,0,,The second step is that the
Dialogue: 0,0:08:56.68,0:08:59.31,Default,,0,0,0,,working set, the system is going
Dialogue: 0,0:08:59.31,0:09:00.87,Default,,0,0,0,,to drive the enumeration of the
Dialogue: 0,0:09:00.87,0:09:02.12,Default,,0,0,0,,working set from your file
Dialogue: 0,0:09:02.12,0:09:04.54,Default,,0,0,0,,providers to build the index.
Dialogue: 0,0:09:06.01,0:09:07.31,Default,,0,0,0,,Happens in the background.
Dialogue: 0,0:09:07.31,0:09:09.09,Default,,0,0,0,,And then at a later time, when
Dialogue: 0,0:09:09.09,0:09:11.17,Default,,0,0,0,,the UI comes up, the system will
Dialogue: 0,0:09:11.17,0:09:12.65,Default,,0,0,0,,enumerate the working set index
Dialogue: 0,0:09:12.65,0:09:13.82,Default,,0,0,0,,without waking your file
Dialogue: 0,0:09:13.82,0:09:16.04,Default,,0,0,0,,provider extension to show the
Dialogue: 0,0:09:16.04,0:09:17.35,Default,,0,0,0,,Recents in the document browser.
Dialogue: 0,0:09:17.35,0:09:20.05,Default,,0,0,0,,All right, we're asking you to
Dialogue: 0,0:09:20.05,0:09:20.97,Default,,0,0,0,,do a lot of things here.
Dialogue: 0,0:09:20.97,0:09:22.45,Default,,0,0,0,,We're asking you do sync and to
Dialogue: 0,0:09:22.45,0:09:23.91,Default,,0,0,0,,do sync of a partial set of your
Dialogue: 0,0:09:23.91,0:09:24.52,Default,,0,0,0,,documents.
Dialogue: 0,0:09:25.63,0:09:26.89,Default,,0,0,0,,If you can't do partial sync,
Dialogue: 0,0:09:26.99,0:09:28.18,Default,,0,0,0,,you might want to consider
Dialogue: 0,0:09:29.02,0:09:31.04,Default,,0,0,0,,syncing all the user's documents
Dialogue: 0,0:09:31.04,0:09:32.06,Default,,0,0,0,,down to the device.
Dialogue: 0,0:09:32.38,0:09:34.22,Default,,0,0,0,,You're going to hit scaling
Dialogue: 0,0:09:34.22,0:09:36.12,Default,,0,0,0,,issues, so think carefully about
Dialogue: 0,0:09:36.70,0:09:37.41,Default,,0,0,0,,what you do there.
Dialogue: 0,0:09:39.96,0:09:42.42,Default,,0,0,0,,OK, what we saw to this point is
Dialogue: 0,0:09:42.42,0:09:45.41,Default,,0,0,0,,that there are two ways to
Dialogue: 0,0:09:45.41,0:09:46.37,Default,,0,0,0,,browse documents.
Dialogue: 0,0:09:46.37,0:09:48.26,Default,,0,0,0,,There is a Recents tab that
Dialogue: 0,0:09:48.26,0:09:49.87,Default,,0,0,0,,shows the working set, which is
Dialogue: 0,0:09:49.87,0:09:50.91,Default,,0,0,0,,synced in the background to the
Dialogue: 0,0:09:50.91,0:09:53.03,Default,,0,0,0,,device, and there is a Browse
Dialogue: 0,0:09:53.03,0:09:55.17,Default,,0,0,0,,tab, which is based on the
Dialogue: 0,0:09:55.17,0:09:57.16,Default,,0,0,0,,online enumerations of folders.
Dialogue: 0,0:09:57.67,0:09:59.21,Default,,0,0,0,,And I'm going to call Pierre to
Dialogue: 0,0:09:59.21,0:10:00.78,Default,,0,0,0,,show you how to create a file
Dialogue: 0,0:10:00.78,0:10:01.89,Default,,0,0,0,,provider extension now.
Dialogue: 0,0:10:02.80,0:10:04.26,Default,,0,0,0,,Thank you, Pierre.
Dialogue: 0,0:10:04.26,0:10:05.58,Default,,0,0,0,,>> Thank you, Jean-Gabriel.
Dialogue: 0,0:10:06.39,0:10:09.08,Default,,0,0,0,,So let's talk about creating a
Dialogue: 0,0:10:09.08,0:10:10.76,Default,,0,0,0,,file provider extension.
Dialogue: 0,0:10:10.76,0:10:12.97,Default,,0,0,0,,First, we're going to see how to
Dialogue: 0,0:10:12.97,0:10:14.97,Default,,0,0,0,,create the project, then how to
Dialogue: 0,0:10:14.97,0:10:16.14,Default,,0,0,0,,provide a single item, then
Dialogue: 0,0:10:16.50,0:10:18.87,Default,,0,0,0,,enumerate a list of items, and
Dialogue: 0,0:10:18.87,0:10:19.88,Default,,0,0,0,,then I will [inaudible] was
Dialogue: 0,0:10:19.95,0:10:22.02,Default,,0,0,0,,going to go through you, with
Dialogue: 0,0:10:22.02,0:10:26.01,Default,,0,0,0,,you an [inaudible] to modify
Dialogue: 0,0:10:26.01,0:10:28.58,Default,,0,0,0,,item, provide custom action, and
Dialogue: 0,0:10:28.58,0:10:29.85,Default,,0,0,0,,as well as do something very,
Dialogue: 0,0:10:29.85,0:10:31.91,Default,,0,0,0,,very powerful, which is provide
Dialogue: 0,0:10:31.91,0:10:33.62,Default,,0,0,0,,services to third-parties.
Dialogue: 0,0:10:33.62,0:10:34.45,Default,,0,0,0,,What does that mean?
Dialogue: 0,0:10:34.45,0:10:35.88,Default,,0,0,0,,It means that your file provider
Dialogue: 0,0:10:35.88,0:10:37.63,Default,,0,0,0,,extension can provide its own
Dialogue: 0,0:10:37.63,0:10:39.92,Default,,0,0,0,,API, so you own API to other
Dialogue: 0,0:10:39.92,0:10:40.71,Default,,0,0,0,,third-party's app.
Dialogue: 0,0:10:41.70,0:10:42.76,Default,,0,0,0,,This is really cool, so you
Dialogue: 0,0:10:42.76,0:10:44.30,Default,,0,0,0,,probably want to stay until you
Dialogue: 0,0:10:44.30,0:10:47.63,Default,,0,0,0,,see this or play it online
Dialogue: 0,0:10:48.66,0:10:48.79,Default,,0,0,0,,later.
Dialogue: 0,0:10:49.90,0:10:50.93,Default,,0,0,0,,Creating a file provider
Dialogue: 0,0:10:50.93,0:10:52.19,Default,,0,0,0,,extension is really simple if
Dialogue: 0,0:10:52.19,0:10:53.26,Default,,0,0,0,,you start from scratch.
Dialogue: 0,0:10:53.26,0:10:55.20,Default,,0,0,0,,So there is a Xcode template,
Dialogue: 0,0:10:55.66,0:10:56.95,Default,,0,0,0,,File Provider Extension.
Dialogue: 0,0:10:56.95,0:10:57.60,Default,,0,0,0,,Just click on it.
Dialogue: 0,0:10:57.60,0:10:58.43,Default,,0,0,0,,Boom, it's done.
Dialogue: 0,0:10:59.05,0:11:00.37,Default,,0,0,0,,And then the real work begin.
Dialogue: 0,0:11:00.50,0:11:01.47,Default,,0,0,0,,You have to subclass
Dialogue: 0,0:11:01.47,0:11:03.02,Default,,0,0,0,,NSFileProviderExtension.
Dialogue: 0,0:11:04.00,0:11:06.15,Default,,0,0,0,,If you already have an existing
Dialogue: 0,0:11:06.15,0:11:07.90,Default,,0,0,0,,file provider extension, in that
Dialogue: 0,0:11:07.90,0:11:10.31,Default,,0,0,0,,case, what you should do is add
Dialogue: 0,0:11:10.31,0:11:12.75,Default,,0,0,0,,the support enumeration key to
Dialogue: 0,0:11:12.75,0:11:13.59,Default,,0,0,0,,your Info.plist.
Dialogue: 0,0:11:13.97,0:11:15.82,Default,,0,0,0,,That will tell the system, look,
Dialogue: 0,0:11:15.82,0:11:17.68,Default,,0,0,0,,you probably want to take this
Dialogue: 0,0:11:17.68,0:11:19.74,Default,,0,0,0,,file extension and use the new
Dialogue: 0,0:11:19.86,0:11:21.98,Default,,0,0,0,,UI to render my document.
Dialogue: 0,0:11:23.06,0:11:26.63,Default,,0,0,0,,So the big picture during this
Dialogue: 0,0:11:26.63,0:11:28.30,Default,,0,0,0,,file provider extension subclass
Dialogue: 0,0:11:28.56,0:11:30.33,Default,,0,0,0,,that you should build.
Dialogue: 0,0:11:31.06,0:11:32.59,Default,,0,0,0,,Your file provider extension
Dialogue: 0,0:11:32.59,0:11:34.20,Default,,0,0,0,,subclass [inaudible] is to vend
Dialogue: 0,0:11:34.20,0:11:35.86,Default,,0,0,0,,the item metadata by
Dialogue: 0,0:11:35.86,0:11:37.64,Default,,0,0,0,,implementing or returning object
Dialogue: 0,0:11:37.64,0:11:39.23,Default,,0,0,0,,implementing the NSFileProvider
Dialogue: 0,0:11:39.23,0:11:42.81,Default,,0,0,0,,protocol, NSFileProviderItem
Dialogue: 0,0:11:42.81,0:11:43.30,Default,,0,0,0,,protocol.
Dialogue: 0,0:11:44.12,0:11:46.66,Default,,0,0,0,,Those item are identified by a
Dialogue: 0,0:11:46.66,0:11:50.06,Default,,0,0,0,,string that you provide and are
Dialogue: 0,0:11:50.06,0:11:51.73,Default,,0,0,0,,materialized on disk through
Dialogue: 0,0:11:51.73,0:11:53.31,Default,,0,0,0,,file URL.
Dialogue: 0,0:11:54.38,0:11:58.72,Default,,0,0,0,,The folder contents of your file
Dialogue: 0,0:11:58.76,0:12:01.29,Default,,0,0,0,,provider is exposed by
Dialogue: 0,0:12:01.29,0:12:02.94,Default,,0,0,0,,implementing what we call an
Dialogue: 0,0:12:02.94,0:12:04.56,Default,,0,0,0,,NSFileProviderEnumerator.
Dialogue: 0,0:12:05.01,0:12:07.18,Default,,0,0,0,,That sounds complicated, but
Dialogue: 0,0:12:07.18,0:12:07.67,Default,,0,0,0,,it's not.
Dialogue: 0,0:12:08.30,0:12:10.94,Default,,0,0,0,,So, and before jumping into the
Dialogue: 0,0:12:10.94,0:12:12.12,Default,,0,0,0,,very detail, let's have a big
Dialogue: 0,0:12:12.18,0:12:14.10,Default,,0,0,0,,picture of the tasks we've been
Dialogue: 0,0:12:14.10,0:12:16.61,Default,,0,0,0,,going through and see what the
Dialogue: 0,0:12:16.64,0:12:18.53,Default,,0,0,0,,anatomy of a file provider
Dialogue: 0,0:12:18.53,0:12:20.05,Default,,0,0,0,,extension is going to look like
Dialogue: 0,0:12:20.25,0:12:21.48,Default,,0,0,0,,after we build all this.
Dialogue: 0,0:12:22.05,0:12:23.35,Default,,0,0,0,,So first task, we need to
Dialogue: 0,0:12:23.35,0:12:24.73,Default,,0,0,0,,provide the metadata for a given
Dialogue: 0,0:12:24.73,0:12:25.67,Default,,0,0,0,,item identifier.
Dialogue: 0,0:12:26.76,0:12:28.97,Default,,0,0,0,,That's straightforward if you
Dialogue: 0,0:12:28.97,0:12:30.52,Default,,0,0,0,,have a database, so you probably
Dialogue: 0,0:12:30.52,0:12:32.16,Default,,0,0,0,,want to have a database.
Dialogue: 0,0:12:32.30,0:12:35.93,Default,,0,0,0,,Then, you need to map URLs to
Dialogue: 0,0:12:35.93,0:12:36.88,Default,,0,0,0,,item identifiers.
Dialogue: 0,0:12:36.88,0:12:39.75,Default,,0,0,0,,That's probably a semicolon in
Dialogue: 0,0:12:39.75,0:12:40.49,Default,,0,0,0,,your database.
Dialogue: 0,0:12:40.76,0:12:43.19,Default,,0,0,0,,Last, you're in charge of
Dialogue: 0,0:12:43.19,0:12:46.05,Default,,0,0,0,,managing the disk storage,
Dialogue: 0,0:12:46.16,0:12:48.19,Default,,0,0,0,,whether the data corresponding
Dialogue: 0,0:12:48.19,0:12:50.11,Default,,0,0,0,,to a file is local or not.
Dialogue: 0,0:12:50.84,0:12:52.79,Default,,0,0,0,,That's the second piece of your
Dialogue: 0,0:12:52.79,0:12:53.82,Default,,0,0,0,,file provider extension.
Dialogue: 0,0:12:54.69,0:12:57.08,Default,,0,0,0,,And inside the disk storage, of
Dialogue: 0,0:12:57.08,0:12:58.27,Default,,0,0,0,,course, file can be there or
Dialogue: 0,0:12:58.27,0:13:01.40,Default,,0,0,0,,not, as [inaudible].
Dialogue: 0,0:13:02.31,0:13:04.19,Default,,0,0,0,,OK, so we've seen the anatomy.
Dialogue: 0,0:13:04.27,0:13:06.30,Default,,0,0,0,,Let's jump in and provide an
Dialogue: 0,0:13:06.30,0:13:06.79,Default,,0,0,0,,item.
Dialogue: 0,0:13:06.88,0:13:08.47,Default,,0,0,0,,What does it mean to provide an
Dialogue: 0,0:13:08.47,0:13:08.87,Default,,0,0,0,,item?
Dialogue: 0,0:13:09.74,0:13:11.22,Default,,0,0,0,,First, you need to provide a
Dialogue: 0,0:13:11.22,0:13:11.52,Default,,0,0,0,,file URL.
Dialogue: 0,0:13:11.87,0:13:15.02,Default,,0,0,0,,Then, file contents, metadata,
Dialogue: 0,0:13:15.88,0:13:17.31,Default,,0,0,0,,and thumbnail for your item.
Dialogue: 0,0:13:17.77,0:13:19.24,Default,,0,0,0,,That's it.
Dialogue: 0,0:13:20.02,0:13:22.12,Default,,0,0,0,,Why do you need to provide a
Dialogue: 0,0:13:22.12,0:13:23.40,Default,,0,0,0,,file URL, you might ask?
Dialogue: 0,0:13:24.49,0:13:26.86,Default,,0,0,0,,Well, file provider manipulates
Dialogue: 0,0:13:27.12,0:13:29.25,Default,,0,0,0,,file provider item and file
Dialogue: 0,0:13:29.25,0:13:31.01,Default,,0,0,0,,provider item identifier, not
Dialogue: 0,0:13:31.01,0:13:32.15,Default,,0,0,0,,file URLs directly.
Dialogue: 0,0:13:32.99,0:13:35.99,Default,,0,0,0,,However, document-based apps do
Dialogue: 0,0:13:35.99,0:13:40.39,Default,,0,0,0,,consume file URLs, so we need to
Dialogue: 0,0:13:40.39,0:13:43.08,Default,,0,0,0,,bridge between the two, so let's
Dialogue: 0,0:13:43.62,0:13:45.86,Default,,0,0,0,,take an example.
Dialogue: 0,0:13:45.86,0:13:47.16,Default,,0,0,0,,When the user taps on the file
Dialogue: 0,0:13:47.16,0:13:49.34,Default,,0,0,0,,in the File app, the File app
Dialogue: 0,0:13:49.57,0:13:50.75,Default,,0,0,0,,only has access to your item
Dialogue: 0,0:13:50.75,0:13:51.92,Default,,0,0,0,,identifier at that point.
Dialogue: 0,0:13:52.40,0:13:53.42,Default,,0,0,0,,So before calling the
Dialogue: 0,0:13:53.42,0:13:55.68,Default,,0,0,0,,document-based app, it's
Dialogue: 0,0:13:55.68,0:13:57.12,Default,,0,0,0,,actually going to call into your
Dialogue: 0,0:13:57.12,0:13:58.22,Default,,0,0,0,,file provider extension
Dialogue: 0,0:13:58.22,0:13:59.01,Default,,0,0,0,,subclass.
Dialogue: 0,0:14:00.20,0:14:02.16,Default,,0,0,0,,The method urlForItem with
Dialogue: 0,0:14:02.16,0:14:04.34,Default,,0,0,0,,identifier is going to get
Dialogue: 0,0:14:04.34,0:14:06.02,Default,,0,0,0,,called, and so you will look in
Dialogue: 0,0:14:06.02,0:14:08.08,Default,,0,0,0,,your database, figure out the
Dialogue: 0,0:14:08.08,0:14:09.31,Default,,0,0,0,,URL for the given item
Dialogue: 0,0:14:09.31,0:14:11.15,Default,,0,0,0,,identifier, and, boom, you'll
Dialogue: 0,0:14:11.15,0:14:12.74,Default,,0,0,0,,return into the document-based
Dialogue: 0,0:14:12.74,0:14:12.93,Default,,0,0,0,,app.
Dialogue: 0,0:14:13.62,0:14:15.18,Default,,0,0,0,,Not sure if the system does it
Dialogue: 0,0:14:15.18,0:14:16.32,Default,,0,0,0,,for you, but you [inaudible] to
Dialogue: 0,0:14:16.32,0:14:18.34,Default,,0,0,0,,the system which items to the
Dialogue: 0,0:14:18.34,0:14:19.83,Default,,0,0,0,,document-based app, and you're
Dialogue: 0,0:14:19.83,0:14:20.05,Default,,0,0,0,,done.
Dialogue: 0,0:14:20.94,0:14:22.24,Default,,0,0,0,,At that point, the
Dialogue: 0,0:14:22.24,0:14:23.61,Default,,0,0,0,,document-based app opened a file
Dialogue: 0,0:14:23.61,0:14:24.47,Default,,0,0,0,,by URL.
Dialogue: 0,0:14:24.47,0:14:25.86,Default,,0,0,0,,On the other [inaudible], I was
Dialogue: 0,0:14:25.86,0:14:27.50,Default,,0,0,0,,talking about the database to
Dialogue: 0,0:14:27.50,0:14:29.94,Default,,0,0,0,,the URL to item identifier
Dialogue: 0,0:14:29.94,0:14:30.41,Default,,0,0,0,,mapping.
Dialogue: 0,0:14:30.41,0:14:31.77,Default,,0,0,0,,One thing you might want to do
Dialogue: 0,0:14:32.02,0:14:33.62,Default,,0,0,0,,is to actually start the item
Dialogue: 0,0:14:33.62,0:14:35.41,Default,,0,0,0,,identifier inside the file URL.
Dialogue: 0,0:14:36.44,0:14:37.97,Default,,0,0,0,,It's very convenient because you
Dialogue: 0,0:14:37.97,0:14:40.64,Default,,0,0,0,,can avoid database lookup if you
Dialogue: 0,0:14:40.64,0:14:44.82,Default,,0,0,0,,do that and you can tag items
Dialogue: 0,0:14:44.82,0:14:45.59,Default,,0,0,0,,between renames.
Dialogue: 0,0:14:45.59,0:14:47.06,Default,,0,0,0,,Last tidbit, you probably want
Dialogue: 0,0:14:47.06,0:14:49.40,Default,,0,0,0,,to keep a flat list in your disk
Dialogue: 0,0:14:49.40,0:14:50.09,Default,,0,0,0,,storage.
Dialogue: 0,0:14:50.25,0:14:51.33,Default,,0,0,0,,You don't need to replicate the
Dialogue: 0,0:14:51.33,0:14:53.15,Default,,0,0,0,,folder hierarchy because this is
Dialogue: 0,0:14:53.15,0:14:54.45,Default,,0,0,0,,quite complicated, and so you
Dialogue: 0,0:14:54.45,0:14:55.93,Default,,0,0,0,,can avoid it, so please do.
Dialogue: 0,0:14:56.29,0:14:57.69,Default,,0,0,0,,So you might say, hey, Pierre,
Dialogue: 0,0:14:57.69,0:14:59.34,Default,,0,0,0,,so we have the file URL, but
Dialogue: 0,0:14:59.34,0:15:00.46,Default,,0,0,0,,what about the file content?
Dialogue: 0,0:15:00.46,0:15:02.07,Default,,0,0,0,,Because I did not know they're
Dialogue: 0,0:15:02.07,0:15:02.96,Default,,0,0,0,,missing at that point.
Dialogue: 0,0:15:03.66,0:15:05.50,Default,,0,0,0,,So of course, we should look
Dialogue: 0,0:15:05.50,0:15:05.98,Default,,0,0,0,,into that.
Dialogue: 0,0:15:05.98,0:15:07.85,Default,,0,0,0,,So you can open the file by, so
Dialogue: 0,0:15:07.85,0:15:09.12,Default,,0,0,0,,when the document-based app
Dialogue: 0,0:15:09.59,0:15:11.98,Default,,0,0,0,,opened your app, it opened the
Dialogue: 0,0:15:11.98,0:15:14.00,Default,,0,0,0,,file by URL.
Dialogue: 0,0:15:15.27,0:15:18.39,Default,,0,0,0,,But it's not doing that state.
Dialogue: 0,0:15:18.46,0:15:19.42,Default,,0,0,0,,Like, it should use
Dialogue: 0,0:15:19.49,0:15:23.11,Default,,0,0,0,,NSFileCoordinator and read using
Dialogue: 0,0:15:23.11,0:15:24.49,Default,,0,0,0,,a file coordination request.
Dialogue: 0,0:15:24.94,0:15:27.09,Default,,0,0,0,,That is something apps using UI
Dialogue: 0,0:15:27.09,0:15:29.77,Default,,0,0,0,,documents do for free, so when
Dialogue: 0,0:15:29.77,0:15:31.34,Default,,0,0,0,,that happens, your file provider
Dialogue: 0,0:15:31.34,0:15:32.41,Default,,0,0,0,,extension is called.
Dialogue: 0,0:15:33.72,0:15:34.76,Default,,0,0,0,,Most specifically, in your
Dialogue: 0,0:15:34.76,0:15:37.40,Default,,0,0,0,,subclass, startProvidingItem at
Dialogue: 0,0:15:37.40,0:15:39.31,Default,,0,0,0,,URL with completionHandler is
Dialogue: 0,0:15:39.31,0:15:40.12,Default,,0,0,0,,going to get called.
Dialogue: 0,0:15:41.06,0:15:41.74,Default,,0,0,0,,When you [inaudible], you look
Dialogue: 0,0:15:41.74,0:15:43.60,Default,,0,0,0,,into your disk storage.
Dialogue: 0,0:15:43.60,0:15:44.95,Default,,0,0,0,,You figure out the item is not
Dialogue: 0,0:15:44.95,0:15:45.24,Default,,0,0,0,,there.
Dialogue: 0,0:15:46.12,0:15:48.46,Default,,0,0,0,,So you go in your server,
Dialogue: 0,0:15:48.46,0:15:50.64,Default,,0,0,0,,NSURLSession most likely, and
Dialogue: 0,0:15:50.64,0:15:51.41,Default,,0,0,0,,you download the file.
Dialogue: 0,0:15:52.02,0:15:53.82,Default,,0,0,0,,The download completes.
Dialogue: 0,0:15:55.09,0:15:58.55,Default,,0,0,0,,The file is moved into your disk
Dialogue: 0,0:15:58.74,0:15:59.34,Default,,0,0,0,,storage.
Dialogue: 0,0:16:00.53,0:16:01.61,Default,,0,0,0,,Now, you can call the
Dialogue: 0,0:16:01.61,0:16:03.88,Default,,0,0,0,,completionHandler that is going
Dialogue: 0,0:16:03.88,0:16:05.28,Default,,0,0,0,,to grant the coordination to the
Dialogue: 0,0:16:05.63,0:16:07.02,Default,,0,0,0,,document-based app.
Dialogue: 0,0:16:07.30,0:16:09.26,Default,,0,0,0,,And at that point, the file is
Dialogue: 0,0:16:09.26,0:16:09.58,Default,,0,0,0,,opened.
Dialogue: 0,0:16:10.57,0:16:12.56,Default,,0,0,0,,Cool. So what happens if you
Dialogue: 0,0:16:12.56,0:16:13.83,Default,,0,0,0,,want this a second time?
Dialogue: 0,0:16:14.15,0:16:15.73,Default,,0,0,0,,Because this time, the file is
Dialogue: 0,0:16:15.73,0:16:16.14,Default,,0,0,0,,there.
Dialogue: 0,0:16:17.21,0:16:20.46,Default,,0,0,0,,But there is still going to be a
Dialogue: 0,0:16:20.46,0:16:22.59,Default,,0,0,0,,file coordinator reader request
Dialogue: 0,0:16:22.89,0:16:23.40,Default,,0,0,0,,issued.
Dialogue: 0,0:16:23.74,0:16:25.40,Default,,0,0,0,,And at that point, this is
Dialogue: 0,0:16:25.40,0:16:25.96,Default,,0,0,0,,pretty cool.
Dialogue: 0,0:16:26.29,0:16:27.57,Default,,0,0,0,,Your file provider extension
Dialogue: 0,0:16:27.57,0:16:28.76,Default,,0,0,0,,subclass is going to get called
Dialogue: 0,0:16:28.76,0:16:29.06,Default,,0,0,0,,again.
Dialogue: 0,0:16:29.06,0:16:30.72,Default,,0,0,0,,So that's very powerful for you
Dialogue: 0,0:16:30.72,0:16:32.97,Default,,0,0,0,,to track usage on your files.
Dialogue: 0,0:16:33.71,0:16:35.18,Default,,0,0,0,,But this time, the file is here,
Dialogue: 0,0:16:35.18,0:16:36.19,Default,,0,0,0,,so what do you need to do?
Dialogue: 0,0:16:36.26,0:16:36.90,Default,,0,0,0,,Well, you just
Dialogue: 0,0:16:36.90,0:16:38.29,Default,,0,0,0,,completionHandler, and you're
Dialogue: 0,0:16:38.29,0:16:38.54,Default,,0,0,0,,done.
Dialogue: 0,0:16:38.73,0:16:40.90,Default,,0,0,0,,It's very powerful, but at the
Dialogue: 0,0:16:40.90,0:16:42.56,Default,,0,0,0,,same time, it means that your
Dialogue: 0,0:16:42.56,0:16:44.03,Default,,0,0,0,,file provider extension might
Dialogue: 0,0:16:44.11,0:16:46.86,Default,,0,0,0,,be, might delay file loading.
Dialogue: 0,0:16:47.10,0:16:49.61,Default,,0,0,0,,So you better be fast when you
Dialogue: 0,0:16:50.29,0:16:52.59,Default,,0,0,0,,implement startProvidingItem if
Dialogue: 0,0:16:52.59,0:16:53.83,Default,,0,0,0,,the file is already local.
Dialogue: 0,0:16:53.83,0:16:56.47,Default,,0,0,0,,OK, so the coordination is
Dialogue: 0,0:16:56.47,0:16:58.77,Default,,0,0,0,,granted, and you've seen this
Dialogue: 0,0:16:58.77,0:16:59.18,Default,,0,0,0,,before.
Dialogue: 0,0:16:59.18,0:17:00.29,Default,,0,0,0,,The file is now opened.
Dialogue: 0,0:17:02.08,0:17:02.82,Default,,0,0,0,,Second part.
Dialogue: 0,0:17:03.13,0:17:06.50,Default,,0,0,0,,In the Files app, the metadata
Dialogue: 0,0:17:06.50,0:17:07.72,Default,,0,0,0,,of your files are prominent.
Dialogue: 0,0:17:07.72,0:17:10.53,Default,,0,0,0,,And the way it works is that for
Dialogue: 0,0:17:10.53,0:17:12.84,Default,,0,0,0,,each item that the files have
Dialogue: 0,0:17:12.84,0:17:14.76,Default,,0,0,0,,displayed, your file provider is
Dialogue: 0,0:17:14.76,0:17:16.96,Default,,0,0,0,,going to be called, and the
Dialogue: 0,0:17:16.96,0:17:18.45,Default,,0,0,0,,specific method this time is
Dialogue: 0,0:17:18.45,0:17:20.69,Default,,0,0,0,,called item for itemIdentifier,
Dialogue: 0,0:17:21.22,0:17:22.02,Default,,0,0,0,,which returned an
Dialogue: 0,0:17:22.02,0:17:23.17,Default,,0,0,0,,NSFileProviderItem.
Dialogue: 0,0:17:23.25,0:17:25.42,Default,,0,0,0,,That item should be [inaudible]
Dialogue: 0,0:17:25.42,0:17:26.46,Default,,0,0,0,,from your database.
Dialogue: 0,0:17:26.46,0:17:30.12,Default,,0,0,0,,So you look at your database,
Dialogue: 0,0:17:31.22,0:17:32.92,Default,,0,0,0,,you get an NSFileProviderItem,
Dialogue: 0,0:17:33.15,0:17:35.43,Default,,0,0,0,,and you return it.
Dialogue: 0,0:17:36.84,0:17:39.71,Default,,0,0,0,,OK, that was simple, but I did
Dialogue: 0,0:17:39.71,0:17:41.16,Default,,0,0,0,,not actually go into the detail
Dialogue: 0,0:17:41.16,0:17:42.54,Default,,0,0,0,,of what is an
Dialogue: 0,0:17:42.54,0:17:43.42,Default,,0,0,0,,NSFileProviderItem.
Dialogue: 0,0:17:43.42,0:17:45.85,Default,,0,0,0,,So as I told you a bit earlier,
Dialogue: 0,0:17:45.85,0:17:46.67,Default,,0,0,0,,it's a protocol.
Dialogue: 0,0:17:46.67,0:17:49.15,Default,,0,0,0,,And with most protocol, you have
Dialogue: 0,0:17:50.07,0:17:52.28,Default,,0,0,0,,required properties as well as
Dialogue: 0,0:17:52.40,0:17:53.27,Default,,0,0,0,,optional properties.
Dialogue: 0,0:17:53.27,0:17:54.71,Default,,0,0,0,,So let's go into the detail of
Dialogue: 0,0:17:54.71,0:17:56.54,Default,,0,0,0,,the required properties that
Dialogue: 0,0:17:56.54,0:17:58.75,Default,,0,0,0,,your object conforming to
Dialogue: 0,0:17:58.75,0:18:00.38,Default,,0,0,0,,NSFileProviderItem must
Dialogue: 0,0:18:00.38,0:18:00.76,Default,,0,0,0,,implement.
Dialogue: 0,0:18:01.27,0:18:03.37,Default,,0,0,0,,So the first properties are
Dialogue: 0,0:18:03.37,0:18:04.73,Default,,0,0,0,,usually the itemIdentifier, so
Dialogue: 0,0:18:04.81,0:18:05.95,Default,,0,0,0,,that's a simple string.
Dialogue: 0,0:18:06.73,0:18:07.67,Default,,0,0,0,,Then, you have the
Dialogue: 0,0:18:07.67,0:18:09.48,Default,,0,0,0,,typeIdentifier, and that is the
Dialogue: 0,0:18:09.48,0:18:11.60,Default,,0,0,0,,UTI, indicating whether the file
Dialogue: 0,0:18:11.60,0:18:15.02,Default,,0,0,0,,is a PDF, an image, or a folder.
Dialogue: 0,0:18:15.02,0:18:19.11,Default,,0,0,0,,And last but not least, you have
Dialogue: 0,0:18:19.11,0:18:20.93,Default,,0,0,0,,the filename, which is pretty
Dialogue: 0,0:18:20.93,0:18:22.26,Default,,0,0,0,,prominent in [inaudible] UI.
Dialogue: 0,0:18:22.26,0:18:27.19,Default,,0,0,0,,So now that we've seen the
Dialogue: 0,0:18:27.19,0:18:28.59,Default,,0,0,0,,required properties, that's all
Dialogue: 0,0:18:28.59,0:18:30.24,Default,,0,0,0,,you really need to implement, we
Dialogue: 0,0:18:30.24,0:18:31.50,Default,,0,0,0,,can move on to the optional
Dialogue: 0,0:18:31.50,0:18:33.46,Default,,0,0,0,,properties that we strongly
Dialogue: 0,0:18:33.46,0:18:36.10,Default,,0,0,0,,encourage you to also implement.
Dialogue: 0,0:18:36.22,0:18:39.68,Default,,0,0,0,,For instance, in this particular
Dialogue: 0,0:18:39.68,0:18:43.89,Default,,0,0,0,,screenshot here, there is the
Dialogue: 0,0:18:43.89,0:18:46.91,Default,,0,0,0,,shared status that is displayed
Dialogue: 0,0:18:46.91,0:18:48.93,Default,,0,0,0,,just below the filename.
Dialogue: 0,0:18:49.33,0:18:51.30,Default,,0,0,0,,That shared status is displayed
Dialogue: 0,0:18:51.30,0:18:53.06,Default,,0,0,0,,onscreen if you set the isShared
Dialogue: 0,0:18:53.06,0:18:53.61,Default,,0,0,0,,property.
Dialogue: 0,0:18:53.96,0:18:56.04,Default,,0,0,0,,And to go along with the shared
Dialogue: 0,0:18:56.04,0:18:56.92,Default,,0,0,0,,status, you have the
Dialogue: 0,0:18:56.92,0:18:58.83,Default,,0,0,0,,ownerNameComponents that you can
Dialogue: 0,0:18:58.83,0:18:59.42,Default,,0,0,0,,specify.
Dialogue: 0,0:19:00.08,0:19:01.11,Default,,0,0,0,,And now, you can see on my
Dialogue: 0,0:19:01.11,0:19:02.32,Default,,0,0,0,,document slide, "Shared by
Dialogue: 0,0:19:02.32,0:19:05.38,Default,,0,0,0,,Amaury," which is pretty good to
Dialogue: 0,0:19:05.57,0:19:05.64,Default,,0,0,0,,know.
Dialogue: 0,0:19:05.63,0:19:06.82,Default,,0,0,0,,Then, you have additional states
Dialogue: 0,0:19:06.83,0:19:08.53,Default,,0,0,0,,such as isDownloaded -- that
Dialogue: 0,0:19:08.53,0:19:10.95,Default,,0,0,0,,lets, display a small down arrow
Dialogue: 0,0:19:11.27,0:19:13.39,Default,,0,0,0,,-- isUploading and uploadError.
Dialogue: 0,0:19:13.39,0:19:14.07,Default,,0,0,0,,So the uploadError is
Dialogue: 0,0:19:14.07,0:19:16.11,Default,,0,0,0,,interesting because if your user
Dialogue: 0,0:19:16.11,0:19:16.86,Default,,0,0,0,,doesn't have enough [inaudible]
Dialogue: 0,0:19:16.86,0:19:19.09,Default,,0,0,0,,to actually upload the file, you
Dialogue: 0,0:19:19.09,0:19:20.50,Default,,0,0,0,,probably won't position that
Dialogue: 0,0:19:20.50,0:19:20.69,Default,,0,0,0,,error.
Dialogue: 0,0:19:21.20,0:19:22.91,Default,,0,0,0,,OK, there are a lot of
Dialogue: 0,0:19:22.91,0:19:24.01,Default,,0,0,0,,additional properties.
Dialogue: 0,0:19:24.08,0:19:25.35,Default,,0,0,0,,Unfortunately, we don't have
Dialogue: 0,0:19:25.40,0:19:27.04,Default,,0,0,0,,time to go through all of them.
Dialogue: 0,0:19:27.47,0:19:29.32,Default,,0,0,0,,So we're just going to move on,
Dialogue: 0,0:19:29.32,0:19:30.89,Default,,0,0,0,,but I encourage you to read our
Dialogue: 0,0:19:30.89,0:19:32.13,Default,,0,0,0,,documentation, which is pretty
Dialogue: 0,0:19:32.13,0:19:34.15,Default,,0,0,0,,good on the subject, as well as
Dialogue: 0,0:19:34.15,0:19:35.40,Default,,0,0,0,,our header files.
Dialogue: 0,0:19:35.73,0:19:37.22,Default,,0,0,0,,Well, so we've seen the
Dialogue: 0,0:19:37.22,0:19:38.78,Default,,0,0,0,,metadata, but there is one last
Dialogue: 0,0:19:38.78,0:19:40.11,Default,,0,0,0,,piece of metadata we did not
Dialogue: 0,0:19:40.11,0:19:41.25,Default,,0,0,0,,talk about, and it's a fairly
Dialogue: 0,0:19:41.25,0:19:43.04,Default,,0,0,0,,big one, so it used a different
Dialogue: 0,0:19:43.04,0:19:43.54,Default,,0,0,0,,pipeline.
Dialogue: 0,0:19:43.82,0:19:44.75,Default,,0,0,0,,It's the thumbnail.
Dialogue: 0,0:19:45.63,0:19:46.87,Default,,0,0,0,,So when the Files app displays
Dialogue: 0,0:19:46.87,0:19:48.44,Default,,0,0,0,,your file, especially if the
Dialogue: 0,0:19:48.44,0:19:49.80,Default,,0,0,0,,file is not local -- in that
Dialogue: 0,0:19:49.80,0:19:51.03,Default,,0,0,0,,case, there is no way we can
Dialogue: 0,0:19:51.03,0:19:52.91,Default,,0,0,0,,generate a thumbnail out of that
Dialogue: 0,0:19:52.91,0:19:55.13,Default,,0,0,0,,file -- what we are going to do
Dialogue: 0,0:19:55.13,0:19:56.64,Default,,0,0,0,,is to ask your file provider
Dialogue: 0,0:19:56.64,0:19:58.16,Default,,0,0,0,,extension to fetch the
Dialogue: 0,0:19:58.16,0:20:00.08,Default,,0,0,0,,thumbnails for a list of files.
Dialogue: 0,0:20:00.76,0:20:02.85,Default,,0,0,0,,In that case, you can go on your
Dialogue: 0,0:20:02.85,0:20:04.35,Default,,0,0,0,,server, ask it to download the
Dialogue: 0,0:20:04.53,0:20:05.85,Default,,0,0,0,,thumbnail associated to the
Dialogue: 0,0:20:05.85,0:20:06.37,Default,,0,0,0,,file.
Dialogue: 0,0:20:07.52,0:20:09.01,Default,,0,0,0,,When the download completes, you
Dialogue: 0,0:20:09.01,0:20:10.48,Default,,0,0,0,,hand back the thumbnail data.
Dialogue: 0,0:20:10.53,0:20:13.75,Default,,0,0,0,,And at this point, we just
Dialogue: 0,0:20:14.03,0:20:17.22,Default,,0,0,0,,display the thumbnail.
Dialogue: 0,0:20:18.20,0:20:19.90,Default,,0,0,0,,So I'm going to go into detail
Dialogue: 0,0:20:19.90,0:20:21.61,Default,,0,0,0,,of how that fetch thumbnail
Dialogue: 0,0:20:21.61,0:20:22.85,Default,,0,0,0,,function works because it's a
Dialogue: 0,0:20:22.85,0:20:24.15,Default,,0,0,0,,bit more involved than the other
Dialogue: 0,0:20:24.15,0:20:24.49,Default,,0,0,0,,one.
Dialogue: 0,0:20:25.71,0:20:28.00,Default,,0,0,0,,So first, what you have onscreen
Dialogue: 0,0:20:28.00,0:20:29.38,Default,,0,0,0,,if your file provider extension
Dialogue: 0,0:20:29.38,0:20:29.94,Default,,0,0,0,,subclass.
Dialogue: 0,0:20:30.63,0:20:32.99,Default,,0,0,0,,And so we did, it's a file
Dialogue: 0,0:20:32.99,0:20:34.07,Default,,0,0,0,,provider extension subclass
Dialogue: 0,0:20:34.07,0:20:35.44,Default,,0,0,0,,called MyFileProviderExtension.
Dialogue: 0,0:20:35.44,0:20:36.88,Default,,0,0,0,,And there, you want to override
Dialogue: 0,0:20:36.88,0:20:37.99,Default,,0,0,0,,the fetchThumbnail function.
Dialogue: 0,0:20:38.58,0:20:39.90,Default,,0,0,0,,It takes a list of item
Dialogue: 0,0:20:39.90,0:20:40.79,Default,,0,0,0,,identifiers.
Dialogue: 0,0:20:40.79,0:20:41.38,Default,,0,0,0,,Why a list?
Dialogue: 0,0:20:41.51,0:20:42.70,Default,,0,0,0,,Because we want to do batching
Dialogue: 0,0:20:42.70,0:20:45.08,Default,,0,0,0,,for performance reasons so that
Dialogue: 0,0:20:45.08,0:20:46.62,Default,,0,0,0,,we don't [inaudible] the server
Dialogue: 0,0:20:46.62,0:20:47.41,Default,,0,0,0,,for every thumbnail.
Dialogue: 0,0:20:48.61,0:20:50.33,Default,,0,0,0,,Then, you have a requestedSize,
Dialogue: 0,0:20:50.62,0:20:52.40,Default,,0,0,0,,a perThumbnailCompletionHandler,
Dialogue: 0,0:20:52.40,0:20:53.45,Default,,0,0,0,,and then an overall
Dialogue: 0,0:20:53.45,0:20:54.38,Default,,0,0,0,,completionHandler.
Dialogue: 0,0:20:54.38,0:20:57.06,Default,,0,0,0,,The first thing you want to do
Dialogue: 0,0:20:57.06,0:20:58.88,Default,,0,0,0,,is to actually create a progress
Dialogue: 0,0:20:58.88,0:20:59.21,Default,,0,0,0,,object.
Dialogue: 0,0:20:59.43,0:21:01.23,Default,,0,0,0,,The reason why is not so much
Dialogue: 0,0:21:01.23,0:21:03.15,Default,,0,0,0,,for reporting, but more for
Dialogue: 0,0:21:03.15,0:21:05.20,Default,,0,0,0,,consideration purposes so that
Dialogue: 0,0:21:05.36,0:21:07.73,Default,,0,0,0,,if the thumbnail request is
Dialogue: 0,0:21:07.73,0:21:08.73,Default,,0,0,0,,canceled because the user
Dialogue: 0,0:21:08.73,0:21:10.56,Default,,0,0,0,,dismissed the Files app, then
Dialogue: 0,0:21:10.56,0:21:11.73,Default,,0,0,0,,you would be aware and you would
Dialogue: 0,0:21:11.73,0:21:12.73,Default,,0,0,0,,be able -- and you must,
Dialogue: 0,0:21:12.73,0:21:13.96,Default,,0,0,0,,actually -- cancel your
Dialogue: 0,0:21:13.96,0:21:14.84,Default,,0,0,0,,thumbnail request.
Dialogue: 0,0:21:17.18,0:21:18.43,Default,,0,0,0,,So now, imagine you download the
Dialogue: 0,0:21:18.43,0:21:20.24,Default,,0,0,0,,files from your server using a
Dialogue: 0,0:21:20.60,0:21:22.22,Default,,0,0,0,,download task.
Dialogue: 0,0:21:23.20,0:21:24.98,Default,,0,0,0,,For each thumbnail, you get the
Dialogue: 0,0:21:24.98,0:21:26.08,Default,,0,0,0,,file UI that you would have
Dialogue: 0,0:21:26.08,0:21:27.47,Default,,0,0,0,,downloaded and you map it.
Dialogue: 0,0:21:27.97,0:21:29.22,Default,,0,0,0,,So be sure to not allocate
Dialogue: 0,0:21:29.22,0:21:29.96,Default,,0,0,0,,memory there.
Dialogue: 0,0:21:29.96,0:21:31.67,Default,,0,0,0,,So I encourage you to use the
Dialogue: 0,0:21:31.67,0:21:32.85,Default,,0,0,0,,alwaysMapped option.
Dialogue: 0,0:21:33.88,0:21:35.47,Default,,0,0,0,,Finally, you call your
Dialogue: 0,0:21:35.47,0:21:36.85,Default,,0,0,0,,perThumbnailCompletionHandler,
Dialogue: 0,0:21:37.38,0:21:39.48,Default,,0,0,0,,and that's not the real finally,
Dialogue: 0,0:21:39.48,0:21:40.85,Default,,0,0,0,,the real finally is this one.
Dialogue: 0,0:21:41.18,0:21:42.77,Default,,0,0,0,,You actually call the overall
Dialogue: 0,0:21:42.77,0:21:43.56,Default,,0,0,0,,completionHandler.
Dialogue: 0,0:21:43.56,0:21:46.29,Default,,0,0,0,,So remember one thing: You must
Dialogue: 0,0:21:46.29,0:21:48.09,Default,,0,0,0,,call it in case of success,
Dialogue: 0,0:21:48.09,0:21:50.66,Default,,0,0,0,,failure, cancellation always.
Dialogue: 0,0:21:51.18,0:21:53.45,Default,,0,0,0,,And now, you can return the
Dialogue: 0,0:21:53.45,0:21:54.49,Default,,0,0,0,,progress object so that the
Dialogue: 0,0:21:54.49,0:21:56.37,Default,,0,0,0,,system knows how to cancel your
Dialogue: 0,0:21:56.37,0:21:57.17,Default,,0,0,0,,thumbnail request.
Dialogue: 0,0:21:58.35,0:21:59.03,Default,,0,0,0,,Boom, well done.
Dialogue: 0,0:21:59.03,0:22:00.46,Default,,0,0,0,,We provided an item, so we're
Dialogue: 0,0:22:00.46,0:22:00.87,Default,,0,0,0,,happy.
Dialogue: 0,0:22:00.87,0:22:02.11,Default,,0,0,0,,But now, let's move on to the
Dialogue: 0,0:22:02.11,0:22:04.91,Default,,0,0,0,,next topic, which is enumerating
Dialogue: 0,0:22:04.91,0:22:05.24,Default,,0,0,0,,items.
Dialogue: 0,0:22:06.09,0:22:08.48,Default,,0,0,0,,So for that, enumerating items
Dialogue: 0,0:22:08.48,0:22:10.40,Default,,0,0,0,,means actually providing data to
Dialogue: 0,0:22:10.40,0:22:12.68,Default,,0,0,0,,the screenshots or to the Files
Dialogue: 0,0:22:12.68,0:22:14.23,Default,,0,0,0,,app that I have on screenshot
Dialogue: 0,0:22:14.42,0:22:14.83,Default,,0,0,0,,beside me.
Dialogue: 0,0:22:14.91,0:22:17.93,Default,,0,0,0,,And we are going to see how to
Dialogue: 0,0:22:17.93,0:22:19.86,Default,,0,0,0,,paginate items, sync changes,
Dialogue: 0,0:22:20.54,0:22:22.03,Default,,0,0,0,,render push notification, and
Dialogue: 0,0:22:22.03,0:22:23.12,Default,,0,0,0,,then signal changes.
Dialogue: 0,0:22:24.10,0:22:26.90,Default,,0,0,0,,So enumerating item works this
Dialogue: 0,0:22:26.90,0:22:27.12,Default,,0,0,0,,way.
Dialogue: 0,0:22:27.65,0:22:29.74,Default,,0,0,0,,The Files app starts up,
Dialogue: 0,0:22:29.74,0:22:31.08,Default,,0,0,0,,requests a page of item.
Dialogue: 0,0:22:32.07,0:22:33.14,Default,,0,0,0,,Your file provider extension
Dialogue: 0,0:22:33.14,0:22:34.20,Default,,0,0,0,,return the first page.
Dialogue: 0,0:22:36.37,0:22:37.63,Default,,0,0,0,,It's all over.
Dialogue: 0,0:22:37.63,0:22:38.52,Default,,0,0,0,,There's still some room
Dialogue: 0,0:22:38.52,0:22:39.95,Default,,0,0,0,,onscreen, so it's going to ask
Dialogue: 0,0:22:39.95,0:22:40.88,Default,,0,0,0,,for another page.
Dialogue: 0,0:22:41.49,0:22:44.19,Default,,0,0,0,,And so on and so forth until it
Dialogue: 0,0:22:44.19,0:22:44.87,Default,,0,0,0,,does everything.
Dialogue: 0,0:22:45.90,0:22:47.33,Default,,0,0,0,,The question you might ask is,
Dialogue: 0,0:22:47.33,0:22:48.58,Default,,0,0,0,,why do we paginate?
Dialogue: 0,0:22:49.08,0:22:50.68,Default,,0,0,0,,What's the sense of all this?
Dialogue: 0,0:22:51.31,0:22:52.99,Default,,0,0,0,,So what you have to know is that
Dialogue: 0,0:22:52.99,0:22:54.74,Default,,0,0,0,,your extension is granted a tiny
Dialogue: 0,0:22:54.74,0:22:57.13,Default,,0,0,0,,fraction of the memory your app
Dialogue: 0,0:22:57.32,0:22:57.92,Default,,0,0,0,,is granted.
Dialogue: 0,0:22:58.25,0:23:02.59,Default,,0,0,0,,If your app is in blue there,
Dialogue: 0,0:23:03.03,0:23:04.18,Default,,0,0,0,,your extension is in gray.
Dialogue: 0,0:23:04.66,0:23:06.03,Default,,0,0,0,,You can't even see it onscreen.
Dialogue: 0,0:23:06.75,0:23:08.97,Default,,0,0,0,,What you also have to know is
Dialogue: 0,0:23:08.97,0:23:11.91,Default,,0,0,0,,that above this limit of, if you
Dialogue: 0,0:23:11.91,0:23:13.23,Default,,0,0,0,,allocate more memory than what
Dialogue: 0,0:23:13.23,0:23:15.34,Default,,0,0,0,,you have available, your
Dialogue: 0,0:23:15.40,0:23:16.66,Default,,0,0,0,,extension is terminated.
Dialogue: 0,0:23:16.66,0:23:18.16,Default,,0,0,0,,So we strongly encourage you --
Dialogue: 0,0:23:18.16,0:23:19.83,Default,,0,0,0,,and this is what pagination is
Dialogue: 0,0:23:19.83,0:23:22.60,Default,,0,0,0,,all about -- to avoid peak in
Dialogue: 0,0:23:22.60,0:23:23.82,Default,,0,0,0,,your memory allocation.
Dialogue: 0,0:23:24.65,0:23:27.20,Default,,0,0,0,,I just want to go through some
Dialogue: 0,0:23:27.20,0:23:29.38,Default,,0,0,0,,other tips that we found useful
Dialogue: 0,0:23:29.38,0:23:30.69,Default,,0,0,0,,and that you might also find
Dialogue: 0,0:23:30.69,0:23:31.14,Default,,0,0,0,,useful.
Dialogue: 0,0:23:31.91,0:23:33.98,Default,,0,0,0,,Avoid using all data task.
Dialogue: 0,0:23:34.09,0:23:35.75,Default,,0,0,0,,Instead, prefer the download and
Dialogue: 0,0:23:35.75,0:23:36.76,Default,,0,0,0,,upload task because they
Dialogue: 0,0:23:36.76,0:23:38.57,Default,,0,0,0,,manipulate files, so they don't
Dialogue: 0,0:23:38.57,0:23:40.11,Default,,0,0,0,,require memory allocation.
Dialogue: 0,0:23:41.27,0:23:42.87,Default,,0,0,0,,Use dispatch queues with an
Dialogue: 0,0:23:42.87,0:23:44.81,Default,,0,0,0,,autorelease frequency of always.
Dialogue: 0,0:23:45.00,0:23:46.85,Default,,0,0,0,,Otherwise, you can get memory
Dialogue: 0,0:23:46.85,0:23:49.06,Default,,0,0,0,,peak due to too many allocation
Dialogue: 0,0:23:49.06,0:23:50.04,Default,,0,0,0,,in your autorelease pool.
Dialogue: 0,0:23:51.12,0:23:52.88,Default,,0,0,0,,And finally, as always, if you
Dialogue: 0,0:23:52.88,0:23:55.25,Default,,0,0,0,,have a long running while or for
Dialogue: 0,0:23:55.25,0:23:56.91,Default,,0,0,0,,loop, be sure to [inaudible] to
Dialogue: 0,0:23:57.02,0:23:57.67,Default,,0,0,0,,autorelease [inaudible].
Dialogue: 0,0:23:59.05,0:24:01.01,Default,,0,0,0,,So in any case, we don't have
Dialogue: 0,0:24:01.05,0:24:02.59,Default,,0,0,0,,time to go into more details, so
Dialogue: 0,0:24:03.09,0:24:05.24,Default,,0,0,0,,check out this super session
Dialogue: 0,0:24:05.24,0:24:07.69,Default,,0,0,0,,from a while back, and there are
Dialogue: 0,0:24:07.69,0:24:09.00,Default,,0,0,0,,some other you can probably
Dialogue: 0,0:24:09.00,0:24:10.08,Default,,0,0,0,,check out online.
Dialogue: 0,0:24:10.72,0:24:12.62,Default,,0,0,0,,OK, let's go back to enumerating
Dialogue: 0,0:24:12.62,0:24:12.99,Default,,0,0,0,,items.
Dialogue: 0,0:24:13.22,0:24:15.11,Default,,0,0,0,,So on your Files app, you've
Dialogue: 0,0:24:15.11,0:24:15.73,Default,,0,0,0,,opened a folder.
Dialogue: 0,0:24:16.40,0:24:18.61,Default,,0,0,0,,And it's going to call your file
Dialogue: 0,0:24:18.61,0:24:20.86,Default,,0,0,0,,provider extension subclass and
Dialogue: 0,0:24:20.86,0:24:22.36,Default,,0,0,0,,ask you to provide an enumerator
Dialogue: 0,0:24:22.36,0:24:24.57,Default,,0,0,0,,for a given item identifier.
Dialogue: 0,0:24:25.22,0:24:27.63,Default,,0,0,0,,On waving [phonetic], you will
Dialogue: 0,0:24:27.63,0:24:28.97,Default,,0,0,0,,locate your NSFileProvider
Dialogue: 0,0:24:28.97,0:24:30.88,Default,,0,0,0,,enumerator and return it to us.
Dialogue: 0,0:24:31.66,0:24:32.96,Default,,0,0,0,,The Files app is going to store
Dialogue: 0,0:24:32.96,0:24:33.46,Default,,0,0,0,,that enumerator.
Dialogue: 0,0:24:33.46,0:24:35.18,Default,,0,0,0,,And the next thing it's going to
Dialogue: 0,0:24:35.18,0:24:38.10,Default,,0,0,0,,do is to ask you to provide the
Dialogue: 0,0:24:38.10,0:24:39.73,Default,,0,0,0,,initial page of item.
Dialogue: 0,0:24:43.81,0:24:45.59,Default,,0,0,0,,You get a callback on your
Dialogue: 0,0:24:45.59,0:24:47.37,Default,,0,0,0,,enumerator this time, which is
Dialogue: 0,0:24:47.37,0:24:48.80,Default,,0,0,0,,called enumerateItems for
Dialogue: 0,0:24:48.80,0:24:50.32,Default,,0,0,0,,observer, startingAt page.
Dialogue: 0,0:24:51.10,0:24:54.34,Default,,0,0,0,,You figure out the items in your
Dialogue: 0,0:24:54.34,0:24:56.43,Default,,0,0,0,,first page.
Dialogue: 0,0:24:56.65,0:24:57.49,Default,,0,0,0,,You return them.
Dialogue: 0,0:24:58.20,0:24:59.00,Default,,0,0,0,,And you say, you're done
Dialogue: 0,0:24:59.00,0:24:59.83,Default,,0,0,0,,enumerating.
Dialogue: 0,0:24:59.83,0:25:01.60,Default,,0,0,0,,There is my second page.
Dialogue: 0,0:25:03.70,0:25:04.29,Default,,0,0,0,,Well done.
Dialogue: 0,0:25:04.35,0:25:05.52,Default,,0,0,0,,We've enumerated a page.
Dialogue: 0,0:25:05.61,0:25:06.95,Default,,0,0,0,,If the file is [inaudible] to
Dialogue: 0,0:25:06.95,0:25:08.09,Default,,0,0,0,,have more items, it will
Dialogue: 0,0:25:08.09,0:25:09.87,Default,,0,0,0,,continue the, it will ask you
Dialogue: 0,0:25:09.87,0:25:11.72,Default,,0,0,0,,for more pages using the exact
Dialogue: 0,0:25:11.72,0:25:12.55,Default,,0,0,0,,same mechanism.
Dialogue: 0,0:25:13.57,0:25:16.33,Default,,0,0,0,,Let's go through the different
Dialogue: 0,0:25:16.33,0:25:17.34,Default,,0,0,0,,methods we've seen.
Dialogue: 0,0:25:17.59,0:25:19.74,Default,,0,0,0,,So first method is in your
Dialogue: 0,0:25:19.74,0:25:20.60,Default,,0,0,0,,subclass of
Dialogue: 0,0:25:20.60,0:25:21.90,Default,,0,0,0,,NSFileProviderExtension.
Dialogue: 0,0:25:21.90,0:25:23.07,Default,,0,0,0,,It's called enumerator
Dialogue: 0,0:25:23.07,0:25:24.82,Default,,0,0,0,,forContainer itemIdentifier, and
Dialogue: 0,0:25:24.89,0:25:26.95,Default,,0,0,0,,it returns an object conforming
Dialogue: 0,0:25:26.95,0:25:28.47,Default,,0,0,0,,to NSFileProviderEnumerator.
Dialogue: 0,0:25:28.47,0:25:30.98,Default,,0,0,0,,The itemIdentifier can be one of
Dialogue: 0,0:25:31.05,0:25:33.51,Default,,0,0,0,,workingSet if we're enumerating
Dialogue: 0,0:25:33.51,0:25:35.11,Default,,0,0,0,,the Recents, as Jean-Gabriel was
Dialogue: 0,0:25:35.11,0:25:37.03,Default,,0,0,0,,describing earlier, or the
Dialogue: 0,0:25:37.03,0:25:37.67,Default,,0,0,0,,rootContainer.
Dialogue: 0,0:25:39.08,0:25:41.57,Default,,0,0,0,,Finally, it can also be any of
Dialogue: 0,0:25:41.57,0:25:42.99,Default,,0,0,0,,your folder item identifiers
Dialogue: 0,0:25:43.10,0:25:45.35,Default,,0,0,0,,that you've previously returned.
Dialogue: 0,0:25:45.35,0:25:46.58,Default,,0,0,0,,The other function that we saw
Dialogue: 0,0:25:46.92,0:25:47.92,Default,,0,0,0,,is this time on
Dialogue: 0,0:25:47.92,0:25:49.55,Default,,0,0,0,,NSFileProviderEnumerator.
Dialogue: 0,0:25:49.96,0:25:51.78,Default,,0,0,0,,It's enumerateItems for
Dialogue: 0,0:25:51.78,0:25:53.17,Default,,0,0,0,,observer, startingAt page.
Dialogue: 0,0:25:54.34,0:25:57.25,Default,,0,0,0,,The observer is a system, as we
Dialogue: 0,0:25:57.25,0:26:00.39,Default,,0,0,0,,saw earlier, is a system object
Dialogue: 0,0:26:00.39,0:26:03.09,Default,,0,0,0,,presenting, receiving your items
Dialogue: 0,0:26:03.28,0:26:04.26,Default,,0,0,0,,and the next page.
Dialogue: 0,0:26:04.90,0:26:07.46,Default,,0,0,0,,The page is a simple data blob.
Dialogue: 0,0:26:08.40,0:26:10.29,Default,,0,0,0,,It has a type, but it's a simple
Dialogue: 0,0:26:10.29,0:26:13.17,Default,,0,0,0,,data blob that you're free to
Dialogue: 0,0:26:13.17,0:26:15.41,Default,,0,0,0,,decide what's, and you're free
Dialogue: 0,0:26:15.41,0:26:17.16,Default,,0,0,0,,to decide what's inside, as long
Dialogue: 0,0:26:17.16,0:26:19.34,Default,,0,0,0,,as it doesn't go below 500
Dialogue: 0,0:26:19.34,0:26:19.70,Default,,0,0,0,,bytes.
Dialogue: 0,0:26:19.92,0:26:21.50,Default,,0,0,0,,What you generally put there is
Dialogue: 0,0:26:21.50,0:26:23.50,Default,,0,0,0,,like a page index -- 1, 2, 3, 4,
Dialogue: 0,0:26:23.50,0:26:25.37,Default,,0,0,0,,5 -- or an item of sets
Dialogue: 0,0:26:25.57,0:26:27.92,Default,,0,0,0,,[inaudible] et cetera.
Dialogue: 0,0:26:28.94,0:26:30.48,Default,,0,0,0,,For the first page, it can be
Dialogue: 0,0:26:30.48,0:26:32.40,Default,,0,0,0,,one of any initial page sorted
Dialogue: 0,0:26:32.40,0:26:33.99,Default,,0,0,0,,by date or sorted by name,
Dialogue: 0,0:26:33.99,0:26:37.01,Default,,0,0,0,,depending on what the UI is
Dialogue: 0,0:26:38.86,0:26:39.17,Default,,0,0,0,,displaying.
Dialogue: 0,0:26:39.17,0:26:40.96,Default,,0,0,0,,OK, so let's go back to this
Dialogue: 0,0:26:40.96,0:26:43.13,Default,,0,0,0,,slide that you've seen before.
Dialogue: 0,0:26:43.87,0:26:46.12,Default,,0,0,0,,One crucial thing we've just
Dialogue: 0,0:26:46.12,0:26:47.27,Default,,0,0,0,,added is the ability to
Dialogue: 0,0:26:47.27,0:26:49.12,Default,,0,0,0,,enumerate folders and the
Dialogue: 0,0:26:49.12,0:26:49.77,Default,,0,0,0,,working set.
Dialogue: 0,0:26:50.57,0:26:51.62,Default,,0,0,0,,So we have two kinds of
Dialogue: 0,0:26:51.62,0:26:54.42,Default,,0,0,0,,enumerator, of enumerators, as
Dialogue: 0,0:26:54.42,0:26:55.30,Default,,0,0,0,,you can see onscreen.
Dialogue: 0,0:26:55.76,0:26:58.44,Default,,0,0,0,,And I just want to go back -- or
Dialogue: 0,0:26:58.44,0:26:59.45,Default,,0,0,0,,actually, highlight the
Dialogue: 0,0:26:59.45,0:27:01.68,Default,,0,0,0,,differences between the two.
Dialogue: 0,0:27:02.43,0:27:04.30,Default,,0,0,0,,So for folder enumerator, what
Dialogue: 0,0:27:04.30,0:27:06.32,Default,,0,0,0,,you typically do is enumerate
Dialogue: 0,0:27:06.32,0:27:07.63,Default,,0,0,0,,the cloud directly.
Dialogue: 0,0:27:08.15,0:27:09.65,Default,,0,0,0,,That's it.
Dialogue: 0,0:27:09.93,0:27:12.56,Default,,0,0,0,,You can do caching, however, if
Dialogue: 0,0:27:12.56,0:27:12.90,Default,,0,0,0,,you want.
Dialogue: 0,0:27:12.90,0:27:13.60,Default,,0,0,0,,It's up to you.
Dialogue: 0,0:27:13.60,0:27:14.21,Default,,0,0,0,,You decide.
Dialogue: 0,0:27:14.59,0:27:16.69,Default,,0,0,0,,However, for the working set,
Dialogue: 0,0:27:17.24,0:27:19.67,Default,,0,0,0,,it's very different.
Dialogue: 0,0:27:20.01,0:27:21.87,Default,,0,0,0,,You need to enumerate your own
Dialogue: 0,0:27:21.87,0:27:24.05,Default,,0,0,0,,local copy of the working set.
Dialogue: 0,0:27:24.80,0:27:26.47,Default,,0,0,0,,So not the cloud.
Dialogue: 0,0:27:27.65,0:27:28.61,Default,,0,0,0,,Just your working set.
Dialogue: 0,0:27:29.81,0:27:31.90,Default,,0,0,0,,The main reason for that is that
Dialogue: 0,0:27:31.90,0:27:33.97,Default,,0,0,0,,your working set must work
Dialogue: 0,0:27:33.97,0:27:34.64,Default,,0,0,0,,offline.
Dialogue: 0,0:27:34.64,0:27:36.22,Default,,0,0,0,,The item is the working set, in
Dialogue: 0,0:27:36.22,0:27:37.28,Default,,0,0,0,,the working set must be
Dialogue: 0,0:27:37.28,0:27:38.38,Default,,0,0,0,,available offline and work
Dialogue: 0,0:27:38.38,0:27:38.77,Default,,0,0,0,,offline.
Dialogue: 0,0:27:39.04,0:27:42.83,Default,,0,0,0,,I just want to reiterate on this
Dialogue: 0,0:27:42.87,0:27:44.14,Default,,0,0,0,,because this is something that
Dialogue: 0,0:27:44.14,0:27:47.37,Default,,0,0,0,,is not obvious.
Dialogue: 0,0:27:47.94,0:27:50.66,Default,,0,0,0,,So I'll say it again.
Dialogue: 0,0:27:51.22,0:27:53.72,Default,,0,0,0,,The working set should never
Dialogue: 0,0:27:53.80,0:27:54.52,Default,,0,0,0,,read the cloud.
Dialogue: 0,0:27:54.88,0:27:56.64,Default,,0,0,0,,The folder enumerator, it's OK.
Dialogue: 0,0:27:57.66,0:27:58.79,Default,,0,0,0,,And the working set should
Dialogue: 0,0:27:58.83,0:28:00.54,Default,,0,0,0,,always read the database, and
Dialogue: 0,0:28:00.54,0:28:01.91,Default,,0,0,0,,the folders, it's OK if you want
Dialogue: 0,0:28:01.91,0:28:02.49,Default,,0,0,0,,to cache them.
Dialogue: 0,0:28:02.49,0:28:02.95,Default,,0,0,0,,It's fine.
Dialogue: 0,0:28:03.46,0:28:07.45,Default,,0,0,0,,I hope it's clear.
Dialogue: 0,0:28:07.45,0:28:08.82,Default,,0,0,0,,Now, let's move on to the next
Dialogue: 0,0:28:08.82,0:28:10.39,Default,,0,0,0,,topic, which is syncing changes.
Dialogue: 0,0:28:10.52,0:28:12.63,Default,,0,0,0,,So for that, on your cloud
Dialogue: 0,0:28:12.63,0:28:14.09,Default,,0,0,0,,server, you are probably doing
Dialogue: 0,0:28:14.09,0:28:15.54,Default,,0,0,0,,it anyway, but you need to
Dialogue: 0,0:28:15.54,0:28:16.89,Default,,0,0,0,,assign version numbers to your
Dialogue: 0,0:28:16.89,0:28:17.29,Default,,0,0,0,,items.
Dialogue: 0,0:28:17.29,0:28:20.09,Default,,0,0,0,,So here are some version numbers
Dialogue: 0,0:28:20.09,0:28:20.93,Default,,0,0,0,,on my [inaudible] cloud.
Dialogue: 0,0:28:22.26,0:28:24.37,Default,,0,0,0,,The maximum known version number
Dialogue: 0,0:28:24.37,0:28:27.28,Default,,0,0,0,,is what we call the sync anchor.
Dialogue: 0,0:28:27.28,0:28:30.06,Default,,0,0,0,,So here it's 14.
Dialogue: 0,0:28:30.19,0:28:32.45,Default,,0,0,0,,On changes, you need to bump the
Dialogue: 0,0:28:32.45,0:28:33.46,Default,,0,0,0,,file version number.
Dialogue: 0,0:28:33.89,0:28:36.11,Default,,0,0,0,,So here, for instance, 15.
Dialogue: 0,0:28:36.66,0:28:39.73,Default,,0,0,0,,The count sync anchor -- oh, I
Dialogue: 0,0:28:39.73,0:28:41.14,Default,,0,0,0,,went a bit fast, but it's OK.
Dialogue: 0,0:28:41.58,0:28:44.15,Default,,0,0,0,,I did a new file, which is,
Dialogue: 0,0:28:44.34,0:28:45.44,Default,,0,0,0,,which gave the version number
Dialogue: 0,0:28:45.44,0:28:46.01,Default,,0,0,0,,16.
Dialogue: 0,0:28:46.01,0:28:47.26,Default,,0,0,0,,And this time, we bumped the
Dialogue: 0,0:28:47.26,0:28:48.59,Default,,0,0,0,,sync anchor to 16.
Dialogue: 0,0:28:48.59,0:28:49.91,Default,,0,0,0,,And remember, it was 13 at the
Dialogue: 0,0:28:49.91,0:28:51.12,Default,,0,0,0,,beginning, and then I went a bit
Dialogue: 0,0:28:51.12,0:28:52.77,Default,,0,0,0,,fast, but you can see that now.
Dialogue: 0,0:28:53.67,0:28:57.77,Default,,0,0,0,,Then, if you, if we go back to
Dialogue: 0,0:28:57.77,0:28:58.71,Default,,0,0,0,,the Files app in your file
Dialogue: 0,0:28:58.71,0:29:02.12,Default,,0,0,0,,provider extension enumerator,
Dialogue: 0,0:29:02.12,0:29:04.69,Default,,0,0,0,,what is going to happen -- and I
Dialogue: 0,0:29:04.76,0:29:05.66,Default,,0,0,0,,lied to you earlier.
Dialogue: 0,0:29:06.20,0:29:07.69,Default,,0,0,0,,Before enumerating, what we are
Dialogue: 0,0:29:07.69,0:29:09.65,Default,,0,0,0,,going to do is to ask your
Dialogue: 0,0:29:09.65,0:29:11.10,Default,,0,0,0,,enumerator to provide its
Dialogue: 0,0:29:11.10,0:29:11.94,Default,,0,0,0,,current sync anchor.
Dialogue: 0,0:29:11.94,0:29:15.26,Default,,0,0,0,,So that's before enumerating the
Dialogue: 0,0:29:15.26,0:29:15.82,Default,,0,0,0,,pages.
Dialogue: 0,0:29:17.03,0:29:18.61,Default,,0,0,0,,So this [inaudible] you just
Dialogue: 0,0:29:18.73,0:29:19.45,Default,,0,0,0,,have your sync anchor.
Dialogue: 0,0:29:19.45,0:29:21.84,Default,,0,0,0,,You return it back to the Files
Dialogue: 0,0:29:21.84,0:29:23.56,Default,,0,0,0,,app, and the Files app is going
Dialogue: 0,0:29:24.15,0:29:26.18,Default,,0,0,0,,to store it.
Dialogue: 0,0:29:26.18,0:29:28.80,Default,,0,0,0,,After that, we'll just fetch the
Dialogue: 0,0:29:28.80,0:29:31.10,Default,,0,0,0,,pages as we did before, and
Dialogue: 0,0:29:31.10,0:29:31.77,Default,,0,0,0,,we're in sync.
Dialogue: 0,0:29:37.37,0:29:38.62,Default,,0,0,0,,When a new file is added on your
Dialogue: 0,0:29:38.62,0:29:42.19,Default,,0,0,0,,server, you add a new file here
Dialogue: 0,0:29:42.19,0:29:44.81,Default,,0,0,0,,in green, you bump your sync
Dialogue: 0,0:29:44.81,0:29:49.40,Default,,0,0,0,,anchor, it becomes 14, and you
Dialogue: 0,0:29:49.40,0:29:50.30,Default,,0,0,0,,emit a push.
Dialogue: 0,0:29:51.06,0:29:54.27,Default,,0,0,0,,The Files app receives the push.
Dialogue: 0,0:29:54.49,0:29:55.88,Default,,0,0,0,,Your enumerator is called with
Dialogue: 0,0:29:56.32,0:29:57.43,Default,,0,0,0,,this new function,
Dialogue: 0,0:29:57.81,0:29:58.83,Default,,0,0,0,,enumerateChanges.
Dialogue: 0,0:29:58.83,0:30:00.36,Default,,0,0,0,,So before, it was enumerateItem,
Dialogue: 0,0:30:00.88,0:30:02.37,Default,,0,0,0,,and now, it's enumerateChanges.
Dialogue: 0,0:30:02.63,0:30:04.81,Default,,0,0,0,,And it's passing you the
Dialogue: 0,0:30:04.81,0:30:06.73,Default,,0,0,0,,previous sync anchor it has.
Dialogue: 0,0:30:06.73,0:30:09.03,Default,,0,0,0,,So here it's the current
Dialogue: 0,0:30:09.03,0:30:10.82,Default,,0,0,0,,version, it's the version 13, so
Dialogue: 0,0:30:10.82,0:30:11.96,Default,,0,0,0,,it's passing you 13.
Dialogue: 0,0:30:13.13,0:30:14.51,Default,,0,0,0,,When your enumerator gets that
Dialogue: 0,0:30:14.51,0:30:17.92,Default,,0,0,0,,callback, it fetches the new
Dialogue: 0,0:30:17.92,0:30:20.92,Default,,0,0,0,,item, which is here, 14, the
Dialogue: 0,0:30:20.92,0:30:22.57,Default,,0,0,0,,item with the change number 14.
Dialogue: 0,0:30:23.29,0:30:24.73,Default,,0,0,0,,It sent it back to the observer,
Dialogue: 0,0:30:24.73,0:30:25.93,Default,,0,0,0,,and then it called
Dialogue: 0,0:30:26.11,0:30:28.84,Default,,0,0,0,,finishEnumerating up to the new
Dialogue: 0,0:30:28.84,0:30:30.02,Default,,0,0,0,,version here.
Dialogue: 0,0:30:30.25,0:30:31.60,Default,,0,0,0,,This is 14.
Dialogue: 0,0:30:32.37,0:30:33.26,Default,,0,0,0,,And you don't have anymore
Dialogue: 0,0:30:33.26,0:30:34.53,Default,,0,0,0,,change coming, so you just say,
Dialogue: 0,0:30:34.53,0:30:38.27,Default,,0,0,0,,notComing false.
Dialogue: 0,0:30:38.45,0:30:39.92,Default,,0,0,0,,OK, and now we're ready to
Dialogue: 0,0:30:39.92,0:30:40.95,Default,,0,0,0,,display the update.
Dialogue: 0,0:30:42.04,0:30:43.27,Default,,0,0,0,,Oh, we forgot one thing, which
Dialogue: 0,0:30:43.27,0:30:47.53,Default,,0,0,0,,is the Files app [inaudible] the
Dialogue: 0,0:30:48.54,0:30:50.68,Default,,0,0,0,,new sync anchor.
Dialogue: 0,0:30:50.90,0:30:52.44,Default,,0,0,0,,So I went very fast on push
Dialogue: 0,0:30:52.44,0:30:55.39,Default,,0,0,0,,notification, and it's actually
Dialogue: 0,0:30:55.39,0:30:57.14,Default,,0,0,0,,interesting because for this
Dialogue: 0,0:30:57.20,0:30:58.45,Default,,0,0,0,,time, the push notification
Dialogue: 0,0:30:58.45,0:30:59.83,Default,,0,0,0,,doesn't go to your file provider
Dialogue: 0,0:30:59.83,0:31:00.50,Default,,0,0,0,,extension.
Dialogue: 0,0:31:01.46,0:31:04.17,Default,,0,0,0,,It goes to the file provider
Dialogue: 0,0:31:04.17,0:31:04.96,Default,,0,0,0,,daemon, actually.
Dialogue: 0,0:31:05.87,0:31:09.32,Default,,0,0,0,,And so when receiving your push,
Dialogue: 0,0:31:09.32,0:31:10.39,Default,,0,0,0,,the file provider daemon is
Dialogue: 0,0:31:10.39,0:31:11.27,Default,,0,0,0,,going to initiate the
Dialogue: 0,0:31:11.27,0:31:14.29,Default,,0,0,0,,enumerateChanges code on your
Dialogue: 0,0:31:14.29,0:31:16.34,Default,,0,0,0,,enumerator, and at that point,
Dialogue: 0,0:31:16.34,0:31:18.15,Default,,0,0,0,,you can return the item.
Dialogue: 0,0:31:18.15,0:31:18.95,Default,,0,0,0,,Another [inaudible] what you
Dialogue: 0,0:31:18.95,0:31:20.30,Default,,0,0,0,,have to know for push is -- and
Dialogue: 0,0:31:20.30,0:31:21.75,Default,,0,0,0,,I will go briefly into this --
Dialogue: 0,0:31:22.23,0:31:24.53,Default,,0,0,0,,your PKPushType must be a
Dialogue: 0,0:31:24.53,0:31:25.80,Default,,0,0,0,,PKPushType file provider.
Dialogue: 0,0:31:25.80,0:31:27.92,Default,,0,0,0,,The topic name is your
Dialogue: 0,0:31:27.92,0:31:31.14,Default,,0,0,0,,bundle-identifier plus a suffix,
Dialogue: 0,0:31:31.62,0:31:32.98,Default,,0,0,0,,pushkit.fileprovider.
Dialogue: 0,0:31:33.41,0:31:35.51,Default,,0,0,0,,And your payload must include a
Dialogue: 0,0:31:35.51,0:31:36.94,Default,,0,0,0,,container identifier, which
Dialogue: 0,0:31:36.94,0:31:38.58,Default,,0,0,0,,refers to one of the possible
Dialogue: 0,0:31:38.58,0:31:39.06,Default,,0,0,0,,enumerator.
Dialogue: 0,0:31:40.00,0:31:42.26,Default,,0,0,0,,For more on push notification,
Dialogue: 0,0:31:42.26,0:31:43.74,Default,,0,0,0,,check out this session,
Dialogue: 0,0:31:43.74,0:31:45.23,Default,,0,0,0,,Introduction to Notification,
Dialogue: 0,0:31:45.50,0:31:46.27,Default,,0,0,0,,from last year.
Dialogue: 0,0:31:46.73,0:31:48.35,Default,,0,0,0,,So we've seen pushes, but you
Dialogue: 0,0:31:48.35,0:31:49.95,Default,,0,0,0,,might ask, what if I have some
Dialogue: 0,0:31:49.95,0:31:51.20,Default,,0,0,0,,changes and I want to tell the
Dialogue: 0,0:31:51.20,0:31:52.83,Default,,0,0,0,,system about it, but I don't
Dialogue: 0,0:31:52.83,0:31:53.73,Default,,0,0,0,,have a push for it?
Dialogue: 0,0:31:54.82,0:31:57.18,Default,,0,0,0,,In that case, you would want to
Dialogue: 0,0:31:57.29,0:31:59.11,Default,,0,0,0,,code the file provider daemon
Dialogue: 0,0:31:59.11,0:31:59.92,Default,,0,0,0,,and just say, oh, I have a
Dialogue: 0,0:31:59.92,0:32:00.33,Default,,0,0,0,,change.
Dialogue: 0,0:32:00.41,0:32:01.72,Default,,0,0,0,,Well, we have a function just
Dialogue: 0,0:32:01.72,0:32:02.75,Default,,0,0,0,,for that, which is called,
Dialogue: 0,0:32:03.29,0:32:05.55,Default,,0,0,0,,NSFileProvider signalChanges
Dialogue: 0,0:32:05.91,0:32:06.46,Default,,0,0,0,,forContainer.
Dialogue: 0,0:32:07.54,0:32:09.34,Default,,0,0,0,,When receiving such a code, the
Dialogue: 0,0:32:09.34,0:32:10.66,Default,,0,0,0,,file provider daemon is going to
Dialogue: 0,0:32:10.66,0:32:12.42,Default,,0,0,0,,enumerate changes just like it
Dialogue: 0,0:32:12.46,0:32:13.56,Default,,0,0,0,,would do for pushes.
Dialogue: 0,0:32:13.88,0:32:15.05,Default,,0,0,0,,So let me go back to that
Dialogue: 0,0:32:15.05,0:32:15.53,Default,,0,0,0,,method.
Dialogue: 0,0:32:16.48,0:32:19.11,Default,,0,0,0,,The signalChanges method, when
Dialogue: 0,0:32:19.11,0:32:20.87,Default,,0,0,0,,should you call it?
Dialogue: 0,0:32:20.98,0:32:22.44,Default,,0,0,0,,So first, you can tell, you can
Dialogue: 0,0:32:22.44,0:32:23.79,Default,,0,0,0,,call it for the initial set of
Dialogue: 0,0:32:23.79,0:32:24.20,Default,,0,0,0,,files.
Dialogue: 0,0:32:24.20,0:32:25.83,Default,,0,0,0,,Imagine you just installed your
Dialogue: 0,0:32:26.11,0:32:27.48,Default,,0,0,0,,app and you already have some
Dialogue: 0,0:32:27.48,0:32:28.57,Default,,0,0,0,,files in your file provider
Dialogue: 0,0:32:28.57,0:32:30.28,Default,,0,0,0,,extension that you want the
Dialogue: 0,0:32:30.28,0:32:31.33,Default,,0,0,0,,system to know about.
Dialogue: 0,0:32:32.46,0:32:34.16,Default,,0,0,0,,Then, in case of changing
Dialogue: 0,0:32:34.16,0:32:35.07,Default,,0,0,0,,account -- for instance, the
Dialogue: 0,0:32:35.07,0:32:36.68,Default,,0,0,0,,user is logging out, logging in
Dialogue: 0,0:32:36.68,0:32:37.94,Default,,0,0,0,,to a new account -- you would
Dialogue: 0,0:32:37.94,0:32:39.18,Default,,0,0,0,,want to tell the system to
Dialogue: 0,0:32:39.18,0:32:40.64,Default,,0,0,0,,reload after this account change
Dialogue: 0,0:32:41.12,0:32:42.85,Default,,0,0,0,,because usually there were no
Dialogue: 0,0:32:42.85,0:32:43.30,Default,,0,0,0,,pushes.
Dialogue: 0,0:32:43.68,0:32:44.94,Default,,0,0,0,,More generally, you would want
Dialogue: 0,0:32:44.94,0:32:46.32,Default,,0,0,0,,to call that for any change
Dialogue: 0,0:32:46.32,0:32:48.33,Default,,0,0,0,,without a push, including the
Dialogue: 0,0:32:48.33,0:32:49.15,Default,,0,0,0,,one made locally.
Dialogue: 0,0:32:49.54,0:32:51.33,Default,,0,0,0,,So let me go back to one thing,
Dialogue: 0,0:32:51.33,0:32:53.76,Default,,0,0,0,,which is earlier we saw that
Dialogue: 0,0:32:54.55,0:32:56.68,Default,,0,0,0,,your file provider needs to
Dialogue: 0,0:32:56.68,0:32:58.56,Default,,0,0,0,,implement [inaudible] providing
Dialogue: 0,0:32:58.56,0:32:59.41,Default,,0,0,0,,[inaudible].
Dialogue: 0,0:32:59.41,0:33:01.61,Default,,0,0,0,,If the file is not local at that
Dialogue: 0,0:33:01.66,0:33:03.73,Default,,0,0,0,,point, you need to tell the
Dialogue: 0,0:33:03.73,0:33:05.45,Default,,0,0,0,,system that, well, this file is
Dialogue: 0,0:33:05.45,0:33:06.31,Default,,0,0,0,,not downloading.
Dialogue: 0,0:33:06.88,0:33:11.52,Default,,0,0,0,,If it is, what you should do is
Dialogue: 0,0:33:11.52,0:33:13.68,Default,,0,0,0,,you should signal for changes in
Dialogue: 0,0:33:13.68,0:33:15.03,Default,,0,0,0,,the working set if the item is
Dialogue: 0,0:33:15.03,0:33:16.82,Default,,0,0,0,,in the working set.
Dialogue: 0,0:33:18.21,0:33:19.31,Default,,0,0,0,,Same thing if you have an
Dialogue: 0,0:33:19.31,0:33:20.58,Default,,0,0,0,,enumerator running for the
Dialogue: 0,0:33:20.58,0:33:22.35,Default,,0,0,0,,parent, you should call
Dialogue: 0,0:33:22.35,0:33:23.51,Default,,0,0,0,,signalChanges on the
Dialogue: 0,0:33:23.51,0:33:24.77,Default,,0,0,0,,parentItemIdentifier.
Dialogue: 0,0:33:25.29,0:33:27.42,Default,,0,0,0,,Well, so under the hood, signal
Dialogue: 0,0:33:27.42,0:33:28.79,Default,,0,0,0,,changes can be called from both
Dialogue: 0,0:33:29.09,0:33:30.33,Default,,0,0,0,,your app and your file provider
Dialogue: 0,0:33:30.33,0:33:31.21,Default,,0,0,0,,extension, so it's very
Dialogue: 0,0:33:31.21,0:33:31.70,Default,,0,0,0,,convenient.
Dialogue: 0,0:33:33.14,0:33:35.54,Default,,0,0,0,,You must call signalChanges even
Dialogue: 0,0:33:35.54,0:33:37.22,Default,,0,0,0,,for system-initiated changes.
Dialogue: 0,0:33:37.30,0:33:39.04,Default,,0,0,0,,This is exactly what I was
Dialogue: 0,0:33:39.04,0:33:39.76,Default,,0,0,0,,describing earlier.
Dialogue: 0,0:33:39.76,0:33:41.22,Default,,0,0,0,,You could say the system could
Dialogue: 0,0:33:41.22,0:33:43.25,Default,,0,0,0,,infer that the file has changed.
Dialogue: 0,0:33:43.25,0:33:44.21,Default,,0,0,0,,No, we don't do that.
Dialogue: 0,0:33:44.26,0:33:46.23,Default,,0,0,0,,We let you explicitly tell us
Dialogue: 0,0:33:46.23,0:33:47.49,Default,,0,0,0,,that you know about this change.
Dialogue: 0,0:33:48.70,0:33:51.02,Default,,0,0,0,,But don't worry about it.
Dialogue: 0,0:33:51.02,0:33:53.01,Default,,0,0,0,,signalChanges is very, very
Dialogue: 0,0:33:53.01,0:33:53.24,Default,,0,0,0,,cheap.
Dialogue: 0,0:33:53.94,0:33:55.44,Default,,0,0,0,,So now, we've seen all these
Dialogue: 0,0:33:55.57,0:33:57.46,Default,,0,0,0,,three topics on screen: creating
Dialogue: 0,0:33:57.46,0:33:58.79,Default,,0,0,0,,the project, providing an item,
Dialogue: 0,0:33:58.79,0:34:00.10,Default,,0,0,0,,and enumerating items.
Dialogue: 0,0:34:00.10,0:34:02.19,Default,,0,0,0,,So now, it's time for Johannes
Dialogue: 0,0:34:02.61,0:34:03.82,Default,,0,0,0,,to come on stage and cover the
Dialogue: 0,0:34:03.82,0:34:04.69,Default,,0,0,0,,last topics.
Dialogue: 0,0:34:05.52,0:34:11.18,Default,,0,0,0,,[ Applause ]
Dialogue: 0,0:34:11.68,0:34:12.23,Default,,0,0,0,,>> Thank you, Pierre.
Dialogue: 0,0:34:13.19,0:34:15.98,Default,,0,0,0,,So we've seen how to get your
Dialogue: 0,0:34:15.98,0:34:18.83,Default,,0,0,0,,items into the Files app or into
Dialogue: 0,0:34:18.83,0:34:19.76,Default,,0,0,0,,the document browser.
Dialogue: 0,0:34:20.61,0:34:23.01,Default,,0,0,0,,But of course, that is only part
Dialogue: 0,0:34:23.01,0:34:24.35,Default,,0,0,0,,of what you are interested in
Dialogue: 0,0:34:24.35,0:34:25.52,Default,,0,0,0,,doing or what your users are
Dialogue: 0,0:34:25.52,0:34:26.37,Default,,0,0,0,,interested in doing.
Dialogue: 0,0:34:26.95,0:34:28.44,Default,,0,0,0,,An equally important part is
Dialogue: 0,0:34:28.81,0:34:30.61,Default,,0,0,0,,that your users are able to
Dialogue: 0,0:34:30.61,0:34:31.66,Default,,0,0,0,,modify files.
Dialogue: 0,0:34:32.43,0:34:35.65,Default,,0,0,0,,And to modify files, there are
Dialogue: 0,0:34:35.65,0:34:37.40,Default,,0,0,0,,various possibilities how you
Dialogue: 0,0:34:37.40,0:34:39.40,Default,,0,0,0,,can modify files in the Files
Dialogue: 0,0:34:39.40,0:34:41.23,Default,,0,0,0,,app and using other
Dialogue: 0,0:34:41.23,0:34:42.16,Default,,0,0,0,,technologies.
Dialogue: 0,0:34:42.80,0:34:44.63,Default,,0,0,0,,So in the Files app, as an
Dialogue: 0,0:34:44.63,0:34:46.60,Default,,0,0,0,,example, bring up this menu
Dialogue: 0,0:34:46.60,0:34:48.54,Default,,0,0,0,,controller here as a user, and
Dialogue: 0,0:34:48.89,0:34:50.37,Default,,0,0,0,,this menu controller gives the
Dialogue: 0,0:34:50.37,0:34:52.47,Default,,0,0,0,,users a variety of options to
Dialogue: 0,0:34:52.47,0:34:54.90,Default,,0,0,0,,modify files or to perform
Dialogue: 0,0:34:54.90,0:34:56.26,Default,,0,0,0,,actions on files.
Dialogue: 0,0:34:56.48,0:34:57.58,Default,,0,0,0,,One of these actions, for
Dialogue: 0,0:34:57.58,0:35:00.40,Default,,0,0,0,,example, is the Info option
Dialogue: 0,0:35:00.40,0:35:02.78,Default,,0,0,0,,here, and that simply brings up
Dialogue: 0,0:35:02.78,0:35:04.22,Default,,0,0,0,,a nice Info panel.
Dialogue: 0,0:35:04.62,0:35:05.58,Default,,0,0,0,,And that is backed by
Dialogue: 0,0:35:05.58,0:35:07.69,Default,,0,0,0,,information that you're already
Dialogue: 0,0:35:07.69,0:35:08.37,Default,,0,0,0,,providing.
Dialogue: 0,0:35:08.74,0:35:11.65,Default,,0,0,0,,That's the item method that
Dialogue: 0,0:35:11.65,0:35:12.77,Default,,0,0,0,,you're already implementing.
Dialogue: 0,0:35:13.69,0:35:15.65,Default,,0,0,0,,Other options are, for example,
Dialogue: 0,0:35:15.65,0:35:18.93,Default,,0,0,0,,the Share action here, and that
Dialogue: 0,0:35:18.93,0:35:21.54,Default,,0,0,0,,is backed by a well-known old
Dialogue: 0,0:35:21.54,0:35:22.16,Default,,0,0,0,,friend, the
Dialogue: 0,0:35:22.16,0:35:23.56,Default,,0,0,0,,UIActivityViewController.
Dialogue: 0,0:35:23.56,0:35:25.43,Default,,0,0,0,,And of course, you're able to
Dialogue: 0,0:35:25.43,0:35:27.64,Default,,0,0,0,,simply add activities using
Dialogue: 0,0:35:28.00,0:35:30.03,Default,,0,0,0,,activity plug-ins, and that's
Dialogue: 0,0:35:30.03,0:35:31.43,Default,,0,0,0,,another way for you to expose
Dialogue: 0,0:35:31.43,0:35:32.69,Default,,0,0,0,,actions on these items.
Dialogue: 0,0:35:33.36,0:35:35.04,Default,,0,0,0,,But then, there are other
Dialogue: 0,0:35:35.51,0:35:37.22,Default,,0,0,0,,possible options that are not
Dialogue: 0,0:35:37.22,0:35:39.89,Default,,0,0,0,,backed by any existing system UI
Dialogue: 0,0:35:40.24,0:35:40.79,Default,,0,0,0,,so far.
Dialogue: 0,0:35:41.38,0:35:43.28,Default,,0,0,0,,For example, renaming items.
Dialogue: 0,0:35:43.82,0:35:45.48,Default,,0,0,0,,Renaming items brings up a nice
Dialogue: 0,0:35:45.48,0:35:48.20,Default,,0,0,0,,UI in the Files app, but we're
Dialogue: 0,0:35:48.20,0:35:50.83,Default,,0,0,0,,not so far exposing a way to
Dialogue: 0,0:35:51.81,0:35:53.03,Default,,0,0,0,,actually tell you about the
Dialogue: 0,0:35:53.03,0:35:53.45,Default,,0,0,0,,rename.
Dialogue: 0,0:35:53.65,0:35:55.44,Default,,0,0,0,,And that is what this part of
Dialogue: 0,0:35:55.50,0:35:56.67,Default,,0,0,0,,the session is about.
Dialogue: 0,0:35:57.02,0:35:59.05,Default,,0,0,0,,To back a rename or something
Dialogue: 0,0:35:59.05,0:36:01.81,Default,,0,0,0,,like that, we expose a wide
Dialogue: 0,0:36:01.81,0:36:03.66,Default,,0,0,0,,variety of options, and these
Dialogue: 0,0:36:03.66,0:36:05.56,Default,,0,0,0,,options are moving files around,
Dialogue: 0,0:36:06.05,0:36:07.67,Default,,0,0,0,,creating files -- for example,
Dialogue: 0,0:36:07.67,0:36:08.83,Default,,0,0,0,,if you, if the user hits the
Dialogue: 0,0:36:08.83,0:36:10.43,Default,,0,0,0,,little + button, that shows up
Dialogue: 0,0:36:10.43,0:36:11.37,Default,,0,0,0,,in the document browser view
Dialogue: 0,0:36:11.37,0:36:13.64,Default,,0,0,0,,controller, or if the user drag
Dialogue: 0,0:36:13.64,0:36:15.31,Default,,0,0,0,,and drops a file into the Files
Dialogue: 0,0:36:15.31,0:36:17.43,Default,,0,0,0,,app or into the document browser
Dialogue: 0,0:36:17.43,0:36:18.55,Default,,0,0,0,,in another application.
Dialogue: 0,0:36:18.76,0:36:20.03,Default,,0,0,0,,Last but not least, modifying
Dialogue: 0,0:36:20.03,0:36:21.08,Default,,0,0,0,,attributes on files.
Dialogue: 0,0:36:21.08,0:36:22.40,Default,,0,0,0,,So if the user performs a
Dialogue: 0,0:36:22.40,0:36:25.11,Default,,0,0,0,,tagging operation or looks at a
Dialogue: 0,0:36:25.11,0:36:26.94,Default,,0,0,0,,file and thus wants to modify
Dialogue: 0,0:36:26.94,0:36:28.48,Default,,0,0,0,,the last use date of the file.
Dialogue: 0,0:36:30.01,0:36:32.48,Default,,0,0,0,,And all of these are actions
Dialogue: 0,0:36:32.52,0:36:34.92,Default,,0,0,0,,that are backed by, that back
Dialogue: 0,0:36:34.97,0:36:35.92,Default,,0,0,0,,user operations.
Dialogue: 0,0:36:36.97,0:36:38.58,Default,,0,0,0,,And you are, your extension is
Dialogue: 0,0:36:38.58,0:36:39.31,Default,,0,0,0,,implementing these.
Dialogue: 0,0:36:40.35,0:36:41.78,Default,,0,0,0,,All right, so that is awfully
Dialogue: 0,0:36:41.78,0:36:43.17,Default,,0,0,0,,abstract, so let's have a look
Dialogue: 0,0:36:43.17,0:36:45.82,Default,,0,0,0,,at one of these actions and how
Dialogue: 0,0:36:45.82,0:36:46.56,Default,,0,0,0,,you implement it.
Dialogue: 0,0:36:46.79,0:36:48.61,Default,,0,0,0,,All right, and as our example,
Dialogue: 0,0:36:48.61,0:36:49.82,Default,,0,0,0,,we're going to use the Import
Dialogue: 0,0:36:49.82,0:36:50.60,Default,,0,0,0,,Document action.
Dialogue: 0,0:36:51.22,0:36:52.93,Default,,0,0,0,,But all of the actions are
Dialogue: 0,0:36:52.93,0:36:54.82,Default,,0,0,0,,actually implemented in a very
Dialogue: 0,0:36:54.82,0:36:55.63,Default,,0,0,0,,similar way.
Dialogue: 0,0:36:55.94,0:36:57.48,Default,,0,0,0,,The Import Document action is a
Dialogue: 0,0:36:57.48,0:36:59.55,Default,,0,0,0,,nice one because it deals with a
Dialogue: 0,0:36:59.55,0:37:02.32,Default,,0,0,0,,new file, but most of these
Dialogue: 0,0:37:02.32,0:37:04.31,Default,,0,0,0,,actions are kind of similar.
Dialogue: 0,0:37:04.79,0:37:05.75,Default,,0,0,0,,They have slightly different
Dialogue: 0,0:37:05.75,0:37:06.86,Default,,0,0,0,,parameters and, of course, have
Dialogue: 0,0:37:06.86,0:37:08.04,Default,,0,0,0,,slightly different semantics,
Dialogue: 0,0:37:08.49,0:37:09.84,Default,,0,0,0,,but everything I'm going to tell
Dialogue: 0,0:37:09.84,0:37:11.04,Default,,0,0,0,,you in this session is going to
Dialogue: 0,0:37:11.04,0:37:12.84,Default,,0,0,0,,count for pretty much all of the
Dialogue: 0,0:37:12.84,0:37:13.44,Default,,0,0,0,,actions.
Dialogue: 0,0:37:14.14,0:37:16.13,Default,,0,0,0,,So the Import Document action
Dialogue: 0,0:37:17.35,0:37:18.00,Default,,0,0,0,,works this way.
Dialogue: 0,0:37:18.61,0:37:20.08,Default,,0,0,0,,The system gives you an existing
Dialogue: 0,0:37:20.08,0:37:22.84,Default,,0,0,0,,file URL, so that's a file on
Dialogue: 0,0:37:22.84,0:37:26.40,Default,,0,0,0,,disk, and this file is any
Dialogue: 0,0:37:26.40,0:37:27.81,Default,,0,0,0,,location that the system gives
Dialogue: 0,0:37:27.81,0:37:29.23,Default,,0,0,0,,you, it's possibly in the Temp
Dialogue: 0,0:37:29.23,0:37:31.45,Default,,0,0,0,,folder or wherever the
Dialogue: 0,0:37:31.83,0:37:34.01,Default,,0,0,0,,application that, for example,
Dialogue: 0,0:37:34.01,0:37:35.50,Default,,0,0,0,,performs a create operation
Dialogue: 0,0:37:35.50,0:37:38.97,Default,,0,0,0,,stores its templates, but in any
Dialogue: 0,0:37:38.97,0:37:40.67,Default,,0,0,0,,case, this file is basically for
Dialogue: 0,0:37:40.67,0:37:41.39,Default,,0,0,0,,you to use.
Dialogue: 0,0:37:41.80,0:37:44.05,Default,,0,0,0,,You can go and move this file
Dialogue: 0,0:37:44.05,0:37:46.17,Default,,0,0,0,,into your file provider storage.
Dialogue: 0,0:37:46.50,0:37:48.29,Default,,0,0,0,,So this is, this file is now
Dialogue: 0,0:37:48.29,0:37:49.22,Default,,0,0,0,,under your control.
Dialogue: 0,0:37:49.22,0:37:50.27,Default,,0,0,0,,It's in your container.
Dialogue: 0,0:37:50.82,0:37:53.06,Default,,0,0,0,,At this point, you need to
Dialogue: 0,0:37:53.06,0:37:54.85,Default,,0,0,0,,schedule a background upload so
Dialogue: 0,0:37:54.85,0:37:56.19,Default,,0,0,0,,that this file from your
Dialogue: 0,0:37:56.19,0:37:58.31,Default,,0,0,0,,container actually gets uploaded
Dialogue: 0,0:37:58.31,0:37:59.40,Default,,0,0,0,,into your cloud.
Dialogue: 0,0:37:59.40,0:38:02.16,Default,,0,0,0,,And last but not least, you call
Dialogue: 0,0:38:02.16,0:38:03.02,Default,,0,0,0,,the completion handler.
Dialogue: 0,0:38:03.75,0:38:06.69,Default,,0,0,0,,This is very important, and this
Dialogue: 0,0:38:06.69,0:38:08.81,Default,,0,0,0,,is a very important part of
Dialogue: 0,0:38:08.81,0:38:09.18,Default,,0,0,0,,this.
Dialogue: 0,0:38:09.74,0:38:11.37,Default,,0,0,0,,We just scheduled a background
Dialogue: 0,0:38:11.37,0:38:13.67,Default,,0,0,0,,upload, but we did not wait for
Dialogue: 0,0:38:13.67,0:38:15.00,Default,,0,0,0,,the background upload to finish
Dialogue: 0,0:38:15.00,0:38:16.14,Default,,0,0,0,,until we call the completion
Dialogue: 0,0:38:16.14,0:38:16.52,Default,,0,0,0,,handler.
Dialogue: 0,0:38:17.45,0:38:18.97,Default,,0,0,0,,So the file is actually being
Dialogue: 0,0:38:18.97,0:38:20.19,Default,,0,0,0,,uploaded in the background,
Dialogue: 0,0:38:20.95,0:38:22.41,Default,,0,0,0,,meaning that the user does not
Dialogue: 0,0:38:22.41,0:38:24.63,Default,,0,0,0,,have to wait for this file to be
Dialogue: 0,0:38:24.63,0:38:27.19,Default,,0,0,0,,actually fully uploaded until
Dialogue: 0,0:38:27.39,0:38:29.03,Default,,0,0,0,,you tell the system, hey, I got
Dialogue: 0,0:38:29.03,0:38:29.38,Default,,0,0,0,,this.
Dialogue: 0,0:38:29.45,0:38:30.68,Default,,0,0,0,,I've got this file under my
Dialogue: 0,0:38:30.68,0:38:31.10,Default,,0,0,0,,control.
Dialogue: 0,0:38:31.10,0:38:32.12,Default,,0,0,0,,I'll scheduled the upload.
Dialogue: 0,0:38:32.12,0:38:33.49,Default,,0,0,0,,This file will be in the cloud
Dialogue: 0,0:38:33.49,0:38:34.18,Default,,0,0,0,,at some point.
Dialogue: 0,0:38:35.10,0:38:36.70,Default,,0,0,0,,So the user doesn't have to wait
Dialogue: 0,0:38:36.70,0:38:38.10,Default,,0,0,0,,for this upload of the file that
Dialogue: 0,0:38:38.10,0:38:39.28,Default,,0,0,0,,can be potentially many
Dialogue: 0,0:38:39.28,0:38:39.92,Default,,0,0,0,,megabytes.
Dialogue: 0,0:38:40.27,0:38:42.56,Default,,0,0,0,,So that's how the general flow
Dialogue: 0,0:38:42.56,0:38:43.53,Default,,0,0,0,,of this looks.
Dialogue: 0,0:38:43.53,0:38:44.85,Default,,0,0,0,,Let's have a look at how the
Dialogue: 0,0:38:44.85,0:38:46.78,Default,,0,0,0,,data flow of this operation
Dialogue: 0,0:38:46.78,0:38:47.02,Default,,0,0,0,,looks.
Dialogue: 0,0:38:47.39,0:38:50.24,Default,,0,0,0,,So as I said, the initial
Dialogue: 0,0:38:50.42,0:38:52.51,Default,,0,0,0,,impetus for this operation is
Dialogue: 0,0:38:52.54,0:38:54.19,Default,,0,0,0,,that the user created, or
Dialogue: 0,0:38:54.19,0:38:56.00,Default,,0,0,0,,pasted, or dropped a file into
Dialogue: 0,0:38:56.48,0:38:58.61,Default,,0,0,0,,the, into a container in your
Dialogue: 0,0:38:59.19,0:38:59.96,Default,,0,0,0,,file provider.
Dialogue: 0,0:39:00.63,0:39:03.03,Default,,0,0,0,,And at that point, the Import
Dialogue: 0,0:39:03.03,0:39:05.11,Default,,0,0,0,,Document action on your file
Dialogue: 0,0:39:05.11,0:39:06.62,Default,,0,0,0,,provider extension subclass gets
Dialogue: 0,0:39:06.66,0:39:07.27,Default,,0,0,0,,called.
Dialogue: 0,0:39:07.27,0:39:09.10,Default,,0,0,0,,You make a database entry.
Dialogue: 0,0:39:09.10,0:39:10.14,Default,,0,0,0,,You make sure that the file is
Dialogue: 0,0:39:10.14,0:39:10.98,Default,,0,0,0,,getting uploaded.
Dialogue: 0,0:39:11.92,0:39:13.12,Default,,0,0,0,,So you schedule the upload.
Dialogue: 0,0:39:13.45,0:39:14.28,Default,,0,0,0,,Now, we're done, right?
Dialogue: 0,0:39:14.53,0:39:15.05,Default,,0,0,0,,We can call the
Dialogue: 0,0:39:15.05,0:39:15.81,Default,,0,0,0,,completionHandler.
Dialogue: 0,0:39:15.95,0:39:17.89,Default,,0,0,0,,But as Pierre has told, the
Dialogue: 0,0:39:17.89,0:39:19.79,Default,,0,0,0,,system does not automatically
Dialogue: 0,0:39:19.79,0:39:22.14,Default,,0,0,0,,infer that this file basically
Dialogue: 0,0:39:22.40,0:39:23.30,Default,,0,0,0,,has changed.
Dialogue: 0,0:39:24.05,0:39:25.88,Default,,0,0,0,,So one important bit here is
Dialogue: 0,0:39:25.88,0:39:27.90,Default,,0,0,0,,that you at this point signal us
Dialogue: 0,0:39:28.95,0:39:30.69,Default,,0,0,0,,to tell us, hey, there are
Dialogue: 0,0:39:30.69,0:39:32.19,Default,,0,0,0,,changes on this container.
Dialogue: 0,0:39:32.59,0:39:33.88,Default,,0,0,0,,We need to re-enumerate this
Dialogue: 0,0:39:33.88,0:39:34.35,Default,,0,0,0,,container.
Dialogue: 0,0:39:35.02,0:39:36.15,Default,,0,0,0,,This is important so that the
Dialogue: 0,0:39:36.15,0:39:37.56,Default,,0,0,0,,user gets immediate feedback.
Dialogue: 0,0:39:38.00,0:39:39.36,Default,,0,0,0,,So the next step is actually
Dialogue: 0,0:39:39.36,0:39:40.87,Default,,0,0,0,,that you tell us there are
Dialogue: 0,0:39:40.87,0:39:41.47,Default,,0,0,0,,changes here.
Dialogue: 0,0:39:41.47,0:39:43.66,Default,,0,0,0,,And at that point, we simply
Dialogue: 0,0:39:43.66,0:39:44.26,Default,,0,0,0,,make a note.
Dialogue: 0,0:39:44.31,0:39:46.46,Default,,0,0,0,,We say, OK, for this container
Dialogue: 0,0:39:46.46,0:39:48.41,Default,,0,0,0,,-- and keep in mind, the user is
Dialogue: 0,0:39:48.41,0:39:49.37,Default,,0,0,0,,probably looking at this
Dialogue: 0,0:39:49.37,0:39:50.15,Default,,0,0,0,,container, right?
Dialogue: 0,0:39:50.45,0:39:51.52,Default,,0,0,0,,They just hit the little +
Dialogue: 0,0:39:51.52,0:39:52.27,Default,,0,0,0,,button there.
Dialogue: 0,0:39:52.93,0:39:54.26,Default,,0,0,0,,Of course, they hit the + button
Dialogue: 0,0:39:54.26,0:39:55.18,Default,,0,0,0,,in the container that they're
Dialogue: 0,0:39:55.18,0:39:57.67,Default,,0,0,0,,looking at, so they want to see
Dialogue: 0,0:39:57.67,0:39:58.33,Default,,0,0,0,,these changes.
Dialogue: 0,0:39:58.72,0:40:00.52,Default,,0,0,0,,So you told the system, changes
Dialogue: 0,0:40:00.52,0:40:01.16,Default,,0,0,0,,are pending.
Dialogue: 0,0:40:01.47,0:40:03.83,Default,,0,0,0,,Now, you tell the system, call
Dialogue: 0,0:40:03.83,0:40:04.62,Default,,0,0,0,,the completionHandler.
Dialogue: 0,0:40:04.78,0:40:06.02,Default,,0,0,0,,We're done with this operation.
Dialogue: 0,0:40:06.87,0:40:08.00,Default,,0,0,0,,The system gets unblocked.
Dialogue: 0,0:40:08.11,0:40:09.63,Default,,0,0,0,,And at this point, the system
Dialogue: 0,0:40:09.63,0:40:11.83,Default,,0,0,0,,can go and call, turn around,
Dialogue: 0,0:40:11.83,0:40:13.06,Default,,0,0,0,,and enumerate changes.
Dialogue: 0,0:40:13.41,0:40:15.85,Default,,0,0,0,,You tell us, sweet, we just
Dialogue: 0,0:40:15.85,0:40:17.64,Default,,0,0,0,,added this item, and it's now
Dialogue: 0,0:40:17.64,0:40:18.58,Default,,0,0,0,,uploading, probably.
Dialogue: 0,0:40:19.47,0:40:21.70,Default,,0,0,0,,And you return the changed item
Dialogue: 0,0:40:21.70,0:40:23.92,Default,,0,0,0,,to us as part of a change set.
Dialogue: 0,0:40:25.05,0:40:27.46,Default,,0,0,0,,And we can update our UI and
Dialogue: 0,0:40:27.46,0:40:29.44,Default,,0,0,0,,show a little uploading error in
Dialogue: 0,0:40:29.44,0:40:30.38,Default,,0,0,0,,the corner of the item.
Dialogue: 0,0:40:30.83,0:40:32.61,Default,,0,0,0,,So the user gets immediate
Dialogue: 0,0:40:32.61,0:40:34.25,Default,,0,0,0,,feedback that their data is safe
Dialogue: 0,0:40:34.25,0:40:37.15,Default,,0,0,0,,in your cloud.
Dialogue: 0,0:40:37.29,0:40:38.75,Default,,0,0,0,,So let me reiterate that.
Dialogue: 0,0:40:38.78,0:40:40.02,Default,,0,0,0,,Operations are expected to
Dialogue: 0,0:40:40.02,0:40:42.28,Default,,0,0,0,,finish immediately, and thus,
Dialogue: 0,0:40:42.28,0:40:43.99,Default,,0,0,0,,you need to defer long-running
Dialogue: 0,0:40:44.06,0:40:46.92,Default,,0,0,0,,tasks, such as uploads, to the
Dialogue: 0,0:40:46.92,0:40:49.00,Default,,0,0,0,,background using NSURLSession.
Dialogue: 0,0:40:49.11,0:40:50.31,Default,,0,0,0,,So now, we've got this item
Dialogue: 0,0:40:50.31,0:40:51.76,Default,,0,0,0,,uploading, and that's great,
Dialogue: 0,0:40:52.41,0:40:53.42,Default,,0,0,0,,but, of course, at some point,
Dialogue: 0,0:40:53.42,0:40:54.65,Default,,0,0,0,,this upload is going to finish
Dialogue: 0,0:40:54.65,0:40:56.01,Default,,0,0,0,,and we want to tell the user
Dialogue: 0,0:40:56.01,0:40:57.07,Default,,0,0,0,,about the new status of the
Dialogue: 0,0:40:57.07,0:40:57.46,Default,,0,0,0,,file.
Dialogue: 0,0:40:57.99,0:40:58.84,Default,,0,0,0,,So let's go into that.
Dialogue: 0,0:40:59.63,0:41:01.26,Default,,0,0,0,,The way that works is that
Dialogue: 0,0:41:01.26,0:41:02.92,Default,,0,0,0,,NSURLSession at some point will
Dialogue: 0,0:41:02.92,0:41:04.67,Default,,0,0,0,,notice, hey, this upload
Dialogue: 0,0:41:04.67,0:41:05.16,Default,,0,0,0,,succeeded.
Dialogue: 0,0:41:05.16,0:41:06.66,Default,,0,0,0,,Sweet, the item is in the cloud.
Dialogue: 0,0:41:07.00,0:41:09.13,Default,,0,0,0,,And the way this, the way
Dialogue: 0,0:41:09.13,0:41:10.46,Default,,0,0,0,,NSURLSession tells you about
Dialogue: 0,0:41:10.50,0:41:11.91,Default,,0,0,0,,that is that it calls a
Dialogue: 0,0:41:12.03,0:41:14.18,Default,,0,0,0,,callback, an NSURLSession
Dialogue: 0,0:41:14.18,0:41:16.16,Default,,0,0,0,,background callback, on your
Dialogue: 0,0:41:16.16,0:41:17.10,Default,,0,0,0,,parent application.
Dialogue: 0,0:41:17.68,0:41:19.51,Default,,0,0,0,,Your parent application at this
Dialogue: 0,0:41:19.51,0:41:20.89,Default,,0,0,0,,point can go and update the
Dialogue: 0,0:41:20.89,0:41:21.79,Default,,0,0,0,,database entry.
Dialogue: 0,0:41:21.87,0:41:23.50,Default,,0,0,0,,It sets a little flag in your
Dialogue: 0,0:41:23.50,0:41:25.16,Default,,0,0,0,,database that says, this file is
Dialogue: 0,0:41:25.16,0:41:25.61,Default,,0,0,0,,uploaded.
Dialogue: 0,0:41:25.61,0:41:26.97,Default,,0,0,0,,It's no longer [inaudible] on
Dialogue: 0,0:41:26.97,0:41:27.23,Default,,0,0,0,,disk.
Dialogue: 0,0:41:27.23,0:41:29.32,Default,,0,0,0,,Our upload succeeded.
Dialogue: 0,0:41:29.71,0:41:31.72,Default,,0,0,0,,We don't have to retry this
Dialogue: 0,0:41:31.72,0:41:32.20,Default,,0,0,0,,upload.
Dialogue: 0,0:41:33.02,0:41:34.45,Default,,0,0,0,,And we should inform the user
Dialogue: 0,0:41:34.45,0:41:35.72,Default,,0,0,0,,that this upload is finished.
Dialogue: 0,0:41:36.48,0:41:38.38,Default,,0,0,0,,So as Pierre mentioned, the
Dialogue: 0,0:41:38.38,0:41:39.76,Default,,0,0,0,,signalChanges method can be
Dialogue: 0,0:41:39.76,0:41:41.23,Default,,0,0,0,,called both by your extension
Dialogue: 0,0:41:41.23,0:41:42.93,Default,,0,0,0,,and the parent application, and
Dialogue: 0,0:41:42.93,0:41:43.61,Default,,0,0,0,,this is why.
Dialogue: 0,0:41:44.05,0:41:45.77,Default,,0,0,0,,Now, you tell us there are
Dialogue: 0,0:41:45.77,0:41:47.35,Default,,0,0,0,,changes on this container.
Dialogue: 0,0:41:47.90,0:41:51.47,Default,,0,0,0,,And at this point, the same old
Dialogue: 0,0:41:51.47,0:41:52.29,Default,,0,0,0,,dance happens.
Dialogue: 0,0:41:52.95,0:41:54.28,Default,,0,0,0,,The system notes that changes
Dialogue: 0,0:41:54.28,0:41:56.76,Default,,0,0,0,,are pending, it re-enumerates
Dialogue: 0,0:41:56.86,0:42:01.41,Default,,0,0,0,,your, the, your working set, and
Dialogue: 0,0:42:01.94,0:42:03.33,Default,,0,0,0,,at this point, you can return
Dialogue: 0,0:42:03.49,0:42:04.57,Default,,0,0,0,,in, from your file provider
Dialogue: 0,0:42:04.57,0:42:07.16,Default,,0,0,0,,extension that this item is
Dialogue: 0,0:42:07.16,0:42:08.87,Default,,0,0,0,,properly uploaded using the
Dialogue: 0,0:42:09.08,0:42:11.40,Default,,0,0,0,,isUploaded key on the
Dialogue: 0,0:42:11.40,0:42:13.57,Default,,0,0,0,,NSFileProviderItem protocol.
Dialogue: 0,0:42:14.46,0:42:17.27,Default,,0,0,0,,Now, sometimes uploads fail.
Dialogue: 0,0:42:18.32,0:42:19.67,Default,,0,0,0,,For example, your server might
Dialogue: 0,0:42:19.76,0:42:22.57,Default,,0,0,0,,tell us, hey, this user is out
Dialogue: 0,0:42:22.57,0:42:22.96,Default,,0,0,0,,of quota.
Dialogue: 0,0:42:24.38,0:42:26.25,Default,,0,0,0,,And in this situation, the same
Dialogue: 0,0:42:26.25,0:42:27.71,Default,,0,0,0,,dance happens, basically.
Dialogue: 0,0:42:28.07,0:42:30.61,Default,,0,0,0,,So NSURLSession D is going to
Dialogue: 0,0:42:30.61,0:42:32.41,Default,,0,0,0,,tell your parent application,
Dialogue: 0,0:42:32.99,0:42:34.35,Default,,0,0,0,,hey, this upload failed.
Dialogue: 0,0:42:34.59,0:42:35.37,Default,,0,0,0,,That's too bad.
Dialogue: 0,0:42:35.37,0:42:36.56,Default,,0,0,0,,You're going to have to handle
Dialogue: 0,0:42:36.56,0:42:37.19,Default,,0,0,0,,this somehow.
Dialogue: 0,0:42:37.78,0:42:39.20,Default,,0,0,0,,So again, we make a database
Dialogue: 0,0:42:39.20,0:42:39.72,Default,,0,0,0,,entry.
Dialogue: 0,0:42:39.72,0:42:40.93,Default,,0,0,0,,We signal the system.
Dialogue: 0,0:42:42.11,0:42:43.28,Default,,0,0,0,,The system notes that changes
Dialogue: 0,0:42:43.28,0:42:43.96,Default,,0,0,0,,are pending.
Dialogue: 0,0:42:44.53,0:42:45.86,Default,,0,0,0,,The system re-enumerates.
Dialogue: 0,0:42:46.30,0:42:48.36,Default,,0,0,0,,And we can return the updated
Dialogue: 0,0:42:48.36,0:42:48.77,Default,,0,0,0,,item.
Dialogue: 0,0:42:49.39,0:42:50.80,Default,,0,0,0,,Now, this updated item should
Dialogue: 0,0:42:50.80,0:42:53.92,Default,,0,0,0,,reflect the fact that this item
Dialogue: 0,0:42:53.92,0:42:55.70,Default,,0,0,0,,is now in an error state, so to
Dialogue: 0,0:42:55.70,0:42:57.48,Default,,0,0,0,,turn an update error, an upload
Dialogue: 0,0:42:57.48,0:42:59.84,Default,,0,0,0,,error that is reflecting what
Dialogue: 0,0:42:59.84,0:43:00.72,Default,,0,0,0,,actually here.
Dialogue: 0,0:43:00.72,0:43:02.06,Default,,0,0,0,,All right, let's get into a bit
Dialogue: 0,0:43:02.06,0:43:02.88,Default,,0,0,0,,more detail.
Dialogue: 0,0:43:02.88,0:43:05.97,Default,,0,0,0,,As I said, you mark the item as
Dialogue: 0,0:43:05.97,0:43:07.80,Default,,0,0,0,,being in an error status by
Dialogue: 0,0:43:07.80,0:43:10.07,Default,,0,0,0,,using the upload error property
Dialogue: 0,0:43:10.07,0:43:11.25,Default,,0,0,0,,on the item properties.
Dialogue: 0,0:43:12.31,0:43:13.70,Default,,0,0,0,,You signal re-enumeration so
Dialogue: 0,0:43:13.70,0:43:15.18,Default,,0,0,0,,that the user can see that this
Dialogue: 0,0:43:15.18,0:43:16.41,Default,,0,0,0,,item's in an error state.
Dialogue: 0,0:43:17.26,0:43:18.79,Default,,0,0,0,,And then, how you actually
Dialogue: 0,0:43:19.27,0:43:21.29,Default,,0,0,0,,continue in this error state
Dialogue: 0,0:43:21.29,0:43:23.12,Default,,0,0,0,,depends completely on the kind
Dialogue: 0,0:43:23.19,0:43:24.97,Default,,0,0,0,,of error that you're looking at.
Dialogue: 0,0:43:25.46,0:43:27.53,Default,,0,0,0,,So some, not all errors are the
Dialogue: 0,0:43:27.53,0:43:28.22,Default,,0,0,0,,same thing.
Dialogue: 0,0:43:29.02,0:43:30.32,Default,,0,0,0,,There's the possibility that
Dialogue: 0,0:43:30.32,0:43:31.08,Default,,0,0,0,,you're running into an
Dialogue: 0,0:43:31.08,0:43:32.02,Default,,0,0,0,,intermittent error.
Dialogue: 0,0:43:32.02,0:43:34.28,Default,,0,0,0,,For example, the user was, I
Dialogue: 0,0:43:34.38,0:43:35.52,Default,,0,0,0,,don't know, camping out in the
Dialogue: 0,0:43:35.52,0:43:37.44,Default,,0,0,0,,jungle for two weeks, and
Dialogue: 0,0:43:37.44,0:43:38.93,Default,,0,0,0,,NSURLSession D just gave up
Dialogue: 0,0:43:38.93,0:43:41.58,Default,,0,0,0,,because there was no Wi-Fi, no
Dialogue: 0,0:43:41.58,0:43:42.85,Default,,0,0,0,,wireless connection.
Dialogue: 0,0:43:43.29,0:43:44.83,Default,,0,0,0,,In this situation, the easiest
Dialogue: 0,0:43:44.83,0:43:46.15,Default,,0,0,0,,thing to do is tell the user,
Dialogue: 0,0:43:46.15,0:43:47.98,Default,,0,0,0,,hey, your data wasn't uploaded,
Dialogue: 0,0:43:48.08,0:43:49.07,Default,,0,0,0,,but we're on it.
Dialogue: 0,0:43:49.14,0:43:51.31,Default,,0,0,0,,We re-enqueue the, your
Dialogue: 0,0:43:51.31,0:43:52.42,Default,,0,0,0,,NSURLSession task.
Dialogue: 0,0:43:53.24,0:43:55.03,Default,,0,0,0,,We still mark this item as being
Dialogue: 0,0:43:55.03,0:43:56.43,Default,,0,0,0,,in an error state, as not being
Dialogue: 0,0:43:56.43,0:43:58.91,Default,,0,0,0,,up to date in the cloud, but we
Dialogue: 0,0:43:58.91,0:43:59.77,Default,,0,0,0,,simply retry.
Dialogue: 0,0:44:00.24,0:44:01.21,Default,,0,0,0,,There's nothing that the user
Dialogue: 0,0:44:01.21,0:44:01.85,Default,,0,0,0,,has to do.
Dialogue: 0,0:44:02.42,0:44:03.49,Default,,0,0,0,,In the error description, you
Dialogue: 0,0:44:03.49,0:44:04.86,Default,,0,0,0,,can possibly tell the user, hey,
Dialogue: 0,0:44:05.36,0:44:07.02,Default,,0,0,0,,maybe go online or something
Dialogue: 0,0:44:07.02,0:44:09.07,Default,,0,0,0,,like that, but that's pretty
Dialogue: 0,0:44:09.07,0:44:10.53,Default,,0,0,0,,much it.
Dialogue: 0,0:44:10.74,0:44:12.12,Default,,0,0,0,,There's also the possibility
Dialogue: 0,0:44:12.64,0:44:13.36,Default,,0,0,0,,that you're running into a
Dialogue: 0,0:44:13.36,0:44:15.13,Default,,0,0,0,,persistent error, and that is
Dialogue: 0,0:44:15.13,0:44:15.59,Default,,0,0,0,,different.
Dialogue: 0,0:44:16.28,0:44:17.79,Default,,0,0,0,,In a persistent error case,
Dialogue: 0,0:44:17.79,0:44:19.02,Default,,0,0,0,,like, for example, the user's
Dialogue: 0,0:44:19.02,0:44:20.84,Default,,0,0,0,,out of quota, what you need to
Dialogue: 0,0:44:20.84,0:44:23.38,Default,,0,0,0,,do is tell the user, hey, you're
Dialogue: 0,0:44:23.47,0:44:24.31,Default,,0,0,0,,out of quota.
Dialogue: 0,0:44:24.31,0:44:26.05,Default,,0,0,0,,You got to go and buy more quota
Dialogue: 0,0:44:26.05,0:44:27.35,Default,,0,0,0,,on our web page.
Dialogue: 0,0:44:27.64,0:44:29.12,Default,,0,0,0,,And in that situation, basically
Dialogue: 0,0:44:29.12,0:44:30.77,Default,,0,0,0,,what you give us is a, an error
Dialogue: 0,0:44:30.77,0:44:32.69,Default,,0,0,0,,that suggests a recovery option.
Dialogue: 0,0:44:34.04,0:44:35.67,Default,,0,0,0,,Now, last but not least, there's
Dialogue: 0,0:44:35.67,0:44:36.50,Default,,0,0,0,,the possibility for
Dialogue: 0,0:44:36.50,0:44:38.15,Default,,0,0,0,,authentication errors, and these
Dialogue: 0,0:44:38.15,0:44:39.03,Default,,0,0,0,,are kind of special.
Dialogue: 0,0:44:39.26,0:44:41.58,Default,,0,0,0,,The user has to do something
Dialogue: 0,0:44:41.82,0:44:43.61,Default,,0,0,0,,specific to your application.
Dialogue: 0,0:44:44.13,0:44:45.48,Default,,0,0,0,,For example, re-authenticate.
Dialogue: 0,0:44:46.67,0:44:48.58,Default,,0,0,0,,Well, that's actually the only
Dialogue: 0,0:44:48.90,0:44:50.23,Default,,0,0,0,,possibility in that situation,
Dialogue: 0,0:44:50.23,0:44:50.62,Default,,0,0,0,,probably.
Dialogue: 0,0:44:51.28,0:44:54.79,Default,,0,0,0,,And for that possibility, a
Dialogue: 0,0:44:54.79,0:44:56.34,Default,,0,0,0,,custom action will be called by
Dialogue: 0,0:44:56.34,0:44:56.87,Default,,0,0,0,,the system.
Dialogue: 0,0:44:57.59,0:44:58.69,Default,,0,0,0,,So what's a custom action?
Dialogue: 0,0:44:59.31,0:45:00.70,Default,,0,0,0,,Well, conveniently, that's our
Dialogue: 0,0:45:00.70,0:45:03.12,Default,,0,0,0,,next section, and let's have a
Dialogue: 0,0:45:03.12,0:45:05.18,Default,,0,0,0,,look at, back at this menu view
Dialogue: 0,0:45:05.18,0:45:06.75,Default,,0,0,0,,controller here, menu controller
Dialogue: 0,0:45:06.75,0:45:06.97,Default,,0,0,0,,here.
Dialogue: 0,0:45:07.29,0:45:09.09,Default,,0,0,0,,We've seen these system-provided
Dialogue: 0,0:45:09.09,0:45:11.37,Default,,0,0,0,,actions here, and the way these
Dialogue: 0,0:45:11.37,0:45:12.70,Default,,0,0,0,,work is that the user just taps
Dialogue: 0,0:45:12.70,0:45:15.29,Default,,0,0,0,,them and is backed by an action
Dialogue: 0,0:45:15.29,0:45:17.04,Default,,0,0,0,,that is internally backed by
Dialogue: 0,0:45:17.04,0:45:17.99,Default,,0,0,0,,your provider.
Dialogue: 0,0:45:18.54,0:45:20.71,Default,,0,0,0,,But we also offer another
Dialogue: 0,0:45:20.71,0:45:22.70,Default,,0,0,0,,opportunity for you to customize
Dialogue: 0,0:45:22.70,0:45:25.86,Default,,0,0,0,,this, which is to introduce a
Dialogue: 0,0:45:25.86,0:45:27.50,Default,,0,0,0,,custom action in this situation.
Dialogue: 0,0:45:28.02,0:45:31.81,Default,,0,0,0,,So that's a action, and this one
Dialogue: 0,0:45:31.81,0:45:32.98,Default,,0,0,0,,here is called Custom on the
Dialogue: 0,0:45:32.98,0:45:34.93,Default,,0,0,0,,slide, but it can be whatever
Dialogue: 0,0:45:34.93,0:45:36.16,Default,,0,0,0,,name you want.
Dialogue: 0,0:45:36.97,0:45:38.28,Default,,0,0,0,,And the way this works is that
Dialogue: 0,0:45:39.23,0:45:41.32,Default,,0,0,0,,you expose an operation, a UI
Dialogue: 0,0:45:41.32,0:45:43.63,Default,,0,0,0,,operation, that is scoped to
Dialogue: 0,0:45:43.63,0:45:44.91,Default,,0,0,0,,your file provider extension.
Dialogue: 0,0:45:46.81,0:45:48.33,Default,,0,0,0,,You provide an interface for
Dialogue: 0,0:45:48.67,0:45:51.01,Default,,0,0,0,,this operation that is backed by
Dialogue: 0,0:45:51.01,0:45:53.87,Default,,0,0,0,,a new type of UI extension.
Dialogue: 0,0:45:55.30,0:45:57.89,Default,,0,0,0,,And this is a separate process
Dialogue: 0,0:45:57.89,0:46:00.19,Default,,0,0,0,,that's running on the system,
Dialogue: 0,0:46:00.64,0:46:02.80,Default,,0,0,0,,and it's backed by a subclass of
Dialogue: 0,0:46:02.92,0:46:04.09,Default,,0,0,0,,FPUIActionExtension
Dialogue: 0,0:46:04.09,0:46:04.67,Default,,0,0,0,,ViewController.
Dialogue: 0,0:46:05.25,0:46:07.21,Default,,0,0,0,,So how do we do that?
Dialogue: 0,0:46:07.84,0:46:10.24,Default,,0,0,0,,Well, first of all, we list the
Dialogue: 0,0:46:10.24,0:46:12.20,Default,,0,0,0,,possible number of actions in
Dialogue: 0,0:46:12.29,0:46:13.89,Default,,0,0,0,,the info.plist of our extension,
Dialogue: 0,0:46:13.89,0:46:15.33,Default,,0,0,0,,and this is really easy.
Dialogue: 0,0:46:15.60,0:46:17.40,Default,,0,0,0,,We have an action name, we have
Dialogue: 0,0:46:17.40,0:46:18.86,Default,,0,0,0,,an identifier, and we have an
Dialogue: 0,0:46:18.86,0:46:19.82,Default,,0,0,0,,activation rule.
Dialogue: 0,0:46:19.85,0:46:22.00,Default,,0,0,0,,And this activation rule is used
Dialogue: 0,0:46:22.00,0:46:23.63,Default,,0,0,0,,to figure out which of these
Dialogue: 0,0:46:23.63,0:46:25.32,Default,,0,0,0,,actions applies to which items.
Dialogue: 0,0:46:26.26,0:46:27.97,Default,,0,0,0,,So in this example on the slide,
Dialogue: 0,0:46:27.97,0:46:29.51,Default,,0,0,0,,we're simply using a true
Dialogue: 0,0:46:29.51,0:46:30.81,Default,,0,0,0,,predicate, which means that this
Dialogue: 0,0:46:30.81,0:46:34.19,Default,,0,0,0,,action is, that every item in
Dialogue: 0,0:46:34.19,0:46:35.42,Default,,0,0,0,,your provider's eligible for
Dialogue: 0,0:46:35.42,0:46:36.33,Default,,0,0,0,,this specific action.
Dialogue: 0,0:46:36.94,0:46:38.85,Default,,0,0,0,,But you can basically go wild on
Dialogue: 0,0:46:38.85,0:46:39.16,Default,,0,0,0,,this.
Dialogue: 0,0:46:39.16,0:46:42.97,Default,,0,0,0,,You can expose different keys on
Dialogue: 0,0:46:43.07,0:46:44.83,Default,,0,0,0,,your items and use these for
Dialogue: 0,0:46:44.83,0:46:46.01,Default,,0,0,0,,matching in your activation
Dialogue: 0,0:46:46.01,0:46:46.31,Default,,0,0,0,,rule.
Dialogue: 0,0:46:46.82,0:46:47.98,Default,,0,0,0,,So how does this work?
Dialogue: 0,0:46:48.51,0:46:50.64,Default,,0,0,0,,Well, the user long presses on
Dialogue: 0,0:46:50.64,0:46:52.98,Default,,0,0,0,,an item in the Files app or in
Dialogue: 0,0:46:52.98,0:46:53.98,Default,,0,0,0,,the document browser, and at
Dialogue: 0,0:46:54.56,0:46:56.33,Default,,0,0,0,,this point, we consult the
Dialogue: 0,0:46:56.33,0:46:58.43,Default,,0,0,0,,index, not your extension.
Dialogue: 0,0:46:58.68,0:47:00.36,Default,,0,0,0,,We don't even bring that up.
Dialogue: 0,0:47:00.36,0:47:02.87,Default,,0,0,0,,We consult the index of the item
Dialogue: 0,0:47:02.87,0:47:04.23,Default,,0,0,0,,that you previously returned to
Dialogue: 0,0:47:04.23,0:47:04.53,Default,,0,0,0,,us.
Dialogue: 0,0:47:04.53,0:47:09.12,Default,,0,0,0,,We look at the attributes and we
Dialogue: 0,0:47:09.12,0:47:10.57,Default,,0,0,0,,match this predicate against the
Dialogue: 0,0:47:10.57,0:47:11.25,Default,,0,0,0,,attributes.
Dialogue: 0,0:47:11.50,0:47:12.62,Default,,0,0,0,,At this point, we know whether
Dialogue: 0,0:47:12.62,0:47:14.18,Default,,0,0,0,,this predicate returns a yes or
Dialogue: 0,0:47:14.18,0:47:16.68,Default,,0,0,0,,a no, and we can simply display
Dialogue: 0,0:47:16.68,0:47:18.07,Default,,0,0,0,,the action if it returns a yes.
Dialogue: 0,0:47:18.92,0:47:21.54,Default,,0,0,0,,OK, so now, the user sees this
Dialogue: 0,0:47:21.54,0:47:23.40,Default,,0,0,0,,action, and probably they tap on
Dialogue: 0,0:47:24.15,0:47:24.22,Default,,0,0,0,,it.
Dialogue: 0,0:47:24.49,0:47:26.27,Default,,0,0,0,,So the user taps on the action.
Dialogue: 0,0:47:26.27,0:47:27.08,Default,,0,0,0,,What happens now?
Dialogue: 0,0:47:27.42,0:47:29.29,Default,,0,0,0,,Well, we bring up your UI
Dialogue: 0,0:47:29.29,0:47:31.48,Default,,0,0,0,,extension, and your UI extension
Dialogue: 0,0:47:31.48,0:47:33.04,Default,,0,0,0,,gets a call to its
Dialogue: 0,0:47:33.04,0:47:34.47,Default,,0,0,0,,prepareForAction method.
Dialogue: 0,0:47:34.95,0:47:36.55,Default,,0,0,0,,What this gets, what this does
Dialogue: 0,0:47:36.55,0:47:40.13,Default,,0,0,0,,is it, we hand it a set of items
Dialogue: 0,0:47:40.46,0:47:41.78,Default,,0,0,0,,plus the actionIdentifier that
Dialogue: 0,0:47:41.78,0:47:43.75,Default,,0,0,0,,the user actually chose, and you
Dialogue: 0,0:47:43.75,0:47:46.06,Default,,0,0,0,,can go and present whatever UI
Dialogue: 0,0:47:46.84,0:47:49.88,Default,,0,0,0,,you have for this action.
Dialogue: 0,0:47:50.05,0:47:51.18,Default,,0,0,0,,You return from this method.
Dialogue: 0,0:47:51.18,0:47:52.47,Default,,0,0,0,,We present your view controller.
Dialogue: 0,0:47:52.47,0:47:54.75,Default,,0,0,0,,It slides up nicely in the Files
Dialogue: 0,0:47:54.75,0:47:54.95,Default,,0,0,0,,app.
Dialogue: 0,0:47:54.95,0:47:56.59,Default,,0,0,0,,And that's it.
Dialogue: 0,0:47:56.59,0:47:58.47,Default,,0,0,0,,At this point, you know which
Dialogue: 0,0:47:58.47,0:47:59.63,Default,,0,0,0,,items you're performing these
Dialogue: 0,0:47:59.63,0:48:00.25,Default,,0,0,0,,actions on.
Dialogue: 0,0:48:00.25,0:48:01.99,Default,,0,0,0,,For example, and you can do
Dialogue: 0,0:48:01.99,0:48:03.83,Default,,0,0,0,,whatever is necessary to perform
Dialogue: 0,0:48:03.83,0:48:04.38,Default,,0,0,0,,these actions.
Dialogue: 0,0:48:04.38,0:48:05.39,Default,,0,0,0,,And these actions are completely
Dialogue: 0,0:48:05.39,0:48:07.55,Default,,0,0,0,,custom, so, of course, it's
Dialogue: 0,0:48:07.55,0:48:09.04,Default,,0,0,0,,completely up to you what is
Dialogue: 0,0:48:09.04,0:48:09.64,Default,,0,0,0,,happening here.
Dialogue: 0,0:48:10.49,0:48:12.05,Default,,0,0,0,,At some point, the user will be
Dialogue: 0,0:48:12.05,0:48:13.00,Default,,0,0,0,,done with this action.
Dialogue: 0,0:48:13.76,0:48:14.90,Default,,0,0,0,,Maybe you're implementing a Done
Dialogue: 0,0:48:14.90,0:48:15.24,Default,,0,0,0,,button.
Dialogue: 0,0:48:15.24,0:48:16.99,Default,,0,0,0,,Maybe this is, there's some
Dialogue: 0,0:48:16.99,0:48:18.44,Default,,0,0,0,,natural end to this action.
Dialogue: 0,0:48:18.80,0:48:20.59,Default,,0,0,0,,But at any rate, you call the
Dialogue: 0,0:48:20.59,0:48:22.10,Default,,0,0,0,,completeRequest method on the
Dialogue: 0,0:48:22.10,0:48:24.10,Default,,0,0,0,,extension context, and the
Dialogue: 0,0:48:24.10,0:48:25.86,Default,,0,0,0,,system simply dismisses your UI.
Dialogue: 0,0:48:26.04,0:48:27.75,Default,,0,0,0,,But that's just custom actions.
Dialogue: 0,0:48:27.75,0:48:30.03,Default,,0,0,0,,As I promised earlier, there's a
Dialogue: 0,0:48:30.03,0:48:31.43,Default,,0,0,0,,special case for authentication
Dialogue: 0,0:48:31.43,0:48:32.52,Default,,0,0,0,,actions, so look at that.
Dialogue: 0,0:48:33.38,0:48:34.54,Default,,0,0,0,,Authentication actions are
Dialogue: 0,0:48:34.54,0:48:36.78,Default,,0,0,0,,called exactly the same way as
Dialogue: 0,0:48:36.78,0:48:38.58,Default,,0,0,0,,custom UI actions are called,
Dialogue: 0,0:48:39.30,0:48:40.26,Default,,0,0,0,,except they're called in a
Dialogue: 0,0:48:40.26,0:48:41.45,Default,,0,0,0,,special case, and that's when
Dialogue: 0,0:48:41.45,0:48:42.79,Default,,0,0,0,,you to us return an
Dialogue: 0,0:48:42.79,0:48:43.60,Default,,0,0,0,,authentication error.
Dialogue: 0,0:48:44.13,0:48:45.34,Default,,0,0,0,,So if you return an
Dialogue: 0,0:48:45.34,0:48:46.93,Default,,0,0,0,,authentication error, what
Dialogue: 0,0:48:46.93,0:48:48.28,Default,,0,0,0,,happens is that we call the
Dialogue: 0,0:48:48.28,0:48:49.80,Default,,0,0,0,,prepareForAuthentication method
Dialogue: 0,0:48:50.21,0:48:51.89,Default,,0,0,0,,on your FPUI extension,
Dialogue: 0,0:48:52.30,0:48:53.71,Default,,0,0,0,,ActionExtensionViewController.
Dialogue: 0,0:48:54.42,0:48:55.66,Default,,0,0,0,,And everything from there on
Dialogue: 0,0:48:55.66,0:48:57.19,Default,,0,0,0,,flows just the same way.
Dialogue: 0,0:48:57.76,0:48:59.18,Default,,0,0,0,,You call, you can call, you can
Dialogue: 0,0:48:59.18,0:49:00.68,Default,,0,0,0,,display whatever UI is necessary
Dialogue: 0,0:49:00.68,0:49:01.60,Default,,0,0,0,,for authenticating.
Dialogue: 0,0:49:01.83,0:49:03.11,Default,,0,0,0,,At some point, the user has
Dialogue: 0,0:49:03.11,0:49:03.92,Default,,0,0,0,,authenticated.
Dialogue: 0,0:49:03.92,0:49:05.51,Default,,0,0,0,,You can call the dismiss method,
Dialogue: 0,0:49:05.63,0:49:07.13,Default,,0,0,0,,the view controller dismisses,
Dialogue: 0,0:49:07.13,0:49:08.37,Default,,0,0,0,,and you're now authenticated,
Dialogue: 0,0:49:08.37,0:49:09.65,Default,,0,0,0,,and we will simply retry.
Dialogue: 0,0:49:10.54,0:49:11.74,Default,,0,0,0,,So those are actions, and those
Dialogue: 0,0:49:11.74,0:49:15.92,Default,,0,0,0,,are very nice, but all said and
Dialogue: 0,0:49:15.92,0:49:17.69,Default,,0,0,0,,done, they are only showing up
Dialogue: 0,0:49:17.69,0:49:20.76,Default,,0,0,0,,in the, either the document
Dialogue: 0,0:49:20.76,0:49:22.02,Default,,0,0,0,,browser view controller or the
Dialogue: 0,0:49:22.02,0:49:22.54,Default,,0,0,0,,Files app.
Dialogue: 0,0:49:22.88,0:49:24.11,Default,,0,0,0,,And that is great.
Dialogue: 0,0:49:24.66,0:49:26.53,Default,,0,0,0,,That is a great way for you to
Dialogue: 0,0:49:26.53,0:49:28.04,Default,,0,0,0,,expose something to your user,
Dialogue: 0,0:49:28.72,0:49:30.34,Default,,0,0,0,,but sometimes you need something
Dialogue: 0,0:49:30.34,0:49:31.50,Default,,0,0,0,,more, and for that, we have this
Dialogue: 0,0:49:31.50,0:49:32.66,Default,,0,0,0,,concept of Services.
Dialogue: 0,0:49:33.88,0:49:35.11,Default,,0,0,0,,What's a Service?
Dialogue: 0,0:49:35.59,0:49:37.56,Default,,0,0,0,,Well, as I said, there's caveats
Dialogue: 0,0:49:37.56,0:49:38.58,Default,,0,0,0,,for the custom actions.
Dialogue: 0,0:49:39.54,0:49:41.72,Default,,0,0,0,,But sometimes you need
Dialogue: 0,0:49:41.99,0:49:44.00,Default,,0,0,0,,programmatic access to specific
Dialogue: 0,0:49:44.00,0:49:44.47,Default,,0,0,0,,files.
Dialogue: 0,0:49:45.02,0:49:45.82,Default,,0,0,0,,And if you're currently
Dialogue: 0,0:49:45.82,0:49:47.56,Default,,0,0,0,,publishing an SDK, for example,
Dialogue: 0,0:49:47.92,0:49:50.59,Default,,0,0,0,,this is where you export,
Dialogue: 0,0:49:50.59,0:49:52.31,Default,,0,0,0,,expose, where you can expose the
Dialogue: 0,0:49:52.31,0:49:53.73,Default,,0,0,0,,same functionality that your SDK
Dialogue: 0,0:49:53.73,0:49:54.77,Default,,0,0,0,,is currently exposing.
Dialogue: 0,0:49:56.22,0:49:58.60,Default,,0,0,0,,Services are a way for you to
Dialogue: 0,0:49:58.60,0:50:00.42,Default,,0,0,0,,expose functionality directly on
Dialogue: 0,0:50:00.42,0:50:02.20,Default,,0,0,0,,an item, so let's have a look at
Dialogue: 0,0:50:02.20,0:50:03.78,Default,,0,0,0,,how that goes.
Dialogue: 0,0:50:03.97,0:50:05.14,Default,,0,0,0,,First, you need to define what
Dialogue: 0,0:50:05.14,0:50:05.87,Default,,0,0,0,,your service is.
Dialogue: 0,0:50:06.34,0:50:08.74,Default,,0,0,0,,And at the base level, a service
Dialogue: 0,0:50:08.74,0:50:11.19,Default,,0,0,0,,is simply a name that's an
Dialogue: 0,0:50:11.23,0:50:12.52,Default,,0,0,0,,identifier that you give the
Dialogue: 0,0:50:12.52,0:50:15.75,Default,,0,0,0,,service plus an Objective-C
Dialogue: 0,0:50:15.75,0:50:16.50,Default,,0,0,0,,protocol.
Dialogue: 0,0:50:16.61,0:50:18.28,Default,,0,0,0,,And this is basically any old
Dialogue: 0,0:50:18.28,0:50:19.35,Default,,0,0,0,,Objective-C protocol.
Dialogue: 0,0:50:19.96,0:50:21.31,Default,,0,0,0,,There's some caveats here that
Dialogue: 0,0:50:21.31,0:50:22.79,Default,,0,0,0,,we'll go into real soon.
Dialogue: 0,0:50:23.00,0:50:25.55,Default,,0,0,0,,The protocol must be known to
Dialogue: 0,0:50:25.55,0:50:27.58,Default,,0,0,0,,you and to the developer that's
Dialogue: 0,0:50:27.58,0:50:28.06,Default,,0,0,0,,using it.
Dialogue: 0,0:50:28.06,0:50:30.29,Default,,0,0,0,,So both of you need to determine
Dialogue: 0,0:50:30.29,0:50:31.84,Default,,0,0,0,,what the protocol is.
Dialogue: 0,0:50:32.38,0:50:33.75,Default,,0,0,0,,And this is because the
Dialogue: 0,0:50:33.75,0:50:35.74,Default,,0,0,0,,developer using this is going to
Dialogue: 0,0:50:35.74,0:50:37.15,Default,,0,0,0,,perform method calls on an
Dialogue: 0,0:50:37.15,0:50:38.92,Default,,0,0,0,,object that is exposed by you,
Dialogue: 0,0:50:38.92,0:50:39.60,Default,,0,0,0,,effectively.
Dialogue: 0,0:50:40.12,0:50:41.24,Default,,0,0,0,,So if the signatures don't
Dialogue: 0,0:50:41.24,0:50:43.03,Default,,0,0,0,,match, nothing will happen.
Dialogue: 0,0:50:43.03,0:50:44.56,Default,,0,0,0,,This will just result in an
Dialogue: 0,0:50:44.95,0:50:45.04,Default,,0,0,0,,error.
Dialogue: 0,0:50:45.91,0:50:47.60,Default,,0,0,0,,And when I say they're
Dialogue: 0,0:50:47.60,0:50:49.08,Default,,0,0,0,,performing method calls, the way
Dialogue: 0,0:50:49.08,0:50:51.24,Default,,0,0,0,,this works is actually that this
Dialogue: 0,0:50:51.24,0:50:52.88,Default,,0,0,0,,is implemented using NSXPC,
Dialogue: 0,0:50:52.94,0:50:55.14,Default,,0,0,0,,which is a great technology for
Dialogue: 0,0:50:55.14,0:50:56.31,Default,,0,0,0,,interprocess communication.
Dialogue: 0,0:50:56.86,0:50:59.06,Default,,0,0,0,,And that means that the usual
Dialogue: 0,0:50:59.06,0:51:00.21,Default,,0,0,0,,XPC rules apply.
Dialogue: 0,0:51:01.06,0:51:03.32,Default,,0,0,0,,So all the parameters that are
Dialogue: 0,0:51:03.32,0:51:04.45,Default,,0,0,0,,passed through this protocol
Dialogue: 0,0:51:04.45,0:51:05.59,Default,,0,0,0,,have to be secure codable.
Dialogue: 0,0:51:05.88,0:51:07.24,Default,,0,0,0,,And of course, the classes have
Dialogue: 0,0:51:07.24,0:51:09.09,Default,,0,0,0,,to be available in both your
Dialogue: 0,0:51:09.09,0:51:11.92,Default,,0,0,0,,extension and the app that's
Dialogue: 0,0:51:11.95,0:51:12.64,Default,,0,0,0,,calling this.
Dialogue: 0,0:51:13.23,0:51:14.93,Default,,0,0,0,,And you cannot directly return
Dialogue: 0,0:51:15.22,0:51:17.35,Default,,0,0,0,,any objects from this protocol.
Dialogue: 0,0:51:18.00,0:51:20.24,Default,,0,0,0,,So you have to return, if you
Dialogue: 0,0:51:20.31,0:51:21.56,Default,,0,0,0,,want to return something, you
Dialogue: 0,0:51:21.56,0:51:23.00,Default,,0,0,0,,have to call back via completion
Dialogue: 0,0:51:23.00,0:51:23.27,Default,,0,0,0,,block.
Dialogue: 0,0:51:23.87,0:51:25.67,Default,,0,0,0,,Now, the rules for this are
Dialogue: 0,0:51:25.67,0:51:28.58,Default,,0,0,0,,somewhat interesting, and
Dialogue: 0,0:51:28.61,0:51:30.41,Default,,0,0,0,,there's, was a session in 2012
Dialogue: 0,0:51:30.87,0:51:32.21,Default,,0,0,0,,that goes into way more detail
Dialogue: 0,0:51:32.21,0:51:33.91,Default,,0,0,0,,than I can go, possibly go into
Dialogue: 0,0:51:33.91,0:51:34.54,Default,,0,0,0,,here today.
Dialogue: 0,0:51:35.79,0:51:37.55,Default,,0,0,0,,So I encourage you to have a
Dialogue: 0,0:51:37.55,0:51:38.31,Default,,0,0,0,,look at that session.
Dialogue: 0,0:51:39.34,0:51:40.58,Default,,0,0,0,,All right, let's quickly go
Dialogue: 0,0:51:40.79,0:51:42.00,Default,,0,0,0,,through the data flow that is
Dialogue: 0,0:51:42.00,0:51:44.04,Default,,0,0,0,,happening here because that is,
Dialogue: 0,0:51:44.18,0:51:45.60,Default,,0,0,0,,that warrants having a look at.
Dialogue: 0,0:51:46.08,0:51:47.33,Default,,0,0,0,,Your third-party application
Dialogue: 0,0:51:47.98,0:51:50.23,Default,,0,0,0,,goes and basically inquires on
Dialogue: 0,0:51:50.23,0:51:54.42,Default,,0,0,0,,an URL, what are the services
Dialogue: 0,0:51:54.85,0:51:56.69,Default,,0,0,0,,that are exposed on this URL?
Dialogue: 0,0:51:56.69,0:51:57.96,Default,,0,0,0,,And at this point, your
Dialogue: 0,0:51:57.96,0:52:01.57,Default,,0,0,0,,extension gets a call to answer,
Dialogue: 0,0:52:01.68,0:52:02.92,Default,,0,0,0,,hey, what are the supported
Dialogue: 0,0:52:02.92,0:52:04.54,Default,,0,0,0,,services on this item?
Dialogue: 0,0:52:05.64,0:52:07.96,Default,,0,0,0,,It returns an array of service
Dialogue: 0,0:52:07.96,0:52:09.34,Default,,0,0,0,,sources, and a service source is
Dialogue: 0,0:52:09.34,0:52:10.33,Default,,0,0,0,,not a service itself.
Dialogue: 0,0:52:10.87,0:52:13.33,Default,,0,0,0,,It's an object that can create a
Dialogue: 0,0:52:13.33,0:52:14.83,Default,,0,0,0,,service, effectively, that can
Dialogue: 0,0:52:14.83,0:52:16.59,Default,,0,0,0,,create an XPC listener endpoint.
Dialogue: 0,0:52:17.05,0:52:19.61,Default,,0,0,0,,We return these services as
Dialogue: 0,0:52:19.77,0:52:21.68,Default,,0,0,0,,services to the application.
Dialogue: 0,0:52:22.14,0:52:23.43,Default,,0,0,0,,So on the service object, the
Dialogue: 0,0:52:23.43,0:52:24.83,Default,,0,0,0,,application can go and then
Dialogue: 0,0:52:25.14,0:52:26.32,Default,,0,0,0,,create a proxy object.
Dialogue: 0,0:52:26.67,0:52:27.92,Default,,0,0,0,,Let's have a look at that, how
Dialogue: 0,0:52:27.92,0:52:28.55,Default,,0,0,0,,that works.
Dialogue: 0,0:52:29.20,0:52:31.15,Default,,0,0,0,,So the third-party application
Dialogue: 0,0:52:31.15,0:52:32.73,Default,,0,0,0,,uses that service after it's
Dialogue: 0,0:52:32.73,0:52:34.22,Default,,0,0,0,,looked at which services are
Dialogue: 0,0:52:34.22,0:52:34.71,Default,,0,0,0,,available.
Dialogue: 0,0:52:34.71,0:52:36.05,Default,,0,0,0,,Of course, they can be any
Dialogue: 0,0:52:36.05,0:52:37.19,Default,,0,0,0,,number of services, right?
Dialogue: 0,0:52:37.78,0:52:39.16,Default,,0,0,0,,So it looks at the identifiers
Dialogue: 0,0:52:39.54,0:52:42.08,Default,,0,0,0,,of these services, figures out
Dialogue: 0,0:52:42.08,0:52:43.80,Default,,0,0,0,,which one it wants to use, and
Dialogue: 0,0:52:43.80,0:52:44.68,Default,,0,0,0,,creates a messenger.
Dialogue: 0,0:52:45.54,0:52:47.70,Default,,0,0,0,,At this point, we are asking
Dialogue: 0,0:52:47.70,0:52:50.13,Default,,0,0,0,,your extension on the service
Dialogue: 0,0:52:50.13,0:52:51.73,Default,,0,0,0,,source to make a listener
Dialogue: 0,0:52:51.73,0:52:52.33,Default,,0,0,0,,endpoint.
Dialogue: 0,0:52:53.08,0:52:54.98,Default,,0,0,0,,So it returned that.
Dialogue: 0,0:52:54.98,0:52:56.28,Default,,0,0,0,,A ListenerEndpoint, that's an
Dialogue: 0,0:52:56.66,0:52:58.44,Default,,0,0,0,,existing NSXPC class, although
Dialogue: 0,0:52:58.44,0:52:59.88,Default,,0,0,0,,it's currently only exposed on
Dialogue: 0,0:52:59.88,0:53:00.43,Default,,0,0,0,,macOS.
Dialogue: 0,0:53:00.87,0:53:02.14,Default,,0,0,0,,We're now bringing it to iOS.
Dialogue: 0,0:53:02.58,0:53:03.91,Default,,0,0,0,,At this point, the third-party
Dialogue: 0,0:53:03.91,0:53:05.46,Default,,0,0,0,,application can grab the remote
Dialogue: 0,0:53:05.46,0:53:07.19,Default,,0,0,0,,proxy on this messenger, and
Dialogue: 0,0:53:07.19,0:53:09.27,Default,,0,0,0,,that calls on your listener
Dialogue: 0,0:53:09.27,0:53:10.82,Default,,0,0,0,,delegate the
Dialogue: 0,0:53:10.82,0:53:13.78,Default,,0,0,0,,shouldAcceptConnection callback.
Dialogue: 0,0:53:14.82,0:53:16.40,Default,,0,0,0,,At this point, you can call, you
Dialogue: 0,0:53:16.40,0:53:18.31,Default,,0,0,0,,can configure this connection
Dialogue: 0,0:53:19.25,0:53:22.00,Default,,0,0,0,,and return this connection to
Dialogue: 0,0:53:22.28,0:53:22.90,Default,,0,0,0,,the system.
Dialogue: 0,0:53:23.62,0:53:25.24,Default,,0,0,0,,So in this case, for example,
Dialogue: 0,0:53:25.24,0:53:27.63,Default,,0,0,0,,you provide a proxy object that
Dialogue: 0,0:53:27.63,0:53:28.93,Default,,0,0,0,,is being exported by our
Dialogue: 0,0:53:28.93,0:53:29.53,Default,,0,0,0,,extension.
Dialogue: 0,0:53:30.01,0:53:33.37,Default,,0,0,0,,And from there on out, we can go
Dialogue: 0,0:53:33.37,0:53:35.39,Default,,0,0,0,,and call whatever methods are
Dialogue: 0,0:53:35.74,0:53:37.86,Default,,0,0,0,,defined in our protocol on this
Dialogue: 0,0:53:37.86,0:53:39.21,Default,,0,0,0,,remote proxy object in our
Dialogue: 0,0:53:39.21,0:53:40.21,Default,,0,0,0,,third-party application.
Dialogue: 0,0:53:40.69,0:53:42.16,Default,,0,0,0,,And all of these calls will be
Dialogue: 0,0:53:42.16,0:53:45.24,Default,,0,0,0,,translated into calls in our
Dialogue: 0,0:53:45.24,0:53:45.81,Default,,0,0,0,,extension.
Dialogue: 0,0:53:47.22,0:53:49.71,Default,,0,0,0,,This is a, an extremely powerful
Dialogue: 0,0:53:50.90,0:53:53.11,Default,,0,0,0,,mechanism for you to expose
Dialogue: 0,0:53:54.34,0:53:58.92,Default,,0,0,0,,basically any old possible SDK
Dialogue: 0,0:53:58.92,0:54:01.37,Default,,0,0,0,,operations on your extension.
Dialogue: 0,0:54:01.89,0:54:04.28,Default,,0,0,0,,As a, as an aside, we don't
Dialogue: 0,0:54:04.28,0:54:05.49,Default,,0,0,0,,expect everyone to implement
Dialogue: 0,0:54:05.49,0:54:06.88,Default,,0,0,0,,this, and it's perfectly fine if
Dialogue: 0,0:54:06.88,0:54:08.96,Default,,0,0,0,,your first version does not use
Dialogue: 0,0:54:08.96,0:54:09.92,Default,,0,0,0,,this mechanism at all.
Dialogue: 0,0:54:10.25,0:54:11.84,Default,,0,0,0,,This is a very advanced topic,
Dialogue: 0,0:54:12.32,0:54:15.64,Default,,0,0,0,,so if you only, if all you
Dialogue: 0,0:54:15.64,0:54:18.01,Default,,0,0,0,,implement is enumeration and the
Dialogue: 0,0:54:18.01,0:54:19.79,Default,,0,0,0,,usual file provider actions,
Dialogue: 0,0:54:20.11,0:54:21.88,Default,,0,0,0,,we're already super happy.
Dialogue: 0,0:54:23.00,0:54:23.63,Default,,0,0,0,,All right.
Dialogue: 0,0:54:24.08,0:54:25.12,Default,,0,0,0,,Let's summarize what we've seen
Dialogue: 0,0:54:25.12,0:54:25.47,Default,,0,0,0,,today.
Dialogue: 0,0:54:26.34,0:54:27.59,Default,,0,0,0,,We've seen what a file provider
Dialogue: 0,0:54:27.59,0:54:29.00,Default,,0,0,0,,is, and how we can use a file
Dialogue: 0,0:54:29.00,0:54:30.93,Default,,0,0,0,,provider to back the
Dialogue: 0,0:54:31.48,0:54:32.99,Default,,0,0,0,,enumerations in the Files app,
Dialogue: 0,0:54:33.04,0:54:36.85,Default,,0,0,0,,and how to use it to show files
Dialogue: 0,0:54:36.85,0:54:37.99,Default,,0,0,0,,in the document browser.
Dialogue: 0,0:54:39.21,0:54:40.33,Default,,0,0,0,,We've seen how you use
Dialogue: 0,0:54:40.33,0:54:43.61,Default,,0,0,0,,enumerations to expose items to
Dialogue: 0,0:54:43.97,0:54:46.10,Default,,0,0,0,,both of these controls and how
Dialogue: 0,0:54:46.10,0:54:47.24,Default,,0,0,0,,you can enumerate the working
Dialogue: 0,0:54:47.24,0:54:48.20,Default,,0,0,0,,set, how you can enumerate
Dialogue: 0,0:54:48.20,0:54:49.85,Default,,0,0,0,,changes to the working set, and
Dialogue: 0,0:54:49.85,0:54:51.05,Default,,0,0,0,,how you can push changes to the
Dialogue: 0,0:54:51.05,0:54:51.66,Default,,0,0,0,,working set.
Dialogue: 0,0:54:52.50,0:54:54.58,Default,,0,0,0,,And finally, we've seen how you
Dialogue: 0,0:54:54.58,0:54:57.44,Default,,0,0,0,,can implement actions to modify
Dialogue: 0,0:54:57.60,0:54:59.90,Default,,0,0,0,,stuff in your hierarchy and how
Dialogue: 0,0:54:59.90,0:55:01.65,Default,,0,0,0,,you can then go even further,
Dialogue: 0,0:55:01.65,0:55:03.73,Default,,0,0,0,,and customize these actions, and
Dialogue: 0,0:55:03.73,0:55:06.29,Default,,0,0,0,,even implement services that are
Dialogue: 0,0:55:06.29,0:55:07.44,Default,,0,0,0,,completely custom to your
Dialogue: 0,0:55:07.44,0:55:09.42,Default,,0,0,0,,provider, and expose those to
Dialogue: 0,0:55:09.42,0:55:10.17,Default,,0,0,0,,third-party apps.
Dialogue: 0,0:55:11.06,0:55:13.12,Default,,0,0,0,,For more information, we have a
Dialogue: 0,0:55:13.12,0:55:16.08,Default,,0,0,0,,page on the developer.apple.com
Dialogue: 0,0:55:17.20,0:55:18.97,Default,,0,0,0,,and we have a list of related
Dialogue: 0,0:55:18.97,0:55:20.92,Default,,0,0,0,,sessions that go into way more
Dialogue: 0,0:55:20.92,0:55:22.23,Default,,0,0,0,,detail than we can possibly do
Dialogue: 0,0:55:22.23,0:55:25.01,Default,,0,0,0,,here on some of the technologies
Dialogue: 0,0:55:25.01,0:55:25.36,Default,,0,0,0,,used.
Dialogue: 0,0:55:26.46,0:55:27.86,Default,,0,0,0,,And with that, I hope you are
Dialogue: 0,0:55:27.86,0:55:29.02,Default,,0,0,0,,having a great conference.
Dialogue: 0,0:55:29.25,0:55:29.95,Default,,0,0,0,,Thank you very much.
Dialogue: 0,0:55:31.02,0:55:33.00,Default,,0,0,0,,[ Applause ]
