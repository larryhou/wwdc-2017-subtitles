[Script Info]
; Script generated by FFmpeg/Lavc57.89.100
ScriptType: v4.00+
PlayResX: 384
PlayResY: 288

[V4+ Styles]
Format: Name, Fontname, Fontsize, PrimaryColour, SecondaryColour, OutlineColour, BackColour, Bold, Italic, Underline, StrikeOut, ScaleX, ScaleY, Spacing, Angle, BorderStyle, Outline, Shadow, Alignment, MarginL, MarginR, MarginV, Encoding
Style: Default,Arial,16,&Hffffff,&Hffffff,&H0,&H0,0,0,0,0,100,100,0,0,1,1,0,2,10,10,10,0

[Events]
Format: Layer, Start, End, Style, Name, MarginL, MarginR, MarginV, Effect, Text
Dialogue: 0,0:00:24.52,0:00:26.74,Default,,0,0,0,,[ Applause ]
Dialogue: 0,0:00:27.24,0:00:28.13,Default,,0,0,0,,>> Good morning, everyone.
Dialogue: 0,0:00:28.75,0:00:30.48,Default,,0,0,0,,Welcome to VR with Metal 2.
Dialogue: 0,0:00:31.16,0:00:32.65,Default,,0,0,0,,My name is Rav Dhiraj, and I'm a
Dialogue: 0,0:00:32.65,0:00:34.47,Default,,0,0,0,,member of the GPU Software Team
Dialogue: 0,0:00:34.72,0:00:35.23,Default,,0,0,0,,at Apple.
Dialogue: 0,0:00:35.68,0:00:37.45,Default,,0,0,0,,So, as you saw in our
Dialogue: 0,0:00:37.45,0:00:39.01,Default,,0,0,0,,Introducing Metal 2 Session,
Dialogue: 0,0:00:39.42,0:00:40.73,Default,,0,0,0,,we've enabled some great new
Dialogue: 0,0:00:40.73,0:00:41.63,Default,,0,0,0,,features this year.
Dialogue: 0,0:00:42.44,0:00:43.55,Default,,0,0,0,,And in this session, I'll be
Dialogue: 0,0:00:43.61,0:00:45.48,Default,,0,0,0,,focusing specifically on the
Dialogue: 0,0:00:45.48,0:00:46.99,Default,,0,0,0,,support for VR that we're adding
Dialogue: 0,0:00:46.99,0:00:47.67,Default,,0,0,0,,with Metal 2.
Dialogue: 0,0:00:48.23,0:00:51.43,Default,,0,0,0,,So, I'll start with a brief
Dialogue: 0,0:00:51.51,0:00:53.40,Default,,0,0,0,,summary of what we've enabled in
Dialogue: 0,0:00:53.40,0:00:54.63,Default,,0,0,0,,macOS High Sierra.
Dialogue: 0,0:00:54.63,0:00:57.11,Default,,0,0,0,,And then, take a deep dive into
Dialogue: 0,0:00:57.11,0:00:58.39,Default,,0,0,0,,what's required to build a VR
Dialogue: 0,0:00:58.39,0:00:58.87,Default,,0,0,0,,app.
Dialogue: 0,0:00:59.19,0:01:00.98,Default,,0,0,0,,And then, end by providing some
Dialogue: 0,0:01:00.98,0:01:02.58,Default,,0,0,0,,details on how you can take
Dialogue: 0,0:01:02.58,0:01:04.05,Default,,0,0,0,,advantage of the new external
Dialogue: 0,0:01:04.05,0:01:05.91,Default,,0,0,0,,GPU support that we've added to
Dialogue: 0,0:01:05.91,0:01:06.44,Default,,0,0,0,,the OS.
Dialogue: 0,0:01:09.26,0:01:09.52,Default,,0,0,0,,All right.
Dialogue: 0,0:01:09.52,0:01:11.17,Default,,0,0,0,,I hope everyone here knows what
Dialogue: 0,0:01:11.22,0:01:12.28,Default,,0,0,0,,virtual reality is.
Dialogue: 0,0:01:12.79,0:01:14.71,Default,,0,0,0,,But just in case, it's am
Dialogue: 0,0:01:14.71,0:01:17.53,Default,,0,0,0,,immersive 360-degree 3D
Dialogue: 0,0:01:17.61,0:01:20.25,Default,,0,0,0,,experience, with direct object
Dialogue: 0,0:01:20.25,0:01:21.73,Default,,0,0,0,,manipulation using controllera.
Dialogue: 0,0:01:22.37,0:01:24.48,Default,,0,0,0,,And an interactive room sized
Dialogue: 0,0:01:24.48,0:01:25.68,Default,,0,0,0,,environment that you can
Dialogue: 0,0:01:25.68,0:01:27.48,Default,,0,0,0,,explore, thanks to highly
Dialogue: 0,0:01:27.48,0:01:28.83,Default,,0,0,0,,accurate motion tracking.
Dialogue: 0,0:01:30.04,0:01:31.31,Default,,0,0,0,,Now, we at Apple think that this
Dialogue: 0,0:01:31.31,0:01:32.72,Default,,0,0,0,,is a great new medium for
Dialogue: 0,0:01:32.72,0:01:34.79,Default,,0,0,0,,developers like you to create
Dialogue: 0,0:01:34.79,0:01:36.65,Default,,0,0,0,,new experiences for our users.
Dialogue: 0,0:01:37.28,0:01:40.96,Default,,0,0,0,,And Metal 2 enables this support
Dialogue: 0,0:01:40.96,0:01:41.85,Default,,0,0,0,,in three ways.
Dialogue: 0,0:01:42.52,0:01:46.77,Default,,0,0,0,,First, by providing a fast path
Dialogue: 0,0:01:46.85,0:01:48.32,Default,,0,0,0,,to present the frame directly to
Dialogue: 0,0:01:48.32,0:01:49.78,Default,,0,0,0,,the VR headset with our new
Dialogue: 0,0:01:50.30,0:01:52.01,Default,,0,0,0,,Direct to Display capability.
Dialogue: 0,0:01:53.62,0:01:56.14,Default,,0,0,0,,Second, by enabling new features
Dialogue: 0,0:01:56.14,0:01:57.70,Default,,0,0,0,,like Viewport Array that are
Dialogue: 0,0:01:57.76,0:02:00.03,Default,,0,0,0,,specifically targeting VR.
Dialogue: 0,0:02:01.51,0:02:03.01,Default,,0,0,0,,And finally, by providing that
Dialogue: 0,0:02:03.08,0:02:04.37,Default,,0,0,0,,foundational support for
Dialogue: 0,0:02:04.37,0:02:06.10,Default,,0,0,0,,external GPUs, so that
Dialogue: 0,0:02:06.10,0:02:07.80,Default,,0,0,0,,developers have a broader range
Dialogue: 0,0:02:07.80,0:02:08.71,Default,,0,0,0,,of Mac hardware.
Dialogue: 0,0:02:08.95,0:02:10.62,Default,,0,0,0,,Of VR capable Mac hardware to
Dialogue: 0,0:02:10.62,0:02:11.07,Default,,0,0,0,,work on.
Dialogue: 0,0:02:11.61,0:02:13.57,Default,,0,0,0,,So, let's get right into what
Dialogue: 0,0:02:13.57,0:02:15.57,Default,,0,0,0,,we've enabled with macOS High
Dialogue: 0,0:02:15.70,0:02:16.04,Default,,0,0,0,,Sierra.
Dialogue: 0,0:02:17.06,0:02:18.73,Default,,0,0,0,,So, we've added built-in plug
Dialogue: 0,0:02:18.73,0:02:20.19,Default,,0,0,0,,and play support for the HTC
Dialogue: 0,0:02:20.40,0:02:21.62,Default,,0,0,0,,Vive VR headset.
Dialogue: 0,0:02:21.62,0:02:24.29,Default,,0,0,0,,And this headset works in
Dialogue: 0,0:02:24.29,0:02:26.35,Default,,0,0,0,,conjunction with Valve SteamVR
Dialogue: 0,0:02:26.35,0:02:28.44,Default,,0,0,0,,runtime, which provides a number
Dialogue: 0,0:02:28.44,0:02:30.21,Default,,0,0,0,,of services, including the VR
Dialogue: 0,0:02:30.21,0:02:31.09,Default,,0,0,0,,compositor.
Dialogue: 0,0:02:32.56,0:02:33.95,Default,,0,0,0,,Valve is also bringing their
Dialogue: 0,0:02:34.01,0:02:36.80,Default,,0,0,0,,open VR APIs to macOS, so that
Dialogue: 0,0:02:36.80,0:02:39.14,Default,,0,0,0,,you guys can create VR apps that
Dialogue: 0,0:02:39.14,0:02:40.14,Default,,0,0,0,,work with SteamVR.
Dialogue: 0,0:02:40.42,0:02:41.47,Default,,0,0,0,,We've been working really
Dialogue: 0,0:02:41.47,0:02:43.01,Default,,0,0,0,,closely with Valve over the last
Dialogue: 0,0:02:43.11,0:02:45.22,Default,,0,0,0,,year to align our releases, and
Dialogue: 0,0:02:45.22,0:02:47.26,Default,,0,0,0,,both SteamVR and OpenVR are
Dialogue: 0,0:02:47.73,0:02:49.57,Default,,0,0,0,,available to download in beta
Dialogue: 0,0:02:49.64,0:02:50.75,Default,,0,0,0,,form, this week.
Dialogue: 0,0:02:51.39,0:02:55.38,Default,,0,0,0,,So, before I go on, I'd like to
Dialogue: 0,0:02:55.41,0:02:57.16,Default,,0,0,0,,describe what the VR compositor
Dialogue: 0,0:02:57.16,0:02:57.86,Default,,0,0,0,,actually does.
Dialogue: 0,0:02:59.06,0:03:00.62,Default,,0,0,0,,So, in a nutshell, it distorts
Dialogue: 0,0:03:00.72,0:03:02.77,Default,,0,0,0,,the image that your app renders
Dialogue: 0,0:03:02.82,0:03:05.11,Default,,0,0,0,,to account for the lens optics
Dialogue: 0,0:03:05.11,0:03:06.16,Default,,0,0,0,,in the VR headset.
Dialogue: 0,0:03:07.19,0:03:08.53,Default,,0,0,0,,In this example, you can see the
Dialogue: 0,0:03:08.69,0:03:10.30,Default,,0,0,0,,barrel distortion that the
Dialogue: 0,0:03:10.30,0:03:12.11,Default,,0,0,0,,compositor is applying to
Dialogue: 0,0:03:12.11,0:03:13.52,Default,,0,0,0,,account for the pincushion
Dialogue: 0,0:03:13.52,0:03:14.68,Default,,0,0,0,,effect of the lenses.
Dialogue: 0,0:03:15.68,0:03:16.70,Default,,0,0,0,,Now, in practice, there's
Dialogue: 0,0:03:16.70,0:03:18.31,Default,,0,0,0,,actually a lot more complexity
Dialogue: 0,0:03:18.31,0:03:19.06,Default,,0,0,0,,under the covers.
Dialogue: 0,0:03:19.36,0:03:20.75,Default,,0,0,0,,And the compositor had to handle
Dialogue: 0,0:03:20.75,0:03:21.92,Default,,0,0,0,,things like chromatic
Dialogue: 0,0:03:21.92,0:03:24.32,Default,,0,0,0,,aberration, and also presenting
Dialogue: 0,0:03:24.32,0:03:26.18,Default,,0,0,0,,a Chaperone UI, so that
Dialogue: 0,0:03:26.21,0:03:28.15,Default,,0,0,0,,developers know the bounds of
Dialogue: 0,0:03:28.29,0:03:31.26,Default,,0,0,0,,their VR space.
Dialogue: 0,0:03:31.47,0:03:32.32,Default,,0,0,0,,All right.
Dialogue: 0,0:03:32.32,0:03:33.44,Default,,0,0,0,,Now, that you have built-in
Dialogue: 0,0:03:33.49,0:03:36.39,Default,,0,0,0,,support for a VR headset, a VR
Dialogue: 0,0:03:36.90,0:03:39.07,Default,,0,0,0,,compositor with SteamVR, and an
Dialogue: 0,0:03:39.07,0:03:41.30,Default,,0,0,0,,API to write to, let's dive
Dialogue: 0,0:03:41.40,0:03:42.98,Default,,0,0,0,,right into how you build a VR
Dialogue: 0,0:03:42.98,0:03:43.29,Default,,0,0,0,,app.
Dialogue: 0,0:03:44.76,0:03:46.10,Default,,0,0,0,,Well, we have two options.
Dialogue: 0,0:03:46.87,0:03:49.16,Default,,0,0,0,,You first, is to use an existing
Dialogue: 0,0:03:49.16,0:03:51.00,Default,,0,0,0,,game engine that has VR support.
Dialogue: 0,0:03:51.79,0:03:53.43,Default,,0,0,0,,This is a great option that many
Dialogue: 0,0:03:53.43,0:03:55.13,Default,,0,0,0,,developers prefer, because it
Dialogue: 0,0:03:55.13,0:03:56.57,Default,,0,0,0,,hides some of the complexities
Dialogue: 0,0:03:56.57,0:03:57.73,Default,,0,0,0,,of the VR compositor.
Dialogue: 0,0:03:58.46,0:04:00.36,Default,,0,0,0,,It also provides a familiar
Dialogue: 0,0:04:00.36,0:04:01.79,Default,,0,0,0,,content creation tool chain.
Dialogue: 0,0:04:03.16,0:04:04.92,Default,,0,0,0,,Now, your second option, is to
Dialogue: 0,0:04:04.92,0:04:06.91,Default,,0,0,0,,write a native VR app that calls
Dialogue: 0,0:04:06.91,0:04:08.11,Default,,0,0,0,,open VR, directly.
Dialogue: 0,0:04:08.93,0:04:10.77,Default,,0,0,0,,This gives your app full control
Dialogue: 0,0:04:11.09,0:04:12.72,Default,,0,0,0,,of rendering and synchronization
Dialogue: 0,0:04:12.72,0:04:13.76,Default,,0,0,0,,with the VR compositor.
Dialogue: 0,0:04:14.24,0:04:15.24,Default,,0,0,0,,But at the cost of some
Dialogue: 0,0:04:15.24,0:04:16.37,Default,,0,0,0,,additional complexity.
Dialogue: 0,0:04:16.94,0:04:19.91,Default,,0,0,0,,Which path you take depends on
Dialogue: 0,0:04:19.91,0:04:20.88,Default,,0,0,0,,the goals of your app.
Dialogue: 0,0:04:21.49,0:04:23.35,Default,,0,0,0,,Let's start by talking a bit
Dialogue: 0,0:04:23.85,0:04:24.95,Default,,0,0,0,,about the game engines.
Dialogue: 0,0:04:26.80,0:04:29.31,Default,,0,0,0,,So, you saw Epic's Unreal Engine
Dialogue: 0,0:04:29.43,0:04:31.32,Default,,0,0,0,,4 in action in the keynote, and
Dialogue: 0,0:04:31.32,0:04:32.98,Default,,0,0,0,,it's a powerful platform on
Dialogue: 0,0:04:32.98,0:04:34.07,Default,,0,0,0,,which to build your VR
Dialogue: 0,0:04:34.07,0:04:34.97,Default,,0,0,0,,experiences.
Dialogue: 0,0:04:36.25,0:04:38.42,Default,,0,0,0,,VR support will be coming later,
Dialogue: 0,0:04:38.42,0:04:40.68,Default,,0,0,0,,this year, and you can find
Dialogue: 0,0:04:40.68,0:04:42.65,Default,,0,0,0,,tutorials and other information
Dialogue: 0,0:04:42.65,0:04:43.59,Default,,0,0,0,,on Epic's website.
Dialogue: 0,0:04:44.97,0:04:46.66,Default,,0,0,0,,We're also really excited that
Dialogue: 0,0:04:46.70,0:04:48.94,Default,,0,0,0,,Unity is bringing VR support to
Dialogue: 0,0:04:48.94,0:04:50.60,Default,,0,0,0,,macOS in a future release of
Dialogue: 0,0:04:50.63,0:04:51.22,Default,,0,0,0,,their engine.
Dialogue: 0,0:04:51.90,0:04:53.12,Default,,0,0,0,,We've been working closely with
Dialogue: 0,0:04:53.12,0:04:54.30,Default,,0,0,0,,them to ensure that the engine
Dialogue: 0,0:04:54.30,0:04:56.27,Default,,0,0,0,,is optimized for both VR
Dialogue: 0,0:04:56.27,0:04:58.59,Default,,0,0,0,,playback and development using
Dialogue: 0,0:04:58.59,0:04:58.88,Default,,0,0,0,,Metal.
Dialogue: 0,0:05:02.08,0:05:03.40,Default,,0,0,0,,So, I'd like to take a moment,
Dialogue: 0,0:05:03.40,0:05:04.64,Default,,0,0,0,,at this point, to talk about a
Dialogue: 0,0:05:04.77,0:05:06.94,Default,,0,0,0,,specific Unity title called
Dialogue: 0,0:05:06.94,0:05:08.34,Default,,0,0,0,,Space Pirate Trainer.
Dialogue: 0,0:05:08.81,0:05:10.40,Default,,0,0,0,,So, we've been collaborating
Dialogue: 0,0:05:10.40,0:05:12.56,Default,,0,0,0,,with Unity and I-Illusions to
Dialogue: 0,0:05:12.56,0:05:14.60,Default,,0,0,0,,bring an early preview of Space
Dialogue: 0,0:05:14.67,0:05:16.20,Default,,0,0,0,,Pirate Trainer to macOS.
Dialogue: 0,0:05:16.92,0:05:19.84,Default,,0,0,0,,And the speed at with I-Illusion
Dialogue: 0,0:05:20.07,0:05:21.92,Default,,0,0,0,,was able to bring their app to
Dialogue: 0,0:05:21.92,0:05:23.18,Default,,0,0,0,,our platform was truly
Dialogue: 0,0:05:23.24,0:05:23.72,Default,,0,0,0,,astounding.
Dialogue: 0,0:05:23.72,0:05:25.92,Default,,0,0,0,,They had a working build in just
Dialogue: 0,0:05:25.92,0:05:28.54,Default,,0,0,0,,a few hours, then a stable fully
Dialogue: 0,0:05:28.54,0:05:30.39,Default,,0,0,0,,playable game in just a handful
Dialogue: 0,0:05:30.39,0:05:30.79,Default,,0,0,0,,of days.
Dialogue: 0,0:05:31.93,0:05:33.48,Default,,0,0,0,,We've been having tremendous fun
Dialogue: 0,0:05:33.57,0:05:35.17,Default,,0,0,0,,playing with this game, and
Dialogue: 0,0:05:35.21,0:05:36.34,Default,,0,0,0,,think that it's a great
Dialogue: 0,0:05:36.34,0:05:38.52,Default,,0,0,0,,representation of the type of VR
Dialogue: 0,0:05:38.52,0:05:39.89,Default,,0,0,0,,experience that you can build
Dialogue: 0,0:05:40.15,0:05:40.77,Default,,0,0,0,,with unity.
Dialogue: 0,0:05:42.18,0:05:43.17,Default,,0,0,0,,We hope you get a chance to
Dialogue: 0,0:05:43.17,0:05:44.14,Default,,0,0,0,,check it out at WWDC.
Dialogue: 0,0:05:44.14,0:05:45.94,Default,,0,0,0,,We think you'll love it, as
Dialogue: 0,0:05:45.94,0:05:46.23,Default,,0,0,0,,well.
Dialogue: 0,0:05:47.56,0:05:50.64,Default,,0,0,0,,So, Unity and Unreal Engine 4
Dialogue: 0,0:05:50.64,0:05:52.38,Default,,0,0,0,,are two great options for VR
Dialogue: 0,0:05:52.38,0:05:53.14,Default,,0,0,0,,development.
Dialogue: 0,0:05:54.54,0:05:56.54,Default,,0,0,0,,But you can, of course, choose
Dialogue: 0,0:05:56.54,0:05:58.14,Default,,0,0,0,,to write a native SteamVR app,
Dialogue: 0,0:05:58.50,0:05:59.76,Default,,0,0,0,,that calls the open VR
Dialogue: 0,0:05:59.85,0:06:00.77,Default,,0,0,0,,framework, directly.
Dialogue: 0,0:06:01.57,0:06:02.91,Default,,0,0,0,,Now, we'll have details on how
Dialogue: 0,0:06:02.91,0:06:04.00,Default,,0,0,0,,you can add the framework to
Dialogue: 0,0:06:04.00,0:06:05.76,Default,,0,0,0,,your app, later in the session.
Dialogue: 0,0:06:06.01,0:06:07.44,Default,,0,0,0,,But you can download binaries
Dialogue: 0,0:06:07.48,0:06:09.39,Default,,0,0,0,,and API documentation at the
Dialogue: 0,0:06:09.39,0:06:10.37,Default,,0,0,0,,OpenVR GitHub.
Dialogue: 0,0:06:12.78,0:06:14.29,Default,,0,0,0,,There'll also be a Metal
Dialogue: 0,0:06:14.35,0:06:16.42,Default,,0,0,0,,specific sample app available to
Dialogue: 0,0:06:16.42,0:06:17.79,Default,,0,0,0,,download in the near future.
Dialogue: 0,0:06:18.63,0:06:19.68,Default,,0,0,0,,But to give you a taste of
Dialogue: 0,0:06:19.68,0:06:21.56,Default,,0,0,0,,what's involved, I'd like to
Dialogue: 0,0:06:21.56,0:06:23.62,Default,,0,0,0,,now, provide a primer on VR app
Dialogue: 0,0:06:23.62,0:06:25.32,Default,,0,0,0,,development in a segment that I
Dialogue: 0,0:06:25.32,0:06:27.03,Default,,0,0,0,,like to call VR App Building
Dialogue: 0,0:06:27.03,0:06:27.53,Default,,0,0,0,,101.
Dialogue: 0,0:06:28.67,0:06:29.86,Default,,0,0,0,,So, we're going to cover a few
Dialogue: 0,0:06:29.86,0:06:30.36,Default,,0,0,0,,things, here.
Dialogue: 0,0:06:31.11,0:06:32.71,Default,,0,0,0,,We'll start with an overview of
Dialogue: 0,0:06:32.77,0:06:34.18,Default,,0,0,0,,some of the challenges involved
Dialogue: 0,0:06:34.18,0:06:35.25,Default,,0,0,0,,in VR development.
Dialogue: 0,0:06:36.50,0:06:38.38,Default,,0,0,0,,And then, talk a bit about some
Dialogue: 0,0:06:38.38,0:06:40.21,Default,,0,0,0,,unique considerations on our
Dialogue: 0,0:06:40.21,0:06:40.84,Default,,0,0,0,,platform.
Dialogue: 0,0:06:40.92,0:06:43.10,Default,,0,0,0,,And then, take a deep dive into
Dialogue: 0,0:06:43.10,0:06:45.31,Default,,0,0,0,,the anatomy of a VR frame.
Dialogue: 0,0:06:46.16,0:06:47.14,Default,,0,0,0,,And then, end with some best
Dialogue: 0,0:06:47.23,0:06:48.83,Default,,0,0,0,,practices specific to VR apps.
Dialogue: 0,0:06:50.33,0:06:51.25,Default,,0,0,0,,So, we've got a lot to cover,
Dialogue: 0,0:06:51.25,0:06:51.45,Default,,0,0,0,,here.
Dialogue: 0,0:06:51.64,0:06:53.07,Default,,0,0,0,,So, let's get started with the
Dialogue: 0,0:06:53.07,0:06:53.54,Default,,0,0,0,,overview.
Dialogue: 0,0:06:54.11,0:06:57.59,Default,,0,0,0,,So, a traditional non-VR work
Dialogue: 0,0:06:57.59,0:07:00.17,Default,,0,0,0,,load targeting a 60Hz display
Dialogue: 0,0:07:00.71,0:07:03.70,Default,,0,0,0,,has around 16.7 milliseconds to
Dialogue: 0,0:07:03.70,0:07:06.99,Default,,0,0,0,,do work for the frame.
Dialogue: 0,0:07:07.17,0:07:09.99,Default,,0,0,0,,And in many cases, the app has
Dialogue: 0,0:07:10.40,0:07:12.86,Default,,0,0,0,,the entire frame budget to do
Dialogue: 0,0:07:12.86,0:07:14.02,Default,,0,0,0,,work on the GPU.
Dialogue: 0,0:07:14.57,0:07:17.27,Default,,0,0,0,,A VR workload, on the other
Dialogue: 0,0:07:17.33,0:07:19.66,Default,,0,0,0,,hand, has to target a 90 frame
Dialogue: 0,0:07:19.66,0:07:20.68,Default,,0,0,0,,per second display.
Dialogue: 0,0:07:20.68,0:07:22.77,Default,,0,0,0,,And it needs to hit this target
Dialogue: 0,0:07:22.81,0:07:24.69,Default,,0,0,0,,to achieve a smooth stutter-free
Dialogue: 0,0:07:24.69,0:07:26.45,Default,,0,0,0,,experience on a headset like the
Dialogue: 0,0:07:26.45,0:07:26.81,Default,,0,0,0,,Vive.
Dialogue: 0,0:07:27.76,0:07:29.19,Default,,0,0,0,,So, this reduces the available
Dialogue: 0,0:07:29.19,0:07:31.12,Default,,0,0,0,,frame budget to around 11
Dialogue: 0,0:07:31.12,0:07:31.89,Default,,0,0,0,,milliseconds.
Dialogue: 0,0:07:33.28,0:07:35.19,Default,,0,0,0,,Additionally, the VR compositor
Dialogue: 0,0:07:35.19,0:07:37.30,Default,,0,0,0,,has to do work on the GPU to
Dialogue: 0,0:07:37.30,0:07:39.14,Default,,0,0,0,,prepare the frame for the VR
Dialogue: 0,0:07:39.14,0:07:39.62,Default,,0,0,0,,headset.
Dialogue: 0,0:07:40.72,0:07:42.14,Default,,0,0,0,,This can take up to 1
Dialogue: 0,0:07:42.14,0:07:44.27,Default,,0,0,0,,millisecond, leaving you app an
Dialogue: 0,0:07:44.27,0:07:46.45,Default,,0,0,0,,effective frame time budget of
Dialogue: 0,0:07:46.45,0:07:48.03,Default,,0,0,0,,around 10 milliseconds.
Dialogue: 0,0:07:48.80,0:07:51.73,Default,,0,0,0,,Which is about 60% of the non-VR
Dialogue: 0,0:07:51.73,0:07:52.04,Default,,0,0,0,,case.
Dialogue: 0,0:07:52.78,0:07:55.64,Default,,0,0,0,,And if that wasn't enough, your
Dialogue: 0,0:07:55.64,0:07:57.66,Default,,0,0,0,,app also has to do more work
Dialogue: 0,0:07:57.66,0:07:58.28,Default,,0,0,0,,every frame.
Dialogue: 0,0:07:59.31,0:08:01.26,Default,,0,0,0,,This includes stereo rendering
Dialogue: 0,0:08:01.56,0:08:03.11,Default,,0,0,0,,for the left and right eye.
Dialogue: 0,0:08:04.10,0:08:05.79,Default,,0,0,0,,And also, rendering to a higher
Dialogue: 0,0:08:05.79,0:08:07.42,Default,,0,0,0,,resolution, in many cases.
Dialogue: 0,0:08:08.48,0:08:10.09,Default,,0,0,0,,The Vive headset has a
Dialogue: 0,0:08:10.09,0:08:12.84,Default,,0,0,0,,resolution of 2160 x 1200.
Dialogue: 0,0:08:13.19,0:08:15.48,Default,,0,0,0,,That's 25% more pixels than a
Dialogue: 0,0:08:15.48,0:08:16.59,Default,,0,0,0,,1080 display.
Dialogue: 0,0:08:17.58,0:08:19.68,Default,,0,0,0,,Additionally, many VR apps
Dialogue: 0,0:08:19.68,0:08:22.70,Default,,0,0,0,,render at a 1.2 to 1.4 X scale
Dialogue: 0,0:08:22.75,0:08:24.22,Default,,0,0,0,,factor to further improve
Dialogue: 0,0:08:24.22,0:08:24.78,Default,,0,0,0,,quality.
Dialogue: 0,0:08:25.37,0:08:28.32,Default,,0,0,0,,So, in summary, your app has a
Dialogue: 0,0:08:28.32,0:08:30.25,Default,,0,0,0,,lot more work to do in less
Dialogue: 0,0:08:30.34,0:08:30.63,Default,,0,0,0,,time.
Dialogue: 0,0:08:31.53,0:08:32.65,Default,,0,0,0,,Welcome to VR development.
Dialogue: 0,0:08:34.60,0:08:35.19,Default,,0,0,0,,All right.
Dialogue: 0,0:08:35.19,0:08:36.54,Default,,0,0,0,,Let's talk about some platform
Dialogue: 0,0:08:36.54,0:08:37.34,Default,,0,0,0,,specifics.
Dialogue: 0,0:08:38.34,0:08:40.54,Default,,0,0,0,,So, Metal 2 introduces a new
Dialogue: 0,0:08:40.54,0:08:42.81,Default,,0,0,0,,Direct to Display capability for
Dialogue: 0,0:08:42.81,0:08:44.17,Default,,0,0,0,,supported headsets like the
Dialogue: 0,0:08:44.17,0:08:44.60,Default,,0,0,0,,Vive.
Dialogue: 0,0:08:45.48,0:08:47.89,Default,,0,0,0,,This is a low latency path that
Dialogue: 0,0:08:47.93,0:08:49.45,Default,,0,0,0,,bypasses the OS window
Dialogue: 0,0:08:49.45,0:08:51.38,Default,,0,0,0,,compositor, and gives the VR
Dialogue: 0,0:08:51.38,0:08:54.26,Default,,0,0,0,,compositor, like SteamVR, the
Dialogue: 0,0:08:54.26,0:08:55.90,Default,,0,0,0,,direct ability to present a
Dialogue: 0,0:08:55.90,0:08:57.65,Default,,0,0,0,,surface onto the VR headset.
Dialogue: 0,0:08:58.33,0:09:00.15,Default,,0,0,0,,This avoids any pixel processing
Dialogue: 0,0:09:00.15,0:09:03.55,Default,,0,0,0,,or additional copies by the OS.
Dialogue: 0,0:09:03.81,0:09:05.28,Default,,0,0,0,,Now, it's worth noting that in
Dialogue: 0,0:09:05.35,0:09:06.93,Default,,0,0,0,,order to guarantee this fast
Dialogue: 0,0:09:07.00,0:09:09.85,Default,,0,0,0,,path, that macOS does not treat
Dialogue: 0,0:09:09.90,0:09:11.37,Default,,0,0,0,,VR headsets as displays.
Dialogue: 0,0:09:11.96,0:09:13.15,Default,,0,0,0,,They're hidden from the system
Dialogue: 0,0:09:13.29,0:09:15.38,Default,,0,0,0,,and offer no extended desktop
Dialogue: 0,0:09:15.38,0:09:16.06,Default,,0,0,0,,capabilities.
Dialogue: 0,0:09:16.75,0:09:20.68,Default,,0,0,0,,So, to summarize, we move from a
Dialogue: 0,0:09:20.68,0:09:22.98,Default,,0,0,0,,model where you can present or
Dialogue: 0,0:09:23.52,0:09:25.28,Default,,0,0,0,,an app presents to a display
Dialogue: 0,0:09:25.37,0:09:26.34,Default,,0,0,0,,through the OS window
Dialogue: 0,0:09:26.34,0:09:27.03,Default,,0,0,0,,compositor.
Dialogue: 0,0:09:28.32,0:09:30.09,Default,,0,0,0,,To one where a VR app can
Dialogue: 0,0:09:30.14,0:09:32.46,Default,,0,0,0,,present to a headset directly
Dialogue: 0,0:09:32.50,0:09:33.76,Default,,0,0,0,,through the VR compositor.
Dialogue: 0,0:09:34.57,0:09:36.45,Default,,0,0,0,,And that's our Direct to Display
Dialogue: 0,0:09:36.52,0:09:39.72,Default,,0,0,0,,capability for VR with Metal 2.
Dialogue: 0,0:09:41.42,0:09:41.98,Default,,0,0,0,,All right.
Dialogue: 0,0:09:42.21,0:09:43.56,Default,,0,0,0,,Keeping with the theme of macOS
Dialogue: 0,0:09:43.62,0:09:46.13,Default,,0,0,0,,platform specifics, let's talk a
Dialogue: 0,0:09:46.13,0:09:48.03,Default,,0,0,0,,bit about how your app selects a
Dialogue: 0,0:09:48.03,0:09:49.30,Default,,0,0,0,,Metal device to use.
Dialogue: 0,0:09:50.28,0:09:52.27,Default,,0,0,0,,So, in macOS, the VR compositor
Dialogue: 0,0:09:52.32,0:09:54.55,Default,,0,0,0,,can query the OS to find the
Dialogue: 0,0:09:54.55,0:09:57.01,Default,,0,0,0,,Metal device for the GPU that
Dialogue: 0,0:09:57.01,0:09:58.35,Default,,0,0,0,,the headset is attached to.
Dialogue: 0,0:09:59.56,0:10:00.79,Default,,0,0,0,,And for performance reasons,
Dialogue: 0,0:10:01.36,0:10:02.78,Default,,0,0,0,,your app will want to select the
Dialogue: 0,0:10:02.78,0:10:04.77,Default,,0,0,0,,same device that the compositor
Dialogue: 0,0:10:04.77,0:10:04.98,Default,,0,0,0,,is using.
Dialogue: 0,0:10:06.27,0:10:07.23,Default,,0,0,0,,So, we've worked with Valve to
Dialogue: 0,0:10:07.23,0:10:08.48,Default,,0,0,0,,make sure that there's an API to
Dialogue: 0,0:10:08.48,0:10:10.57,Default,,0,0,0,,do this, simply called
Dialogue: 0,0:10:10.86,0:10:13.19,Default,,0,0,0,,GetOutputDevice to get the Metal
Dialogue: 0,0:10:13.19,0:10:14.27,Default,,0,0,0,,device that you should render
Dialogue: 0,0:10:14.27,0:10:14.51,Default,,0,0,0,,to.
Dialogue: 0,0:10:14.88,0:10:15.49,Default,,0,0,0,,It's that simple.
Dialogue: 0,0:10:18.49,0:10:20.42,Default,,0,0,0,,Now, let's talk about managing
Dialogue: 0,0:10:20.42,0:10:22.24,Default,,0,0,0,,drawable surfaces on macOS.
Dialogue: 0,0:10:23.58,0:10:25.38,Default,,0,0,0,,So, the VR compositor and your
Dialogue: 0,0:10:25.38,0:10:28.13,Default,,0,0,0,,app each maintain separate pools
Dialogue: 0,0:10:28.40,0:10:29.58,Default,,0,0,0,,of drawable surfaces.
Dialogue: 0,0:10:30.20,0:10:32.28,Default,,0,0,0,,And in a typical frame your app
Dialogue: 0,0:10:32.56,0:10:34.18,Default,,0,0,0,,will render to textures that it
Dialogue: 0,0:10:34.18,0:10:36.93,Default,,0,0,0,,owns, submit these to the VR
Dialogue: 0,0:10:36.93,0:10:37.74,Default,,0,0,0,,compositor.
Dialogue: 0,0:10:38.81,0:10:40.67,Default,,0,0,0,,These will get composited onto a
Dialogue: 0,0:10:40.67,0:10:42.19,Default,,0,0,0,,surface that the compositor
Dialogue: 0,0:10:42.19,0:10:44.08,Default,,0,0,0,,owns, and that's the surface
Dialogue: 0,0:10:44.08,0:10:45.25,Default,,0,0,0,,that'll get presented to the
Dialogue: 0,0:10:45.25,0:10:45.77,Default,,0,0,0,,headset.
Dialogue: 0,0:10:47.01,0:10:49.72,Default,,0,0,0,,And on macOS, IO surfaces are
Dialogue: 0,0:10:49.72,0:10:51.38,Default,,0,0,0,,ideal for transferring this
Dialogue: 0,0:10:51.56,0:10:53.50,Default,,0,0,0,,rendered data from your app to
Dialogue: 0,0:10:53.50,0:10:54.29,Default,,0,0,0,,the compositor.
Dialogue: 0,0:10:54.82,0:10:56.35,Default,,0,0,0,,So, make sure that you create
Dialogue: 0,0:10:56.35,0:10:58.07,Default,,0,0,0,,Metal textures that are backed
Dialogue: 0,0:10:58.42,0:10:59.57,Default,,0,0,0,,by IO surfaces.
Dialogue: 0,0:11:01.08,0:11:02.60,Default,,0,0,0,,As a refresher, let's take a
Dialogue: 0,0:11:02.66,0:11:03.93,Default,,0,0,0,,quick look at how you create
Dialogue: 0,0:11:03.93,0:11:04.61,Default,,0,0,0,,those textures.
Dialogue: 0,0:11:06.62,0:11:08.05,Default,,0,0,0,,So, you'll want to build a
Dialogue: 0,0:11:08.16,0:11:09.77,Default,,0,0,0,,texture descriptor that
Dialogue: 0,0:11:09.77,0:11:11.44,Default,,0,0,0,,specifies the Render Target
Dialogue: 0,0:11:11.48,0:11:13.27,Default,,0,0,0,,Usage flag, since your app will
Dialogue: 0,0:11:13.27,0:11:14.41,Default,,0,0,0,,be rendering into it.
Dialogue: 0,0:11:15.28,0:11:17.42,Default,,0,0,0,,But also, the Shader Read Usage
Dialogue: 0,0:11:17.42,0:11:17.77,Default,,0,0,0,,flag.
Dialogue: 0,0:11:18.15,0:11:19.34,Default,,0,0,0,,Since the compositor will be
Dialogue: 0,0:11:19.43,0:11:20.93,Default,,0,0,0,,sourcing it as an input.
Dialogue: 0,0:11:21.41,0:11:24.73,Default,,0,0,0,,And then, to create your left
Dialogue: 0,0:11:24.95,0:11:26.98,Default,,0,0,0,,and right eye Textures, you
Dialogue: 0,0:11:27.07,0:11:29.97,Default,,0,0,0,,simply pass IO surfaces that you
Dialogue: 0,0:11:29.97,0:11:31.59,Default,,0,0,0,,previously allocated and this
Dialogue: 0,0:11:31.63,0:11:33.10,Default,,0,0,0,,Texture descriptor to
Dialogue: 0,0:11:33.10,0:11:34.70,Default,,0,0,0,,newTextureWithDescriptor.
Dialogue: 0,0:11:35.37,0:11:35.60,Default,,0,0,0,,All right.
Dialogue: 0,0:11:35.72,0:11:36.79,Default,,0,0,0,,I'd like to now, take a few
Dialogue: 0,0:11:36.79,0:11:39.27,Default,,0,0,0,,minutes to talk or to describe a
Dialogue: 0,0:11:39.27,0:11:40.68,Default,,0,0,0,,typical frame in a VR app.
Dialogue: 0,0:11:41.58,0:11:43.08,Default,,0,0,0,,This is important, because your
Dialogue: 0,0:11:43.08,0:11:45.09,Default,,0,0,0,,app and the VR compositor need
Dialogue: 0,0:11:45.09,0:11:46.38,Default,,0,0,0,,to work in lock step.
Dialogue: 0,0:11:47.44,0:11:49.19,Default,,0,0,0,,As I noted before, the rendered
Dialogue: 0,0:11:49.19,0:11:50.83,Default,,0,0,0,,output of your app will be
Dialogue: 0,0:11:50.83,0:11:53.10,Default,,0,0,0,,passed to the VR compositor for
Dialogue: 0,0:11:53.10,0:11:54.34,Default,,0,0,0,,additional processing on the
Dialogue: 0,0:11:54.34,0:11:54.93,Default,,0,0,0,,GPU.
Dialogue: 0,0:11:55.73,0:11:57.76,Default,,0,0,0,,And since the GPU is a shared
Dialogue: 0,0:11:57.81,0:12:00.60,Default,,0,0,0,,resource, synchronization and
Dialogue: 0,0:12:00.60,0:12:02.49,Default,,0,0,0,,when work is scheduled matters.
Dialogue: 0,0:12:03.09,0:12:05.44,Default,,0,0,0,,So, let's start at the beginning
Dialogue: 0,0:12:05.44,0:12:06.03,Default,,0,0,0,,of the frame.
Dialogue: 0,0:12:06.95,0:12:08.71,Default,,0,0,0,,Your app will need to query the
Dialogue: 0,0:12:08.71,0:12:10.51,Default,,0,0,0,,VR system to get the headset
Dialogue: 0,0:12:10.51,0:12:12.20,Default,,0,0,0,,poses that it needs to render
Dialogue: 0,0:12:12.20,0:12:12.75,Default,,0,0,0,,the frame.
Dialogue: 0,0:12:13.94,0:12:15.77,Default,,0,0,0,,For SteamVr, this is done by the
Dialogue: 0,0:12:15.87,0:12:17.32,Default,,0,0,0,,WaitGetPoses call.
Dialogue: 0,0:12:18.37,0:12:20.41,Default,,0,0,0,,And then, your app can encode
Dialogue: 0,0:12:20.41,0:12:22.12,Default,,0,0,0,,the rendered commands for that
Dialogue: 0,0:12:22.25,0:12:24.25,Default,,0,0,0,,frame immediately after getting
Dialogue: 0,0:12:24.25,0:12:24.95,Default,,0,0,0,,those inputs.
Dialogue: 0,0:12:25.54,0:12:28.41,Default,,0,0,0,,And then, once you've encoded
Dialogue: 0,0:12:28.41,0:12:30.14,Default,,0,0,0,,your command buffer, you can
Dialogue: 0,0:12:30.18,0:12:31.84,Default,,0,0,0,,commit it to Metal to queue onto
Dialogue: 0,0:12:31.84,0:12:32.58,Default,,0,0,0,,the GPU.
Dialogue: 0,0:12:33.15,0:12:35.30,Default,,0,0,0,,And then, submit your left and
Dialogue: 0,0:12:35.30,0:12:37.96,Default,,0,0,0,,right eye textures to SteamVR.
Dialogue: 0,0:12:38.95,0:12:40.67,Default,,0,0,0,,This'll wake the compositor so
Dialogue: 0,0:12:40.67,0:12:42.61,Default,,0,0,0,,it can start encoding its GPU
Dialogue: 0,0:12:42.61,0:12:43.90,Default,,0,0,0,,work for the frame.
Dialogue: 0,0:12:44.48,0:12:46.98,Default,,0,0,0,,And then, since ordered
Dialogue: 0,0:12:46.98,0:12:49.29,Default,,0,0,0,,execution matters, your app will
Dialogue: 0,0:12:49.29,0:12:50.82,Default,,0,0,0,,also need to signal the VR
Dialogue: 0,0:12:50.82,0:12:53.53,Default,,0,0,0,,compositor when work that is
Dialogue: 0,0:12:53.60,0:12:54.90,Default,,0,0,0,,sent to the GPU has been
Dialogue: 0,0:12:54.90,0:12:55.44,Default,,0,0,0,,scheduled.
Dialogue: 0,0:12:56.66,0:12:58.57,Default,,0,0,0,,So, for a Metal SteamVR app, you
Dialogue: 0,0:12:58.65,0:13:00.71,Default,,0,0,0,,simply wait until your command
Dialogue: 0,0:13:00.71,0:13:02.75,Default,,0,0,0,,buffer has been scheduled, and
Dialogue: 0,0:13:02.75,0:13:04.50,Default,,0,0,0,,then, you can call the SteamVR
Dialogue: 0,0:13:04.50,0:13:06.41,Default,,0,0,0,,PostPresentHandoff function.
Dialogue: 0,0:13:07.14,0:13:08.89,Default,,0,0,0,,This'll signal the VR compositor
Dialogue: 0,0:13:09.14,0:13:10.73,Default,,0,0,0,,that it can commit its work to
Dialogue: 0,0:13:10.73,0:13:13.03,Default,,0,0,0,,the GPU and it'll get queued up
Dialogue: 0,0:13:13.48,0:13:14.37,Default,,0,0,0,,in the right order.
Dialogue: 0,0:13:14.37,0:13:16.89,Default,,0,0,0,,So, let's see what that would
Dialogue: 0,0:13:16.89,0:13:18.35,Default,,0,0,0,,look like in your draw loop.
Dialogue: 0,0:13:18.71,0:13:20.28,Default,,0,0,0,,So, at the top of your loop
Dialogue: 0,0:13:20.69,0:13:22.01,Default,,0,0,0,,you'd have your WaitGetPoses
Dialogue: 0,0:13:22.01,0:13:23.88,Default,,0,0,0,,call, to gather the inputs from
Dialogue: 0,0:13:23.88,0:13:24.40,Default,,0,0,0,,the headset.
Dialogue: 0,0:13:25.66,0:13:27.20,Default,,0,0,0,,You then, build your command
Dialogue: 0,0:13:27.20,0:13:29.54,Default,,0,0,0,,buffer to render your scene and
Dialogue: 0,0:13:29.54,0:13:30.71,Default,,0,0,0,,commit it to the GPU.
Dialogue: 0,0:13:31.83,0:13:33.15,Default,,0,0,0,,And then, at this point, you'll
Dialogue: 0,0:13:33.24,0:13:35.09,Default,,0,0,0,,submit your left and right eye
Dialogue: 0,0:13:35.19,0:13:36.58,Default,,0,0,0,,textures to SteamVR.
Dialogue: 0,0:13:37.91,0:13:39.88,Default,,0,0,0,,And then, once you've waited for
Dialogue: 0,0:13:39.88,0:13:40.80,Default,,0,0,0,,that command buffer to be
Dialogue: 0,0:13:40.84,0:13:43.47,Default,,0,0,0,,scheduled, you can call
Dialogue: 0,0:13:43.47,0:13:45.09,Default,,0,0,0,,PostPresentHandoff to tell the
Dialogue: 0,0:13:45.09,0:13:47.23,Default,,0,0,0,,VR compositor that it's now free
Dialogue: 0,0:13:47.46,0:13:49.97,Default,,0,0,0,,to commit work to the GPU, as
Dialogue: 0,0:13:50.86,0:13:51.02,Default,,0,0,0,,well.
Dialogue: 0,0:13:51.93,0:13:53.50,Default,,0,0,0,,So, one more note before I move
Dialogue: 0,0:13:53.50,0:13:53.73,Default,,0,0,0,,on.
Dialogue: 0,0:13:55.06,0:13:57.05,Default,,0,0,0,,It's worth noting that as we
Dialogue: 0,0:13:57.05,0:13:58.49,Default,,0,0,0,,extend this diagram to include
Dialogue: 0,0:13:58.49,0:14:00.68,Default,,0,0,0,,the next frame, it's
Dialogue: 0,0:14:00.99,0:14:04.09,Default,,0,0,0,,WaitGetPoses and not the
Dialogue: 0,0:14:04.20,0:14:06.56,Default,,0,0,0,,vertical blank that defines the
Dialogue: 0,0:14:06.56,0:14:08.05,Default,,0,0,0,,start of the frame for your app.
Dialogue: 0,0:14:08.90,0:14:09.96,Default,,0,0,0,,This is an important thing to
Dialogue: 0,0:14:09.96,0:14:11.03,Default,,0,0,0,,keep in mind, and we'll be
Dialogue: 0,0:14:11.03,0:14:12.12,Default,,0,0,0,,coming back to this, very
Dialogue: 0,0:14:12.12,0:14:12.56,Default,,0,0,0,,shortly.
Dialogue: 0,0:14:13.14,0:14:15.02,Default,,0,0,0,,All right.
Dialogue: 0,0:14:15.99,0:14:17.40,Default,,0,0,0,,Let's move on to talk about some
Dialogue: 0,0:14:17.40,0:14:18.42,Default,,0,0,0,,best practices.
Dialogue: 0,0:14:19.03,0:14:22.63,Default,,0,0,0,,So, the first is to avoid
Dialogue: 0,0:14:22.63,0:14:24.60,Default,,0,0,0,,introducing a GPU bubble at the
Dialogue: 0,0:14:24.60,0:14:26.15,Default,,0,0,0,,start of your frame, while
Dialogue: 0,0:14:26.15,0:14:27.84,Default,,0,0,0,,encoding commands on the CPU.
Dialogue: 0,0:14:29.04,0:14:31.65,Default,,0,0,0,,So, helpfully, SteamVR offers a
Dialogue: 0,0:14:31.65,0:14:33.22,Default,,0,0,0,,useful mechanism to let you
Dialogue: 0,0:14:33.22,0:14:35.21,Default,,0,0,0,,start work for that frame early,
Dialogue: 0,0:14:35.63,0:14:37.22,Default,,0,0,0,,by giving your app a two to
Dialogue: 0,0:14:37.28,0:14:38.86,Default,,0,0,0,,three millisecond running start.
Dialogue: 0,0:14:40.29,0:14:41.23,Default,,0,0,0,,So, his should look very
Dialogue: 0,0:14:41.28,0:14:41.79,Default,,0,0,0,,familiar.
Dialogue: 0,0:14:42.46,0:14:43.84,Default,,0,0,0,,By aligning the start of your
Dialogue: 0,0:14:43.84,0:14:46.13,Default,,0,0,0,,frame with WaitGetPoses, you'll
Dialogue: 0,0:14:46.13,0:14:47.42,Default,,0,0,0,,ensure that you're taking
Dialogue: 0,0:14:47.42,0:14:48.97,Default,,0,0,0,,advantage of this optimization
Dialogue: 0,0:14:49.23,0:14:50.58,Default,,0,0,0,,and getting that running start.
Dialogue: 0,0:14:54.08,0:14:54.64,Default,,0,0,0,,All right.
Dialogue: 0,0:14:54.72,0:14:57.08,Default,,0,0,0,,Next, make sure that your app is
Dialogue: 0,0:14:57.08,0:14:59.15,Default,,0,0,0,,not building large monolithic
Dialogue: 0,0:14:59.20,0:15:00.40,Default,,0,0,0,,command buffers before
Dialogue: 0,0:15:00.40,0:15:02.15,Default,,0,0,0,,committing them to the GPU, as
Dialogue: 0,0:15:02.15,0:15:03.94,Default,,0,0,0,,this can also introduce GPU
Dialogue: 0,0:15:03.94,0:15:04.46,Default,,0,0,0,,bubbles.
Dialogue: 0,0:15:05.50,0:15:07.97,Default,,0,0,0,,Instead, you want to split your
Dialogue: 0,0:15:07.97,0:15:09.42,Default,,0,0,0,,command buffers where possible
Dialogue: 0,0:15:09.66,0:15:11.21,Default,,0,0,0,,and commit them as you go, to
Dialogue: 0,0:15:11.21,0:15:13.47,Default,,0,0,0,,maximize GPU utilization in the
Dialogue: 0,0:15:13.47,0:15:13.87,Default,,0,0,0,,frame.
Dialogue: 0,0:15:14.41,0:15:18.25,Default,,0,0,0,,So, the next optimization that
Dialogue: 0,0:15:18.25,0:15:19.89,Default,,0,0,0,,we recommend is to try and
Dialogue: 0,0:15:19.96,0:15:22.05,Default,,0,0,0,,coalesce your left and right eye
Dialogue: 0,0:15:22.05,0:15:22.85,Default,,0,0,0,,draws, together.
Dialogue: 0,0:15:25.04,0:15:26.84,Default,,0,0,0,,The Metal 2 Viewport Array
Dialogue: 0,0:15:26.84,0:15:28.30,Default,,0,0,0,,feature provides a great
Dialogue: 0,0:15:28.30,0:15:30.30,Default,,0,0,0,,mechanism for you to do this, by
Dialogue: 0,0:15:30.30,0:15:32.04,Default,,0,0,0,,letting your app select a per
Dialogue: 0,0:15:32.10,0:15:34.18,Default,,0,0,0,,primitive destination viewport
Dialogue: 0,0:15:34.60,0:15:35.55,Default,,0,0,0,,in the vertex shader.
Dialogue: 0,0:15:36.33,0:15:37.80,Default,,0,0,0,,This can substantially reduce
Dialogue: 0,0:15:37.80,0:15:39.67,Default,,0,0,0,,your draw call overhead, as you
Dialogue: 0,0:15:39.67,0:15:41.26,Default,,0,0,0,,can now render to both the left
Dialogue: 0,0:15:41.92,0:15:43.63,Default,,0,0,0,,and the right eye with a single
Dialogue: 0,0:15:43.63,0:15:44.19,Default,,0,0,0,,draw call.
Dialogue: 0,0:15:45.39,0:15:46.73,Default,,0,0,0,,So, let's take a look at an
Dialogue: 0,0:15:46.73,0:15:48.30,Default,,0,0,0,,example of how you can adopt
Dialogue: 0,0:15:48.68,0:15:50.24,Default,,0,0,0,,Viewport Array for your Metal
Dialogue: 0,0:15:50.24,0:15:51.75,Default,,0,0,0,,app using instancing.
Dialogue: 0,0:15:53.14,0:15:54.02,Default,,0,0,0,,So, the first thing I want to
Dialogue: 0,0:15:54.02,0:15:55.62,Default,,0,0,0,,point out is that you'll need to
Dialogue: 0,0:15:55.62,0:15:57.45,Default,,0,0,0,,create a texture that's twice as
Dialogue: 0,0:15:57.45,0:15:58.96,Default,,0,0,0,,wide, because you'll now be
Dialogue: 0,0:15:58.96,0:16:00.36,Default,,0,0,0,,rendering both the left and
Dialogue: 0,0:16:00.36,0:16:02.27,Default,,0,0,0,,right eye scene to the same
Dialogue: 0,0:16:02.44,0:16:02.91,Default,,0,0,0,,texture.
Dialogue: 0,0:16:03.84,0:16:05.77,Default,,0,0,0,,And then, you simply create your
Dialogue: 0,0:16:05.77,0:16:07.39,Default,,0,0,0,,Viewpoint array that defines the
Dialogue: 0,0:16:07.39,0:16:10.03,Default,,0,0,0,,bounds for your left and your
Dialogue: 0,0:16:10.03,0:16:11.60,Default,,0,0,0,,right eye viewports.
Dialogue: 0,0:16:12.79,0:16:13.91,Default,,0,0,0,,And then, you can pass this
Dialogue: 0,0:16:13.95,0:16:15.22,Default,,0,0,0,,Viewport array to your render
Dialogue: 0,0:16:15.22,0:16:16.98,Default,,0,0,0,,commanding coder using the new
Dialogue: 0,0:16:17.42,0:16:18.43,Default,,0,0,0,,setViewports API.
Dialogue: 0,0:16:19.59,0:16:20.59,Default,,0,0,0,,And then, at this point, you'll
Dialogue: 0,0:16:20.59,0:16:21.83,Default,,0,0,0,,want to make an instance to
Dialogue: 0,0:16:21.98,0:16:23.71,Default,,0,0,0,,DrawPrimitives call with an
Dialogue: 0,0:16:23.77,0:16:26.29,Default,,0,0,0,,instance count of 2 to issue the
Dialogue: 0,0:16:26.29,0:16:27.37,Default,,0,0,0,,draw to your left and right
Dialogue: 0,0:16:27.42,0:16:28.07,Default,,0,0,0,,Viewports.
Dialogue: 0,0:16:29.29,0:16:31.05,Default,,0,0,0,,We'll be using the instance ID
Dialogue: 0,0:16:31.37,0:16:33.84,Default,,0,0,0,,as our eye index in the vertex
Dialogue: 0,0:16:33.84,0:16:34.15,Default,,0,0,0,,shader.
Dialogue: 0,0:16:35.29,0:16:36.14,Default,,0,0,0,,So, let's take a look at that
Dialogue: 0,0:16:36.14,0:16:36.79,Default,,0,0,0,,vertex shader.
Dialogue: 0,0:16:37.41,0:16:39.54,Default,,0,0,0,,So, the first thing I want to
Dialogue: 0,0:16:39.54,0:16:42.13,Default,,0,0,0,,point out is that the viewport
Dialogue: 0,0:16:42.46,0:16:44.10,Default,,0,0,0,,is selected by the new viewport
Dialogue: 0,0:16:44.32,0:16:45.44,Default,,0,0,0,,underscore array underscore
Dialogue: 0,0:16:45.44,0:16:46.28,Default,,0,0,0,,index attribute.
Dialogue: 0,0:16:47.76,0:16:49.28,Default,,0,0,0,,And then, as I previously noted,
Dialogue: 0,0:16:49.41,0:16:50.17,Default,,0,0,0,,we're using the instance
Dialogue: 0,0:16:50.17,0:16:52.49,Default,,0,0,0,,underscore id as our eye index.
Dialogue: 0,0:16:52.83,0:16:54.19,Default,,0,0,0,,And we'll be able to use it to
Dialogue: 0,0:16:54.19,0:16:56.42,Default,,0,0,0,,access our viewport dependent
Dialogue: 0,0:16:56.42,0:16:57.94,Default,,0,0,0,,data like this model view
Dialogue: 0,0:16:57.97,0:16:59.65,Default,,0,0,0,,projection matrix in this
Dialogue: 0,0:16:59.65,0:17:00.18,Default,,0,0,0,,example.
Dialogue: 0,0:17:00.72,0:17:03.17,Default,,0,0,0,,And then, finally, you do want
Dialogue: 0,0:17:03.17,0:17:05.01,Default,,0,0,0,,to associate your viewport index
Dialogue: 0,0:17:05.48,0:17:06.71,Default,,0,0,0,,with the instance underscore id
Dialogue: 0,0:17:06.75,0:17:08.01,Default,,0,0,0,,so that the right viewport is
Dialogue: 0,0:17:08.07,0:17:10.06,Default,,0,0,0,,selected when rasterizing your
Dialogue: 0,0:17:10.06,0:17:10.44,Default,,0,0,0,,image.
Dialogue: 0,0:17:11.47,0:17:13.47,Default,,0,0,0,,And that's how you use the new
Dialogue: 0,0:17:13.47,0:17:15.29,Default,,0,0,0,,Viewport Array feature to reduce
Dialogue: 0,0:17:15.35,0:17:17.91,Default,,0,0,0,,the draw call cost in your VR
Dialogue: 0,0:17:18.86,0:17:18.98,Default,,0,0,0,,apps.
Dialogue: 0,0:17:20.30,0:17:20.85,Default,,0,0,0,,All right.
Dialogue: 0,0:17:21.01,0:17:22.39,Default,,0,0,0,,The final optimization that I
Dialogue: 0,0:17:22.39,0:17:24.01,Default,,0,0,0,,want to talk about, today, is
Dialogue: 0,0:17:24.07,0:17:25.47,Default,,0,0,0,,really a general best practice.
Dialogue: 0,0:17:25.47,0:17:27.41,Default,,0,0,0,,You want to try and reduce the
Dialogue: 0,0:17:27.41,0:17:29.72,Default,,0,0,0,,number of pixels that you're
Dialogue: 0,0:17:29.72,0:17:30.88,Default,,0,0,0,,shading every frame.
Dialogue: 0,0:17:31.41,0:17:33.24,Default,,0,0,0,,So, due to the nature of the
Dialogue: 0,0:17:33.24,0:17:35.82,Default,,0,0,0,,lens warp, about 15% of your
Dialogue: 0,0:17:35.82,0:17:37.88,Default,,0,0,0,,rendered scene is not actually
Dialogue: 0,0:17:37.88,0:17:39.39,Default,,0,0,0,,visible on the VR headset.
Dialogue: 0,0:17:40.14,0:17:41.63,Default,,0,0,0,,This is represented by the blue
Dialogue: 0,0:17:41.63,0:17:42.59,Default,,0,0,0,,regions in this image.
Dialogue: 0,0:17:43.54,0:17:45.98,Default,,0,0,0,,Luckily, SteamVR offers a mesh
Dialogue: 0,0:17:46.06,0:17:47.79,Default,,0,0,0,,based stencil mask that is
Dialogue: 0,0:17:47.87,0:17:49.47,Default,,0,0,0,,specific to the Vive headset
Dialogue: 0,0:17:49.63,0:17:51.01,Default,,0,0,0,,that you can use to cull these
Dialogue: 0,0:17:51.07,0:17:51.58,Default,,0,0,0,,pixels.
Dialogue: 0,0:17:52.10,0:17:54.30,Default,,0,0,0,,It's really easy to use and
Dialogue: 0,0:17:54.33,0:17:56.00,Default,,0,0,0,,provides a substantial benefit.
Dialogue: 0,0:17:56.00,0:17:56.87,Default,,0,0,0,,All right.
Dialogue: 0,0:17:57.88,0:18:00.59,Default,,0,0,0,,That brings us to the end of our
Dialogue: 0,0:18:00.67,0:18:01.98,Default,,0,0,0,,brief journey into building a VR
Dialogue: 0,0:18:01.98,0:18:02.31,Default,,0,0,0,,app.
Dialogue: 0,0:18:02.77,0:18:03.72,Default,,0,0,0,,So, with that background
Dialogue: 0,0:18:03.72,0:18:05.26,Default,,0,0,0,,covered, I'd like to now
Dialogue: 0,0:18:05.26,0:18:06.92,Default,,0,0,0,,introduce Nat Brown from Valve
Dialogue: 0,0:18:07.00,0:18:08.84,Default,,0,0,0,,Software, to come onstage and
Dialogue: 0,0:18:08.84,0:18:10.89,Default,,0,0,0,,talk a bit more about SteamVR on
Dialogue: 0,0:18:10.89,0:18:11.39,Default,,0,0,0,,macOS.
Dialogue: 0,0:18:12.02,0:18:13.73,Default,,0,0,0,,[ Applause ]
Dialogue: 0,0:18:13.73,0:18:14.13,Default,,0,0,0,,Thanks, Nat.
Dialogue: 0,0:18:14.36,0:18:14.75,Default,,0,0,0,,>> Thanks, Rav.
Dialogue: 0,0:18:16.15,0:18:17.52,Default,,0,0,0,,Hi, everybody.
Dialogue: 0,0:18:17.57,0:18:20.49,Default,,0,0,0,,I'm Nat. I work on VR at Valve.
Dialogue: 0,0:18:20.79,0:18:22.55,Default,,0,0,0,,So, if you don't know Valve,
Dialogue: 0,0:18:22.55,0:18:24.08,Default,,0,0,0,,we're a game company.
Dialogue: 0,0:18:24.08,0:18:25.19,Default,,0,0,0,,We distribute games and we have
Dialogue: 0,0:18:25.19,0:18:28.64,Default,,0,0,0,,a community of gamers that play
Dialogue: 0,0:18:28.64,0:18:29.28,Default,,0,0,0,,on Steam.
Dialogue: 0,0:18:29.64,0:18:30.90,Default,,0,0,0,,It turns out, games are actually
Dialogue: 0,0:18:30.90,0:18:33.27,Default,,0,0,0,,a super-interesting crucible for
Dialogue: 0,0:18:33.27,0:18:34.19,Default,,0,0,0,,user interface and
Dialogue: 0,0:18:34.19,0:18:35.23,Default,,0,0,0,,human/computer interaction.
Dialogue: 0,0:18:35.68,0:18:36.77,Default,,0,0,0,,And at Valve, we do a lot of
Dialogue: 0,0:18:36.77,0:18:39.01,Default,,0,0,0,,experiments around games and
Dialogue: 0,0:18:39.01,0:18:39.31,Default,,0,0,0,,input.
Dialogue: 0,0:18:40.16,0:18:42.36,Default,,0,0,0,,So, years of VR prototypes
Dialogue: 0,0:18:42.89,0:18:44.19,Default,,0,0,0,,really didn't click, for us, for
Dialogue: 0,0:18:44.19,0:18:45.35,Default,,0,0,0,,making games or any other kind
Dialogue: 0,0:18:45.35,0:18:45.83,Default,,0,0,0,,of content.
Dialogue: 0,0:18:46.37,0:18:47.87,Default,,0,0,0,,Until we found this sweet
Dialogue: 0,0:18:47.87,0:18:50.11,Default,,0,0,0,,combination of 90 hertz low
Dialogue: 0,0:18:50.11,0:18:52.10,Default,,0,0,0,,persistence displays, accurate
Dialogue: 0,0:18:52.10,0:18:53.72,Default,,0,0,0,,room scale tracking, with two
Dialogue: 0,0:18:53.72,0:18:54.54,Default,,0,0,0,,track controllers.
Dialogue: 0,0:18:55.28,0:18:57.06,Default,,0,0,0,,We consider this a magical
Dialogue: 0,0:18:57.06,0:18:58.08,Default,,0,0,0,,threshold for VR.
Dialogue: 0,0:18:58.73,0:19:00.83,Default,,0,0,0,,I like to think of it as kind of
Dialogue: 0,0:19:00.83,0:19:02.78,Default,,0,0,0,,similar to how when you first
Dialogue: 0,0:19:03.25,0:19:04.55,Default,,0,0,0,,used a smartphone with low
Dialogue: 0,0:19:04.55,0:19:06.22,Default,,0,0,0,,latency accurate touch, it
Dialogue: 0,0:19:06.22,0:19:07.07,Default,,0,0,0,,really felt magical.
Dialogue: 0,0:19:07.40,0:19:08.54,Default,,0,0,0,,That's what this magical
Dialogue: 0,0:19:08.54,0:19:11.53,Default,,0,0,0,,threshold is, for VR.
Dialogue: 0,0:19:11.75,0:19:12.92,Default,,0,0,0,,Once room scale VR really
Dialogue: 0,0:19:12.92,0:19:14.22,Default,,0,0,0,,clicked for us, we knew that we
Dialogue: 0,0:19:14.22,0:19:16.17,Default,,0,0,0,,could build VR games and VR
Dialogue: 0,0:19:16.17,0:19:16.50,Default,,0,0,0,,content.
Dialogue: 0,0:19:17.52,0:19:19.37,Default,,0,0,0,,We license aspects of our VR
Dialogue: 0,0:19:19.37,0:19:22.30,Default,,0,0,0,,technology like base stations,
Dialogue: 0,0:19:22.47,0:19:24.69,Default,,0,0,0,,headset lens designs, and so
Dialogue: 0,0:19:24.69,0:19:26.69,Default,,0,0,0,,forth, non-exclusively to
Dialogue: 0,0:19:26.69,0:19:28.16,Default,,0,0,0,,partners like HTC and LG.
Dialogue: 0,0:19:28.16,0:19:30.02,Default,,0,0,0,,And we have a big program that
Dialogue: 0,0:19:30.02,0:19:31.49,Default,,0,0,0,,licenses Lighthouse tracking
Dialogue: 0,0:19:31.49,0:19:32.82,Default,,0,0,0,,technology to lots of different
Dialogue: 0,0:19:32.82,0:19:33.22,Default,,0,0,0,,partners.
Dialogue: 0,0:19:33.76,0:19:37.20,Default,,0,0,0,,Our approach to the software
Dialogue: 0,0:19:37.20,0:19:38.34,Default,,0,0,0,,stack you've heard a little bit
Dialogue: 0,0:19:38.34,0:19:39.91,Default,,0,0,0,,about, already, is called the
Dialogue: 0,0:19:39.91,0:19:42.19,Default,,0,0,0,,SteamVr runtime.
Dialogue: 0,0:19:42.42,0:19:43.94,Default,,0,0,0,,SteamVr has an application
Dialogue: 0,0:19:43.94,0:19:45.51,Default,,0,0,0,,model, up above, and a hardware
Dialogue: 0,0:19:45.51,0:19:46.88,Default,,0,0,0,,and driver model, down below.
Dialogue: 0,0:19:47.02,0:19:49.27,Default,,0,0,0,,Our goal here, is to promote
Dialogue: 0,0:19:49.27,0:19:50.61,Default,,0,0,0,,experiments in VR, because we're
Dialogue: 0,0:19:50.61,0:19:52.10,Default,,0,0,0,,really in the early days of what
Dialogue: 0,0:19:52.10,0:19:53.55,Default,,0,0,0,,VR is and what the content's
Dialogue: 0,0:19:53.55,0:19:55.01,Default,,0,0,0,,going to be like.
Dialogue: 0,0:19:55.55,0:19:57.24,Default,,0,0,0,,We wanted to make this model so
Dialogue: 0,0:19:57.24,0:19:58.75,Default,,0,0,0,,that people could experiment in
Dialogue: 0,0:19:58.75,0:19:59.58,Default,,0,0,0,,VR hardware and content and
Dialogue: 0,0:19:59.58,0:19:59.98,Default,,0,0,0,,reduce risk.
Dialogue: 0,0:20:00.05,0:20:03.04,Default,,0,0,0,,So, you can go out, maybe not
Dialogue: 0,0:20:03.04,0:20:04.25,Default,,0,0,0,,you, but some of you can go out
Dialogue: 0,0:20:04.54,0:20:06.19,Default,,0,0,0,,and design a new headset or a
Dialogue: 0,0:20:06.19,0:20:08.35,Default,,0,0,0,,new tracking system, or new
Dialogue: 0,0:20:08.35,0:20:08.90,Default,,0,0,0,,controllers.
Dialogue: 0,0:20:09.07,0:20:10.53,Default,,0,0,0,,And then, you can come to an
Dialogue: 0,0:20:10.53,0:20:12.15,Default,,0,0,0,,Open VR platform, and you can
Dialogue: 0,0:20:12.15,0:20:13.53,Default,,0,0,0,,write a driver that plugs right
Dialogue: 0,0:20:13.53,0:20:13.73,Default,,0,0,0,,in.
Dialogue: 0,0:20:14.04,0:20:15.12,Default,,0,0,0,,And you'll have access to all
Dialogue: 0,0:20:15.12,0:20:16.61,Default,,0,0,0,,the existing content that's
Dialogue: 0,0:20:16.61,0:20:17.34,Default,,0,0,0,,already running.
Dialogue: 0,0:20:18.06,0:20:19.60,Default,,0,0,0,,That will give you real world
Dialogue: 0,0:20:19.60,0:20:21.67,Default,,0,0,0,,tests that make your hardware
Dialogue: 0,0:20:21.67,0:20:21.97,Default,,0,0,0,,better.
Dialogue: 0,0:20:21.97,0:20:23.27,Default,,0,0,0,,Because you and your customers
Dialogue: 0,0:20:23.50,0:20:25.43,Default,,0,0,0,,can compare your new idea
Dialogue: 0,0:20:25.43,0:20:26.57,Default,,0,0,0,,directly with other hardware
Dialogue: 0,0:20:26.57,0:20:27.33,Default,,0,0,0,,that's already out there.
Dialogue: 0,0:20:27.83,0:20:29.25,Default,,0,0,0,,So, hardware developers don't
Dialogue: 0,0:20:29.25,0:20:30.57,Default,,0,0,0,,have to develop custom content
Dialogue: 0,0:20:30.92,0:20:32.21,Default,,0,0,0,,and content developers don't
Dialogue: 0,0:20:32.21,0:20:33.93,Default,,0,0,0,,have to bet on which hardware
Dialogue: 0,0:20:33.93,0:20:34.49,Default,,0,0,0,,will win.
Dialogue: 0,0:20:34.49,0:20:36.48,Default,,0,0,0,,They can just focus on making
Dialogue: 0,0:20:37.24,0:20:38.91,Default,,0,0,0,,great content.
Dialogue: 0,0:20:38.91,0:20:41.49,Default,,0,0,0,,So, applications link to the
Dialogue: 0,0:20:41.49,0:20:42.34,Default,,0,0,0,,Open VR framework.
Dialogue: 0,0:20:42.34,0:20:44.29,Default,,0,0,0,,It's a really tiny library, and
Dialogue: 0,0:20:44.29,0:20:45.79,Default,,0,0,0,,all it knows how to do is define
Dialogue: 0,0:20:46.11,0:20:47.17,Default,,0,0,0,,the runtime that's currently
Dialogue: 0,0:20:47.17,0:20:47.58,Default,,0,0,0,,installed.
Dialogue: 0,0:20:47.58,0:20:49.34,Default,,0,0,0,,So, it finds this VR client
Dialogue: 0,0:20:49.34,0:20:50.55,Default,,0,0,0,,library, that's a shared
Dialogue: 0,0:20:50.55,0:20:51.82,Default,,0,0,0,,library, and that either
Dialogue: 0,0:20:51.82,0:20:53.56,Default,,0,0,0,,connects to or launches the
Dialogue: 0,0:20:53.56,0:20:55.01,Default,,0,0,0,,other runtime processes of
Dialogue: 0,0:20:55.01,0:20:55.60,Default,,0,0,0,,SteamVr.
Dialogue: 0,0:20:56.00,0:20:57.16,Default,,0,0,0,,The vrmonitor process.
Dialogue: 0,0:20:57.16,0:20:58.52,Default,,0,0,0,,You're going to see a lot of
Dialogue: 0,0:20:58.52,0:21:00.07,Default,,0,0,0,,that little window.
Dialogue: 0,0:21:00.07,0:21:01.49,Default,,0,0,0,,It's a UI and a setting
Dialogue: 0,0:21:01.49,0:21:02.07,Default,,0,0,0,,application.
Dialogue: 0,0:21:02.07,0:21:03.59,Default,,0,0,0,,It shows you the state of any
Dialogue: 0,0:21:03.59,0:21:04.54,Default,,0,0,0,,attached headsets and
Dialogue: 0,0:21:04.54,0:21:05.89,Default,,0,0,0,,controllers, and the tracking
Dialogue: 0,0:21:05.89,0:21:06.33,Default,,0,0,0,,sensors.
Dialogue: 0,0:21:06.84,0:21:11.90,Default,,0,0,0,,The vrserver is in charge of
Dialogue: 0,0:21:12.01,0:21:13.66,Default,,0,0,0,,keeping track of drivers,
Dialogue: 0,0:21:13.84,0:21:14.98,Default,,0,0,0,,loading alternate drivers.
Dialogue: 0,0:21:14.98,0:21:16.81,Default,,0,0,0,,And it puts poses and other
Dialogue: 0,0:21:16.81,0:21:19.08,Default,,0,0,0,,information into shared memory.
Dialogue: 0,0:21:19.08,0:21:21.14,Default,,0,0,0,,So, that your application and
Dialogue: 0,0:21:21.14,0:21:22.66,Default,,0,0,0,,the rest of the SteamVR runtime
Dialogue: 0,0:21:22.71,0:21:24.84,Default,,0,0,0,,have access to it.
Dialogue: 0,0:21:25.11,0:21:26.34,Default,,0,0,0,,The vrcompositor, you just heard
Dialogue: 0,0:21:26.34,0:21:28.07,Default,,0,0,0,,a little bit about, this process
Dialogue: 0,0:21:28.28,0:21:30.70,Default,,0,0,0,,is sort of like the Windows
Dialogue: 0,0:21:30.70,0:21:31.09,Default,,0,0,0,,server.
Dialogue: 0,0:21:31.33,0:21:33.03,Default,,0,0,0,,It draws scenes and overlays to
Dialogue: 0,0:21:33.03,0:21:33.64,Default,,0,0,0,,the headset.
Dialogue: 0,0:21:33.64,0:21:35.51,Default,,0,0,0,,And it corrects images for lens
Dialogue: 0,0:21:35.54,0:21:36.67,Default,,0,0,0,,distortion, color.
Dialogue: 0,0:21:36.89,0:21:37.72,Default,,0,0,0,,And one of the things that's
Dialogue: 0,0:21:37.72,0:21:39.53,Default,,0,0,0,,sort of under the hood, that you
Dialogue: 0,0:21:39.53,0:21:42.66,Default,,0,0,0,,may not understand, is it
Dialogue: 0,0:21:42.66,0:21:43.75,Default,,0,0,0,,corrects for smearing and
Dialogue: 0,0:21:43.75,0:21:44.73,Default,,0,0,0,,ghosting under motion.
Dialogue: 0,0:21:45.09,0:21:48.51,Default,,0,0,0,,And it also, fades into a stable
Dialogue: 0,0:21:48.51,0:21:50.22,Default,,0,0,0,,tracking area when applications
Dialogue: 0,0:21:50.22,0:21:51.45,Default,,0,0,0,,fail to meet frame rate.
Dialogue: 0,0:21:51.72,0:21:52.85,Default,,0,0,0,,Because we don't want people to
Dialogue: 0,0:21:52.85,0:21:53.85,Default,,0,0,0,,fall over or bump into
Dialogue: 0,0:21:53.85,0:21:54.19,Default,,0,0,0,,something.
Dialogue: 0,0:21:54.53,0:21:55.93,Default,,0,0,0,,So, the vrcompositor
Dialogue: 0,0:21:55.93,0:21:56.95,Default,,0,0,0,,communicates with Metal, like
Dialogue: 0,0:21:56.95,0:21:57.39,Default,,0,0,0,,you heard.
Dialogue: 0,0:21:57.60,0:21:59.07,Default,,0,0,0,,It presents directly to the
Dialogue: 0,0:21:59.07,0:22:00.03,Default,,0,0,0,,headset through the Direct to
Dialogue: 0,0:22:00.03,0:22:01.55,Default,,0,0,0,,Display Metal 2 API.
Dialogue: 0,0:22:03.15,0:22:03.53,Default,,0,0,0,,Let's see.
Dialogue: 0,0:22:03.53,0:22:05.22,Default,,0,0,0,,Last, but not least, the mighty
Dialogue: 0,0:22:05.50,0:22:06.27,Default,,0,0,0,,vrdashboard.
Dialogue: 0,0:22:06.49,0:22:09.22,Default,,0,0,0,,That is a piece of UI that lets
Dialogue: 0,0:22:09.22,0:22:10.61,Default,,0,0,0,,you select applications.
Dialogue: 0,0:22:10.94,0:22:12.18,Default,,0,0,0,,It lets you control volume,
Dialogue: 0,0:22:12.58,0:22:13.64,Default,,0,0,0,,other system settings.
Dialogue: 0,0:22:14.49,0:22:16.26,Default,,0,0,0,,We provide a default one that
Dialogue: 0,0:22:16.26,0:22:17.59,Default,,0,0,0,,shows you your Steam library,
Dialogue: 0,0:22:17.59,0:22:18.61,Default,,0,0,0,,unless you choose applications.
Dialogue: 0,0:22:18.96,0:22:20.10,Default,,0,0,0,,But there's actually an API.
Dialogue: 0,0:22:20.10,0:22:21.21,Default,,0,0,0,,So, you can write your own
Dialogue: 0,0:22:21.45,0:22:22.74,Default,,0,0,0,,dashboard application, as well.
Dialogue: 0,0:22:22.97,0:22:24.65,Default,,0,0,0,,So, Valve and Apple, we started
Dialogue: 0,0:22:24.65,0:22:25.89,Default,,0,0,0,,working together more closely,
Dialogue: 0,0:22:26.09,0:22:27.34,Default,,0,0,0,,about a year ago.
Dialogue: 0,0:22:27.65,0:22:28.78,Default,,0,0,0,,And our port to Metal from
Dialogue: 0,0:22:28.78,0:22:30.29,Default,,0,0,0,,OpenGL, it didn't cost us very
Dialogue: 0,0:22:30.29,0:22:30.57,Default,,0,0,0,,much.
Dialogue: 0,0:22:30.69,0:22:31.86,Default,,0,0,0,,Metal is a really cool API.
Dialogue: 0,0:22:31.86,0:22:34.12,Default,,0,0,0,,And it was critical for us to
Dialogue: 0,0:22:34.12,0:22:35.72,Default,,0,0,0,,get VR up and performing.
Dialogue: 0,0:22:35.88,0:22:38.17,Default,,0,0,0,,Our biggest request to Apple, a
Dialogue: 0,0:22:38.17,0:22:39.84,Default,,0,0,0,,year ago, was for this Direct to
Dialogue: 0,0:22:39.84,0:22:40.54,Default,,0,0,0,,Display feature.
Dialogue: 0,0:22:40.99,0:22:42.13,Default,,0,0,0,,Because it's critical to ensure
Dialogue: 0,0:22:42.13,0:22:43.48,Default,,0,0,0,,that the VR compositor has the
Dialogue: 0,0:22:43.48,0:22:45.85,Default,,0,0,0,,fastest time predictable path to
Dialogue: 0,0:22:45.85,0:22:46.97,Default,,0,0,0,,the headset display panels.
Dialogue: 0,0:22:47.91,0:22:50.05,Default,,0,0,0,,We also, really needed super
Dialogue: 0,0:22:50.05,0:22:52.17,Default,,0,0,0,,accurate low variance VBL,
Dialogue: 0,0:22:52.28,0:22:53.61,Default,,0,0,0,,vertical blank, events.
Dialogue: 0,0:22:53.96,0:22:54.73,Default,,0,0,0,,So, that we could set the
Dialogue: 0,0:22:54.73,0:22:56.22,Default,,0,0,0,,cadence of the VR frame
Dialogue: 0,0:22:56.22,0:22:57.86,Default,,0,0,0,,presentation timing, and we
Dialogue: 0,0:22:57.86,0:22:58.94,Default,,0,0,0,,could predict those poses
Dialogue: 0,0:22:58.94,0:23:00.09,Default,,0,0,0,,accurately.
Dialogue: 0,0:23:00.32,0:23:01.74,Default,,0,0,0,,Predicting the pose accurately
Dialogue: 0,0:23:01.97,0:23:04.16,Default,,0,0,0,,is actually more important than
Dialogue: 0,0:23:04.16,0:23:06.02,Default,,0,0,0,,the time between motion happens
Dialogue: 0,0:23:06.32,0:23:07.37,Default,,0,0,0,,and when the display happens.
Dialogue: 0,0:23:07.37,0:23:08.50,Default,,0,0,0,,If we know when it's going to
Dialogue: 0,0:23:08.50,0:23:09.44,Default,,0,0,0,,be, that's actually more
Dialogue: 0,0:23:09.44,0:23:09.89,Default,,0,0,0,,important.
Dialogue: 0,0:23:10.66,0:23:12.82,Default,,0,0,0,,Finally, we hit some speed bumps
Dialogue: 0,0:23:12.82,0:23:13.84,Default,,0,0,0,,around inter-process and
Dialogue: 0,0:23:13.84,0:23:15.46,Default,,0,0,0,,inter-thread synchronization.
Dialogue: 0,0:23:15.82,0:23:17.20,Default,,0,0,0,,Once everything else was working
Dialogue: 0,0:23:17.20,0:23:18.52,Default,,0,0,0,,really well, Metal was blazing
Dialogue: 0,0:23:18.52,0:23:21.60,Default,,0,0,0,,fast, we had really tight VBL,
Dialogue: 0,0:23:21.60,0:23:22.82,Default,,0,0,0,,but we still were having some
Dialogue: 0,0:23:22.82,0:23:24.12,Default,,0,0,0,,synchronization problems.
Dialogue: 0,0:23:24.32,0:23:25.91,Default,,0,0,0,,But Apple helped us find better
Dialogue: 0,0:23:25.91,0:23:28.07,Default,,0,0,0,,ways to signal and synchronize
Dialogue: 0,0:23:28.07,0:23:29.45,Default,,0,0,0,,with low scheduling variance
Dialogue: 0,0:23:29.45,0:23:30.72,Default,,0,0,0,,between all the processes and
Dialogue: 0,0:23:30.72,0:23:31.38,Default,,0,0,0,,thread involved.
Dialogue: 0,0:23:33.29,0:23:37.42,Default,,0,0,0,,Okay. So, my diagram of a VR
Dialogue: 0,0:23:37.50,0:23:38.31,Default,,0,0,0,,frame is a little more
Dialogue: 0,0:23:38.31,0:23:39.24,Default,,0,0,0,,complicated.
Dialogue: 0,0:23:39.47,0:23:40.69,Default,,0,0,0,,Most of you are never going to
Dialogue: 0,0:23:40.69,0:23:41.78,Default,,0,0,0,,look under the hood, this far.
Dialogue: 0,0:23:41.78,0:23:42.69,Default,,0,0,0,,But I thought I'd show it to
Dialogue: 0,0:23:42.69,0:23:43.07,Default,,0,0,0,,you, anyway.
Dialogue: 0,0:23:43.56,0:23:46.75,Default,,0,0,0,,So, the low persistence OLED of
Dialogue: 0,0:23:46.75,0:23:48.65,Default,,0,0,0,,the HTC Vibe uses global
Dialogue: 0,0:23:48.65,0:23:49.13,Default,,0,0,0,,illumination.
Dialogue: 0,0:23:50.00,0:23:52.15,Default,,0,0,0,,All of the pixels of the display
Dialogue: 0,0:23:52.15,0:23:54.23,Default,,0,0,0,,flash for a tiny period, all at
Dialogue: 0,0:23:54.23,0:23:54.73,Default,,0,0,0,,once.
Dialogue: 0,0:23:54.73,0:23:56.28,Default,,0,0,0,,And this is common in VR,
Dialogue: 0,0:23:56.28,0:23:57.56,Default,,0,0,0,,because heads move really
Dialogue: 0,0:23:57.56,0:23:57.94,Default,,0,0,0,,quickly.
Dialogue: 0,0:23:58.43,0:24:00.68,Default,,0,0,0,,And we want to make sure that
Dialogue: 0,0:24:00.68,0:24:02.51,Default,,0,0,0,,the image doesn't smear or tear
Dialogue: 0,0:24:02.51,0:24:03.53,Default,,0,0,0,,in front of the user.
Dialogue: 0,0:24:03.89,0:24:05.57,Default,,0,0,0,,So, the panel illuminates for
Dialogue: 0,0:24:05.57,0:24:07.78,Default,,0,0,0,,about two milliseconds, one
Dialogue: 0,0:24:07.78,0:24:09.27,Default,,0,0,0,,frame after it is presented by
Dialogue: 0,0:24:09.27,0:24:10.97,Default,,0,0,0,,the GPU, because the panel takes
Dialogue: 0,0:24:11.04,0:24:12.33,Default,,0,0,0,,time to charge before it can do
Dialogue: 0,0:24:12.33,0:24:14.10,Default,,0,0,0,,that global illumination pulse.
Dialogue: 0,0:24:14.92,0:24:16.27,Default,,0,0,0,,So, over here, that's the
Dialogue: 0,0:24:16.27,0:24:17.08,Default,,0,0,0,,photons coming out.
Dialogue: 0,0:24:17.08,0:24:18.05,Default,,0,0,0,,We're going to follow this red
Dialogue: 0,0:24:18.11,0:24:19.25,Default,,0,0,0,,frame through this sequence.
Dialogue: 0,0:24:19.64,0:24:23.44,Default,,0,0,0,,So, way out here is the photons
Dialogue: 0,0:24:23.44,0:24:24.24,Default,,0,0,0,,coming out.
Dialogue: 0,0:24:24.84,0:24:25.92,Default,,0,0,0,,Because of this timing,
Dialogue: 0,0:24:26.32,0:24:27.71,Default,,0,0,0,,applications typically pick up a
Dialogue: 0,0:24:27.76,0:24:28.93,Default,,0,0,0,,pose, like you heard before,
Dialogue: 0,0:24:28.99,0:24:30.99,Default,,0,0,0,,from IVR compositor wakeup
Dialogue: 0,0:24:30.99,0:24:31.41,Default,,0,0,0,,poses.
Dialogue: 0,0:24:31.65,0:24:33.95,Default,,0,0,0,,So, wakeup poses stalls and
Dialogue: 0,0:24:33.95,0:24:36.10,Default,,0,0,0,,returns with a pose for that
Dialogue: 0,0:24:36.10,0:24:37.36,Default,,0,0,0,,future firing of photons.
Dialogue: 0,0:24:37.62,0:24:39.53,Default,,0,0,0,,So, the rendering is happening
Dialogue: 0,0:24:39.53,0:24:41.15,Default,,0,0,0,,here, and you present it there,
Dialogue: 0,0:24:41.37,0:24:42.39,Default,,0,0,0,,here in the middle.
Dialogue: 0,0:24:42.52,0:24:43.80,Default,,0,0,0,,But the photons don't go out
Dialogue: 0,0:24:43.80,0:24:44.06,Default,,0,0,0,,there.
Dialogue: 0,0:24:44.06,0:24:46.92,Default,,0,0,0,,So, we've had to predict a pose
Dialogue: 0,0:24:46.92,0:24:49.43,Default,,0,0,0,,about 25 milliseconds out.
Dialogue: 0,0:24:50.08,0:24:54.21,Default,,0,0,0,,So, 25 milliseconds is two
Dialogue: 0,0:24:54.21,0:24:56.21,Default,,0,0,0,,frames plus the little tiny bit
Dialogue: 0,0:24:56.37,0:24:57.19,Default,,0,0,0,,of running start.
Dialogue: 0,0:24:57.24,0:24:58.04,Default,,0,0,0,,And you heard how running
Dialogue: 0,0:24:58.04,0:25:00.52,Default,,0,0,0,,start's very important, because
Dialogue: 0,0:25:00.52,0:25:01.71,Default,,0,0,0,,we want to give you as much of
Dialogue: 0,0:25:01.71,0:25:04.15,Default,,0,0,0,,that 11 milliseconds of GPU to
Dialogue: 0,0:25:04.15,0:25:05.83,Default,,0,0,0,,get the most excellent pixels up
Dialogue: 0,0:25:05.83,0:25:07.38,Default,,0,0,0,,in front of the users, that you
Dialogue: 0,0:25:08.22,0:25:08.31,Default,,0,0,0,,can.
Dialogue: 0,0:25:08.40,0:25:11.01,Default,,0,0,0,,So, one last thing that's
Dialogue: 0,0:25:11.01,0:25:11.66,Default,,0,0,0,,happening, here.
Dialogue: 0,0:25:11.73,0:25:12.74,Default,,0,0,0,,You see this frame actually
Dialogue: 0,0:25:12.74,0:25:14.16,Default,,0,0,0,,stretches back all the way to
Dialogue: 0,0:25:14.16,0:25:14.93,Default,,0,0,0,,the beginning of the slide.
Dialogue: 0,0:25:15.42,0:25:16.91,Default,,0,0,0,,And that's because this
Dialogue: 0,0:25:16.91,0:25:19.49,Default,,0,0,0,,application, and your game
Dialogue: 0,0:25:19.49,0:25:20.53,Default,,0,0,0,,engine might be doing this under
Dialogue: 0,0:25:20.53,0:25:22.57,Default,,0,0,0,,the covers, is kind of more
Dialogue: 0,0:25:22.57,0:25:23.14,Default,,0,0,0,,complicated.
Dialogue: 0,0:25:23.36,0:25:24.73,Default,,0,0,0,,It has some physics and input
Dialogue: 0,0:25:24.73,0:25:26.59,Default,,0,0,0,,event processing, that it needs
Dialogue: 0,0:25:26.59,0:25:27.12,Default,,0,0,0,,to do.
Dialogue: 0,0:25:27.15,0:25:28.39,Default,,0,0,0,,And that's costly work that's
Dialogue: 0,0:25:28.39,0:25:29.53,Default,,0,0,0,,going to take some CPU time,
Dialogue: 0,0:25:29.53,0:25:29.92,Default,,0,0,0,,over here.
Dialogue: 0,0:25:30.50,0:25:32.05,Default,,0,0,0,,But that code actually needs
Dialogue: 0,0:25:32.11,0:25:33.29,Default,,0,0,0,,pose information, also.
Dialogue: 0,0:25:33.94,0:25:35.35,Default,,0,0,0,,It needs to know when the
Dialogue: 0,0:25:35.35,0:25:36.53,Default,,0,0,0,,buttons were pressed and where
Dialogue: 0,0:25:36.53,0:25:37.37,Default,,0,0,0,,the controllers were.
Dialogue: 0,0:25:37.37,0:25:38.46,Default,,0,0,0,,Maybe it's interpolating
Dialogue: 0,0:25:38.75,0:25:39.58,Default,,0,0,0,,something having to do with
Dialogue: 0,0:25:39.58,0:25:41.55,Default,,0,0,0,,motion, or you're blocking
Dialogue: 0,0:25:41.80,0:25:42.80,Default,,0,0,0,,something, or you're firing
Dialogue: 0,0:25:42.80,0:25:43.14,Default,,0,0,0,,something.
Dialogue: 0,0:25:43.56,0:25:47.03,Default,,0,0,0,,So, this thread actually, it's
Dialogue: 0,0:25:47.03,0:25:48.15,Default,,0,0,0,,going to wake up at around the
Dialogue: 0,0:25:48.15,0:25:49.63,Default,,0,0,0,,same time, because wakeup poses
Dialogue: 0,0:25:49.63,0:25:51.48,Default,,0,0,0,,gives it this important kind of
Dialogue: 0,0:25:51.59,0:25:52.13,Default,,0,0,0,,synch point.
Dialogue: 0,0:25:52.47,0:25:53.87,Default,,0,0,0,,But it's going to be calling a
Dialogue: 0,0:25:53.87,0:25:55.35,Default,,0,0,0,,different API, because it's
Dialogue: 0,0:25:55.35,0:25:56.76,Default,,0,0,0,,trying to get a pose much
Dialogue: 0,0:25:56.76,0:25:57.35,Default,,0,0,0,,further out.
Dialogue: 0,0:25:57.54,0:25:59.11,Default,,0,0,0,,It's looking 36 milliseconds
Dialogue: 0,0:25:59.11,0:26:00.78,Default,,0,0,0,,out, and so, it's going to be
Dialogue: 0,0:26:00.78,0:26:02.75,Default,,0,0,0,,calling the getDevice to
Dialogue: 0,0:26:02.75,0:26:04.03,Default,,0,0,0,,absolute tracking poses.
Dialogue: 0,0:26:04.41,0:26:06.95,Default,,0,0,0,,So, I tell you this just so you
Dialogue: 0,0:26:06.95,0:26:09.64,Default,,0,0,0,,know, Open VR has some pretty
Dialogue: 0,0:26:09.64,0:26:12.71,Default,,0,0,0,,deep APIs for you to tune your
Dialogue: 0,0:26:12.71,0:26:13.75,Default,,0,0,0,,applications so that you're
Dialogue: 0,0:26:13.75,0:26:15.86,Default,,0,0,0,,predicting where the headset and
Dialogue: 0,0:26:15.86,0:26:16.81,Default,,0,0,0,,where the controllers are going
Dialogue: 0,0:26:16.81,0:26:18.81,Default,,0,0,0,,to be very accurately, based on
Dialogue: 0,0:26:19.24,0:26:21.70,Default,,0,0,0,,where you need them to be, where
Dialogue: 0,0:26:21.70,0:26:23.11,Default,,0,0,0,,your code needs them to be.
Dialogue: 0,0:26:23.11,0:26:24.95,Default,,0,0,0,,So, the point of wakeup poses is
Dialogue: 0,0:26:24.95,0:26:26.53,Default,,0,0,0,,it gives you a predictable point
Dialogue: 0,0:26:26.53,0:26:28.18,Default,,0,0,0,,in time at running start, so you
Dialogue: 0,0:26:28.18,0:26:29.38,Default,,0,0,0,,always know when those photons
Dialogue: 0,0:26:29.38,0:26:30.51,Default,,0,0,0,,are going to come out.
Dialogue: 0,0:26:31.54,0:26:35.32,Default,,0,0,0,,So, last but not least, let's
Dialogue: 0,0:26:35.32,0:26:36.28,Default,,0,0,0,,talk about what you need to do
Dialogue: 0,0:26:36.28,0:26:37.43,Default,,0,0,0,,to get up and running with
Dialogue: 0,0:26:37.43,0:26:38.37,Default,,0,0,0,,SteamVr and macOS.
Dialogue: 0,0:26:38.37,0:26:39.66,Default,,0,0,0,,So, first of all, it's a tool in
Dialogue: 0,0:26:39.66,0:26:41.82,Default,,0,0,0,,Steam, as a developer gets
Dialogue: 0,0:26:41.82,0:26:43.55,Default,,0,0,0,,started by installing Steam and
Dialogue: 0,0:26:43.55,0:26:44.91,Default,,0,0,0,,registering for a free account.
Dialogue: 0,0:26:45.70,0:26:47.63,Default,,0,0,0,,And if you don't use Steam, you
Dialogue: 0,0:26:47.63,0:26:48.00,Default,,0,0,0,,should.
Dialogue: 0,0:26:49.34,0:26:51.09,Default,,0,0,0,,Next, install SteamVR itself.
Dialogue: 0,0:26:51.17,0:26:53.07,Default,,0,0,0,,SteamVR is under the Library
Dialogue: 0,0:26:53.07,0:26:53.95,Default,,0,0,0,,menu in Tools.
Dialogue: 0,0:26:54.30,0:26:56.05,Default,,0,0,0,,Search for SteamVR, right click
Dialogue: 0,0:26:56.05,0:26:58.37,Default,,0,0,0,,on it, choose the Properties,
Dialogue: 0,0:26:58.37,0:27:00.25,Default,,0,0,0,,choose the Beta tab, and opt
Dialogue: 0,0:27:00.25,0:27:00.78,Default,,0,0,0,,into the Beta.
Dialogue: 0,0:27:01.25,0:27:02.01,Default,,0,0,0,,For now, it's a beta.
Dialogue: 0,0:27:02.32,0:27:03.21,Default,,0,0,0,,Then, install it.
Dialogue: 0,0:27:03.21,0:27:04.57,Default,,0,0,0,,We'll be keeping SteamVr up to
Dialogue: 0,0:27:04.57,0:27:05.95,Default,,0,0,0,,date as we fix any bugs that you
Dialogue: 0,0:27:05.95,0:27:06.25,Default,,0,0,0,,find.
Dialogue: 0,0:27:07.17,0:27:08.35,Default,,0,0,0,,Finally, you want to download
Dialogue: 0,0:27:08.35,0:27:09.90,Default,,0,0,0,,the Open VR headers and the
Dialogue: 0,0:27:09.90,0:27:11.69,Default,,0,0,0,,framework from GitHub.
Dialogue: 0,0:27:11.69,0:27:12.80,Default,,0,0,0,,And I've put a link, right up
Dialogue: 0,0:27:12.85,0:27:15.41,Default,,0,0,0,,there, for you in the slides.
Dialogue: 0,0:27:15.56,0:27:17.10,Default,,0,0,0,,So, here's the funky part.
Dialogue: 0,0:27:17.66,0:27:18.89,Default,,0,0,0,,You need to include that Open VR
Dialogue: 0,0:27:18.89,0:27:20.77,Default,,0,0,0,,bootstrapping framework inside
Dialogue: 0,0:27:20.77,0:27:21.53,Default,,0,0,0,,of your application.
Dialogue: 0,0:27:22.11,0:27:24.17,Default,,0,0,0,,The Open VR framework that you
Dialogue: 0,0:27:24.17,0:27:25.76,Default,,0,0,0,,link to, that conveys the
Dialogue: 0,0:27:25.76,0:27:27.22,Default,,0,0,0,,version of the interfaces of the
Dialogue: 0,0:27:27.22,0:27:28.44,Default,,0,0,0,,runtime you've built and tested
Dialogue: 0,0:27:28.44,0:27:28.87,Default,,0,0,0,,against.
Dialogue: 0,0:27:29.15,0:27:30.87,Default,,0,0,0,,And that allows us to upgrade
Dialogue: 0,0:27:30.95,0:27:32.74,Default,,0,0,0,,the runtime and to version
Dialogue: 0,0:27:32.74,0:27:33.62,Default,,0,0,0,,forward, gracefully.
Dialogue: 0,0:27:33.62,0:27:35.31,Default,,0,0,0,,Because we move this forward
Dialogue: 0,0:27:35.54,0:27:36.20,Default,,0,0,0,,quite actively.
Dialogue: 0,0:27:36.39,0:27:38.38,Default,,0,0,0,,In XCode, instead of just adding
Dialogue: 0,0:27:38.38,0:27:39.15,Default,,0,0,0,,the framework to your link
Dialogue: 0,0:27:39.15,0:27:40.80,Default,,0,0,0,,phase, go into General Settings
Dialogue: 0,0:27:40.99,0:27:42.22,Default,,0,0,0,,and make it an embedded binary.
Dialogue: 0,0:27:42.22,0:27:43.79,Default,,0,0,0,,So, it will be installed into
Dialogue: 0,0:27:43.79,0:27:45.14,Default,,0,0,0,,the contents frameworks portion
Dialogue: 0,0:27:45.14,0:27:46.09,Default,,0,0,0,,of your application bundle.
Dialogue: 0,0:27:46.90,0:27:50.51,Default,,0,0,0,,Okay. Finally, we really want
Dialogue: 0,0:27:50.51,0:27:51.30,Default,,0,0,0,,your feedback.
Dialogue: 0,0:27:51.48,0:27:53.02,Default,,0,0,0,,So, we put some things right
Dialogue: 0,0:27:53.02,0:27:54.43,Default,,0,0,0,,into the UI of vrmonitor.
Dialogue: 0,0:27:54.43,0:27:56.27,Default,,0,0,0,,There's a pointer to SteamVR's
Dialogue: 0,0:27:56.27,0:27:57.76,Default,,0,0,0,,support site and the community
Dialogue: 0,0:27:57.76,0:27:58.76,Default,,0,0,0,,hardware discussions.
Dialogue: 0,0:27:59.05,0:28:00.65,Default,,0,0,0,,And you can report a bug, create
Dialogue: 0,0:28:00.65,0:28:01.98,Default,,0,0,0,,a system report, and send it to
Dialogue: 0,0:28:01.98,0:28:03.31,Default,,0,0,0,,us or probably send it to me.
Dialogue: 0,0:28:03.31,0:28:05.48,Default,,0,0,0,,You can reach me at
Dialogue: 0,0:28:05.48,0:28:07.74,Default,,0,0,0,,natb@valvesoftware.com, but I'd
Dialogue: 0,0:28:07.74,0:28:08.59,Default,,0,0,0,,rather you use the tool.
Dialogue: 0,0:28:09.20,0:28:12.40,Default,,0,0,0,,And with that, thanks very much.
Dialogue: 0,0:28:12.40,0:28:13.83,Default,,0,0,0,,I'm really looking forward to
Dialogue: 0,0:28:13.83,0:28:15.31,Default,,0,0,0,,what you guys make with VR.
Dialogue: 0,0:28:15.38,0:28:16.62,Default,,0,0,0,,And thanks, to everybody at
Dialogue: 0,0:28:16.62,0:28:18.25,Default,,0,0,0,,Apple for making VR shine on
Dialogue: 0,0:28:18.25,0:28:18.76,Default,,0,0,0,,macOS.
Dialogue: 0,0:28:19.34,0:28:19.72,Default,,0,0,0,,Thank you.
Dialogue: 0,0:28:20.52,0:28:22.64,Default,,0,0,0,,[ Applause ]
Dialogue: 0,0:28:23.14,0:28:23.58,Default,,0,0,0,,>> Thanks, Nat.
Dialogue: 0,0:28:24.89,0:28:25.93,Default,,0,0,0,,It's been great working with
Dialogue: 0,0:28:25.93,0:28:27.38,Default,,0,0,0,,Valve, and I'm still astounded
Dialogue: 0,0:28:27.38,0:28:28.24,Default,,0,0,0,,about what we've been able to
Dialogue: 0,0:28:28.24,0:28:29.64,Default,,0,0,0,,achieve, over the last year.
Dialogue: 0,0:28:31.21,0:28:31.82,Default,,0,0,0,,All right.
Dialogue: 0,0:28:31.82,0:28:33.51,Default,,0,0,0,,Let's move on to talk about the
Dialogue: 0,0:28:33.51,0:28:35.47,Default,,0,0,0,,external GPU support that we've
Dialogue: 0,0:28:35.47,0:28:37.30,Default,,0,0,0,,added with macOS High Sierra.
Dialogue: 0,0:28:37.99,0:28:40.82,Default,,0,0,0,,So, an external GPU is a
Dialogue: 0,0:28:40.82,0:28:42.20,Default,,0,0,0,,standalone chassis with a
Dialogue: 0,0:28:42.31,0:28:44.44,Default,,0,0,0,,desktop class GPU in it, that
Dialogue: 0,0:28:44.44,0:28:47.15,Default,,0,0,0,,you can plug directly to your
Dialogue: 0,0:28:47.15,0:28:48.93,Default,,0,0,0,,host system via Thunderbolt.
Dialogue: 0,0:28:49.86,0:28:52.19,Default,,0,0,0,,And as noted previously, the
Dialogue: 0,0:28:52.47,0:28:54.22,Default,,0,0,0,,primary motivation here, was to
Dialogue: 0,0:28:54.22,0:28:55.88,Default,,0,0,0,,enable developers like you to
Dialogue: 0,0:28:55.88,0:28:58.17,Default,,0,0,0,,build great VR apps using a
Dialogue: 0,0:28:58.26,0:28:59.94,Default,,0,0,0,,broader range of Mac hardware.
Dialogue: 0,0:29:00.69,0:29:02.20,Default,,0,0,0,,There's a great workflow story,
Dialogue: 0,0:29:02.20,0:29:03.44,Default,,0,0,0,,here, where you can use your
Dialogue: 0,0:29:03.44,0:29:06.00,Default,,0,0,0,,MacBook Pro with an external GPU
Dialogue: 0,0:29:06.24,0:29:07.95,Default,,0,0,0,,to get the rendering horsepower
Dialogue: 0,0:29:07.95,0:29:08.70,Default,,0,0,0,,that you need for VR.
Dialogue: 0,0:29:08.70,0:29:11.47,Default,,0,0,0,,But of course, there's also
Dialogue: 0,0:29:11.47,0:29:12.90,Default,,0,0,0,,additional performance benefit
Dialogue: 0,0:29:12.94,0:29:15.09,Default,,0,0,0,,to be had for other GPU bound
Dialogue: 0,0:29:15.09,0:29:17.51,Default,,0,0,0,,cases, like games and pro apps,
Dialogue: 0,0:29:17.51,0:29:17.98,Default,,0,0,0,,as well.
Dialogue: 0,0:29:18.58,0:29:22.71,Default,,0,0,0,,And as you saw on Monday, we've
Dialogue: 0,0:29:22.71,0:29:24.25,Default,,0,0,0,,been partnering with Sonnet and
Dialogue: 0,0:29:24.25,0:29:26.43,Default,,0,0,0,,AMD to offer you an external
Dialogue: 0,0:29:26.43,0:29:28.67,Default,,0,0,0,,graphics developer kit with an
Dialogue: 0,0:29:28.71,0:29:32.23,Default,,0,0,0,,AMD Radeon RX-580 GPU in it.
Dialogue: 0,0:29:32.56,0:29:34.62,Default,,0,0,0,,This kit is optimized for use
Dialogue: 0,0:29:34.62,0:29:36.11,Default,,0,0,0,,with all our Thunderbolt 3
Dialogue: 0,0:29:36.11,0:29:37.97,Default,,0,0,0,,capable Macs, and is available
Dialogue: 0,0:29:37.97,0:29:38.91,Default,,0,0,0,,for purchase through our
Dialogue: 0,0:29:38.91,0:29:40.63,Default,,0,0,0,,developer program, today.
Dialogue: 0,0:29:41.24,0:29:41.97,Default,,0,0,0,,All right.
Dialogue: 0,0:29:42.25,0:29:44.07,Default,,0,0,0,,Let's dive right into how you
Dialogue: 0,0:29:44.07,0:29:45.85,Default,,0,0,0,,identify the external GPU.
Dialogue: 0,0:29:46.56,0:29:48.12,Default,,0,0,0,,This device enumeration code
Dialogue: 0,0:29:48.12,0:29:49.20,Default,,0,0,0,,should look very familiar to
Dialogue: 0,0:29:49.25,0:29:49.48,Default,,0,0,0,,you.
Dialogue: 0,0:29:50.62,0:29:52.65,Default,,0,0,0,,CopyAllDevices will give you all
Dialogue: 0,0:29:52.65,0:29:54.17,Default,,0,0,0,,the Metal devices in the system.
Dialogue: 0,0:29:54.91,0:29:56.34,Default,,0,0,0,,And then, you can identify the
Dialogue: 0,0:29:56.34,0:29:58.63,Default,,0,0,0,,external GPU by simply looking
Dialogue: 0,0:29:58.63,0:30:00.58,Default,,0,0,0,,for the removable property in
Dialogue: 0,0:30:00.58,0:30:00.98,Default,,0,0,0,,the device.
Dialogue: 0,0:30:01.98,0:30:03.47,Default,,0,0,0,,This is very similar to how you
Dialogue: 0,0:30:03.55,0:30:04.94,Default,,0,0,0,,previously identified the low
Dialogue: 0,0:30:04.94,0:30:06.65,Default,,0,0,0,,power devices on our platforms.
Dialogue: 0,0:30:06.65,0:30:10.34,Default,,0,0,0,,Now, let's talk a bit about
Dialogue: 0,0:30:10.34,0:30:11.25,Default,,0,0,0,,Thunderbolt bandwidth
Dialogue: 0,0:30:11.28,0:30:12.07,Default,,0,0,0,,capabilities.
Dialogue: 0,0:30:12.82,0:30:15.09,Default,,0,0,0,,So, Thunderbolt 3 offers twice
Dialogue: 0,0:30:15.15,0:30:16.39,Default,,0,0,0,,the theoretical bandwidth of
Dialogue: 0,0:30:16.44,0:30:18.33,Default,,0,0,0,,Thunderbolt 2, which is great.
Dialogue: 0,0:30:19.17,0:30:20.41,Default,,0,0,0,,But you have to keep in mind
Dialogue: 0,0:30:20.41,0:30:21.81,Default,,0,0,0,,that this is still a quarter the
Dialogue: 0,0:30:21.81,0:30:24.06,Default,,0,0,0,,bandwidth of the PCI bus
Dialogue: 0,0:30:24.31,0:30:25.96,Default,,0,0,0,,available to the internal GPUs
Dialogue: 0,0:30:25.96,0:30:27.12,Default,,0,0,0,,in our platforms.
Dialogue: 0,0:30:28.36,0:30:29.29,Default,,0,0,0,,So, this is important.
Dialogue: 0,0:30:29.91,0:30:31.59,Default,,0,0,0,,You have a choice, now, between
Dialogue: 0,0:30:31.59,0:30:33.90,Default,,0,0,0,,using the internal GPU with a
Dialogue: 0,0:30:34.01,0:30:36.43,Default,,0,0,0,,high bandwidth link, or a high
Dialogue: 0,0:30:36.52,0:30:38.66,Default,,0,0,0,,performance external GPU with a
Dialogue: 0,0:30:38.66,0:30:39.93,Default,,0,0,0,,link at about a quarter the
Dialogue: 0,0:30:39.93,0:30:40.47,Default,,0,0,0,,bandwidth.
Dialogue: 0,0:30:41.13,0:30:43.54,Default,,0,0,0,,So, you need to treat the link
Dialogue: 0,0:30:43.54,0:30:45.06,Default,,0,0,0,,and the GPU as a pair when
Dialogue: 0,0:30:45.06,0:30:47.49,Default,,0,0,0,,deciding which GPU you use.
Dialogue: 0,0:30:48.82,0:30:50.61,Default,,0,0,0,,Additionally, users can now
Dialogue: 0,0:30:50.61,0:30:52.71,Default,,0,0,0,,attach displays to different
Dialogue: 0,0:30:52.71,0:30:52.90,Default,,0,0,0,,GPUs.
Dialogue: 0,0:30:52.90,0:30:55.75,Default,,0,0,0,,And in this environment, there's
Dialogue: 0,0:30:55.75,0:30:57.75,Default,,0,0,0,,a penalty to render on one GPU
Dialogue: 0,0:30:58.01,0:30:59.58,Default,,0,0,0,,and then, display on another, as
Dialogue: 0,0:30:59.58,0:31:00.52,Default,,0,0,0,,that date needs to be
Dialogue: 0,0:31:00.52,0:31:02.23,Default,,0,0,0,,transferred across the link.
Dialogue: 0,0:31:03.74,0:31:05.05,Default,,0,0,0,,So, where your content is
Dialogue: 0,0:31:05.11,0:31:08.95,Default,,0,0,0,,displayed clearly is a huge
Dialogue: 0,0:31:08.95,0:31:10.53,Default,,0,0,0,,consideration when you decide
Dialogue: 0,0:31:10.65,0:31:12.18,Default,,0,0,0,,which GPU you want to use, as
Dialogue: 0,0:31:12.18,0:31:12.41,Default,,0,0,0,,well.
Dialogue: 0,0:31:13.61,0:31:14.21,Default,,0,0,0,,So, there's additional
Dialogue: 0,0:31:14.21,0:31:15.11,Default,,0,0,0,,complexity, here.
Dialogue: 0,0:31:15.86,0:31:16.81,Default,,0,0,0,,But fortunately, there's a
Dialogue: 0,0:31:16.87,0:31:18.57,Default,,0,0,0,,couple simple things that you
Dialogue: 0,0:31:18.57,0:31:20.16,Default,,0,0,0,,can do to make your app a good
Dialogue: 0,0:31:20.22,0:31:21.66,Default,,0,0,0,,citizen in a multi-GPU
Dialogue: 0,0:31:21.66,0:31:22.20,Default,,0,0,0,,environment.
Dialogue: 0,0:31:23.14,0:31:24.12,Default,,0,0,0,,So, let's start with GPU
Dialogue: 0,0:31:24.17,0:31:24.75,Default,,0,0,0,,selection.
Dialogue: 0,0:31:25.65,0:31:27.07,Default,,0,0,0,,The best advice that we can give
Dialogue: 0,0:31:27.07,0:31:29.84,Default,,0,0,0,,you is to render on the same GPU
Dialogue: 0,0:31:29.84,0:31:31.52,Default,,0,0,0,,that's driving the display your
Dialogue: 0,0:31:31.52,0:31:31.92,Default,,0,0,0,,app is on.
Dialogue: 0,0:31:32.51,0:31:34.31,Default,,0,0,0,,I call this the golden rule of
Dialogue: 0,0:31:34.31,0:31:35.12,Default,,0,0,0,,GPU selection.
Dialogue: 0,0:31:36.22,0:31:37.36,Default,,0,0,0,,So, let's extend this and build
Dialogue: 0,0:31:37.36,0:31:38.31,Default,,0,0,0,,a decision tree.
Dialogue: 0,0:31:39.76,0:31:41.19,Default,,0,0,0,,So, if the content your app is
Dialogue: 0,0:31:41.23,0:31:43.23,Default,,0,0,0,,rendering will be presented to a
Dialogue: 0,0:31:43.23,0:31:46.01,Default,,0,0,0,,display, you want to select the
Dialogue: 0,0:31:46.66,0:31:48.44,Default,,0,0,0,,GPU that's driving that display.
Dialogue: 0,0:31:48.66,0:31:49.60,Default,,0,0,0,,This is our golden rule.
Dialogue: 0,0:31:50.78,0:31:51.94,Default,,0,0,0,,However, if your app is doing
Dialogue: 0,0:31:51.98,0:31:53.99,Default,,0,0,0,,compute or other offline
Dialogue: 0,0:31:53.99,0:31:55.96,Default,,0,0,0,,rendering operations, then you
Dialogue: 0,0:31:55.96,0:31:57.62,Default,,0,0,0,,need to decide if you prefer to
Dialogue: 0,0:31:57.62,0:31:59.53,Default,,0,0,0,,use the low power GPU is it's
Dialogue: 0,0:31:59.53,0:32:00.12,Default,,0,0,0,,available.
Dialogue: 0,0:32:01.13,0:32:02.65,Default,,0,0,0,,This can be particularly useful
Dialogue: 0,0:32:02.65,0:32:04.01,Default,,0,0,0,,on our portables, where
Dialogue: 0,0:32:04.28,0:32:05.60,Default,,0,0,0,,selecting this device can have a
Dialogue: 0,0:32:05.67,0:32:07.14,Default,,0,0,0,,substantial battery savings.
Dialogue: 0,0:32:07.92,0:32:09.07,Default,,0,0,0,,But of course, if you need the
Dialogue: 0,0:32:09.07,0:32:11.19,Default,,0,0,0,,GPU horsepower for things like
Dialogue: 0,0:32:11.19,0:32:12.55,Default,,0,0,0,,VR, you're going to want to
Dialogue: 0,0:32:12.55,0:32:14.22,Default,,0,0,0,,select the external GPU.
Dialogue: 0,0:32:14.22,0:32:17.13,Default,,0,0,0,,So, let's get back to our golden
Dialogue: 0,0:32:17.13,0:32:19.26,Default,,0,0,0,,rule and find out how you
Dialogue: 0,0:32:19.26,0:32:21.20,Default,,0,0,0,,identify the Metal device that's
Dialogue: 0,0:32:21.20,0:32:22.56,Default,,0,0,0,,driving a particular display.
Dialogue: 0,0:32:23.87,0:32:24.81,Default,,0,0,0,,Well, it turns out that this is
Dialogue: 0,0:32:24.88,0:32:25.77,Default,,0,0,0,,really easy to do.
Dialogue: 0,0:32:26.50,0:32:27.58,Default,,0,0,0,,There's an existing core
Dialogue: 0,0:32:27.58,0:32:29.42,Default,,0,0,0,,graphics API that will give you
Dialogue: 0,0:32:29.42,0:32:30.18,Default,,0,0,0,,this device.
Dialogue: 0,0:32:31.00,0:32:32.65,Default,,0,0,0,,You simply have to get the ID
Dialogue: 0,0:32:33.22,0:32:34.59,Default,,0,0,0,,for the display that your window
Dialogue: 0,0:32:34.59,0:32:36.03,Default,,0,0,0,,is on, by querying the
Dialogue: 0,0:32:36.03,0:32:36.91,Default,,0,0,0,,NSScreenNumber.
Dialogue: 0,0:32:37.64,0:32:39.52,Default,,0,0,0,,And then, call
Dialogue: 0,0:32:39.58,0:32:42.12,Default,,0,0,0,,CGDirectDisplayCopyCurrentMetal
Dialogue: 0,0:32:42.12,0:32:44.08,Default,,0,0,0,,Device to get the Metal device
Dialogue: 0,0:32:44.15,0:32:45.35,Default,,0,0,0,,that's driving that display.
Dialogue: 0,0:32:46.04,0:32:46.61,Default,,0,0,0,,It's that simple.
Dialogue: 0,0:32:46.61,0:32:47.31,Default,,0,0,0,,All right.
Dialogue: 0,0:32:49.24,0:32:51.59,Default,,0,0,0,,Now, that we've established that
Dialogue: 0,0:32:51.59,0:32:53.06,Default,,0,0,0,,each display can be attached to
Dialogue: 0,0:32:53.06,0:32:55.35,Default,,0,0,0,,a different GPU, your app will
Dialogue: 0,0:32:55.35,0:32:57.66,Default,,0,0,0,,need to handle GPU migration as
Dialogue: 0,0:32:57.66,0:32:58.71,Default,,0,0,0,,your displays are moved.
Dialogue: 0,0:32:59.12,0:33:00.57,Default,,0,0,0,,Sorry, as your window is moved
Dialogue: 0,0:33:00.57,0:33:01.71,Default,,0,0,0,,across those displays.
Dialogue: 0,0:33:03.78,0:33:05.59,Default,,0,0,0,,So, you can do that by
Dialogue: 0,0:33:05.66,0:33:07.65,Default,,0,0,0,,registering for the new, well,
Dialogue: 0,0:33:07.65,0:33:08.95,Default,,0,0,0,,it's not new, our existing
Dialogue: 0,0:33:09.38,0:33:10.93,Default,,0,0,0,,notification handler called
Dialogue: 0,0:33:11.21,0:33:12.90,Default,,0,0,0,,WindowDidChangeScreen.
Dialogue: 0,0:33:12.90,0:33:14.42,Default,,0,0,0,,So, let's take a look at what
Dialogue: 0,0:33:14.42,0:33:15.83,Default,,0,0,0,,you do with this notification
Dialogue: 0,0:33:15.83,0:33:16.15,Default,,0,0,0,,handler.
Dialogue: 0,0:33:16.41,0:33:18.51,Default,,0,0,0,,So, you'll want to start by
Dialogue: 0,0:33:18.60,0:33:21.41,Default,,0,0,0,,finding the Metal device for the
Dialogue: 0,0:33:21.41,0:33:23.29,Default,,0,0,0,,display your app is now on, by
Dialogue: 0,0:33:23.29,0:33:24.63,Default,,0,0,0,,calling the core graphics API
Dialogue: 0,0:33:24.63,0:33:26.20,Default,,0,0,0,,that we previously discussed.
Dialogue: 0,0:33:27.48,0:33:28.59,Default,,0,0,0,,You can early out if it's the
Dialogue: 0,0:33:28.59,0:33:29.65,Default,,0,0,0,,same device that you're
Dialogue: 0,0:33:29.69,0:33:31.11,Default,,0,0,0,,currently rendering to, since no
Dialogue: 0,0:33:31.11,0:33:33.04,Default,,0,0,0,,GPU migration will be required.
Dialogue: 0,0:33:33.04,0:33:35.34,Default,,0,0,0,,And then, you'll want to perform
Dialogue: 0,0:33:35.57,0:33:37.61,Default,,0,0,0,,your device migration and switch
Dialogue: 0,0:33:37.61,0:33:39.32,Default,,0,0,0,,to using the new device for all
Dialogue: 0,0:33:39.32,0:33:39.97,Default,,0,0,0,,your rendering.
Dialogue: 0,0:33:41.02,0:33:43.24,Default,,0,0,0,,So, that's how you use a display
Dialogue: 0,0:33:43.24,0:33:45.25,Default,,0,0,0,,change notification to handle
Dialogue: 0,0:33:45.25,0:33:46.38,Default,,0,0,0,,GPU migration.
Dialogue: 0,0:33:46.38,0:33:48.17,Default,,0,0,0,,But what about the case where
Dialogue: 0,0:33:48.17,0:33:50.08,Default,,0,0,0,,the external GPU is plugged in,
Dialogue: 0,0:33:50.37,0:33:51.76,Default,,0,0,0,,or unplugged from your system?
Dialogue: 0,0:33:53.12,0:33:54.79,Default,,0,0,0,,Well, Metal 2 introduces three
Dialogue: 0,0:33:54.79,0:33:56.53,Default,,0,0,0,,new notifications to help you
Dialogue: 0,0:33:56.53,0:33:57.15,Default,,0,0,0,,with this case.
Dialogue: 0,0:33:58.32,0:34:01.02,Default,,0,0,0,,These are DeviceWasAdded when an
Dialogue: 0,0:34:01.02,0:34:02.62,Default,,0,0,0,,external GPU was plugged in,
Dialogue: 0,0:34:03.73,0:34:05.08,Default,,0,0,0,,DeviceWasRemoved when it's
Dialogue: 0,0:34:05.12,0:34:06.34,Default,,0,0,0,,unplugged, and
Dialogue: 0,0:34:06.34,0:34:08.74,Default,,0,0,0,,DeviceRemovalRequested when the
Dialogue: 0,0:34:08.74,0:34:10.90,Default,,0,0,0,,OS signals an intent to remove a
Dialogue: 0,0:34:10.90,0:34:12.80,Default,,0,0,0,,GPU at some point in the future.
Dialogue: 0,0:34:14.24,0:34:15.41,Default,,0,0,0,,So, let's take a look at how you
Dialogue: 0,0:34:15.41,0:34:16.72,Default,,0,0,0,,would register for, and then,
Dialogue: 0,0:34:16.72,0:34:18.71,Default,,0,0,0,,respond to these notifications.
Dialogue: 0,0:34:19.82,0:34:21.32,Default,,0,0,0,,So, you'll want to use the new
Dialogue: 0,0:34:21.42,0:34:24.02,Default,,0,0,0,,CopyAllDevicesWithObserver API
Dialogue: 0,0:34:24.69,0:34:25.79,Default,,0,0,0,,that we've introduced with Metal
Dialogue: 0,0:34:25.79,0:34:26.09,Default,,0,0,0,,2.
Dialogue: 0,0:34:26.85,0:34:27.94,Default,,0,0,0,,This will let you register a
Dialogue: 0,0:34:28.05,0:34:30.42,Default,,0,0,0,,handler for these new device
Dialogue: 0,0:34:30.42,0:34:31.69,Default,,0,0,0,,change notifications.
Dialogue: 0,0:34:32.69,0:34:34.14,Default,,0,0,0,,In this case, we're simply
Dialogue: 0,0:34:34.14,0:34:35.54,Default,,0,0,0,,invoking a function called
Dialogue: 0,0:34:35.90,0:34:37.27,Default,,0,0,0,,handleGPUHotPlug.
Dialogue: 0,0:34:37.98,0:34:38.88,Default,,0,0,0,,So, let's take a look at it.
Dialogue: 0,0:34:39.67,0:34:41.13,Default,,0,0,0,,It's really straightforward.
Dialogue: 0,0:34:41.62,0:34:43.45,Default,,0,0,0,,All you have to do is check for
Dialogue: 0,0:34:43.45,0:34:45.22,Default,,0,0,0,,and directly respond to each
Dialogue: 0,0:34:45.22,0:34:45.95,Default,,0,0,0,,notification.
Dialogue: 0,0:34:46.69,0:34:47.68,Default,,0,0,0,,But I want to point out a couple
Dialogue: 0,0:34:47.68,0:34:48.28,Default,,0,0,0,,of things, here.
Dialogue: 0,0:34:49.32,0:34:50.97,Default,,0,0,0,,The first is that your app
Dialogue: 0,0:34:50.97,0:34:51.90,Default,,0,0,0,,should treat the
Dialogue: 0,0:34:51.95,0:34:53.44,Default,,0,0,0,,DeviceRemovalRequested
Dialogue: 0,0:34:53.44,0:34:55.70,Default,,0,0,0,,notification as a hint to start
Dialogue: 0,0:34:55.80,0:34:57.97,Default,,0,0,0,,migrating off the external GPU.
Dialogue: 0,0:34:58.45,0:35:02.22,Default,,0,0,0,,And second, if your app did not
Dialogue: 0,0:35:02.22,0:35:02.80,Default,,0,0,0,,receive the
Dialogue: 0,0:35:02.80,0:35:04.12,Default,,0,0,0,,DeviceRemovalRequested
Dialogue: 0,0:35:04.12,0:35:06.02,Default,,0,0,0,,notification, then it should
Dialogue: 0,0:35:06.02,0:35:08.19,Default,,0,0,0,,treat DeviceWasRemoved as an
Dialogue: 0,0:35:08.29,0:35:10.25,Default,,0,0,0,,unexpected GPU removal.
Dialogue: 0,0:35:10.83,0:35:13.65,Default,,0,0,0,,So, an unexpected GPU removal is
Dialogue: 0,0:35:13.65,0:35:15.32,Default,,0,0,0,,when your external GPU is
Dialogue: 0,0:35:15.44,0:35:17.04,Default,,0,0,0,,disconnected or powered down
Dialogue: 0,0:35:17.16,0:35:18.57,Default,,0,0,0,,without the OS being aware.
Dialogue: 0,0:35:19.93,0:35:20.99,Default,,0,0,0,,So, this is the equivalent of
Dialogue: 0,0:35:20.99,0:35:22.20,Default,,0,0,0,,somebody reaching into your
Dialogue: 0,0:35:22.20,0:35:24.12,Default,,0,0,0,,system and yanking out that GPU.
Dialogue: 0,0:35:24.90,0:35:26.13,Default,,0,0,0,,And since the hardware is no
Dialogue: 0,0:35:26.13,0:35:28.29,Default,,0,0,0,,longer there, some Metal API
Dialogue: 0,0:35:28.29,0:35:30.09,Default,,0,0,0,,calls will start returning
Dialogue: 0,0:35:30.09,0:35:30.50,Default,,0,0,0,,errors.
Dialogue: 0,0:35:30.65,0:35:32.49,Default,,0,0,0,,So, you'll want to add defensive
Dialogue: 0,0:35:32.54,0:35:33.99,Default,,0,0,0,,code to your app to protect
Dialogue: 0,0:35:33.99,0:35:34.56,Default,,0,0,0,,against this.
Dialogue: 0,0:35:35.15,0:35:36.52,Default,,0,0,0,,So, it can survive until it
Dialogue: 0,0:35:36.62,0:35:37.79,Default,,0,0,0,,receives a migration
Dialogue: 0,0:35:37.79,0:35:39.24,Default,,0,0,0,,notification and it can
Dialogue: 0,0:35:39.24,0:35:41.08,Default,,0,0,0,,gracefully switch to another GPU
Dialogue: 0,0:35:41.08,0:35:41.70,Default,,0,0,0,,in the system.
Dialogue: 0,0:35:42.88,0:35:44.12,Default,,0,0,0,,It's also worth pointing out
Dialogue: 0,0:35:44.30,0:35:45.76,Default,,0,0,0,,that if you had any transient
Dialogue: 0,0:35:45.76,0:35:47.92,Default,,0,0,0,,data on the external GPU's local
Dialogue: 0,0:35:47.92,0:35:49.65,Default,,0,0,0,,memory, your app may need to
Dialogue: 0,0:35:49.65,0:35:50.93,Default,,0,0,0,,regenerate this, as it's no
Dialogue: 0,0:35:50.93,0:35:51.39,Default,,0,0,0,,longer there.
Dialogue: 0,0:35:51.39,0:35:52.07,Default,,0,0,0,,All right.
Dialogue: 0,0:35:53.35,0:35:55.67,Default,,0,0,0,,Now, on to some best practices.
Dialogue: 0,0:35:56.46,0:35:57.92,Default,,0,0,0,,So, we recommend that you don't
Dialogue: 0,0:35:57.92,0:35:59.72,Default,,0,0,0,,immediately release devices
Dialogue: 0,0:35:59.97,0:36:02.47,Default,,0,0,0,,after you migrate, as users tend
Dialogue: 0,0:36:02.47,0:36:04.11,Default,,0,0,0,,to move windows back and forth
Dialogue: 0,0:36:04.11,0:36:05.07,Default,,0,0,0,,across displays.
Dialogue: 0,0:36:05.95,0:36:08.36,Default,,0,0,0,,Instead, employ a lazy teardown
Dialogue: 0,0:36:08.43,0:36:10.13,Default,,0,0,0,,policy with some reasonable
Dialogue: 0,0:36:10.28,0:36:10.64,Default,,0,0,0,,timeout.
Dialogue: 0,0:36:12.14,0:36:14.57,Default,,0,0,0,,Additionally, if your app has a
Dialogue: 0,0:36:14.57,0:36:16.94,Default,,0,0,0,,complex UI with a number of
Dialogue: 0,0:36:16.94,0:36:19.37,Default,,0,0,0,,windows, you may, may, need to
Dialogue: 0,0:36:19.37,0:36:21.48,Default,,0,0,0,,handle GPU migrations separately
Dialogue: 0,0:36:21.53,0:36:22.31,Default,,0,0,0,,for each window.
Dialogue: 0,0:36:23.43,0:36:25.53,Default,,0,0,0,,And then, finally, we recommend
Dialogue: 0,0:36:25.53,0:36:27.09,Default,,0,0,0,,that you profile your app in
Dialogue: 0,0:36:27.09,0:36:29.52,Default,,0,0,0,,multi-GPU situations, to ensure
Dialogue: 0,0:36:29.52,0:36:30.74,Default,,0,0,0,,that you're not needlessly
Dialogue: 0,0:36:30.74,0:36:32.36,Default,,0,0,0,,transferring data back and
Dialogue: 0,0:36:32.43,0:36:35.99,Default,,0,0,0,,forth, across the GPUs.
Dialogue: 0,0:36:36.19,0:36:36.45,Default,,0,0,0,,All right.
Dialogue: 0,0:36:36.70,0:36:38.20,Default,,0,0,0,,Let's tie it back to VR with
Dialogue: 0,0:36:38.20,0:36:39.82,Default,,0,0,0,,some best practices specific to
Dialogue: 0,0:36:39.82,0:36:40.68,Default,,0,0,0,,this use case.
Dialogue: 0,0:36:41.82,0:36:44.16,Default,,0,0,0,,First and most obvious, make
Dialogue: 0,0:36:44.16,0:36:45.62,Default,,0,0,0,,sure you attach the VR headset
Dialogue: 0,0:36:45.74,0:36:47.54,Default,,0,0,0,,directly to the external GPU.
Dialogue: 0,0:36:48.84,0:36:50.08,Default,,0,0,0,,Less obvious, but equally
Dialogue: 0,0:36:50.08,0:36:51.77,Default,,0,0,0,,important, you want to make sure
Dialogue: 0,0:36:51.77,0:36:53.26,Default,,0,0,0,,that your app is presenting its
Dialogue: 0,0:36:53.26,0:36:56.26,Default,,0,0,0,,UI or the mirrored VR content to
Dialogue: 0,0:36:56.26,0:36:57.75,Default,,0,0,0,,a display that's also being
Dialogue: 0,0:36:57.75,0:36:59.34,Default,,0,0,0,,driven by the external GPU.
Dialogue: 0,0:37:00.04,0:37:01.21,Default,,0,0,0,,This will ensure that both the
Dialogue: 0,0:37:01.21,0:37:03.63,Default,,0,0,0,,VR compositor and your app are
Dialogue: 0,0:37:03.63,0:37:05.32,Default,,0,0,0,,rendering with the external GPU.
Dialogue: 0,0:37:05.91,0:37:08.40,Default,,0,0,0,,And finally, make sure you cache
Dialogue: 0,0:37:08.40,0:37:10.85,Default,,0,0,0,,as many resources as possible on
Dialogue: 0,0:37:10.85,0:37:12.56,Default,,0,0,0,,the external GPU's local memory,
Dialogue: 0,0:37:12.91,0:37:14.23,Default,,0,0,0,,so that you're not streaming
Dialogue: 0,0:37:14.23,0:37:15.42,Default,,0,0,0,,data across the Thunderbolt
Dialogue: 0,0:37:15.42,0:37:17.02,Default,,0,0,0,,link, unless absolutely
Dialogue: 0,0:37:17.02,0:37:17.60,Default,,0,0,0,,required.
Dialogue: 0,0:37:18.22,0:37:19.24,Default,,0,0,0,,All right.
Dialogue: 0,0:37:20.38,0:37:22.10,Default,,0,0,0,,So, this brings us to the end of
Dialogue: 0,0:37:22.10,0:37:22.83,Default,,0,0,0,,our session.
Dialogue: 0,0:37:23.05,0:37:24.39,Default,,0,0,0,,So, let's quickly review what
Dialogue: 0,0:37:24.39,0:37:25.20,Default,,0,0,0,,we've covered, today.
Dialogue: 0,0:37:25.48,0:37:27.68,Default,,0,0,0,,So, the big news is that you can
Dialogue: 0,0:37:27.68,0:37:29.53,Default,,0,0,0,,now, develop VR content on
Dialogue: 0,0:37:29.53,0:37:30.32,Default,,0,0,0,,macOS.
Dialogue: 0,0:37:31.38,0:37:32.89,Default,,0,0,0,,We've added built-in support for
Dialogue: 0,0:37:33.13,0:37:34.72,Default,,0,0,0,,the HTC Vibe headset.
Dialogue: 0,0:37:35.34,0:37:37.37,Default,,0,0,0,,And we've partnered with Valve
Dialogue: 0,0:37:37.37,0:37:39.30,Default,,0,0,0,,to enable an optimized version,
Dialogue: 0,0:37:39.55,0:37:41.05,Default,,0,0,0,,an optimized Metal version of
Dialogue: 0,0:37:41.05,0:37:43.11,Default,,0,0,0,,the SteamVR runtime on our
Dialogue: 0,0:37:43.11,0:37:43.58,Default,,0,0,0,,platform.
Dialogue: 0,0:37:44.97,0:37:46.22,Default,,0,0,0,,Additionally, two of the most
Dialogue: 0,0:37:46.31,0:37:48.49,Default,,0,0,0,,popular game engines, Unity and
Dialogue: 0,0:37:48.49,0:37:50.57,Default,,0,0,0,,Unreal Engine 4 will be bringing
Dialogue: 0,0:37:50.64,0:37:52.60,Default,,0,0,0,,VR support to the Mac, in the
Dialogue: 0,0:37:52.60,0:37:53.28,Default,,0,0,0,,near future.
Dialogue: 0,0:37:53.77,0:37:55.41,Default,,0,0,0,,But of course, we also encourage
Dialogue: 0,0:37:55.41,0:37:56.81,Default,,0,0,0,,you to build your own native VR
Dialogue: 0,0:37:56.81,0:37:57.30,Default,,0,0,0,,app.
Dialogue: 0,0:37:58.13,0:37:59.73,Default,,0,0,0,,And finally, we added support
Dialogue: 0,0:37:59.73,0:38:00.63,Default,,0,0,0,,for external GPUs.
Dialogue: 0,0:38:00.63,0:38:02.85,Default,,0,0,0,,And we hope that this motivates
Dialogue: 0,0:38:02.85,0:38:04.61,Default,,0,0,0,,you to ensure that your app is a
Dialogue: 0,0:38:04.75,0:38:06.95,Default,,0,0,0,,good citizen in a multi-GPU
Dialogue: 0,0:38:06.95,0:38:08.33,Default,,0,0,0,,environment, so that you can
Dialogue: 0,0:38:08.38,0:38:09.38,Default,,0,0,0,,take advantage of that
Dialogue: 0,0:38:09.38,0:38:10.71,Default,,0,0,0,,additional GPU horsepower.
Dialogue: 0,0:38:12.70,0:38:14.75,Default,,0,0,0,,We're really excited to see what
Dialogue: 0,0:38:14.75,0:38:15.70,Default,,0,0,0,,you guys are going to be able to
Dialogue: 0,0:38:15.70,0:38:17.21,Default,,0,0,0,,build with this new technology.
Dialogue: 0,0:38:18.44,0:38:19.40,Default,,0,0,0,,So, be sure to check out the
Dialogue: 0,0:38:19.40,0:38:20.41,Default,,0,0,0,,other sessions on the Metal
Dialogue: 0,0:38:20.41,0:38:20.76,Default,,0,0,0,,Track.
Dialogue: 0,0:38:21.09,0:38:22.67,Default,,0,0,0,,We had a great Introducing Metal
Dialogue: 0,0:38:22.67,0:38:23.71,Default,,0,0,0,,2 session, yesterday.
Dialogue: 0,0:38:23.71,0:38:24.83,Default,,0,0,0,,If you didn't get a chance to
Dialogue: 0,0:38:24.93,0:38:26.13,Default,,0,0,0,,see it, I encourage you to watch
Dialogue: 0,0:38:26.18,0:38:27.19,Default,,0,0,0,,the video online.
Dialogue: 0,0:38:28.08,0:38:29.47,Default,,0,0,0,,We have two additional sessions
Dialogue: 0,0:38:29.47,0:38:30.77,Default,,0,0,0,,in the afternoon, tomorrow,
Dialogue: 0,0:38:31.34,0:38:32.73,Default,,0,0,0,,Metal 2 Optimization and
Dialogue: 0,0:38:32.73,0:38:34.70,Default,,0,0,0,,Debugging, and Using Metal 2 for
Dialogue: 0,0:38:34.70,0:38:35.14,Default,,0,0,0,,Compute.
Dialogue: 0,0:38:35.33,0:38:36.64,Default,,0,0,0,,We hope to see you, there.
Dialogue: 0,0:38:37.52,0:38:38.20,Default,,0,0,0,,I'll see you, there.
Dialogue: 0,0:38:38.20,0:38:39.29,Default,,0,0,0,,Thank you, very much, and have a
Dialogue: 0,0:38:39.34,0:38:40.48,Default,,0,0,0,,great WWDC.
Dialogue: 0,0:38:41.02,0:38:43.00,Default,,0,0,0,,[ Applause ]
